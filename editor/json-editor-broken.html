<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WireMock JSON Studio</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/default.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/matchesonscrollbar.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/json-lint.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/jump-to-line.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsonpath@1.1.1/jsonpath.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WireMock JSON Studio</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/default.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/matchesonscrollbar.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/json-lint.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/jump-to-line.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.js"></script>
<style>
    :root {
        --bg-primary: #ffffff;
        --bg-secondary: #f8f9fa;
        --bg-tertiary: #e9ecef;
        --bg-quaternary: #dee2e6;
        --text-primary: #212529;
        --text-secondary: #6c757d;
        --text-muted: #868e96;
        --border-color: #dee2e6;
        --border-light: #f1f3f4;
        --button-bg: #007bff;
        --button-hover: #0056b3;
        --success-color: #28a745;
        --error-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #17a2b8;
        --purple-color: #6f42c1;
        --handlebars-color: #ff6b35;
        --jsonpath-color: #00d4aa;
        --shadow: 0 2px 4px rgba(0,0,0,0.1);
        --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
    }

    [data-theme="dark"] {
        --bg-primary: #1a1a1a;
        --bg-secondary: #2d2d2d;
        --bg-tertiary: #404040;
        --bg-quaternary: #555555;
        --text-primary: #ffffff;
        --text-secondary: #b0b0b0;
        --text-muted: #888888;
        --border-color: #555555;
        --border-light: #444444;
        --button-bg: #0d6efd;
        --button-hover: #0b5ed7;
        --success-color: #198754;
        --error-color: #dc3545;
        --warning-color: #fd7e14;
        --info-color: #0dcaf0;
        --purple-color: #8b5cf6;
        --handlebars-color: #ff8c69;
        --jsonpath-color: #4ecdc4;
        --shadow: 0 2px 4px rgba(0,0,0,0.3);
        --shadow-lg: 0 10px 25px rgba(0,0,0,0.4);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        height: 100vh;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .app-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    .header {
        background: var(--bg-secondary);
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        box-shadow: var(--shadow);
        z-index: 100;
    }

    .header h1 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .logo {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, var(--button-bg), var(--purple-color));
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 14px;
    }

    .mode-tabs {
        display: flex;
        background: var(--bg-tertiary);
        border-radius: 8px;
        padding: 4px;
        gap: 2px;
    }

    .mode-tab {
        padding: 0.5rem 1rem;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        cursor: pointer;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s ease;
        position: relative;
    }

    .mode-tab.active {
        background: var(--bg-primary);
        color: var(--text-primary);
        box-shadow: var(--shadow);
    }

    .mode-tab:hover:not(.active) {
        background: var(--bg-quaternary);
        color: var(--text-primary);
    }

    .header-controls {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        white-space: nowrap;
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-primary {
        background: var(--button-bg);
        color: white;
    }

    .btn-primary:hover:not(:disabled) {
        background: var(--button-hover);
        transform: translateY(-1px);
    }

    .btn-secondary {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }

    .btn-secondary:hover:not(:disabled) {
        background: var(--bg-quaternary);
        transform: translateY(-1px);
    }

    .btn-success {
        background: var(--success-color);
        color: white;
    }

    .btn-warning {
        background: var(--warning-color);
        color: #000;
    }

    .btn-error {
        background: var(--error-color);
        color: white;
    }

    .btn-group {
        display: flex;
        gap: 2px;
        background: var(--bg-tertiary);
        border-radius: 6px;
        padding: 2px;
    }

    .btn-group .btn {
        border-radius: 4px;
        margin: 0;
    }

    .theme-toggle {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .theme-toggle:hover {
        background: var(--bg-quaternary);
        transform: scale(1.1);
    }

    .toolbar {
        background: var(--bg-secondary);
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .toolbar-section {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .view-controls {
        display: flex;
        gap: 2px;
        background: var(--bg-tertiary);
        border-radius: 6px;
        padding: 2px;
    }

    .view-btn {
        padding: 0.4rem 0.8rem;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        cursor: pointer;
        border-radius: 4px;
        font-size: 0.85rem;
        transition: all 0.2s ease;
    }

    .view-btn.active {
        background: var(--bg-primary);
        color: var(--text-primary);
        box-shadow: var(--shadow);
    }

    .view-btn:hover:not(.active) {
        background: var(--bg-quaternary);
        color: var(--text-primary);
    }

    .search-container {
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .search-input {
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 0.9rem;
        width: 200px;
    }

    .search-input::placeholder {
        color: var(--text-muted);
    }

    .search-mode-toggle {
        padding: 0.4rem 0.6rem;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .search-mode-toggle.jsonpath {
        background: var(--jsonpath-color);
        color: white;
        border-color: var(--jsonpath-color);
    }

    .main-content {
        flex: 1;
        display: flex;
        overflow: hidden;
        position: relative;
    }

    .editor-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .editor-wrapper {
        flex: 1;
        position: relative;
        background: var(--bg-primary);
    }

    .tree-view {
        display: none;
        padding: 1rem;
        overflow-y: auto;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        line-height: 1.6;
    }

    .tree-view.active {
        display: block;
    }

    .preview-view {
        display: none;
        padding: 1rem;
        overflow-y: auto;
    }

    .preview-view.active {
        display: block;
    }

    .CodeMirror {
        height: 100% !important;
        font-size: 14px;
        line-height: 1.6;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }

    .cm-handlebars {
        color: var(--handlebars-color) !important;
        font-weight: bold;
        background: rgba(255, 107, 53, 0.1);
        border-radius: 3px;
    }

    .compare-container {
        display: none;
        flex: 1;
    }

    .compare-container.active {
        display: flex;
    }

    .compare-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--border-color);
    }

    .compare-panel:last-child {
        border-right: none;
    }

    .compare-header {
        background: var(--bg-secondary);
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .compare-title {
        font-weight: 600;
        color: var(--text-primary);
    }

    .templates-panel {
        display: none;
        background: var(--bg-secondary);
        padding: 1.5rem;
        border-bottom: 1px solid var(--border-color);
        box-shadow: var(--shadow);
    }

    .templates-panel.show {
        display: block;
    }

    .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }

    .template-card {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .template-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--button-bg), var(--purple-color));
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .template-card:hover {
        border-color: var(--button-bg);
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .template-card:hover::before {
        transform: scaleX(1);
    }

    .template-title {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }

    .template-desc {
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.5;
    }

    .template-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: var(--info-color);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .status-bar {
        background: var(--bg-secondary);
        padding: 0.5rem 1rem;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
        color: var(--text-secondary);
        flex-wrap: wrap;
        gap: 1rem;
    }

    .status-section {
        display: flex;
        gap: 1.5rem;
        align-items: center;
    }

    .status-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--success-color);
    }

    .status-indicator.error {
        background: var(--error-color);
    }

    .status-indicator.warning {
        background: var(--warning-color);
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        backdrop-filter: blur(4px);
    }

    .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: var(--bg-primary);
        border-radius: 12px;
        width: 95%;
        height: 90%;
        max-width: 1400px;
        display: flex;
        flex-direction: column;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
    }

    .modal.fullscreen .modal-content {
        width: 100%;
        height: 100%;
        border-radius: 0;
    }

    .modal-header {
        background: var(--bg-secondary);
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .modal-controls {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .modal-body {
        flex: 1;
        display: flex;
        overflow: hidden;
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 1001;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        box-shadow: var(--shadow-lg);
        max-width: 350px;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification.success {
        background: var(--success-color);
    }

    .notification.error {
        background: var(--error-color);
    }

    .notification.warning {
        background: var(--warning-color);
        color: #000;
    }

    .notification.info {
        background: var(--info-color);
    }

    .history-panel {
        position: absolute;
        top: 0;
        right: -300px;
        width: 300px;
        height: 100%;
        background: var(--bg-secondary);
        border-left: 1px solid var(--border-color);
        transition: right 0.3s ease;
        z-index: 50;
        box-shadow: var(--shadow-lg);
        display: flex;
        flex-direction: column;
    }

    .history-panel.show {
        right: 0;
    }

    .history-header {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .history-list {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
    }

    .history-item {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .history-item:hover {
        border-color: var(--button-bg);
        transform: translateX(-2px);
    }

    .history-item.current {
        border-color: var(--success-color);
        background: var(--bg-tertiary);
    }

    .history-time {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
    }

    .history-preview {
        font-size: 0.85rem;
        color: var(--text-secondary);
        max-height: 60px;
        overflow: hidden;
        line-height: 1.4;
    }

    .drag-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 123, 255, 0.1);
        border: 2px dashed var(--button-bg);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 100;
        backdrop-filter: blur(2px);
    }

    .drag-overlay.show {
        display: flex;
    }

    .drag-text {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--button-bg);
        text-align: center;
    }

    .tree-node {
        margin-left: 1rem;
        padding: 0.25rem 0;
    }

    .tree-key {
        color: var(--purple-color);
        font-weight: 600;
        cursor: pointer;
    }

    .tree-key:hover {
        background: var(--bg-tertiary);
        border-radius: 3px;
    }

    .tree-value {
        color: var(--text-primary);
        margin-left: 0.5rem;
    }

    .tree-value.string {
        color: var(--success-color);
    }

    .tree-value.number {
        color: var(--info-color);
    }

    .tree-value.boolean {
        color: var(--warning-color);
    }

    .tree-value.null {
        color: var(--text-muted);
    }

    .tree-toggle {
        cursor: pointer;
        user-select: none;
        color: var(--text-muted);
        margin-right: 0.25rem;
    }

    .tree-children {
        margin-left: 1rem;
    }

    .tree-children.collapsed {
        display: none;
    }

    .preview-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .preview-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .preview-content {
        color: var(--text-secondary);
        line-height: 1.5;
    }

    .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 0 0 6px 6px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
    }

    .search-results.show {
        display: block;
    }

    .search-result {
        padding: 0.5rem;
        border-bottom: 1px solid var(--border-light);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .search-result:hover {
        background: var(--bg-tertiary);
    }

    .search-result:last-child {
        border-bottom: none;
    }

    .search-path {
        font-weight: 500;
        color: var(--text-primary);
    }

    .search-value {
        color: var(--text-secondary);
        font-size: 0.85rem;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    @media (max-width: 768px) {
        .header {
            flex-direction: column;
            gap: 0.5rem;
        }

        .header-controls,
        .toolbar-section {
            width: 100%;
            justify-content: center;
        }

        .modal-content {
            width: 98%;
            height: 95%;
        }

        .history-panel {
            width: 280px;
        }

        .templates-grid {
            grid-template-columns: 1fr;
        }

        .search-input {
            width: 150px;
        }
    }

    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: var(--bg-tertiary);
    }

    ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary);
    }

    .fade-in {
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
</style>
</head>
<body data-theme="light">
<div class="app-container">
    <header class="header">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div class="logo">WM</div>
            <h1>WireMock JSON Studio</h1>
            <div class="mode-tabs">
                <button class="mode-tab active" data-mode="create" onclick="switchMode('create')">
                    üìù Create
                </button>
                <button class="mode-tab" data-mode="edit" onclick="switchMode('edit')">
                    ‚úèÔ∏è Edit
                </button>
                <button class="mode-tab" data-mode="compare" onclick="switchMode('compare')">
                    üîç Compare
                </button>
            </div>
        </div>
        
        <div class="header-controls">
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="undoChange()" title="Undo (Ctrl+Z)" id="undoBtn" disabled>
                    ‚Ü∂ Undo
                </button>
                <button class="btn btn-secondary" onclick="redoChange()" title="Redo (Ctrl+Y)" id="redoBtn" disabled>
                    ‚Ü∑ Redo
                </button>
            </div>
            
            <button class="btn btn-secondary" onclick="toggleHistory()" title="History">
                üìö History
            </button>
            
            <button class="btn btn-primary" onclick="openFullscreen()" title="Fullscreen (F11)">
                ‚õ∂ Fullscreen
            </button>
            
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                üåô
            </button>
        </div>
    </header>

    <div class="templates-panel" id="templatesPanel">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3>WireMock Stub Templates</h3>
            <button class="btn btn-secondary" onclick="toggleTemplates()">
                ‚úï Close
            </button>
        </div>
        <div class="templates-grid" id="templatesGrid">
        </div>
    </div>

    <div class="toolbar">
        <div class="toolbar-section">
            <div class="btn-group" id="createEditControls">
                <button class="btn btn-secondary" onclick="newDocument()" title="New (Ctrl+N)">
                    üìÑ New
                </button>
                <button class="btn btn-secondary" onclick="openFile()" title="Open (Ctrl+O)">
                    üìÅ Open
                </button>
                <button class="btn btn-secondary" onclick="saveFile()" title="Save (Ctrl+S)">
                    üíæ Save
                </button>
            </div>

            <div class="btn-group" id="formatControls">
                <button class="btn btn-primary" onclick="formatJSON()" title="Format (Ctrl+Enter)">
                    ‚ú® Format
                </button>
                <button class="btn btn-success" onclick="validateJSON()" title="Validate">
                    ‚úÖ Validate
                </button>
                <button class="btn btn-secondary" onclick="compactJSON()" title="Compact">
                    üì¶ Compact
                </button>
                <button class="btn btn-secondary" onclick="clearEditor()" title="Clear">
                    üóëÔ∏è Clear
                </button>
            </div>

            <div class="btn-group" id="actionControls">
                <button class="btn btn-secondary" onclick="copyContent()" title="Copy (Ctrl+C)">
                    üìã Copy
                </button>
                <button class="btn btn-secondary" onclick="downloadJSON()" title="Download">
                    ‚¨áÔ∏è Download
                </button>
            </div>

            <button class="btn btn-warning" onclick="toggleTemplates()" id="templatesBtn" title="Templates">
                üìã Templates
            </button>
        </div>

        <div class="toolbar-section">
            <div class="search-container">
                <button class="search-mode-toggle" id="searchModeToggle" onclick="toggleSearchMode()" title="Toggle search mode">
                    TEXT
                </button>
                <input type="text" class="search-input" id="searchInput" placeholder="Search text..." 
                       onkeyup="performSearch()" onfocus="showSearchResults()" onblur="hideSearchResults()">
                <button class="btn btn-secondary" onclick="clearSearch()" title="Clear search">
                    üóëÔ∏è
                </button>
                <div class="search-results" id="searchResults">
                </div>
            </div>
            
            <div class="view-controls">
                <button class="view-btn active" data-view="code" onclick="switchView('code')">Code</button>
                <button class="view-btn" data-view="tree" onclick="switchView('tree')">Tree</button>
                <button class="view-btn" data-view="preview" onclick="switchView('preview')">Preview</button>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div class="drag-overlay" id="dragOverlay">
            <div class="drag-text">
                üìÅ Drop JSON files here
            </div>
        </div>

        <div class="editor-container" id="singleEditor">
            <div class="editor-wrapper">
                <textarea id="mainEditor" placeholder="Paste your WireMock JSON stub here..."></textarea>
                <div class="tree-view" id="treeView">
                </div>
                <div class="preview-view" id="previewView">
                </div>
            </div>
        </div>

        <div class="compare-container" id="compareContainer">
            <div class="compare-panel">
                <div class="compare-header">
                    <div class="compare-title">Original</div>
                    <div>
                        <button class="btn btn-secondary" onclick="loadCompareFile('left')" title="Load file">
                            üìÅ Load
                        </button>
                        <button class="btn btn-secondary" onclick="clearComparePanel('left')" title="Clear">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <textarea id="compareLeft" placeholder="Paste original JSON here..."></textarea>
                    <div class="tree-view" id="treeViewLeft">
                    </div>
                    <div class="preview-view" id="previewViewLeft">
                    </div>
                </div>
            </div>
            <div class="compare-panel">
                <div class="compare-header">
                    <div class="compare-title">Modified</div>
                    <div>
                        <button class="btn btn-secondary" onclick="loadCompareFile('right')" title="Load file">
                            üìÅ Load
                        </button>
                        <button class="btn btn-secondary" onclick="clearComparePanel('right')" title="Clear">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <textarea id="compareRight" placeholder="Paste modified JSON here..."></textarea>
                    <div class="tree-view" id="treeViewRight">
                    </div>
                    <div class="preview-view" id="previewViewRight">
                    </div>
                </div>
            </div>
        </div>

        <div class="history-panel" id="historyPanel">
            <div class="history-header">
                <h3>History</h3>
                <button class="btn btn-secondary" onclick="toggleHistory()">‚úï</button>
            </div>
            <div class="history-list" id="historyList">
            </div>
        </div>
    </main>

    <div class="status-bar">
        <div class="status-section">
            <div class="status-item">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">Ready</span>
            </div>
            <div class="status-item">
                <span id="modeText">Create Mode</span>
            </div>
        </div>
        
        <div class="status-section">
            <div class="status-item">
                <span id="charCount">0 characters</span>
            </div>
            <div class="status-item">
                <span id="lineCount">0 lines</span>
            </div>
            <div class="status-item">
                <span id="cursorPos">Ln 1, Col 1</span>
            </div>
            <div class="status-item">
                <span id="viewMode">Code View</span>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="fullscreenModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">WireMock JSON Studio - Fullscreen</div>
            <div class="modal-controls">
                <div class="view-controls">
                    <button class="view-btn active" data-view="code" onclick="switchModalView('code')">Code</button>
                    <button class="view-btn" data-view="tree" onclick="switchModalView('tree')">Tree</button>
                    <button class="view-btn" data-view="preview" onclick="switchModalView('preview')">Preview</button>
                </div>
                <button class="btn btn-primary" onclick="formatModalJSON()">‚ú® Format</button>
                <button class="btn btn-secondary" onclick="toggleModalFullscreen()" title="Toggle Fullscreen (ESC)">
                    ‚õ∂
                </button>
                <button class="btn btn-secondary" onclick="closeFullscreen()" title="Close">‚úï</button>
            </div>
        </div>
        <div class="modal-body">
            <div class="editor-wrapper">
                <textarea id="modalEditor" placeholder="Your JSON content..."></textarea>
                <div class="tree-view" id="modalTreeView">
                </div>
                <div class="preview-view" id="modalPreviewView">
                </div>
            </div>
        </div>
    </div>
</div>

<input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileLoad(event)">
<input type="file" id="compareFileInput" accept=".json" style="display: none;" onchange="handleCompareFileLoad(event)">, value: obj }];
        
        const results = [];
        
        function traverse(current, currentPath, remainingPath) {
            if (!remainingPath) {
                results.push({ path: currentPath, value: current });
                return;
            }
            
            const parts = remainingPath.split('.');
            const firstPart = parts[0];
            const restPath = parts.slice(1).join('.');
            
            if (firstPart === '*') {
                // Wildcard - match all properties
                if (typeof current === 'object' && current !== null) {
                    Object.keys(current).forEach(key => {
                        traverse(current[key], currentPath + '.' + key, restPath);
                    });
                }
            } else if (firstPart.includes('[') && firstPart.includes(']')) {
                // Array index notation like "items[0]"
                const arrayName = firstPart.split('[')[0];
                const indexMatch = firstPart.match(/\[(\d+)\]/);
                if (indexMatch && current[arrayName]) {
                    const index = parseInt(indexMatch[1]);
                    if (Array.isArray(current[arrayName]) && current[arrayName][index] !== undefined) {
                        traverse(current[arrayName][index], currentPath + '.' + arrayName + '[' + index + ']', restPath);
                    }
                }
            } else {
                // Regular property access
                if (current && typeof current === 'object' && current[firstPart] !== undefined) {
                    traverse(current[firstPart], currentPath + '.' + firstPart, restPath);
                }
            }
        }
        
        traverse(obj, '<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WireMock JSON Studio</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/default.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/matchesonscrollbar.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/json-lint.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/jump-to-line.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.js"></script>
<style>
    :root {
        --bg-primary: #ffffff;
        --bg-secondary: #f8f9fa;
        --bg-tertiary: #e9ecef;
        --bg-quaternary: #dee2e6;
        --text-primary: #212529;
        --text-secondary: #6c757d;
        --text-muted: #868e96;
        --border-color: #dee2e6;
        --border-light: #f1f3f4;
        --button-bg: #007bff;
        --button-hover: #0056b3;
        --success-color: #28a745;
        --error-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #17a2b8;
        --purple-color: #6f42c1;
        --handlebars-color: #ff6b35;
        --jsonpath-color: #00d4aa;
        --shadow: 0 2px 4px rgba(0,0,0,0.1);
        --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
    }

    [data-theme="dark"] {
        --bg-primary: #1a1a1a;
        --bg-secondary: #2d2d2d;
        --bg-tertiary: #404040;
        --bg-quaternary: #555555;
        --text-primary: #ffffff;
        --text-secondary: #b0b0b0;
        --text-muted: #888888;
        --border-color: #555555;
        --border-light: #444444;
        --button-bg: #0d6efd;
        --button-hover: #0b5ed7;
        --success-color: #198754;
        --error-color: #dc3545;
        --warning-color: #fd7e14;
        --info-color: #0dcaf0;
        --purple-color: #8b5cf6;
        --handlebars-color: #ff8c69;
        --jsonpath-color: #4ecdc4;
        --shadow: 0 2px 4px rgba(0,0,0,0.3);
        --shadow-lg: 0 10px 25px rgba(0,0,0,0.4);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        height: 100vh;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .app-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    .header {
        background: var(--bg-secondary);
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        box-shadow: var(--shadow);
        z-index: 100;
    }

    .header h1 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .logo {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, var(--button-bg), var(--purple-color));
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 14px;
    }

    .mode-tabs {
        display: flex;
        background: var(--bg-tertiary);
        border-radius: 8px;
        padding: 4px;
        gap: 2px;
    }

    .mode-tab {
        padding: 0.5rem 1rem;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        cursor: pointer;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s ease;
        position: relative;
    }

    .mode-tab.active {
        background: var(--bg-primary);
        color: var(--text-primary);
        box-shadow: var(--shadow);
    }

    .mode-tab:hover:not(.active) {
        background: var(--bg-quaternary);
        color: var(--text-primary);
    }

    .header-controls {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        white-space: nowrap;
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-primary {
        background: var(--button-bg);
        color: white;
    }

    .btn-primary:hover:not(:disabled) {
        background: var(--button-hover);
        transform: translateY(-1px);
    }

    .btn-secondary {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }

    .btn-secondary:hover:not(:disabled) {
        background: var(--bg-quaternary);
        transform: translateY(-1px);
    }

    .btn-success {
        background: var(--success-color);
        color: white;
    }

    .btn-warning {
        background: var(--warning-color);
        color: #000;
    }

    .btn-error {
        background: var(--error-color);
        color: white;
    }

    .btn-group {
        display: flex;
        gap: 2px;
        background: var(--bg-tertiary);
        border-radius: 6px;
        padding: 2px;
    }

    .btn-group .btn {
        border-radius: 4px;
        margin: 0;
    }

    .theme-toggle {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .theme-toggle:hover {
        background: var(--bg-quaternary);
        transform: scale(1.1);
    }

    .toolbar {
        background: var(--bg-secondary);
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .toolbar-section {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .view-controls {
        display: flex;
        gap: 2px;
        background: var(--bg-tertiary);
        border-radius: 6px;
        padding: 2px;
    }

    .view-btn {
        padding: 0.4rem 0.8rem;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        cursor: pointer;
        border-radius: 4px;
        font-size: 0.85rem;
        transition: all 0.2s ease;
    }

    .view-btn.active {
        background: var(--bg-primary);
        color: var(--text-primary);
        box-shadow: var(--shadow);
    }

    .view-btn:hover:not(.active) {
        background: var(--bg-quaternary);
        color: var(--text-primary);
    }

    .search-container {
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .search-input {
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 0.9rem;
        width: 200px;
    }

    .search-input::placeholder {
        color: var(--text-muted);
    }

    .search-mode-toggle {
        padding: 0.4rem 0.6rem;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .search-mode-toggle.jsonpath {
        background: var(--jsonpath-color);
        color: white;
        border-color: var(--jsonpath-color);
    }

    .main-content {
        flex: 1;
        display: flex;
        overflow: hidden;
        position: relative;
    }

    .editor-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .editor-wrapper {
        flex: 1;
        position: relative;
        background: var(--bg-primary);
    }

    .tree-view {
        display: none;
        padding: 1rem;
        overflow-y: auto;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        line-height: 1.6;
    }

    .tree-view.active {
        display: block;
    }

    .preview-view {
        display: none;
        padding: 1rem;
        overflow-y: auto;
    }

    .preview-view.active {
        display: block;
    }

    .CodeMirror {
        height: 100% !important;
        font-size: 14px;
        line-height: 1.6;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }

    .cm-handlebars {
        color: var(--handlebars-color) !important;
        font-weight: bold;
        background: rgba(255, 107, 53, 0.1);
        border-radius: 3px;
    }

    .compare-container {
        display: none;
        flex: 1;
    }

    .compare-container.active {
        display: flex;
    }

    .compare-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--border-color);
    }

    .compare-panel:last-child {
        border-right: none;
    }

    .compare-header {
        background: var(--bg-secondary);
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .compare-title {
        font-weight: 600;
        color: var(--text-primary);
    }

    .templates-panel {
        display: none;
        background: var(--bg-secondary);
        padding: 1.5rem;
        border-bottom: 1px solid var(--border-color);
        box-shadow: var(--shadow);
    }

    .templates-panel.show {
        display: block;
    }

    .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }

    .template-card {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .template-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--button-bg), var(--purple-color));
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .template-card:hover {
        border-color: var(--button-bg);
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .template-card:hover::before {
        transform: scaleX(1);
    }

    .template-title {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }

    .template-desc {
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.5;
    }

    .template-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: var(--info-color);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .status-bar {
        background: var(--bg-secondary);
        padding: 0.5rem 1rem;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
        color: var(--text-secondary);
        flex-wrap: wrap;
        gap: 1rem;
    }

    .status-section {
        display: flex;
        gap: 1.5rem;
        align-items: center;
    }

    .status-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--success-color);
    }

    .status-indicator.error {
        background: var(--error-color);
    }

    .status-indicator.warning {
        background: var(--warning-color);
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        backdrop-filter: blur(4px);
    }

    .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: var(--bg-primary);
        border-radius: 12px;
        width: 95%;
        height: 90%;
        max-width: 1400px;
        display: flex;
        flex-direction: column;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
    }

    .modal.fullscreen .modal-content {
        width: 100%;
        height: 100%;
        border-radius: 0;
    }

    .modal-header {
        background: var(--bg-secondary);
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .modal-controls {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .modal-body {
        flex: 1;
        display: flex;
        overflow: hidden;
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 1001;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        box-shadow: var(--shadow-lg);
        max-width: 350px;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification.success {
        background: var(--success-color);
    }

    .notification.error {
        background: var(--error-color);
    }

    .notification.warning {
        background: var(--warning-color);
        color: #000;
    }

    .notification.info {
        background: var(--info-color);
    }

    .history-panel {
        position: absolute;
        top: 0;
        right: -300px;
        width: 300px;
        height: 100%;
        background: var(--bg-secondary);
        border-left: 1px solid var(--border-color);
        transition: right 0.3s ease;
        z-index: 50;
        box-shadow: var(--shadow-lg);
        display: flex;
        flex-direction: column;
    }

    .history-panel.show {
        right: 0;
    }

    .history-header {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .history-list {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
    }

    .history-item {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .history-item:hover {
        border-color: var(--button-bg);
        transform: translateX(-2px);
    }

    .history-item.current {
        border-color: var(--success-color);
        background: var(--bg-tertiary);
    }

    .history-time {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
    }

    .history-preview {
        font-size: 0.85rem;
        color: var(--text-secondary);
        max-height: 60px;
        overflow: hidden;
        line-height: 1.4;
    }

    .drag-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 123, 255, 0.1);
        border: 2px dashed var(--button-bg);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 100;
        backdrop-filter: blur(2px);
    }

    .drag-overlay.show {
        display: flex;
    }

    .drag-text {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--button-bg);
        text-align: center;
    }

    .tree-node {
        margin-left: 1rem;
        padding: 0.25rem 0;
    }

    .tree-key {
        color: var(--purple-color);
        font-weight: 600;
        cursor: pointer;
    }

    .tree-key:hover {
        background: var(--bg-tertiary);
        border-radius: 3px;
    }

    .tree-value {
        color: var(--text-primary);
        margin-left: 0.5rem;
    }

    .tree-value.string {
        color: var(--success-color);
    }

    .tree-value.number {
        color: var(--info-color);
    }

    .tree-value.boolean {
        color: var(--warning-color);
    }

    .tree-value.null {
        color: var(--text-muted);
    }

    .tree-toggle {
        cursor: pointer;
        user-select: none;
        color: var(--text-muted);
        margin-right: 0.25rem;
    }

    .tree-children {
        margin-left: 1rem;
    }

    .tree-children.collapsed {
        display: none;
    }

    .preview-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .preview-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .preview-content {
        color: var(--text-secondary);
        line-height: 1.5;
    }

    .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 0 0 6px 6px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
    }

    .search-results.show {
        display: block;
    }

    .search-result {
        padding: 0.5rem;
        border-bottom: 1px solid var(--border-light);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .search-result:hover {
        background: var(--bg-tertiary);
    }

    .search-result:last-child {
        border-bottom: none;
    }

    .search-path {
        font-weight: 500;
        color: var(--text-primary);
    }

    .search-value {
        color: var(--text-secondary);
        font-size: 0.85rem;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    @media (max-width: 768px) {
        .header {
            flex-direction: column;
            gap: 0.5rem;
        }

        .header-controls,
        .toolbar-section {
            width: 100%;
            justify-content: center;
        }

        .modal-content {
            width: 98%;
            height: 95%;
        }

        .history-panel {
            width: 280px;
        }

        .templates-grid {
            grid-template-columns: 1fr;
        }

        .search-input {
            width: 150px;
        }
    }

    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: var(--bg-tertiary);
    }

    ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary);
    }

    .fade-in {
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
</style>
</head>
<body data-theme="light">
<div class="app-container">
    <header class="header">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div class="logo">WM</div>
            <h1>WireMock JSON Studio</h1>
            <div class="mode-tabs">
                <button class="mode-tab active" data-mode="create" onclick="switchMode('create')">
                    üìù Create
                </button>
                <button class="mode-tab" data-mode="edit" onclick="switchMode('edit')">
                    ‚úèÔ∏è Edit
                </button>
                <button class="mode-tab" data-mode="compare" onclick="switchMode('compare')">
                    üîç Compare
                </button>
            </div>
        </div>
        
        <div class="header-controls">
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="undoChange()" title="Undo (Ctrl+Z)" id="undoBtn" disabled>
                    ‚Ü∂ Undo
                </button>
                <button class="btn btn-secondary" onclick="redoChange()" title="Redo (Ctrl+Y)" id="redoBtn" disabled>
                    ‚Ü∑ Redo
                </button>
            </div>
            
            <button class="btn btn-secondary" onclick="toggleHistory()" title="History">
                üìö History
            </button>
            
            <button class="btn btn-primary" onclick="openFullscreen()" title="Fullscreen (F11)">
                ‚õ∂ Fullscreen
            </button>
            
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                üåô
            </button>
        </div>
    </header>

    <div class="templates-panel" id="templatesPanel">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3>WireMock Stub Templates</h3>
            <button class="btn btn-secondary" onclick="toggleTemplates()">
                ‚úï Close
            </button>
        </div>
        <div class="templates-grid" id="templatesGrid">
        </div>
    </div>

    <div class="toolbar">
        <div class="toolbar-section">
            <div class="btn-group" id="createEditControls">
                <button class="btn btn-secondary" onclick="newDocument()" title="New (Ctrl+N)">
                    üìÑ New
                </button>
                <button class="btn btn-secondary" onclick="openFile()" title="Open (Ctrl+O)">
                    üìÅ Open
                </button>
                <button class="btn btn-secondary" onclick="saveFile()" title="Save (Ctrl+S)">
                    üíæ Save
                </button>
            </div>

            <div class="btn-group" id="formatControls">
                <button class="btn btn-primary" onclick="formatJSON()" title="Format (Ctrl+Enter)">
                    ‚ú® Format
                </button>
                <button class="btn btn-success" onclick="validateJSON()" title="Validate">
                    ‚úÖ Validate
                </button>
                <button class="btn btn-secondary" onclick="compactJSON()" title="Compact">
                    üì¶ Compact
                </button>
                <button class="btn btn-secondary" onclick="clearEditor()" title="Clear">
                    üóëÔ∏è Clear
                </button>
            </div>

            <div class="btn-group" id="actionControls">
                <button class="btn btn-secondary" onclick="copyContent()" title="Copy (Ctrl+C)">
                    üìã Copy
                </button>
                <button class="btn btn-secondary" onclick="downloadJSON()" title="Download">
                    ‚¨áÔ∏è Download
                </button>
            </div>

            <button class="btn btn-warning" onclick="toggleTemplates()" id="templatesBtn" title="Templates">
                üìã Templates
            </button>
        </div>

        <div class="toolbar-section">
            <div class="search-container">
                <button class="search-mode-toggle" id="searchModeToggle" onclick="toggleSearchMode()" title="Toggle search mode">
                    TEXT
                </button>
                <input type="text" class="search-input" id="searchInput" placeholder="Search text..." 
                       onkeyup="performSearch()" onfocus="showSearchResults()" onblur="hideSearchResults()">
                <button class="btn btn-secondary" onclick="clearSearch()" title="Clear search">
                    üóëÔ∏è
                </button>
                <div class="search-results" id="searchResults">
                </div>
            </div>
            
            <div class="view-controls">
                <button class="view-btn active" data-view="code" onclick="switchView('code')">Code</button>
                <button class="view-btn" data-view="tree" onclick="switchView('tree')">Tree</button>
                <button class="view-btn" data-view="preview" onclick="switchView('preview')">Preview</button>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div class="drag-overlay" id="dragOverlay">
            <div class="drag-text">
                üìÅ Drop JSON files here
            </div>
        </div>

        <div class="editor-container" id="singleEditor">
            <div class="editor-wrapper">
                <textarea id="mainEditor" placeholder="Paste your WireMock JSON stub here..."></textarea>
                <div class="tree-view" id="treeView">
                </div>
                <div class="preview-view" id="previewView">
                </div>
            </div>
        </div>

        <div class="compare-container" id="compareContainer">
            <div class="compare-panel">
                <div class="compare-header">
                    <div class="compare-title">Original</div>
                    <div>
                        <button class="btn btn-secondary" onclick="loadCompareFile('left')" title="Load file">
                            üìÅ Load
                        </button>
                        <button class="btn btn-secondary" onclick="clearComparePanel('left')" title="Clear">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <textarea id="compareLeft" placeholder="Paste original JSON here..."></textarea>
                    <div class="tree-view" id="treeViewLeft">
                    </div>
                    <div class="preview-view" id="previewViewLeft">
                    </div>
                </div>
            </div>
            <div class="compare-panel">
                <div class="compare-header">
                    <div class="compare-title">Modified</div>
                    <div>
                        <button class="btn btn-secondary" onclick="loadCompareFile('right')" title="Load file">
                            üìÅ Load
                        </button>
                        <button class="btn btn-secondary" onclick="clearComparePanel('right')" title="Clear">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <textarea id="compareRight" placeholder="Paste modified JSON here..."></textarea>
                    <div class="tree-view" id="treeViewRight">
                    </div>
                    <div class="preview-view" id="previewViewRight">
                    </div>
                </div>
            </div>
        </div>

        <div class="history-panel" id="historyPanel">
            <div class="history-header">
                <h3>History</h3>
                <button class="btn btn-secondary" onclick="toggleHistory()">‚úï</button>
            </div>
            <div class="history-list" id="historyList">
            </div>
        </div>
    </main>

    <div class="status-bar">
        <div class="status-section">
            <div class="status-item">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">Ready</span>
            </div>
            <div class="status-item">
                <span id="modeText">Create Mode</span>
            </div>
        </div>
        
        <div class="status-section">
            <div class="status-item">
                <span id="charCount">0 characters</span>
            </div>
            <div class="status-item">
                <span id="lineCount">0 lines</span>
            </div>
            <div class="status-item">
                <span id="cursorPos">Ln 1, Col 1</span>
            </div>
            <div class="status-item">
                <span id="viewMode">Code View</span>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="fullscreenModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">WireMock JSON Studio - Fullscreen</div>
            <div class="modal-controls">
                <div class="view-controls">
                    <button class="view-btn active" data-view="code" onclick="switchModalView('code')">Code</button>
                    <button class="view-btn" data-view="tree" onclick="switchModalView('tree')">Tree</button>
                    <button class="view-btn" data-view="preview" onclick="switchModalView('preview')">Preview</button>
                </div>
                <button class="btn btn-primary" onclick="formatModalJSON()">‚ú® Format</button>
                <button class="btn btn-secondary" onclick="toggleModalFullscreen()" title="Toggle Fullscreen (ESC)">
                    ‚õ∂
                </button>
                <button class="btn btn-secondary" onclick="closeFullscreen()" title="Close">‚úï</button>
            </div>
        </div>
        <div class="modal-body">
            <div class="editor-wrapper">
                <textarea id="modalEditor" placeholder="Your JSON content..."></textarea>
                <div class="tree-view" id="modalTreeView">
                </div>
                <div class="preview-view" id="modalPreviewView">
                </div>
            </div>
        </div>
    </div>
</div>

<input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileLoad(event)">
<input type="file" id="compareFileInput" accept=".json" style="display: none;" onchange="handleCompareFileLoad(event)">, path);
        return results;
    }

    // WireMock templates
    const templates = {
        basicGet: {
            title: "Basic GET Response",
            desc: "Simple GET request with JSON response",
            badge: "Basic",
            data: {
                "request": {
                    "method": "GET",
                    "urlPath": "/api/users/123"
                },
                "response": {
                    "status": 200,
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "body": JSON.stringify({
                        "id": 123,
                        "name": "John Doe",
                        "email": "john.doe@example.com"
                    }, null, 2)
                }
            }
        },
        postBody: {
            title: "POST with Body Matching",
            desc: "POST request with JSON body validation",
            badge: "Advanced",
            data: {
                "request": {
                    "method": "POST",
                    "urlPath": "/api/users",
                    "headers": {
                        "Content-Type": {
                            "equalTo": "application/json"
                        }
                    },
                    "bodyPatterns": [
                        {
                            "matchesJsonPath": "$.name"
                        },
                        {
                            "matchesJsonPath": "$.email"
                        }
                    ]
                },
                "response": {
                    "status": 201,
                    "headers": {
                        "Content-Type": "application/json",
                        "Location": "/api/users/124"
                    },
                    "body": JSON.stringify({
                        "id": 124,
                        "name": "{{jsonPath request.body '$.name'}}",
                        "email": "{{jsonPath request.body '$.email'}}",
                        "created": "{{now}}"
                    }, null, 2)
                }
            }
        },
        headerMatch: {
            title: "Header-based Matching",
            desc: "Request matching with specific headers",
            badge: "Security",
            data: {
                "request": {
                    "method": "GET",
                    "urlPath": "/api/secure-endpoint",
                    "headers": {
                        "Authorization": {
                            "matches": "Bearer .*"
                        },
                        "X-API-Key": {
                            "equalTo": "your-api-key-here"
                        }
                    }
                },
                "response": {
                    "status": 200,
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "body": JSON.stringify({
                        "message": "Access granted",
                        "timestamp": "{{now}}"
                    }, null, 2)
                }
            }
        },
        regexPattern: {
            title: "URL Pattern Matching",
            desc: "Regex patterns with path parameters",
            badge: "Dynamic",
            data: {
                "request": {
                    "method": "GET",
                    "urlPathPattern": "/api/users/([0-9]+)/orders/([0-9]+)"
                },
                "response": {
                    "status": 200,
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "body": JSON.stringify({
                        "userId": "{{request.pathSegments.[2]}}",
                        "orderId": "{{request.pathSegments.[4]}}",
                        "status": "completed"
                    }, null, 2)
                }
            }
        },
        proxyPass: {
            title: "Proxy Pass-through",
            desc: "Forward requests to external API",
            badge: "Proxy",
            data: {
                "request": {
                    "method": "ANY",
                    "urlPattern": "/api/external/.*"
                },
                "response": {
                    "proxyBaseUrl": "https://external-api.example.com",
                    "additionalProxyRequestHeaders": {
                        "X-Forwarded-By": "WireMock"
                    }
                }
            }
        },
        faultInjection: {
            title: "Fault Injection",
            desc: "Simulate delays and network errors",
            badge: "Testing",
            data: {
                "request": {
                    "method": "GET",
                    "urlPath": "/api/slow-endpoint"
                },
                "response": {
                    "fixedDelayMilliseconds": 3000,
                    "status": 200,
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "body": JSON.stringify({
                        "message": "This response was delayed by 3 seconds"
                    }, null, 2)
                }
            }
        },
        statefulScenario: {
            title: "Stateful Behavior",
            desc: "State-based responses with scenarios",
            badge: "Stateful",
            data: {
                "scenarioName": "User Login Flow",
                "requiredScenarioState": "Started",
                "newScenarioState": "Logged In",
                "request": {
                    "method": "POST",
                    "urlPath": "/api/login"
                },
                "response": {
                    "status": 200,
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "body": JSON.stringify({
                        "token": "{{randomValue length=32 type='ALPHANUMERIC'}}",
                        "expiresIn": 3600
                    }, null, 2)
                }
            }
        },
        responseTemplate: {
            title: "Response Templating",
            desc: "Dynamic responses with Handlebars",
            badge: "Dynamic",
            data: {
                "request": {
                    "method": "GET",
                    "urlPathPattern": "/api/users/([0-9]+)"
                },
                "response": {
                    "status": 200,
                    "headers": {
                        "Content-Type": "application/json"
                    },
                    "body": JSON.stringify({
                        "id": "{{request.pathSegments.[2]}}",
                        "name": "User {{request.pathSegments.[2]}}",
                        "generatedAt": "{{now}}",
                        "requestId": "{{randomValue length=8 type='ALPHANUMERIC'}}",
                        "userAgent": "{{request.headers.User-Agent}}"
                    }, null, 2),
                    "transformers": ["response-template"]
                }
            }
        }
    };

    function initializeApp() {
        initializeEditors();
        loadTemplates();
        loadTheme();
        setupEventListeners();
        updateStatusBar();
        
        if (currentMode === 'create') {
            useTemplate('basicGet');
        }
    }

    CodeMirror.defineMode("wiremock-json", function(config, parserConfig) {
        const jsonMode = CodeMirror.getMode(config, "application/json");
        
        return {
            startState: function() {
                return {
                    jsonState: CodeMirror.startState(jsonMode),
                    inHandlebars: false
                };
            },
            
            token: function(stream, state) {
                if (stream.match(/\{\{[^}]*\}\}/)) {
                    return "handlebars";
                }
                
                return jsonMode.token(stream, state.jsonState);
            },
            
            indent: function(state, textAfter) {
                return jsonMode.indent(state.jsonState, textAfter);
            },
            
            electricChars: jsonMode.electricChars,
            blockCommentStart: jsonMode.blockCommentStart,
            blockCommentEnd: jsonMode.blockCommentEnd,
            lineComment: jsonMode.lineComment,
            fold: jsonMode.fold
        };
    });

    function initializeEditors() {
        const commonOptions = {
            mode: "wiremock-json",
            theme: currentTheme === 'dark' ? 'monokai' : 'default',
            lineNumbers: true,
            matchBrackets: true,
            autoCloseBrackets: true,
            foldGutter: true,
            gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter", "CodeMirror-lint-markers"],
            lint: true,
            indentUnit: 2,
            tabSize: 2,
            lineWrapping: true,
            autoRefresh: true,
            extraKeys: {
                "Ctrl-F": "findPersistent",
                "Ctrl-G": "findNext",
                "Shift-Ctrl-G": "findPrev",
                "Ctrl-Alt-F": "replace"
            }
        };

        mainEditor = CodeMirror.fromTextArea(document.getElementById('mainEditor'), {
            ...commonOptions,
            placeholder: "Paste your WireMock JSON stub here..."
        });

        compareLeftEditor = CodeMirror.fromTextArea(document.getElementById('compareLeft'), {
            ...commonOptions,
            placeholder: "Paste original JSON here..."
        });

        compareRightEditor = CodeMirror.fromTextArea(document.getElementById('compareRight'), {
            ...commonOptions,
            placeholder: "Paste modified JSON here..."
        });

        modalEditor = CodeMirror.fromTextArea(document.getElementById('modalEditor'), {
            ...commonOptions,
            placeholder: "Your JSON content..."
        });

        mainEditor.on('change', (cm, change) => {
            if (!isHistoryUpdate) {
                addToHistory(cm.getValue());
            }
            updateStatusBar();
            validateContent();
            updateCurrentView();
        });

        mainEditor.on('cursorActivity', updateCursorPosition);

        compareLeftEditor.on('change', () => {
            updateCompareView('left');
        });

        compareRightEditor.on('change', () => {
            updateCompareView('right');
        });

        modalEditor.on('change', () => {
            updateStatusBar();
            updateModalView();
        });
        modalEditor.on('cursorActivity', updateCursorPosition);
    }

    function loadTemplates() {
        const grid = document.getElementById('templatesGrid');
        grid.innerHTML = '';

        Object.entries(templates).forEach(([key, template]) => {
            const card = document.createElement('div');
            card.className = 'template-card fade-in';
            card.onclick = () => useTemplate(key);
            
            card.innerHTML = `
                <div class="template-badge">${template.badge}</div>
                <div class="template-title">${template.title}</div>
                <div class="template-desc">${template.desc}</div>
            `;
            
            grid.appendChild(card);
        });
    }

    function switchMode(mode) {
        if (currentMode === mode) return;

        document.querySelectorAll('.mode-tab').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.mode === mode);
        });

        const templatesBtn = document.getElementById('templatesBtn');
        const templatesPanel = document.getElementById('templatesPanel');
        const singleEditor = document.getElementById('singleEditor');
        const compareContainer = document.getElementById('compareContainer');

        if (mode === 'create') {
            templatesBtn.style.display = 'block';
            singleEditor.style.display = 'flex';
            compareContainer.classList.remove('active');
            document.getElementById('modeText').textContent = 'Create Mode';
        } else if (mode === 'edit') {
            templatesBtn.style.display = 'none';
            templatesPanel.classList.remove('show');
            singleEditor.style.display = 'flex';
            compareContainer.classList.remove('active');
            document.getElementById('modeText').textContent = 'Edit Mode';
        } else if (mode === 'compare') {
            templatesBtn.style.display = 'none';
            templatesPanel.classList.remove('show');
            singleEditor.style.display = 'none';
            compareContainer.classList.add('active');
            document.getElementById('modeText').textContent = 'Compare Mode';
            updateCompareView('left');
            updateCompareView('right');
        }

        currentMode = mode;
        
        setTimeout(() => {
            mainEditor.refresh();
            compareLeftEditor.refresh();
            compareRightEditor.refresh();
        }, 100);
    }

    function switchView(view) {
        if (currentView === view) return;

        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.view === view);
        });

        currentView = view;
        document.getElementById('viewMode').textContent = `${view.charAt(0).toUpperCase() + view.slice(1)} View`;
        
        updateCurrentView();
    }

    function switchModalView(view) {
        document.querySelectorAll('.modal .view-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.view === view);
        });
        updateModalView();
    }

    function updateCurrentView() {
        if (currentMode === 'compare') {
            updateCompareView('left');
            updateCompareView('right');
            return;
        }

        const editor = document.querySelector('#singleEditor .CodeMirror');
        const treeView = document.getElementById('treeView');
        const previewView = document.getElementById('previewView');

        editor.style.display = 'none';
        treeView.classList.remove('active');
        previewView.classList.remove('active');

        if (currentView === 'code') {
            editor.style.display = 'block';
            mainEditor.refresh();
        } else if (currentView === 'tree') {
            treeView.classList.add('active');
            generateTreeView(mainEditor.getValue(), 'treeView');
        } else if (currentView === 'preview') {
            previewView.classList.add('active');
            generatePreviewView(mainEditor.getValue(), 'previewView');
        }
    }

    function updateCompareView(side) {
        if (currentMode !== 'compare') return;

        const editor = side === 'left' ? compareLeftEditor : compareRightEditor;
        const content = editor.getValue();
        
        const editorEl = document.querySelector(`#compareContainer .compare-panel:${side === 'left' ? 'first-child' : 'last-child'} .CodeMirror`);
        const treeView = document.getElementById(`treeView${side.charAt(0).toUpperCase() + side.slice(1)}`);
        const previewView = document.getElementById(`previewView${side.charAt(0).toUpperCase() + side.slice(1)}`);

        editorEl.style.display = 'none';
        treeView.classList.remove('active');
        previewView.classList.remove('active');

        if (currentView === 'code') {
            editorEl.style.display = 'block';
            editor.refresh();
        } else if (currentView === 'tree') {
            treeView.classList.add('active');
            generateTreeView(content, `treeView${side.charAt(0).toUpperCase() + side.slice(1)}`);
        } else if (currentView === 'preview') {
            previewView.classList.add('active');
            generatePreviewView(content, `previewView${side.charAt(0).toUpperCase() + side.slice(1)}`);
        }
    }

    function updateModalView() {
        const activeBtn = document.querySelector('.modal .view-btn.active');
        if (!activeBtn) return;

        const view = activeBtn.dataset.view;
        const content = modalEditor.getValue();
        
        const editorEl = document.querySelector('#fullscreenModal .CodeMirror');
        const treeView = document.getElementById('modalTreeView');
        const previewView = document.getElementById('modalPreviewView');

        editorEl.style.display = 'none';
        treeView.classList.remove('active');
        previewView.classList.remove('active');

        if (view === 'code') {
            editorEl.style.display = 'block';
            modalEditor.refresh();
        } else if (view === 'tree') {
            treeView.classList.add('active');
            generateTreeView(content, 'modalTreeView');
        } else if (view === 'preview') {
            previewView.classList.add('active');
            generatePreviewView(content, 'modalPreviewView');
        }
    }

    function generateTreeView(jsonString, containerId) {
        const container = document.getElementById(containerId);
        if (!container) return;

        try {
            if (!jsonString.trim()) {
                container.innerHTML = '<div style="color: var(--text-muted); text-align: center; padding: 2rem;">No JSON content</div>';
                return;
            }

            const json = JSON.parse(jsonString);
            container.innerHTML = '';
            
            const rootNode = createTreeNode('root', json, true);
            container.appendChild(rootNode);
        } catch (error) {
            container.innerHTML = `<div style="color: var(--error-color); padding: 1rem;">Invalid JSON: ${error.message}</div>`;
        }
    }

    function createTreeNode(key, value, isRoot = false) {
        const node = document.createElement('div');
        node.className = 'tree-node';

        if (typeof value === 'object' && value !== null) {
            const isArray = Array.isArray(value);
            const keys = Object.keys(value);
            
            const header = document.createElement('div');
            header.style.display = 'flex';
            header.style.alignItems = 'center';
            
            if (!isRoot) {
                const toggle = document.createElement('span');
                toggle.className = 'tree-toggle';
                toggle.textContent = '‚ñº';
                toggle.onclick = () => toggleTreeNode(node);
                header.appendChild(toggle);
            }
            
            const keySpan = document.createElement('span');
            keySpan.className = 'tree-key';
            keySpan.textContent = isRoot ? 'JSON' : `${key}`;
            header.appendChild(keySpan);
            
            const valueSpan = document.createElement('span');
            valueSpan.className = 'tree-value';
            valueSpan.textContent = isArray ? ` [${keys.length}]` : ` {${keys.length}}`;
            header.appendChild(valueSpan);
            
            node.appendChild(header);
            
            const children = document.createElement('div');
            children.className = 'tree-children';
            
            keys.forEach(childKey => {
                const childNode = createTreeNode(childKey, value[childKey]);
                children.appendChild(childNode);
            });
            
            node.appendChild(children);
        } else {
            const keySpan = document.createElement('span');
            keySpan.className = 'tree-key';
            keySpan.textContent = key + ': ';
            node.appendChild(keySpan);
            
            const valueSpan = document.createElement('span');
            valueSpan.className = `tree-value ${typeof value}`;
            valueSpan.textContent = JSON.stringify(value);
            node.appendChild(valueSpan);
        }

        return node;
    }

    function toggleTreeNode(node) {
        const toggle = node.querySelector('.tree-toggle');
        const children = node.querySelector('.tree-children');
        
        if (children.classList.contains('collapsed')) {
            children.classList.remove('collapsed');
            toggle.textContent = '‚ñº';
        } else {
            children.classList.add('collapsed');
            toggle.textContent = '‚ñ∂';
        }<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WireMock JSON Studio</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/default.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/matchesonscrollbar.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/json-lint.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/jump-to-line.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.js"></script>
<style>
    :root {
        --bg-primary: #ffffff;
        --bg-secondary: #f8f9fa;
        --bg-tertiary: #e9ecef;
        --bg-quaternary: #dee2e6;
        --text-primary: #212529;
        --text-secondary: #6c757d;
        --text-muted: #868e96;
        --border-color: #dee2e6;
        --border-light: #f1f3f4;
        --button-bg: #007bff;
        --button-hover: #0056b3;
        --success-color: #28a745;
        --error-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #17a2b8;
        --purple-color: #6f42c1;
        --handlebars-color: #ff6b35;
        --jsonpath-color: #00d4aa;
        --shadow: 0 2px 4px rgba(0,0,0,0.1);
        --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
    }

    [data-theme="dark"] {
        --bg-primary: #1a1a1a;
        --bg-secondary: #2d2d2d;
        --bg-tertiary: #404040;
        --bg-quaternary: #555555;
        --text-primary: #ffffff;
        --text-secondary: #b0b0b0;
        --text-muted: #888888;
        --border-color: #555555;
        --border-light: #444444;
        --button-bg: #0d6efd;
        --button-hover: #0b5ed7;
        --success-color: #198754;
        --error-color: #dc3545;
        --warning-color: #fd7e14;
        --info-color: #0dcaf0;
        --purple-color: #8b5cf6;
        --handlebars-color: #ff8c69;
        --jsonpath-color: #4ecdc4;
        --shadow: 0 2px 4px rgba(0,0,0,0.3);
        --shadow-lg: 0 10px 25px rgba(0,0,0,0.4);
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        height: 100vh;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .app-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    .header {
        background: var(--bg-secondary);
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        box-shadow: var(--shadow);
        z-index: 100;
    }

    .header h1 {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .logo {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, var(--button-bg), var(--purple-color));
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 14px;
    }

    .mode-tabs {
        display: flex;
        background: var(--bg-tertiary);
        border-radius: 8px;
        padding: 4px;
        gap: 2px;
    }

    .mode-tab {
        padding: 0.5rem 1rem;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        cursor: pointer;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.2s ease;
        position: relative;
    }

    .mode-tab.active {
        background: var(--bg-primary);
        color: var(--text-primary);
        box-shadow: var(--shadow);
    }

    .mode-tab:hover:not(.active) {
        background: var(--bg-quaternary);
        color: var(--text-primary);
    }

    .header-controls {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .btn {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        white-space: nowrap;
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-primary {
        background: var(--button-bg);
        color: white;
    }

    .btn-primary:hover:not(:disabled) {
        background: var(--button-hover);
        transform: translateY(-1px);
    }

    .btn-secondary {
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--border-color);
    }

    .btn-secondary:hover:not(:disabled) {
        background: var(--bg-quaternary);
        transform: translateY(-1px);
    }

    .btn-success {
        background: var(--success-color);
        color: white;
    }

    .btn-warning {
        background: var(--warning-color);
        color: #000;
    }

    .btn-error {
        background: var(--error-color);
        color: white;
    }

    .btn-group {
        display: flex;
        gap: 2px;
        background: var(--bg-tertiary);
        border-radius: 6px;
        padding: 2px;
    }

    .btn-group .btn {
        border-radius: 4px;
        margin: 0;
    }

    .theme-toggle {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .theme-toggle:hover {
        background: var(--bg-quaternary);
        transform: scale(1.1);
    }

    .toolbar {
        background: var(--bg-secondary);
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .toolbar-section {
        display: flex;
        gap: 0.5rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .view-controls {
        display: flex;
        gap: 2px;
        background: var(--bg-tertiary);
        border-radius: 6px;
        padding: 2px;
    }

    .view-btn {
        padding: 0.4rem 0.8rem;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        cursor: pointer;
        border-radius: 4px;
        font-size: 0.85rem;
        transition: all 0.2s ease;
    }

    .view-btn.active {
        background: var(--bg-primary);
        color: var(--text-primary);
        box-shadow: var(--shadow);
    }

    .view-btn:hover:not(.active) {
        background: var(--bg-quaternary);
        color: var(--text-primary);
    }

    .search-container {
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .search-input {
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background: var(--bg-primary);
        color: var(--text-primary);
        font-size: 0.9rem;
        width: 200px;
    }

    .search-input::placeholder {
        color: var(--text-muted);
    }

    .search-mode-toggle {
        padding: 0.4rem 0.6rem;
        border: 1px solid var(--border-color);
        border-radius: 4px;
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .search-mode-toggle.jsonpath {
        background: var(--jsonpath-color);
        color: white;
        border-color: var(--jsonpath-color);
    }

    .main-content {
        flex: 1;
        display: flex;
        overflow: hidden;
        position: relative;
    }

    .editor-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .editor-wrapper {
        flex: 1;
        position: relative;
        background: var(--bg-primary);
    }

    .tree-view {
        display: none;
        padding: 1rem;
        overflow-y: auto;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        line-height: 1.6;
    }

    .tree-view.active {
        display: block;
    }

    .preview-view {
        display: none;
        padding: 1rem;
        overflow-y: auto;
    }

    .preview-view.active {
        display: block;
    }

    .CodeMirror {
        height: 100% !important;
        font-size: 14px;
        line-height: 1.6;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }

    .cm-handlebars {
        color: var(--handlebars-color) !important;
        font-weight: bold;
        background: rgba(255, 107, 53, 0.1);
        border-radius: 3px;
    }

    .compare-container {
        display: none;
        flex: 1;
    }

    .compare-container.active {
        display: flex;
    }

    .compare-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        border-right: 1px solid var(--border-color);
    }

    .compare-panel:last-child {
        border-right: none;
    }

    .compare-header {
        background: var(--bg-secondary);
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .compare-title {
        font-weight: 600;
        color: var(--text-primary);
    }

    .templates-panel {
        display: none;
        background: var(--bg-secondary);
        padding: 1.5rem;
        border-bottom: 1px solid var(--border-color);
        box-shadow: var(--shadow);
    }

    .templates-panel.show {
        display: block;
    }

    .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
    }

    .template-card {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .template-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--button-bg), var(--purple-color));
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .template-card:hover {
        border-color: var(--button-bg);
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .template-card:hover::before {
        transform: scaleX(1);
    }

    .template-title {
        font-weight: 600;
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }

    .template-desc {
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.5;
    }

    .template-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: var(--info-color);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }

    .status-bar {
        background: var(--bg-secondary);
        padding: 0.5rem 1rem;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
        color: var(--text-secondary);
        flex-wrap: wrap;
        gap: 1rem;
    }

    .status-section {
        display: flex;
        gap: 1.5rem;
        align-items: center;
    }

    .status-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--success-color);
    }

    .status-indicator.error {
        background: var(--error-color);
    }

    .status-indicator.warning {
        background: var(--warning-color);
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        backdrop-filter: blur(4px);
    }

    .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: var(--bg-primary);
        border-radius: 12px;
        width: 95%;
        height: 90%;
        max-width: 1400px;
        display: flex;
        flex-direction: column;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
    }

    .modal.fullscreen .modal-content {
        width: 100%;
        height: 100%;
        border-radius: 0;
    }

    .modal-header {
        background: var(--bg-secondary);
        padding: 1rem 1.5rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .modal-controls {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .modal-body {
        flex: 1;
        display: flex;
        overflow: hidden;
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 1001;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        box-shadow: var(--shadow-lg);
        max-width: 350px;
    }

    .notification.show {
        transform: translateX(0);
    }

    .notification.success {
        background: var(--success-color);
    }

    .notification.error {
        background: var(--error-color);
    }

    .notification.warning {
        background: var(--warning-color);
        color: #000;
    }

    .notification.info {
        background: var(--info-color);
    }

    .history-panel {
        position: absolute;
        top: 0;
        right: -300px;
        width: 300px;
        height: 100%;
        background: var(--bg-secondary);
        border-left: 1px solid var(--border-color);
        transition: right 0.3s ease;
        z-index: 50;
        box-shadow: var(--shadow-lg);
        display: flex;
        flex-direction: column;
    }

    .history-panel.show {
        right: 0;
    }

    .history-header {
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .history-list {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
    }

    .history-item {
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .history-item:hover {
        border-color: var(--button-bg);
        transform: translateX(-2px);
    }

    .history-item.current {
        border-color: var(--success-color);
        background: var(--bg-tertiary);
    }

    .history-time {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
    }

    .history-preview {
        font-size: 0.85rem;
        color: var(--text-secondary);
        max-height: 60px;
        overflow: hidden;
        line-height: 1.4;
    }

    .drag-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 123, 255, 0.1);
        border: 2px dashed var(--button-bg);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 100;
        backdrop-filter: blur(2px);
    }

    .drag-overlay.show {
        display: flex;
    }

    .drag-text {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--button-bg);
        text-align: center;
    }

    .tree-node {
        margin-left: 1rem;
        padding: 0.25rem 0;
    }

    .tree-key {
        color: var(--purple-color);
        font-weight: 600;
        cursor: pointer;
    }

    .tree-key:hover {
        background: var(--bg-tertiary);
        border-radius: 3px;
    }

    .tree-value {
        color: var(--text-primary);
        margin-left: 0.5rem;
    }

    .tree-value.string {
        color: var(--success-color);
    }

    .tree-value.number {
        color: var(--info-color);
    }

    .tree-value.boolean {
        color: var(--warning-color);
    }

    .tree-value.null {
        color: var(--text-muted);
    }

    .tree-toggle {
        cursor: pointer;
        user-select: none;
        color: var(--text-muted);
        margin-right: 0.25rem;
    }

    .tree-children {
        margin-left: 1rem;
    }

    .tree-children.collapsed {
        display: none;
    }

    .preview-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .preview-title {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }

    .preview-content {
        color: var(--text-secondary);
        line-height: 1.5;
    }

    .search-results {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--bg-primary);
        border: 1px solid var(--border-color);
        border-radius: 0 0 6px 6px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
    }

    .search-results.show {
        display: block;
    }

    .search-result {
        padding: 0.5rem;
        border-bottom: 1px solid var(--border-light);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .search-result:hover {
        background: var(--bg-tertiary);
    }

    .search-result:last-child {
        border-bottom: none;
    }

    .search-path {
        font-weight: 500;
        color: var(--text-primary);
    }

    .search-value {
        color: var(--text-secondary);
        font-size: 0.85rem;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    @media (max-width: 768px) {
        .header {
            flex-direction: column;
            gap: 0.5rem;
        }

        .header-controls,
        .toolbar-section {
            width: 100%;
            justify-content: center;
        }

        .modal-content {
            width: 98%;
            height: 95%;
        }

        .history-panel {
            width: 280px;
        }

        .templates-grid {
            grid-template-columns: 1fr;
        }

        .search-input {
            width: 150px;
        }
    }

    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    ::-webkit-scrollbar-track {
        background: var(--bg-tertiary);
    }

    ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: var(--text-secondary);
    }

    .fade-in {
        animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
        animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
</style>
</head>
<body data-theme="light">
<div class="app-container">
    <header class="header">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div class="logo">WM</div>
            <h1>WireMock JSON Studio</h1>
            <div class="mode-tabs">
                <button class="mode-tab active" data-mode="create" onclick="switchMode('create')">
                    üìù Create
                </button>
                <button class="mode-tab" data-mode="edit" onclick="switchMode('edit')">
                    ‚úèÔ∏è Edit
                </button>
                <button class="mode-tab" data-mode="compare" onclick="switchMode('compare')">
                    üîç Compare
                </button>
            </div>
        </div>
        
        <div class="header-controls">
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="undoChange()" title="Undo (Ctrl+Z)" id="undoBtn" disabled>
                    ‚Ü∂ Undo
                </button>
                <button class="btn btn-secondary" onclick="redoChange()" title="Redo (Ctrl+Y)" id="redoBtn" disabled>
                    ‚Ü∑ Redo
                </button>
            </div>
            
            <button class="btn btn-secondary" onclick="toggleHistory()" title="History">
                üìö History
            </button>
            
            <button class="btn btn-primary" onclick="openFullscreen()" title="Fullscreen (F11)">
                ‚õ∂ Fullscreen
            </button>
            
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                üåô
            </button>
        </div>
    </header>

    <div class="templates-panel" id="templatesPanel">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3>WireMock Stub Templates</h3>
            <button class="btn btn-secondary" onclick="toggleTemplates()">
                ‚úï Close
            </button>
        </div>
        <div class="templates-grid" id="templatesGrid">
        </div>
    </div>

    <div class="toolbar">
        <div class="toolbar-section">
            <div class="btn-group" id="createEditControls">
                <button class="btn btn-secondary" onclick="newDocument()" title="New (Ctrl+N)">
                    üìÑ New
                </button>
                <button class="btn btn-secondary" onclick="openFile()" title="Open (Ctrl+O)">
                    üìÅ Open
                </button>
                <button class="btn btn-secondary" onclick="saveFile()" title="Save (Ctrl+S)">
                    üíæ Save
                </button>
            </div>

            <div class="btn-group" id="formatControls">
                <button class="btn btn-primary" onclick="formatJSON()" title="Format (Ctrl+Enter)">
                    ‚ú® Format
                </button>
                <button class="btn btn-success" onclick="validateJSON()" title="Validate">
                    ‚úÖ Validate
                </button>
                <button class="btn btn-secondary" onclick="compactJSON()" title="Compact">
                    üì¶ Compact
                </button>
                <button class="btn btn-secondary" onclick="clearEditor()" title="Clear">
                    üóëÔ∏è Clear
                </button>
            </div>

            <div class="btn-group" id="actionControls">
                <button class="btn btn-secondary" onclick="copyContent()" title="Copy (Ctrl+C)">
                    üìã Copy
                </button>
                <button class="btn btn-secondary" onclick="downloadJSON()" title="Download">
                    ‚¨áÔ∏è Download
                </button>
            </div>

            <button class="btn btn-warning" onclick="toggleTemplates()" id="templatesBtn" title="Templates">
                üìã Templates
            </button>
        </div>

        <div class="toolbar-section">
            <div class="search-container">
                <button class="search-mode-toggle" id="searchModeToggle" onclick="toggleSearchMode()" title="Toggle search mode">
                    TEXT
                </button>
                <input type="text" class="search-input" id="searchInput" placeholder="Search text..." 
                       onkeyup="performSearch()" onfocus="showSearchResults()" onblur="hideSearchResults()">
                <button class="btn btn-secondary" onclick="clearSearch()" title="Clear search">
                    üóëÔ∏è
                </button>
                <div class="search-results" id="searchResults">
                </div>
            </div>
            
            <div class="view-controls">
                <button class="view-btn active" data-view="code" onclick="switchView('code')">Code</button>
                <button class="view-btn" data-view="tree" onclick="switchView('tree')">Tree</button>
                <button class="view-btn" data-view="preview" onclick="switchView('preview')">Preview</button>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div class="drag-overlay" id="dragOverlay">
            <div class="drag-text">
                üìÅ Drop JSON files here
            </div>
        </div>

        <div class="editor-container" id="singleEditor">
            <div class="editor-wrapper">
                <textarea id="mainEditor" placeholder="Paste your WireMock JSON stub here..."></textarea>
                <div class="tree-view" id="treeView">
                </div>
                <div class="preview-view" id="previewView">
                </div>
            </div>
        </div>

        <div class="compare-container" id="compareContainer">
            <div class="compare-panel">
                <div class="compare-header">
                    <div class="compare-title">Original</div>
                    <div>
                        <button class="btn btn-secondary" onclick="loadCompareFile('left')" title="Load file">
                            üìÅ Load
                        </button>
                        <button class="btn btn-secondary" onclick="clearComparePanel('left')" title="Clear">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <textarea id="compareLeft" placeholder="Paste original JSON here..."></textarea>
                    <div class="tree-view" id="treeViewLeft">
                    </div>
                    <div class="preview-view" id="previewViewLeft">
                    </div>
                </div>
            </div>
            <div class="compare-panel">
                <div class="compare-header">
                    <div class="compare-title">Modified</div>
                    <div>
                        <button class="btn btn-secondary" onclick="loadCompareFile('right')" title="Load file">
                            üìÅ Load
                        </button>
                        <button class="btn btn-secondary" onclick="clearComparePanel('right')" title="Clear">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <textarea id="compareRight" placeholder="Paste modified JSON here..."></textarea>
                    <div class="tree-view" id="treeViewRight">
                    </div>
                    <div class="preview-view" id="previewViewRight">
                    </div>
                </div>
            </div>
        </div>

        <div class="history-panel" id="historyPanel">
            <div class="history-header">
                <h3>History</h3>
                <button class="btn btn-secondary" onclick="toggleHistory()">‚úï</button>
            </div>
            <div class="history-list" id="historyList">
            </div>
        </div>
    </main>

    <div class="status-bar">
        <div class="status-section">
            <div class="status-item">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">Ready</span>
            </div>
            <div class="status-item">
                <span id="modeText">Create Mode</span>
            </div>
        </div>
        
        <div class="status-section">
            <div class="status-item">
                <span id="charCount">0 characters</span>
            </div>
            <div class="status-item">
                <span id="lineCount">0 lines</span>
            </div>
            <div class="status-item">
                <span id="cursorPos">Ln 1, Col 1</span>
            </div>
            <div class="status-item">
                <span id="viewMode">Code View</span>
            </div>
        </div>
    </div>
</div>

<div class="modal" id="fullscreenModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">WireMock JSON Studio - Fullscreen</div>
            <div class="modal-controls">
                <div class="view-controls">
                    <button class="view-btn active" data-view="code" onclick="switchModalView('code')">Code</button>
                    <button class="view-btn" data-view="tree" onclick="switchModalView('tree')">Tree</button>
                    <button class="view-btn" data-view="preview" onclick="switchModalView('preview')">Preview</button>
                </div>
                <button class="btn btn-primary" onclick="formatModalJSON()">‚ú® Format</button>
                <button class="btn btn-secondary" onclick="toggleModalFullscreen()" title="Toggle Fullscreen (ESC)">
                    ‚õ∂
                </button>
                <button class="btn btn-secondary" onclick="closeFullscreen()" title="Close">‚úï</button>
            </div>
        </div>
        <div class="modal-body">
            <div class="editor-wrapper">
                <textarea id="modalEditor" placeholder="Your JSON content..."></textarea>
                <div class="tree-view" id="modalTreeView">
                </div>
                <div class="preview-view" id="modalPreviewView">
                </div>
            </div>
        </div>
    </div>
</div>

<input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileLoad(event)">
<input type="file" id="compareFileInput" accept=".json" style="display: none;" onchange="handleCompareFileLoad(event)">