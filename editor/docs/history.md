# История JSON-редактора

## Контроллер истории
- Добавлен `HistoryController`, который связывает Monaco-редакторы и `PatchHistory`, отслеживая каждое изменение через единый стек Undo/Redo.
- Контроллер синхронизирует рабочие поверхности (главный редактор и compare-left/right), чтобы действия из UI и горячие клавиши приводили к одному состоянию.

## Источники снимков
- Создание нового документа, загрузка файла, применение шаблона, форматирование и минификация фиксируются через контроллер, который обеспечивает корректный baseline.
- При невалидном JSON контроллер предотвращает падение истории, отображая уведомление.

## Timeline
- Модальное окно History отображает временную шкалу с метками, превью и кнопками перехода к любому состоянию; Undo/Redo и статистика берутся напрямую через `HistoryController`.
- Список записей доступен из `patchHistory.getTimeline()`, поэтому UI не хранит дополнительные вычисленные данные.

## Горячие клавиши
- `Ctrl/Cmd+Z`, `Ctrl/Cmd+Shift+Z` и `Ctrl/Cmd+Y` перехватываются поверх Monaco и прокидываются в контроллер, чтобы история редактора не конфликтовала с внутренним буфером Monaco.

## Хранилище истории
- `PatchHistory` теперь хранит метаданные (label/summary/preview), поддерживает `goTo(index)` и формирует экспорт вместе с baseline, что упрощает восстановление истории.
