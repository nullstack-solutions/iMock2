var t,e,n=Object.getOwnPropertyNames,i=(t={"assets/editor-5h-4A7cT.js"(t,e){let n=class{constructor(t){this.editor=t,this.fullContent="",this.isVirtualized=!1}setContent(t){"string"!=typeof t&&(t=""),this.fullContent=t,t.split("\n").length,this.isVirtualized=!1,this.editor.getValue()!==t&&this.editor.setValue(t)}updateVisibleRange(){}getFullContent(){return this.isVirtualized?this.fullContent:this.editor.getValue()}dispose(){this.fullContent="",this.isVirtualized=!1}},i=class{constructor(){this.keyIndex=new Map,this.valueIndex=new Map,this.lineIndex=[],this.isIndexed=!1,this.lastBuildTime=0}buildIndex(t){const e=performance.now(),n=t.split("\n");this.keyIndex.clear(),this.valueIndex.clear(),this.lineIndex=[],n.forEach((t,e)=>{this.lineIndex.push(t);const n=t.trim(),i=n.match(/"([^"]+)":/);if(i){const n=i[1].toLowerCase();this.keyIndex.has(n)||this.keyIndex.set(n,[]),this.keyIndex.get(n).push({line:e,column:t.indexOf(i[0]),text:t,key:i[1]})}const o=n.match(/:\s*"([^"]+)"/);if(o){const n=o[1].toLowerCase();this.valueIndex.has(n)||this.valueIndex.set(n,[]),this.valueIndex.get(n).push({line:e,column:t.indexOf(o[1]),text:t,value:o[1]})}}),this.isIndexed=!0,this.lastBuildTime=performance.now()-e}searchKeys(t,e={}){if(!this.isIndexed)return[];const n=e.matchCase?t:t.toLowerCase(),i=[];for(const[o,r]of this.keyIndex)this.matches(o,n,e)&&i.push(...r.map(t=>({...t,type:"key"})));return i.slice(0,1e3)}searchValues(t,e={}){if(!this.isIndexed)return[];const n=e.matchCase?t:t.toLowerCase(),i=[];for(const[o,r]of this.valueIndex)this.matches(o,n,e)&&i.push(...r.map(t=>({...t,type:"value"})));return i.slice(0,1e3)}searchAll(t,e={}){return[...this.searchKeys(t,e),...this.searchValues(t,e)].sort((t,e)=>t.line-e.line).slice(0,1e3)}matches(t,e,n){return n.wholeWord?new RegExp(`\\b${this.escapeRegex(e)}\\b`,n.matchCase?"":"i").test(t):t.includes(e)}escapeRegex(t){return t.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}getStats(){return{indexed:this.isIndexed,keys:this.keyIndex.size,values:this.valueIndex.size,lines:this.lineIndex.length,buildTime:this.lastBuildTime}}clear(){this.keyIndex.clear(),this.valueIndex.clear(),this.lineIndex=[],this.isIndexed=!1,this.lastBuildTime=0}},o=class{constructor(t,e=4){if(this.workers=[],this.queue=[],this.busyWorkers=new Set,this.taskIdCounter=0,this.pendingTasks=new Map,"file:"!==location.protocol)for(let i=0;i<e;i++)try{const e=new Worker(t);e.id=i,e.onmessage=t=>this.handleMessage(e,t),e.onerror=t=>this.handleError(e,t),this.workers.push(e)}catch(n){}}execute(t,e,n=0,i=1e4){return new Promise((o,r)=>{const s=++this.taskIdCounter,a={id:s,operation:t,payload:e,resolve:o,reject:r,priority:n,timestamp:Date.now(),timeout:setTimeout(()=>{this.cancelTask(s,"timeout")},i)};this.pendingTasks.set(s,a);const l=this.getAvailableWorker();l?this.runTask(l,a):(this.queue.push(a),this.queue.sort((t,e)=>e.priority-t.priority))})}getAvailableWorker(){return this.workers.find(t=>!this.busyWorkers.has(t.id))}runTask(t,e){this.busyWorkers.add(t.id),t.currentTask=e,t.postMessage({type:e.operation,payload:e.payload,taskId:e.id})}handleMessage(t,e){const n=t.currentTask;n&&(clearTimeout(n.timeout),this.pendingTasks.delete(n.id),e.data.error?n.reject(new Error(e.data.error)):n.resolve(e.data.result||e.data)),this.releaseWorker(t)}handleError(t,e){const n=t.currentTask;n&&(clearTimeout(n.timeout),this.pendingTasks.delete(n.id),n.reject(e)),this.releaseWorker(t)}releaseWorker(t){if(this.busyWorkers.delete(t.id),t.currentTask=null,this.queue.length>0){const e=this.queue.shift();this.runTask(t,e)}}cancelTask(t,e="cancelled"){const n=this.pendingTasks.get(t);if(n){clearTimeout(n.timeout),this.pendingTasks.delete(t),n.reject(new Error(`Task ${e}`));const i=this.queue.findIndex(e=>e.id===t);-1!==i&&this.queue.splice(i,1)}}getStats(){return{workers:this.workers.length,busy:this.busyWorkers.size,queued:this.queue.length,pending:this.pendingTasks.size}}terminate(){for(const[t]of this.pendingTasks)this.cancelTask(t,"pool_terminated");this.workers.forEach(t=>t.terminate()),this.workers=[],this.queue=[],this.busyWorkers.clear(),this.pendingTasks.clear()}},r=class{constructor(){this.debounceTimers=new Map,this.throttleTimestamps=new Map,this.measurements=new Map}debounce(t,e,n){clearTimeout(this.debounceTimers.get(t)),this.debounceTimers.set(t,setTimeout(()=>{e(),this.debounceTimers.delete(t)},n))}throttle(t,e,n){const i=Date.now();return i-(this.throttleTimestamps.get(t)||0)>=n&&(this.throttleTimestamps.set(t,i),e(),!0)}measurePerformance(t,e){const n=performance.now(),i=e(),o=performance.now()-n;return this.measurements.has(t)||this.measurements.set(t,[]),this.measurements.get(t).push(o),i}async measureAsync(t,e){const n=performance.now(),i=await e(),o=performance.now()-n;return this.measurements.has(t)||this.measurements.set(t,[]),this.measurements.get(t).push(o),i}getStats(t){const e=this.measurements.get(t);if(!e||0===e.length)return null;const n=[...e].sort((t,e)=>t-e);return{count:e.length,min:n[0],max:n[n.length-1],avg:e.reduce((t,e)=>t+e,0)/e.length,median:n[Math.floor(n.length/2)]}}clearStats(){this.measurements.clear()}},s=class{constructor(t=100,e=3e5){this.cache=new Map,this.maxSize=t,this.ttl=e,this.hits=0,this.misses=0}generateKey(t,e){return`${t}:${this.simpleHash(e)}:${e.length}`}simpleHash(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e&=e;return Math.abs(e).toString(36)}get(t,e){const n=this.generateKey(t,e),i=this.cache.get(n);return i&&Date.now()-i.timestamp<this.ttl?(this.hits++,i.result):(i&&this.cache.delete(n),this.misses++,null)}set(t,e,n){const i=this.generateKey(t,e);if(this.cache.size>=this.maxSize){const t=this.cache.keys().next().value;this.cache.delete(t)}this.cache.set(i,{result:n,timestamp:Date.now()})}clear(){this.cache.clear(),this.hits=0,this.misses=0}getStats(){const t=this.hits+this.misses;return{size:this.cache.size,maxSize:this.maxSize,hits:this.hits,misses:this.misses,hitRate:t>0?(this.hits/t*100).toFixed(1)+"%":"0%"}}};function a(t){return null==t?"":String(t).replace(/[&<>"']/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}"undefined"!=typeof window&&(window.VirtualizedJSONRenderer=n,window.IndexedSearch=i,window.WorkerPool=o,window.PerformanceController=r,window.ResultCache=s),void 0!==e&&e.exports&&(e.exports={VirtualizedJSONRenderer:n,IndexedSearch:i,WorkerPool:o,PerformanceController:r,ResultCache:s}),function(t){const e=[{id:"basic-get",title:"Basic GET stub",description:"Static JSON response for a GET endpoint – perfect starting point for simple mocks.",category:"basic",highlight:"GET · /api/example",feature:{path:["response","jsonBody","message"],label:"response.jsonBody.message"},content:{name:"Basic GET stub",request:{method:"GET",urlPath:"/api/example"},response:{status:200,jsonBody:{message:"Hello from WireMock!",timestamp:(new Date).toISOString()},headers:{"Content-Type":"application/json"}}}},{id:"post-body-pattern",title:"POST with JSON body match",description:"Matches on POST payload using JSONPath and echoes selected fields back in the response.",category:"advanced",highlight:"POST · /api/orders",feature:{path:["request","bodyPatterns",0,"matchesJsonPath"],label:"request.bodyPatterns[0].matchesJsonPath"},content:{name:"POST order matcher",request:{method:"POST",url:"/api/orders",headers:{"Content-Type":{contains:"application/json"}},bodyPatterns:[{matchesJsonPath:"$.type",expression:"$[?(@.type == 'priority')]"},{matchesJsonPath:"$.items[*]"}]},response:{status:201,headers:{"Content-Type":"application/json"},jsonBody:{id:"{{randomValue length=8 type='string'}}",status:"ACCEPTED",receivedAt:"{{now offset='0' pattern=\"yyyy-MM-dd'T'HH:mm:ssXXX\"}}"},transformers:["response-template"]},metadata:{tags:["orders","priority"]}}},{id:"webhook-callback",title:"Webhook callback",description:"Illustrates WireMock's webhook post-serve action to notify downstream services after a match.",category:"integration",highlight:"POST · /api/orders · webhook",feature:{path:["postServeActions","webhook","url"],label:"postServeActions.webhook.url"},content:{name:"Order accepted with webhook callback",request:{method:"POST",urlPath:"/api/orders",headers:{"Content-Type":{contains:"application/json"}},bodyPatterns:[{matchesJsonPath:"$.orderId"}]},response:{status:202,headers:{"Content-Type":"application/json"},jsonBody:{status:"QUEUED",message:"Order accepted and will trigger fulfillment webhook.",callback:"https://webhook.site/your-endpoint"}},postServeActions:{webhook:{method:"POST",url:"https://example.org/webhooks/order-events",headers:{"Content-Type":"application/json","X-WireMock-Source":"json-studio"},body:JSON.stringify({type:"ORDER_ACCEPTED",orderId:"{{jsonPath request.body '$.orderId'}}",occurredAt:"{{now offset='0' pattern=\"yyyy-MM-dd'T'HH:mm:ssXXX\"}}"})}},metadata:{tags:["webhook","postServeActions"]}}},{id:"regex-url",title:"Regex URL matcher",description:"Use `urlPathPattern` to handle numeric identifiers without enumerating every path.",category:"advanced",highlight:"GET · /api/items/{id}",feature:{path:["request","urlPathPattern"],label:"request.urlPathPattern"},content:{name:"Item lookup (regex)",request:{method:"GET",urlPathPattern:"/api/items/([0-9]+)",queryParameters:{locale:{matches:"^[a-z]{2}-[A-Z]{2}$"}}},response:{status:200,headers:{"Content-Type":"application/json"},jsonBody:{id:"{{request.pathSegments.[2]}}",locale:"{{request.query.locale}}",name:"Example item",price:12.5},transformers:["response-template"]}}},{id:"fault-injection",title:"Fault injection",description:"Simulate backend failures with delayed responses and WireMock faults to test resiliency.",category:"testing",highlight:"GET · /api/internal/report",feature:{path:["response","fault"],label:"response.fault"},content:{name:"Fault injection stub",request:{method:"GET",urlPath:"/api/internal/report",headers:{"X-Debug-Scenario":{equalTo:"fault-test"}}},response:{fixedDelayMilliseconds:1500,fault:"CONNECTION_RESET_BY_PEER",headers:{"Cache-Control":"no-cache"}},metadata:{severity:"high"}}},{id:"proxy-pass-through",title:"Proxy pass-through with overrides",description:"Forward requests to an upstream service while tweaking headers and enabling recording.",category:"proxy",highlight:"ANY · /external/* → proxy",feature:{path:["response","proxyBaseUrl"],label:"response.proxyBaseUrl"},content:{name:"External proxy passthrough",priority:10,request:{urlPattern:"/external/.*"},response:{proxyBaseUrl:"https://api.upstream.example.com",additionalProxyRequestHeaders:{"X-Trace-Id":'wm-{{randomValue type="UUID"}}'},additionalProxyResponseHeaders:{"X-Proxied-By":"WireMock JSON Studio"}},persistent:!0,metadata:{tags:["proxy","passthrough"]}}}];function n(t){return JSON.parse(JSON.stringify(t))}const i={getAll:()=>e.map(n),findById:t=>e.find(e=>e.id===t)||null,register(t){const n=function(t){if(!t||"object"!=typeof t)throw new Error("Template must be an object");if(!t.id)throw new Error("Template requires an id");return JSON.parse(JSON.stringify(t))}(t),i=e.findIndex(t=>t.id===n.id);return i>=0?e[i]=n:e.push(n),this.getAll()},replaceAll(t){if(!Array.isArray(t))throw new Error("replaceAll expects an array of templates");e.length=0;for(const n of t)e.push(JSON.parse(JSON.stringify(n)));return this.getAll()}};Object.freeze(i),t.MonacoTemplateLibrary||Object.defineProperty(t,"MonacoTemplateLibrary",{value:i,configurable:!1,enumerable:!0,writable:!1})}("undefined"!=typeof window?window:globalThis);const l={basic:"Basic",advanced:"Advanced",testing:"Testing",integration:"Integration",proxy:"Proxy"};function c(){return window.MonacoTemplateLibrary&&"function"==typeof window.MonacoTemplateLibrary.getAll?window.MonacoTemplateLibrary.getAll():[]}function d(t){if(!t)return"—";const e=t-Date.now(),n=Math.abs(e),i=[{limit:6e4,divisor:1e3,unit:"second"},{limit:36e5,divisor:6e4,unit:"minute"},{limit:864e5,divisor:36e5,unit:"hour"},{limit:6048e5,divisor:864e5,unit:"day"},{limit:2592e6,divisor:6048e5,unit:"week"},{limit:1/0,divisor:2592e6,unit:"month"}],o="undefined"!=typeof Intl&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(const{limit:r,divisor:s,unit:a}of i)if(n<r){const t=Math.round(e/s);if(o)return o.format(t,a);const n=t<0?"ago":"from now";return`${Math.abs(t)} ${a}${1!==Math.abs(t)?"s":""} ${n}`}return new Date(t).toLocaleString()}function u(t){if(!Number.isFinite(t)||t<=0)return"0 B";const e=[{limit:1024,suffix:"B",divisor:1},{limit:1048576,suffix:"KB",divisor:1024},{limit:1073741824,suffix:"MB",divisor:1048576}];for(const{limit:n,suffix:i,divisor:o}of e)if(t<n){const e=t/o;return"B"===i?`${Math.round(e)} ${i}`:`${e>=100?Math.round(e):e.toFixed(1)} ${i}`}return`${(t/1073741824).toFixed(2)} GB`}const h="frames",f="shaIndex",p="imock-history-lock",m=52428800,y=new Set(["headers"]),g=new Set(["id","uuid","updatedAt","insertionIndex"]);function w(t){return new Promise((e,n)=>{t.onsuccess=()=>e(t.result),t.onerror=()=>n(t.error)})}function b(t){return new Promise((e,n)=>{t.oncomplete=()=>e(),t.onabort=()=>n(t.error||new Error("Transaction aborted")),t.onerror=()=>n(t.error||new Error("Transaction error"))})}function v(t){if(!t||"object"!=typeof t)return"";if(t.name)return String(t.name).toLowerCase();const e=t.request||{};return[e.method?String(e.method):"",e.url||e.urlPath||e.urlPattern||e.urlPathPattern||""].filter(Boolean).join(" ").toLowerCase()}function S(t){return"string"==typeof t?t.replace(/\r\n/g,"\n"):t}function N(t,e={path:[]}){if(Array.isArray(t)){const n=e.path[e.path.length-1],i=t.map(t=>N(t,{path:[...e.path,null]}));return"mappings"===n?i.map(t=>({key:v(t),item:t})).sort((t,e)=>t.key.localeCompare(e.key)).map(({item:t})=>t):i}if(t&&"object"==typeof t){const n=[],i=function(t){return!(!t||!Array.isArray(t.path))&&t.path.includes("jsonBody")}(e);for(const[s,a]of Object.entries(t)){if(g.has(s)&&!i)continue;const t=e.path[e.path.length-1],o=t&&y.has(t)&&!i?s.toLowerCase():s,r=N(a,{path:[...e.path,o]});n.push([o,r])}const o={},r=i?n:n.sort((t,e)=>t[0].localeCompare(e[0]));for(const[t,e]of r)o[t]=e;return o}return"string"==typeof t?S(t):t}let E=null;async function C(t){if("undefined"!=typeof crypto&&crypto.subtle)try{if(t.byteLength>1e6){const e=await async function(t){if("undefined"==typeof Worker)return null;if(!E){const t=new Blob(["self.onmessage = async (event) => {\n    try {\n        const buffer = event.data;\n        const digest = await crypto.subtle.digest('SHA-256', buffer);\n        self.postMessage(digest, [digest]);\n    } catch (error) {\n        self.postMessage({ error: error.message });\n    }\n};"],{type:"application/javascript"});E=new Worker(URL.createObjectURL(t))}const e=t.buffer.slice(0);return new Promise((t,n)=>{const i=e=>{E.removeEventListener("message",i),E.removeEventListener("error",o);const{data:r}=e;r&&r.error?n(new Error(r.error)):t(r)},o=t=>{E.removeEventListener("message",i),E.removeEventListener("error",o),n(t)};E.addEventListener("message",i),E.addEventListener("error",o),E.postMessage(e,[e])})}(t);if(e instanceof ArrayBuffer)return{algorithm:"sha256",hash:Array.from(new Uint8Array(e)).map(t=>t.toString(16).padStart(2,"0")).join("")}}const e=await crypto.subtle.digest("SHA-256",t);return{algorithm:"sha256",hash:Array.from(new Uint8Array(e)).map(t=>t.toString(16).padStart(2,"0")).join("")}}catch(n){}const e=function(t){let e=-1;for(let n=0;n<t.length;n+=1){e^=t[n];for(let t=0;t<8;t+=1)e=e>>>1^3988292384&-(1&e)}return(-1^e)>>>0}(t).toString(16).padStart(8,"0");return{algorithm:"crc32",hash:e}}function P(t){return new Promise(e=>setTimeout(e,t))}class O{constructor(t=50){this.limit=Math.max(5,t),this.dbPromise=function(){if("undefined"==typeof indexedDB)throw new Error("IndexedDB is not available");return new Promise((t,e)=>{const n=indexedDB.open("imock-history-ak",1);n.onupgradeneeded=()=>{const t=n.result;if(!t.objectStoreNames.contains(h)){const e=t.createObjectStore(h,{keyPath:"seq",autoIncrement:!0});e.createIndex("id","id",{unique:!0}),e.createIndex("ts","ts")}t.objectStoreNames.contains(f)||t.createObjectStore(f,{keyPath:"sha256"})},n.onsuccess=()=>{const e=n.result;e.onversionchange=()=>{e.close()},t(e)},n.onerror=()=>e(n.error)})}(),this.cache=new Map,this.cacheLimit=5,this.currentId=null,this.lastEntry=null,this.budgetBytes=function(){if("undefined"==typeof navigator)return m;const t=navigator.userAgent||"";return/iphone|ipad|ipod/i.test(t)?31457280:m}(),this.stats={count:0,byteSize:0,latestTimestamp:null,latestLabel:null},this.ready=this.initialiseState()}async initialiseState(){try{const t=await this.dbPromise,e=await this.readAllFrames(t);if(e.length){const t=e[e.length-1];this.currentId=t.id,this.lastEntry={seq:t.seq,length:t.json.length,timestamp:t.ts,manual:Boolean(t.manual)}}let n=0,i=null,o=null;for(const r of e)n+=r.byteSize||0,(!i||r.ts>=i)&&(i=r.ts,o=r.label);this.stats={count:e.length,byteSize:n,latestTimestamp:i,latestLabel:o}}catch(t){}}async reset(t="",e={}){await this.ready;const n="string"==typeof t?t:"";await this.withLock(async()=>{const t=(await this.dbPromise).transaction([h,f],"readwrite");t.objectStore(h).clear(),t.objectStore(f).clear(),await b(t),this.cache.clear(),this.currentId=null,this.lastEntry=null,this.stats={count:0,byteSize:0,latestTimestamp:null,latestLabel:null}}),(n.length>0||e.forceInitial)&&await this.record(n,{...e,reason:e.reason||"Initial snapshot",label:e.label||"Initial document",force:!0})}async readAllFrames(t){return new Promise((e,n)=>{const i=t.transaction(h,"readonly").objectStore(h),o=[],r=i.openCursor();r.onsuccess=t=>{const n=t.target.result;n?(o.push(n.value),n.continue()):e(o)},r.onerror=()=>n(r.error)})}updateCache(t,e){if(t)for(this.cache.has(t)&&this.cache.delete(t),this.cache.set(t,e);this.cache.size>this.cacheLimit;){const t=this.cache.keys().next().value;this.cache.delete(t)}}async withLock(t){if("undefined"==typeof localStorage)return t();const e=Date.now()+3e3;let n=!1;for(let o=0;o<10;o+=1){const t=localStorage.getItem(p);if(!t||Number(t)<Date.now())try{localStorage.setItem(p,String(e)),n=!0;break}catch(i){}await P(100)}if(!n)return t();try{return await t()}finally{localStorage.getItem(p)===String(e)&&localStorage.removeItem(p)}}cleanMeta(t){if(!t||"object"!=typeof t)return{};const e={...t};return delete e.force,delete e.contentOverride,delete e.editor,delete e.labelGenerated,e}deriveLabel(t,e={}){const n=e&&e.action?e.action:"Snapshot",i="string"==typeof t?t.trim():"";if(!i)return n;try{const t=JSON.parse(i);if(t&&"object"==typeof t){if(t.name)return t.name;const e=t.request||{},n=e.method||"",i=e.url||e.urlPath||e.urlPattern||e.urlPathPattern||"",o=[];if(n&&o.push(n),i&&o.push(i),o.length)return o.join(" · ")}}catch(r){}const o=i.split("\n")[0];return o.length>60?`${o.slice(0,57)}…`:o||n}buildPreview(t){if("string"!=typeof t||0===t.trim().length)return"(empty document)";try{const e=JSON.parse(t),n=JSON.stringify(e,null,2);return this.truncatePreview(n)}catch(e){const n=t.split("\n").slice(0,12).join("\n");return this.truncatePreview(n)}}truncatePreview(t){return t.length<=480?t:`${t.slice(0,479)}…`}async record(t,e={}){await this.ready;const n="string"==typeof t?t:"",i=Date.now(),o=Boolean(e.manual),r=this.cleanMeta(e),s=function(t){if("string"==typeof t){if(!t.trim())return"";try{const e=N(JSON.parse(S(t)),{path:[]});return JSON.stringify(e,null,2)}catch(e){return S(t)}}if(t&&"object"==typeof t){const e=N(t,{path:[]});return JSON.stringify(e,null,2)}return void 0===t?"":String(t)}(n),a="undefined"!=typeof TextEncoder?new TextEncoder:null,l=a?a.encode(s):new Uint8Array(Array.from(s,t=>255&t.charCodeAt(0))),{hash:c,algorithm:d}=await C(l),u=this.lastEntry;if(!o&&u&&!e.force){const t=Math.abs(s.length-u.length),e=i-u.timestamp;if(t<200&&e<1e4)return{recorded:!1,reason:"debounced",entry:null}}return this.withLock(async()=>{const t=await this.dbPromise,e=t.transaction([h,f],"readwrite"),n=e.objectStore(h),a=e.objectStore(f),u=await w(a.get(c));if(null!=u){const t="object"==typeof u&&u.lastSeq?u.lastSeq:u,a=null!=t?await w(n.get(t)):null;if(a&&a.json===s)return a.occurrences=(a.occurrences||1)+1,a.lastAt=i,o&&!a.manual&&(a.manual=!0),a.meta={...a.meta||{},...r,manual:o||a.meta?.manual||a.manual,occurrences:a.occurrences,lastRecordedAt:new Date(i).toISOString(),hashAlgorithm:d},await w(n.put(a)),await b(e),this.stats.latestTimestamp=i,this.stats.latestLabel=a.label,this.currentId=a.id,this.lastEntry={seq:a.seq,length:s.length,timestamp:i,manual:a.manual},this.updateCache(a.seq,s),{recorded:!1,reason:"duplicate",entry:this.normalizeEntry(a)}}const p=r.label||this.deriveLabel(s,r),m={id:"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():`hist-${i}-${Math.random().toString(36).slice(2,8)}`,ts:i,kind:"full",sha256:c,shaAlgorithm:d,byteSize:l.byteLength,label:p,occurrences:1,json:s,manual:o,meta:{...r,label:p,reason:r.reason||r.action||"Edit",occurrences:1,firstRecordedAt:new Date(i).toISOString(),lastRecordedAt:new Date(i).toISOString(),hashAlgorithm:d}},y=await w(n.add(m));return m.seq=y,await w(a.put({sha256:c,lastSeq:y})),await b(e),this.updateCache(y,s),this.currentId=m.id,this.lastEntry={seq:y,length:s.length,timestamp:i,manual:o},this.stats.count+=1,this.stats.byteSize+=m.byteSize,this.stats.latestTimestamp=i,this.stats.latestLabel=p,await this.enforceBudget({withinLock:!0,db:t}),{recorded:!0,entry:this.normalizeEntry(m)}})}normalizeEntry(t){const e="string"==typeof t.json?t.json:"";return{id:t.id,seq:t.seq,timestamp:t.ts,content:e,label:t.label,preview:this.buildPreview(e),byteSize:t.byteSize,sizeLabel:u(t.byteSize||0),meta:{...t.meta||{},occurrences:t.occurrences||1,recordedAt:new Date(t.ts).toISOString()}}}async getEntries(t={}){await this.ready;const e=!0===t.newestFirst,n=await this.dbPromise,i=(await this.readAllFrames(n)).map(t=>this.normalizeEntry(t));return i.sort((t,n)=>e?n.timestamp-t.timestamp:t.timestamp-n.timestamp),t.limit?i.slice(0,t.limit):i}async getStats(){return await this.ready,{...this.stats}}getCurrentId(){return this.currentId}async getEntryById(t){await this.ready;const e=await this.dbPromise;return new Promise((n,i)=>{const o=e.transaction(h,"readonly").objectStore(h).index("id").get(t);o.onsuccess=()=>{n(o.result?this.normalizeEntry(o.result):null)},o.onerror=()=>i(o.error)})}markCurrent(t){this.currentId=t}async clear(t={}){await this.ready;const e=!1!==t.keepLatest,n=t.latestContent||"",i=t.label||"Current document";let o=null;e&&(o=(await this.getEntries({newestFirst:!0,limit:1}))[0]||null),await this.withLock(async()=>{const t=(await this.dbPromise).transaction([h,f],"readwrite");t.objectStore(h).clear(),t.objectStore(f).clear(),await b(t)}),this.cache.clear(),this.currentId=null,this.lastEntry=null,this.stats={count:0,byteSize:0,latestTimestamp:null,latestLabel:null},o?await this.record(o.content,{...o.meta,label:o.label,reason:"Preserved latest snapshot",manual:Boolean(o.meta?.manual),force:!0}):e&&n&&await this.record(n,{label:i,reason:"Current document",force:!0})}async enforceBudget(t={}){if(await this.ready,this.stats.byteSize<=this.budgetBytes)return;const e=async t=>{const e=await this.readAllFrames(t);if(!e.length)return;const n=e[e.length-1].seq,i=new Set(e.filter(t=>t.manual).map(t=>t.seq)),o=new Set([n]),r=new Map,s=Date.now();for(const u of e){if(i.has(u.seq)){o.add(u.seq);continue}const t=s-u.ts;let e;e=t<=36e5?6e4:t<=864e5?6e5:t<=6048e5?36e5:864e5;const n=`${e}:${Math.floor(u.ts/e)}`,a=r.get(n);(!a||a.ts<u.ts)&&r.set(n,{seq:u.seq,ts:u.ts})}for(const u of r.values())o.add(u.seq);const a=e.filter(t=>!o.has(t.seq)&&!i.has(t.seq)).sort((t,e)=>t.ts-e.ts);if(!a.length)return;const l=t.transaction([h,f],"readwrite"),c=l.objectStore(h),d=l.objectStore(f);for(const u of a){await w(c.delete(u.seq)),this.stats.byteSize-=u.byteSize||0,this.stats.count-=1;const t=await w(d.get(u.sha256));if(t&&(t.lastSeq===u.seq||t===u.seq)){const t=e.filter(t=>t.sha256===u.sha256&&t.seq!==u.seq).sort((t,e)=>e.seq-t.seq)[0];t?await w(d.put({sha256:u.sha256,lastSeq:t.seq})):await w(d.delete(u.sha256))}if(this.stats.byteSize<=this.budgetBytes)break}if(await b(l),this.stats.byteSize<=0||this.stats.count<=0)this.stats={count:0,byteSize:0,latestTimestamp:null,latestLabel:null},this.currentId=null,this.lastEntry=null;else{const e=await this.readAllFrames(t);if(e.length){this.stats.count=e.length,this.stats.byteSize=e.reduce((t,e)=>t+(e.byteSize||0),0);const t=e[e.length-1];this.currentId=t.id,this.lastEntry={seq:t.seq,length:t.json.length,timestamp:t.ts,manual:Boolean(t.manual)},this.stats.latestTimestamp=t.ts,this.stats.latestLabel=t.label}else this.stats={count:0,byteSize:0,latestTimestamp:null,latestLabel:null},this.currentId=null,this.lastEntry=null}};t.withinLock&&t.db?await e(t.db):await this.withLock(async()=>{const t=await this.dbPromise;await e(t)})}}function M(t){if(null==t)return"";if("string"==typeof t)return t.length>80?`${t.slice(0,77)}…`:t;if("number"==typeof t||"boolean"==typeof t)return String(t);try{const e=JSON.stringify(t);return e.length>80?`${e.slice(0,77)}…`:e}catch(e){return""}}function k(t){if(!t||!t.feature)return null;const e=t.feature.path||t.feature,n=t.feature.label||(Array.isArray(e)?e.join("."):String(e)),i=function(t,e){if(t&&e)return(Array.isArray(e)?e:String(e).replace(/\[(\d+)\]/g,".$1").split(".")).reduce((t,e)=>{if(null!=t){if(Array.isArray(t)){const n=Number(e);return Number.isInteger(n)?t[n]:void 0}return t[e]}},t)}(t.content,e);return void 0===i?null:{label:n,value:M(i)}}function x(t){if(!t)return"";if(t.highlight)return t.highlight;const e=[];return t.content?.request?.method&&e.push(t.content.request.method),(t.content?.request?.url||t.content?.request?.urlPath)&&e.push(t.content.request.url||t.content.request.urlPath),e.join(" · ")}function A(t){return"string"!=typeof t&&(t=String(t??"")),"undefined"!=typeof navigator&&navigator.clipboard&&"function"==typeof navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>!0).catch(()=>e(t)):Promise.resolve(e(t));function e(t){try{const e=document.createElement("textarea");return e.value=t,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),!0}catch(e){return!1}}}function I(){const t=document.getElementById("templatePreviewModal");if(!t||"true"===t.dataset.previewBound)return;t.dataset.previewBound="true";const e=t.querySelector("#templatePreviewActions");e&&e.addEventListener("click",async e=>{const n=e.target instanceof HTMLElement?e.target.closest("[data-template-action]"):null;if(!n)return;e.preventDefault();const i=n.dataset.templateAction;if(!i)return;const o=(r=t.dataset.templateId)&&c().find(t=>t.id===r)||null;var r;if(o)if("apply"!==i){if("copy"===i){const t="string"==typeof o.content?o.content:JSON.stringify(o.content,null,2),e=await A(t),n=window.monacoInitializer;return void(n&&"function"==typeof n.showNotification&&n.showNotification(e?`Template "${o.title}" copied`:"Clipboard copy failed",e?"success":"error"))}"close"===i&&"function"==typeof window.closeModal&&window.closeModal("templatePreviewModal")}else L(o)})}function J(t){if(!t||!t.id)return;const e=document.getElementById("templatePreviewModal");if(!e)return;e.dataset.templateId=t.id;const n=e.querySelector("#modal-title-template-preview");n&&(n.textContent=t.title||"Template preview");const i=e.querySelector("#templatePreviewDescription");i&&(i.textContent=t.description||"",i.style.display=t.description?"":"none");const o=e.querySelector("#templatePreviewMeta");if(o){const e=x(t)||"—",n=k(t);o.innerHTML="";const i=document.createElement("div");i.className="template-preview-meta__row";const r=document.createElement("span");r.className="template-preview-meta__label",r.textContent="Endpoint";const s=document.createElement("span");if(s.className="template-preview-meta__value",s.textContent=e,i.appendChild(r),i.appendChild(s),o.appendChild(i),n){const t=document.createElement("div");t.className="template-preview-meta__row";const e=document.createElement("span");e.className="template-preview-meta__label",e.textContent="Highlight";const i=document.createElement("code");i.className="template-preview-meta__code",i.textContent=`${n.label} = ${n.value}`,t.appendChild(e),t.appendChild(i),o.appendChild(t)}}const r=e.querySelector("#templatePreviewCode");if(r){const e=t&&t.content?t.content:{},n="string"==typeof e?e:JSON.stringify(e,null,2);r.textContent=n}I(),"function"==typeof window.openModal&&window.openModal("templatePreviewModal")}function L(t){const e=window.monacoInitializer;if(!e)return;let n=!1;"function"==typeof e.applyTemplate?n=e.applyTemplate(t):"function"==typeof e.applyTemplateById&&(n=e.applyTemplateById(t.id)),n&&"function"==typeof window.closeModal&&(window.closeModal("templatePreviewModal"),window.closeModal("fullscreenModal"))}function T(t){if("string"!=typeof t)return null;try{return JSON.parse(t)}catch(e){return null}}function $(t){if(void 0===t)return"—";if(null===t)return"null";if("string"==typeof t)return`"${t.length>80?`${t.slice(0,77)}…`:t}"`;if("number"==typeof t||"boolean"==typeof t)return String(t);if(Array.isArray(t))return 0===t.length?"[]":t.every(t=>null==t||["string","number","boolean"].includes(typeof t))&&t.length<=5?`[${t.map(t=>$(t)).join(", ")}]`:`[${t.length} items]`;if("object"==typeof t){const e=Object.keys(t||{});return e.length?`{${e.slice(0,5).join(", ")}${e.length>5?", …":""}}`:"{}"}return String(t)}function R(t,e,n="",i=0){if(i>=4||null==t||"object"!=typeof t)return void e.set(n||"(root)",$(t));if(Array.isArray(t)){if(0===t.length)return void e.set(n||"(root)","[]");const o=Math.min(t.length,20);for(let r=0;r<o;r+=1){const o=n?`${n}[${r}]`:`[${r}]`;R(t[r],e,o,i+1)}return}const o=Object.keys(t);if(!o.length)return void e.set(n||"(root)","{}");const r=o.sort((t,e)=>t.localeCompare(e)).slice(0,20);for(const s of r){const o=n?`${n}.${s}`:s;R(t[s],e,o,i+1)}}function j(t,e,n={}){const i="number"==typeof n.limit?n.limit:8,o=T(t),r=T(e);if(!o){const n="string"==typeof t?t.length:0;if(r)return`Snapshot replaced with non-JSON content (${n} chars)`;const i="string"==typeof e?e.length:0;return null==e?`Snapshot captured (non-JSON, ${n} chars)`:"string"==typeof e&&e===t?"No textual changes detected":`Content changed (${i} → ${n} chars)`}const s=new Map;R(o,s);const a=new Map;r&&R(r,a);const l=new Set([...s.keys(),...a.keys()]),c=Array.from(l).sort((t,e)=>t.localeCompare(e)),d=[];let u=0;for(const h of c){const t=a.has(h)?a.get(h):void 0,e=s.has(h)?s.get(h):void 0;if(t===e)continue;const n=h||"(root)";let o;o=void 0===t?`${n}: ++ ${e}`:void 0===e?`${n}: -- ${t}`:`${n}: ${t} → ${e}`,d.length<i?d.push(o):u+=1}return d.length?(u>0&&d.push(`…and ${u} more change${1===u?"":"s"}`),d.join("\n")):null==e?"Snapshot captured":"No field-level changes detected"}function W(t,e){const n=document.getElementById("historyPreviewModal");if(!n||!t)return;const i=window.monacoInitializer,o=n.querySelector("#modal-title-history-preview");o&&(o.textContent=t.label||"Snapshot preview");const r=n.querySelector("#historyPreviewMeta"),s=t.meta?.occurrences||1;var a,l;a=r,l=[["Saved",`${d(t.timestamp)} · ${new Date(t.timestamp).toLocaleString()}`],["Reason",t.meta?.reason||"edit"],["Size",t.sizeLabel||u(t.byteSize||(t.content?t.content.length:0))],["Occurrences",`${s}×`]],a&&(a.innerHTML="",l.forEach(([t,e])=>{const n=document.createElement("div");n.className="history-preview-meta__row";const i=document.createElement("span");i.className="history-preview-meta__label",i.textContent=t;const o=document.createElement("span");o.className="history-preview-meta__value",o.textContent=e,n.appendChild(i),n.appendChild(o),a.appendChild(n)}));const c=n.querySelector("#historyPreviewSummary");c&&(c.textContent=j(t.content,e?e.content:null,{limit:20}));const h=n.querySelector("#historyPreviewContent");h&&(h.textContent=function(t){if("string"!=typeof t)return"";const e=T(t);if(null!=e)try{return JSON.stringify(e,null,2)}catch(n){}return t}(t.content));const f=n.querySelector("#historyPreviewActions");if(f){f.dataset.currentContent=t.content||"",f.dataset.entryId=t.id||"";const e=f.querySelector('[data-history-preview-action="restore"]');if(e){const n=i&&"function"==typeof i.getCurrentHistoryEntryId?i.getCurrentHistoryEntryId():null,o=n&&t.id===n;e.disabled=Boolean(o),e.textContent=o?"Current version":"Restore"}f.dataset.bound||(f.dataset.bound="true",f.addEventListener("click",async t=>{const e=t.target instanceof HTMLElement?t.target.closest("[data-history-preview-action]"):null;if(e){if(t.preventDefault(),"copy"===e.dataset.historyPreviewAction){const t=f.dataset.currentContent||"",e=await A(t);return void(i&&"function"==typeof i.showNotification&&i.showNotification(e?"Snapshot copied to clipboard":"Failed to copy snapshot",e?"success":"error"))}if("restore"===e.dataset.historyPreviewAction){if(!i||"function"!=typeof i.restoreHistoryEntry)return;const t=f.dataset.entryId;if(!t||e.disabled)return;const o=e.textContent;e.disabled=!0;try{await i.restoreHistoryEntry(t,{forceRestore:!1,requireConfirm:!0})}catch(n){return e.disabled=!1,void(e.textContent=o)}const r="function"==typeof i.getCurrentHistoryEntryId?i.getCurrentHistoryEntryId():null;r&&t===r?e.textContent="Current version":(e.disabled=!1,e.textContent=o)}}}))}window.openModal("historyPreviewModal")}class q{constructor(){this.isInitialized=!1,this.editors=new Map,this.performanceController="undefined"!=typeof PerformanceController?new PerformanceController:null,this.searchIndex="undefined"!=typeof IndexedSearch?new IndexedSearch:{updateIndex:()=>{},searchAll:()=>[],buildIndex:()=>{}},this.resultCache="undefined"!=typeof ResultCache?new ResultCache:{get:()=>null,set:()=>{}},this.workerPool=null,this.diffEditor=null,this.virtualRenderer=null,this.healthMonitoring={enabled:!1,interval:null,stats:{}},this.lastJSONPathResults=[],this.lastJSONPathPointerLocator=null,this.lastJSONPathMeta={totalCount:0,truncated:!1},this.currentJSONPathIndex=-1,this.lastJSONPathQuery="",this.jsonPathSearchRequestId=0,this.findWidgetIntegration=null,this.history=new O(60),this.historyDebounce=null,this.suspendHistoryRecording=!1,this.historyNeedsRender=!0,this.monacoSources=this.resolveMonacoSources(),this.activeMonacoSource=null,this.pendingReadOnlyRestore=null,this.editorReadOnlyLocked=!1,this.pendingMappingLoadId=null}resolveMonacoSources(){const t=[{label:"jsDelivr",baseUrl:"https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs"},{label:"cdnjs",baseUrl:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs"},{label:"unpkg",baseUrl:"https://unpkg.com/monaco-editor@0.44.0/min/vs"}],e=("undefined"!=typeof window&&Array.isArray(window.MONACO_CDN_SOURCES)&&window.MONACO_CDN_SOURCES.length?window.MONACO_CDN_SOURCES:t).map(t=>t?"string"==typeof t?{label:t,baseUrl:t}:t.baseUrl?{label:t.label||t.baseUrl,baseUrl:t.baseUrl}:t.url?{label:t.label||t.url,baseUrl:t.url}:null:null).filter(t=>t&&t.baseUrl),n=[],i=new Set;for(const o of e){const t=o.baseUrl.replace(/\/+$/,"");i.has(t)||(i.add(t),n.push({label:o.label||t,baseUrl:t}))}return n.length?n:t.map(t=>({label:t.label,baseUrl:t.baseUrl.replace(/\/+$/,"")}))}async initialize(){if(!this.isInitialized)try{await this.loadMonaco(),this.setupWireMockSchema(),this.setupOptimizations(),await this.createEditors(),this.setupEventHandlers(),this.isInitialized=!0}catch(t){throw t}}async loadMonaco(){await this.waitForMonacoLoader();const t=[];for(const o of this.monacoSources){this.configureMonacoLoader(o);try{return await this.requireMonacoModule(),void(this.activeMonacoSource=o.baseUrl)}catch(i){const e=this.normalizeMonacoLoadError(i,o);t.push({source:o,error:e}),this.invalidateFailedMonacoLoad(o)}}const e=t.map(({error:t})=>t.message).join("; "),n=new Error(`Monaco Editor could not be loaded from any configured source. Attempts: ${e||"none"}`);throw n.attempts=t,n}async waitForMonacoLoader(t=1e4){const e=Date.now();for(;!this.isMonacoLoaderAvailable();){if(Date.now()-e>t)throw new Error("Monaco AMD loader did not become available");await q.sleep(50)}}isMonacoLoaderAvailable(){const t="function"==typeof require?require:"undefined"!=typeof window?window.require:void 0;return"function"==typeof t&&"function"==typeof t.config}configureMonacoLoader(t){const e=t.baseUrl.replace(/\/+$/,""),n="function"==typeof require?require:"undefined"!=typeof window?window.require:void 0;n&&"function"==typeof n.config?n.config({paths:{vs:e}}):"undefined"!=typeof window&&(window.require=window.require||{},window.require.paths=Object.assign({},window.require.paths||{},{vs:e})),"undefined"!=typeof window&&(window.MONACO_BASE_URL=e)}requireMonacoModule(){const t="function"==typeof require?require:"undefined"!=typeof window?window.require:void 0;return new Promise((e,n)=>{try{if("function"!=typeof t)return void n(new Error("Monaco AMD loader is not available"));t(["vs/editor/editor.main"],e,t=>n(t))}catch(i){n(i)}})}normalizeMonacoLoadError(t,e){const n=e.label||e.baseUrl;if(!t)return new Error(`[${n}] Unknown error while loading Monaco Editor`);if(t instanceof Event){const e=t.target,i=e&&e.src?e.src:null,o=new Error(i?`[${n}] Network error while loading ${i}`:`[${n}] Network error while loading Monaco Editor`);return o.cause=t,o.script=i,o}if("string"==typeof t)return new Error(`[${n}] ${t}`);if(t&&t.message){const e=new Error(`[${n}] ${t.message}`);return e.cause=t,e}const i=new Error(`[${n}] ${String(t)}`);return i.cause=t,i}invalidateFailedMonacoLoad(t){const e=t.baseUrl.replace(/\/+$/,""),n="function"==typeof require?require:"undefined"!=typeof window?window.require:void 0;if(n&&"function"==typeof n.undef)try{n.undef("vs/editor/editor.main")}catch(o){console&&console.debug}const i=n&&n.s&&n.s.contexts&&n.s.contexts._;if(i){if(i.urlFetched)for(const t of Object.keys(i.urlFetched))t&&t.startsWith(e)&&delete i.urlFetched[t];if(i.defined)for(const t of Object.keys(i.defined))t&&t.startsWith("vs/")&&delete i.defined[t]}"undefined"!=typeof document&&document.querySelectorAll("script[src]").forEach(t=>{const n=t.getAttribute("src");n&&n.startsWith(`${e}/`)&&/\/vs\//.test(n)&&!/loader\.js$/i.test(n)&&t.remove()})}static sleep(t){return new Promise(e=>setTimeout(e,t))}setupWireMockSchema(){monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:[{uri:"http://wiremock.org/schemas/mapping.json",fileMatch:["*"],schema:{type:"object",properties:{id:{type:"string",description:"Unique identifier for the mapping"},name:{type:"string",description:"Human-readable name for the mapping"},request:{type:"object",description:"Request matching criteria",properties:{method:{enum:["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS","ANY"],description:"HTTP method to match"},url:{type:"string",description:"Exact URL to match"},urlPath:{type:"string",description:"URL path to match"},urlPathPattern:{type:"string",description:"URL path pattern (regex)"},urlPattern:{type:"string",description:"Full URL pattern (regex)"},queryParameters:{type:"object",description:"Query parameter matching"},headers:{type:"object",description:"HTTP headers matching"},bodyPatterns:{type:"array",description:"Request body matching patterns",items:{type:"object"}}}},response:{type:"object",description:"Response configuration",properties:{status:{type:"number",minimum:100,maximum:599,description:"HTTP status code"},body:{type:"string",description:"Response body as string"},jsonBody:{type:["object","array"],description:"Response body as JSON"},headers:{type:"object",description:"Response headers"},fixedDelayMilliseconds:{type:"number",description:"Fixed delay in milliseconds"}}},priority:{type:"number",description:"Mapping priority"},scenarioName:{type:"string",description:"Scenario this mapping belongs to"},metadata:{type:"object",description:"Custom metadata"}},required:["request","response"]}}]})}setupOptimizations(){try{"undefined"!=typeof WorkerPool?(this.workerPool=new WorkerPool("json-worker.js",2),this.startHealthMonitoring()):this.workerPool={execute:async(t,e,n)=>{switch(t){case"format":const t=JSON.parse(e.text);return JSON.stringify(t,null,2);case"minify":const n=JSON.parse(e.text);return JSON.stringify(n);case"validate":try{return JSON.parse(e.text),{valid:!0}}catch(i){return{valid:!1,error:i.message}}case"sort_keys":const o=e&&"number"==typeof e.indent&&e.indent>=0?e.indent:2,r=JSON.parse(e.text),s=this.sortKeysDeep(r);return JSON.stringify(s,null,o);default:return e}},terminate:()=>{},getStats:()=>({workers:0,busy:0,queued:0,pending:0})},"undefined"!=typeof VirtualizedJSONRenderer&&(this.virtualRenderer=null)}catch(t){}}async createEditors(){const t="dark"===document.body.dataset.theme?"vs-dark":"vs",e=new URLSearchParams(window.location.search).get("mappingId")?"":this.getDefaultStub(),n=document.getElementById("jsonEditor");n&&(window.editor=this.createEditor(n,{language:"json",theme:t,value:e,automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on",formatOnPaste:!0,formatOnType:!0,folding:!0}),this.editors.set("main",window.editor),await this.initializeHistory(e))}prepareEditorForMappingLoad(t){const e=this.getActiveEditor();if(!e)return;let n=!1;try{if("undefined"!=typeof monaco&&monaco.editor&&monaco.editor.EditorOption)n=Boolean(e.getOption(monaco.editor.EditorOption.readOnly));else if("function"==typeof e.getRawOptions){const t=e.getRawOptions();n=Boolean(t&&t.readOnly)}}catch(i){}if(this.pendingReadOnlyRestore=n,n)this.editorReadOnlyLocked=!1;else try{e.updateOptions({readOnly:!0}),this.editorReadOnlyLocked=!0}catch(i){this.editorReadOnlyLocked=!1}this.suspendHistoryRecording=!0;try{e.setValue("")}finally{this.suspendHistoryRecording=!1}this.historyDebounce&&(clearTimeout(this.historyDebounce),this.historyDebounce=null),t&&(this.pendingMappingLoadId=t)}finalizeEditorMappingLoad(){const t=this.getActiveEditor();if(t)if(this.editorReadOnlyLocked)try{t.updateOptions({readOnly:!1})}catch(e){}else if("boolean"==typeof this.pendingReadOnlyRestore)try{t.updateOptions({readOnly:this.pendingReadOnlyRestore})}catch(e){}this.editorReadOnlyLocked=!1,this.pendingReadOnlyRestore=null,this.pendingMappingLoadId=null}createEditor(t,e){const n=monaco.editor.create(t,e);if(this.setupFindWidgetIntegration(n),"undefined"!=typeof VirtualizedJSONRenderer){const t=new VirtualizedJSONRenderer(n);n.virtualRenderer=t,e.value&&t.setContent(e.value)}return n.onDidChangeModelContent(()=>{this.changeTimeout&&clearTimeout(this.changeTimeout),this.changeTimeout=setTimeout(()=>{this.onContentChange(n)},500)}),n}async initializeHistory(t=""){const e="string"==typeof t?t:"";this.history||(this.history=new O(60)),await this.history.reset(e,{label:"Initial document",reason:"Initial snapshot"}),this.historyNeedsRender=!0,await this.refreshHistoryUI({statsOnly:!0})}markHistoryRendered(){this.historyNeedsRender=!1}getHistoryEntries(t={}){return this.history?this.history.getEntries(t):Promise.resolve([])}getHistoryStats(){return this.history?this.history.getStats():Promise.resolve({count:0,byteSize:0,latestTimestamp:null})}getCurrentHistoryEntryId(){return this.history?this.history.getCurrentId():null}async recordHistorySnapshot(t="Edit",e={}){if(!this.history)return null;const n=e.editor||this.getActiveEditor();if(!n)return null;let i;if(i="string"==typeof e.contentOverride?e.contentOverride:n.virtualRenderer&&"function"==typeof n.virtualRenderer.getFullContent?n.virtualRenderer.getFullContent():"function"==typeof n.getValue?n.getValue():"",!(e.allowInvalid??Boolean(e.manual)))try{JSON.parse(i)}catch(s){return e.silent,{recorded:!1,skipped:!0,reason:"invalid-json"}}const o={reason:t,label:e.label,manual:Boolean(e.manual),action:t,force:Boolean(e.force)},r=await this.history.record(i,o);return r&&r.recorded&&(this.historyNeedsRender=!0,await this.refreshHistoryUI({statsOnly:!0===e.statsOnly})),r}async refreshHistoryUI(t={}){if("function"!=typeof window.renderHistoryModal)return;const e=document.getElementById("historyModal"),n=e&&(e.classList.contains("show")||"false"===e.getAttribute("aria-hidden"));if(t.force||n)return await window.renderHistoryModal({statsOnly:Boolean(t.statsOnly)}),void(this.historyNeedsRender=!1);t.statsOnly&&document.getElementById("historyStats")&&(await window.renderHistoryModal({statsOnly:!0}),this.historyNeedsRender=!1)}shouldRenderHistory(){return this.historyNeedsRender}async restoreHistoryEntry(t,e={}){if(!this.history)return this.showNotification("History is unavailable","warning"),!1;const n=await this.history.getEntryById(t);if(!n)return this.showNotification("History entry not found","warning"),!1;const i=this.getActiveEditor();if(!i)return this.showNotification("No active editor to restore into","warning"),!1;if((i.getValue?i.getValue():"")===n.content&&!e.forceRestore)return this.history.markCurrent(n.id),await this.refreshHistoryUI({force:!0}),this.showNotification("Already on this version","info"),!0;if(!e.forceRestore&&!1!==e.requireConfirm){const t=n.label||"snapshot",e=`Restore snapshot "${t.length>80?`${t.slice(0,77)}…`:t}"? Current editor content will be replaced.`;if("function"==typeof window.confirm&&!window.confirm(e))return!1}if(this.suspendHistoryRecording=!0,i.setValue(n.content),this.suspendHistoryRecording=!1,this.history.markCurrent(n.id),this.historyNeedsRender=!0,await this.refreshHistoryUI({force:!0}),this.showNotification(`Restored snapshot: ${n.label}`,"success"),"undefined"!=typeof document){const t=Array.from(document.querySelectorAll('.modal.show, .modal[aria-hidden="false"]'));if(t.length)for(const e of t)("undefined"==typeof HTMLElement||e instanceof HTMLElement)&&e&&e.id&&("function"==typeof window.closeModal?window.closeModal(e.id):(e.classList.remove("show"),e.classList.add("hidden"),e.style.display="none",e.setAttribute("aria-hidden","true")))}return!0}async clearHistory(t={}){if(!this.history)return;const e=this.getActiveEditor(),n=e&&"function"==typeof e.getValue?e.getValue():"";await this.history.clear({keepLatest:!1!==t.keepLatest,latestContent:n,label:t.label||"Current document"}),this.historyNeedsRender=!0,await this.refreshHistoryUI({force:!0})}getTemplateLibrary(){return c()}applyTemplateById(t,e={}){const n=this.getTemplateLibrary().find(e=>e.id===t);return n?this.applyTemplate(n,e):(this.showNotification("Template not found","error"),!1)}applyTemplate(t,e={}){const n=this.getActiveEditor();if(!n)return this.showNotification("No active editor to apply template","warning"),!1;const i=t&&t.content?t.content:{};let o="string"==typeof i?i:JSON.stringify(i,null,2);"function"==typeof e.transform&&(o=e.transform(o,t)||o);const r=n.getValue?n.getValue():"",s=!1!==e.replace;let a=o;return!s&&r&&(a=`${r.trimEnd()}\n\n${o}`),!(s&&r&&!e.silent&&!1!==e.confirm&&"function"==typeof window.confirm&&!window.confirm(`Replace current document with "${t.title}" template?`))&&(this.suspendHistoryRecording=!0,n.setValue(a),this.suspendHistoryRecording=!1,this.recordHistorySnapshot("Template applied",{label:t.title,manual:!0,force:!0,statsOnly:!1}).catch(t=>{}),this.showNotification(`Template "${t.title}" applied`,"success"),!0)}setupEventHandlers(){this.setupKeyboardShortcuts(),this.setupThemeHandler()}setupKeyboardShortcuts(){window.editor&&[{key:monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyN,action:()=>this.newDocument()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyO,action:()=>this.loadFile()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyS,action:()=>this.saveFile()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.KeyF,action:()=>this.formatJSON()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyM,action:()=>this.minifyJSON()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyT,action:()=>this.validateJSON()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.BracketLeft,action:()=>this.collapseAllFolds({focus:!0})},{key:monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.BracketRight,action:()=>this.expandAllFolds({focus:!0})},{key:monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KeyS,action:()=>this.sortJSONKeys()},{key:monaco.KeyMod.Alt|monaco.KeyCode.KeyN,action:()=>this.navigateJSONPathMatches(1)},{key:monaco.KeyMod.Alt|monaco.KeyCode.KeyP,action:()=>this.navigateJSONPathMatches(-1)},{key:monaco.KeyMod.Alt|monaco.KeyCode.KeyJ,action:()=>this.toggleFindWidgetJSONPathMode()}].forEach(({key:t,action:e})=>{window.editor.addCommand(t,e)})}setupThemeHandler(){new MutationObserver(t=>{t.forEach(t=>{if("attributes"===t.type&&"data-theme"===t.attributeName){const t="dark"===document.body.dataset.theme?"vs-dark":"vs";monaco.editor.setTheme(t),this.diffEditor&&this.diffEditor.updateOptions({theme:t})}})}).observe(document.body,{attributes:!0,attributeFilter:["data-theme"]})}onContentChange(t){const e=t.virtualRenderer?t.virtualRenderer.getFullContent():t.getValue();this.searchIndex&&"function"==typeof this.searchIndex.buildIndex?this.searchIndex.buildIndex(e):this.searchIndex&&"function"==typeof this.searchIndex.updateIndex&&this.searchIndex.updateIndex(e),t.virtualRenderer&&e.split("\n").length>5e3&&t.virtualRenderer.setContent(e),this.suspendHistoryRecording||(this.historyNeedsRender=!0,this.historyDebounce&&clearTimeout(this.historyDebounce),this.historyDebounce=setTimeout(()=>{this.recordHistorySnapshot("Auto snapshot",{statsOnly:!0,allowInvalid:!1}).catch(t=>{})},1500))}getDefaultStub(){return JSON.stringify({name:"Example WireMock Mapping",request:{method:"GET",urlPath:"/api/example"},response:{status:200,jsonBody:{message:"Hello from WireMock!",timestamp:"2024-01-01T00:00:00Z"},headers:{"Content-Type":"application/json"}}},null,2)}async formatJSON(){const t=this.getActiveEditor(),e=t.getValue();try{if(this.workerPool){const n=await this.workerPool.execute("format",{text:e},1);t.setValue(n)}else{const n=JSON.parse(e),i=JSON.stringify(n,null,2);t.setValue(i)}this.showNotification("JSON formatted","success")}catch(n){this.showNotification("Format error: "+n.message,"error")}}async minifyJSON(){const t=this.getActiveEditor(),e=t.getValue();try{if(this.workerPool){const n=await this.workerPool.execute("minify",{text:e},1);t.setValue(n)}else{const n=JSON.parse(e),i=JSON.stringify(n);t.setValue(i)}this.showNotification("JSON minified","success")}catch(n){this.showNotification("Minify error: "+n.message,"error")}}async validateJSON(){const t=this.getActiveEditor().getValue();try{if(this.workerPool){const e=await this.workerPool.execute("validate",{text:t},1);e.valid?this.showNotification("JSON is valid","success"):this.showNotification(`JSON invalid: ${e.error}`,"error")}else JSON.parse(t),this.showNotification("JSON is valid","success")}catch(e){this.showNotification("JSON invalid: "+e.message,"error")}}getActiveEditor(){return window.editor||this.editors.get("main")}resolveTargetEditors(t={}){if(t&&t.editor)return t.editor?[t.editor]:[];if(t&&Array.isArray(t.editors)&&t.editors.length)return t.editors.filter(Boolean);const e=new Set,n=document.getElementById("editorContainer");if(!n||"none"!==n.style.display){const t=this.editors.get("main");t&&e.add(t)}const i=document.getElementById("compareContainer");if(i&&"none"!==i.style.display)if(this.diffEditor){const t="function"==typeof this.diffEditor.getOriginalEditor?this.diffEditor.getOriginalEditor():null,n="function"==typeof this.diffEditor.getModifiedEditor?this.diffEditor.getModifiedEditor():null;t&&e.add(t),n&&e.add(n)}else{const t=this.editors.get("compareEditorLeft"),n=this.editors.get("compareEditorRight");t&&e.add(t),n&&e.add(n)}if(!e.size){const t=this.getActiveEditor();t&&e.add(t)}return Array.from(e).filter(Boolean)}runEditorCommand(t,e,n=null){if(!t)return!1;try{if("function"==typeof t.getAction){const n=t.getAction(e);if(n&&"function"==typeof n.run&&(!n.isSupported||n.isSupported())){const t=n.run();return t&&"function"==typeof t.then&&t.catch(t=>{}),!0}}if("function"==typeof t.trigger)return t.trigger("json-tools",e,n),!0}catch(i){}return!1}executeCommandOnEditors(t,e={}){const n=this.resolveTargetEditors(e);let i=0;return n.forEach(n=>{this.runEditorCommand(n,t,e.payload)&&i++}),e.focus&&n[0]&&"function"==typeof n[0].focus&&n[0].focus(),{executed:i,editors:n}}collapseAllFolds(t={}){const{executed:e}=this.executeCommandOnEditors("editor.foldAll",t);if(e>0){const t=e>1?"Collapsed JSON structures in all visible editors":"Collapsed JSON structures";this.showNotification(t,"success")}else this.showNotification("Unable to collapse JSON structures","warning")}expandAllFolds(t={}){const{executed:e}=this.executeCommandOnEditors("editor.unfoldAll",t);if(e>0){const t=e>1?"Expanded JSON structures in all visible editors":"Expanded JSON structures";this.showNotification(t,"success")}else this.showNotification("Unable to expand JSON structures","warning")}async sortJSONKeys(t={}){const e=this.getActiveEditor();if(!e)return void this.showNotification("No active editor","warning");const n=e.getValue(),i=e.getModel&&e.getModel(),o=t&&"number"==typeof t.indent&&t.indent>=0?t.indent:i&&"function"==typeof i.getOptions?i.getOptions().tabSize:2,r=Number.isFinite(o)?o:2;try{let t;if(this.workerPool&&"function"==typeof this.workerPool.execute)t=await this.workerPool.execute("sort_keys",{text:n,indent:r},1);else{const e=JSON.parse(n),i=this.sortKeysDeep(e);t=JSON.stringify(i,null,r)}"string"!=typeof t&&(t=JSON.stringify(t)),t!==n&&e.setValue(t),this.showNotification("JSON keys sorted alphabetically","success")}catch(s){this.showNotification("Sort keys error: "+s.message,"error")}}sortKeysDeep(t){if(Array.isArray(t))return t.map(t=>this.sortKeysDeep(t));if(t&&"object"==typeof t){const e=Object.keys(t).sort((t,e)=>t.localeCompare(e)),n={};return e.forEach(e=>{n[e]=this.sortKeysDeep(t[e])}),n}return t}showNotification(t,e){"undefined"!=typeof showNotification&&showNotification(t,e)}loadMappingIntoEditor(t,e={}){const n=this.getActiveEditor();if(n&&t){const i="boolean"==typeof e?{notify:e}:e&&"object"==typeof e?e:{},o=JSON.stringify(t,null,2);n.setValue(o),this.finalizeEditorMappingLoad();const r=t&&(t.mapping||t),s=r&&(r.id||r.uuid);if("undefined"!=typeof window&&"function"==typeof window.rememberEditorMappingId&&window.rememberEditorMappingId(s),i.notify){const t=r&&(r.name||s),e=("string"==typeof i.message?i.message.trim():"")||(t?`Mapping "${t}" loaded`:"Mapping loaded");this.showNotification(e,"success")}}}getMappingFromEditor(){const t=this.getActiveEditor();if(!t)return null;try{const e=t.getValue(),n=JSON.parse(e);if("undefined"!=typeof window&&"function"==typeof window.rememberEditorMappingId){const t=n&&(n.id||n.uuid);window.rememberEditorMappingId(t)}return n}catch(e){return this.showNotification("Invalid JSON in editor","error"),null}}search(t){const e=this.getActiveEditor();if(e)try{e.trigger("search","actions.find",{searchString:t,replaceString:"",isRegex:!1,matchCase:!1,matchWholeWord:!1,preserveCase:!1}),this.showNotification(`Searching for "${t}"`,"success")}catch(n){this.showNotification("Search error: "+n.message,"error")}else this.showNotification("No active editor","warning")}loadCompareContent(t,e){try{if(this.diffEditor||this.initializeDiffEditor(),this.diffEditor){const n=JSON.parse(e),i=JSON.stringify(n,null,2),o=this.diffEditor.getModel();let r,s;o?(r=o.original,s=o.modified):(r=monaco.editor.createModel("","json"),s=monaco.editor.createModel("","json")),"left"===t||"original"===t?r.setValue(i):s.setValue(i),this.diffEditor.setModel({original:r,modified:s}),this.showNotification(`Content loaded to ${t} panel with diff highlighting`,"success")}else this.loadCompareContentFallback(t,e)}catch(n){this.showNotification(`Error loading ${t} content: `+n.message,"error")}}initializeDiffEditor(){const t=document.getElementById("compareContainer");if(t)try{const e="dark"===document.body.dataset.theme?"vs-dark":"vs";this.diffEditor=monaco.editor.createDiffEditor(t,{theme:e,readOnly:!1,automaticLayout:!0,renderSideBySide:!0,ignoreTrimWhitespace:!1,renderWhitespace:"boundary",diffWordWrap:"on",originalEditable:!0,scrollBeyondLastLine:!1,minimap:{enabled:!1},enableSplitViewResizing:!0,renderOverviewRuler:!0,diffCodeLens:!0,scrollbar:{verticalScrollbarSize:8,horizontalScrollbarSize:8,useShadows:!1}});const n=monaco.editor.createModel("","json"),i=monaco.editor.createModel("","json");this.diffEditor.setModel({original:n,modified:i}),this.setupDiffEditorEnhancements(),this.editors.set("diffEditor",this.diffEditor)}catch(e){}}setupDiffEditorEnhancements(){if(!this.diffEditor)return;const t=this.diffEditor.getOriginalEditor(),e=this.diffEditor.getModifiedEditor();[{key:monaco.KeyMod.Alt|monaco.KeyCode.KeyN,action:()=>this.diffEditor.goToNextDiff()},{key:monaco.KeyMod.Alt|monaco.KeyCode.KeyP,action:()=>this.diffEditor.goToPrevDiff()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KeyR,action:()=>this.resetDiffView()}].forEach(({key:n,action:i})=>{t.addCommand(n,i),e.addCommand(n,i)}),t.addAction({id:"diff-copy-to-modified",label:"Copy to Right Side",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.RightArrow],run:()=>{const n=t.getValue();e.setValue(n),this.showNotification("Content copied to right side","success")}}),e.addAction({id:"diff-copy-to-original",label:"Copy to Left Side",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.LeftArrow],run:()=>{const n=e.getValue();t.setValue(n),this.showNotification("Content copied to left side","success")}}),t.onDidChangeModelContent(()=>{this.onDiffContentChange("original")}),e.onDidChangeModelContent(()=>{this.onDiffContentChange("modified")})}onDiffContentChange(t){this.diffAnalysisTimeout&&clearTimeout(this.diffAnalysisTimeout),this.diffAnalysisTimeout=setTimeout(()=>{this.analyzeDiffChanges(t)},1e3)}analyzeDiffChanges(t){if(!this.diffEditor)return;const e=this.diffEditor.getModel();if(!e)return;const n=e.original.getValue(),i=e.modified.getValue();if(n&&i){const t=this.diffEditor.getDiffComputationResult();if(t&&t.changes){const e=t.changes.length;this.showNotification(`${e} difference${1!==e?"s":""} detected`,"info")}}}resetDiffView(){if(!this.diffEditor)return;const t=this.diffEditor.getModel();t&&(t.original.setValue(""),t.modified.setValue(""),this.showNotification("Diff view reset","success"))}loadCompareContentFallback(t,e){const n="left"===t?"compareEditorLeft":"compareEditorRight";let i=this.editors.get(n);if(!i){const t=document.getElementById(n);if(t){const e="dark"===document.body.dataset.theme?"vs-dark":"vs";i=this.createEditor(t,{language:"json",theme:e,readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on"}),this.editors.set(n,i)}}if(!i)throw new Error(`Cannot find container for ${t} compare editor`);{const n=JSON.parse(e),o=JSON.stringify(n,null,2);i.setValue(o),this.showNotification(`Content loaded to ${t} panel`,"success")}}clearCompareContent(t){try{if(this.diffEditor){const e=this.diffEditor.getModel();e&&("left"===t||"original"===t?e.original.setValue(""):"right"===t||"modified"===t?e.modified.setValue(""):"both"===t&&(e.original.setValue(""),e.modified.setValue(""))),this.showNotification(`${t.charAt(0).toUpperCase()+t.slice(1)} diff panel cleared`,"success")}else{const e="left"===t?"compareEditorLeft":"compareEditorRight",n=this.editors.get(e);n?(n.setValue(""),this.showNotification(`${t.charAt(0).toUpperCase()+t.slice(1)} panel cleared`,"success")):this.showNotification(`${t} compare editor not found`,"warning")}}catch(e){this.showNotification(`Error clearing ${t} panel: `+e.message,"error")}}evaluateJSONPath(t,e,n,i){const o=[],r=this.createPointerLocator(n),s="string"==typeof e?e.trim():"";if(!s||"$"===s){const e=this.findValuePosition(t,n,i,"$",r,"$");return o.push({value:t,path:"$",pointer:"$",position:e}),o}const a=s.replace(/^\$\.?/,""),l=a?a.split(".").filter(Boolean):[];return this.traverseJSONPath(t,l,n,i,"$",o,r,"$"),o}traverseJSONPath(t,e,n,i,o,r,s,a){if(0===e.length){const e=this.findValuePosition(t,n,i,o,s,a);return void r.push({value:t,path:o,pointer:a,position:e})}const[l,...c]=e;if(l.includes("[")&&l.includes("]")){const[e,d]=l.split("["),u=d.replace("]","");let h=t,f=a;if(e){if(!t||"object"!=typeof t||!Object.prototype.hasOwnProperty.call(t,e))return;h=t[e],f=B(f,e)}if(Array.isArray(h))if("*"===u)h.forEach((t,a)=>{const l=o+(e?`.${e}`:"")+`[${a}]`,d=B(f,a);this.traverseJSONPath(t,c,n,i,l,r,s,d)});else{const t=parseInt(u,10);if(!Number.isNaN(t)&&t>=0&&t<h.length){const a=o+(e?`.${e}`:"")+`[${t}]`,l=B(f,t);this.traverseJSONPath(h[t],c,n,i,a,r,s,l)}}}else if("*"===l)t&&"object"==typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(e=>{const l=o+`.${e}`,d=B(a,e);this.traverseJSONPath(t[e],c,n,i,l,r,s,d)});else if(t&&"object"==typeof t&&Object.prototype.hasOwnProperty.call(t,l)){const e=o+`.${l}`,d=B(a,l);this.traverseJSONPath(t[l],c,n,i,e,r,s,d)}}findValuePosition(t,e,n,i,o=null,r=null){try{let s=o||null,a=r;if("string"==typeof a&&a.startsWith("$.")){const t=this.convertJSONPathToPointer(a);t&&(a=t)}if(!a&&"string"==typeof i&&i.length>0&&(a=this.convertJSONPathToPointer(i)),a&&(s||(s=this.createPointerLocator(e)),s)){const t=s.getRange(a);if(t)return t}const l=n&&"function"==typeof n.getModel?n.getModel():null;if(!l)return null;let c;if(c="string"==typeof t?`"${t}"`:JSON.stringify(t),c){const t=l.findMatches(c,!1,!1,!0,null,!1);if(t.length>0){const{range:e}=t[0];return{startLineNumber:e.startLineNumber,startColumn:e.startColumn,endLineNumber:e.endLineNumber,endColumn:e.endColumn}}}if(t&&"object"==typeof t){const e=JSON.stringify(t,null,2);if(e&&e!==c){const t=l.findMatches(e,!1,!1,!0,null,!1);if(t.length>0){const{range:e}=t[0];return{startLineNumber:e.startLineNumber,startColumn:e.startColumn,endLineNumber:e.endLineNumber,endColumn:e.endColumn}}}}}catch(s){}return null}formatValuePreview(t){if(null===t)return"null";if(void 0===t)return"undefined";let e=JSON.stringify(t);return e.length>100&&(e=e.slice(0,97)+"..."),e}newDocument(){try{const t=this.getActiveEditor();t&&(t.setValue(this.getDefaultStub()),this.showNotification("New document created","success"))}catch(t){this.showNotification("Error creating new document: "+t.message,"error")}}loadFile(){try{const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=t=>{const e=t.target.files[0];if(e){const t=new FileReader;t.onload=t=>{try{const e=t.target.result,n=this.getActiveEditor();n&&(n.setValue(e),this.showNotification("File loaded successfully","success"))}catch(e){this.showNotification("Error loading file: "+e.message,"error")}},t.readAsText(e)}},t.click()}catch(t){this.showNotification("Error opening file dialog: "+t.message,"error")}}saveFile(){try{const t=this.getActiveEditor();if(t){const e=t.getValue(),n=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download="wiremock-mapping.json",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i),this.showNotification("File saved successfully","success")}}catch(t){this.showNotification("Error saving file: "+t.message,"error")}}exportAsYAML(){const t=this.getActiveEditor();if(!t)return void this.showNotification("No active editor","warning");let e;try{e=JSON.parse(t.getValue())}catch(n){return void this.showNotification("Cannot export YAML: "+n.message,"error")}try{const t=z(e),n=t.endsWith("\n")?t:`${t}\n`,i=new Blob([n],{type:"text/yaml"}),o=URL.createObjectURL(i),r=document.createElement("a");r.href=o,r.download="wiremock-mapping.yaml",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),this.showNotification("YAML exported","success")}catch(n){this.showNotification("YAML export failed: "+n.message,"error")}}async searchJSONPath(t,e={}){if(!this.getActiveEditor())return!1!==e.notify&&this.showNotification("No active editor","warning"),[];const n=("string"==typeof t?t:"").trim(),i=n.length>0,o=!0===e.allowEmpty;if(!i&&!o)return!1!==e.notify&&this.showNotification("Please enter a search term","warning"),[];const r="boolean"==typeof e.jsonPathMode?e.jsonPathMode:null,s=i&&this.isJSONPathQuery(n),a=null!==r?r:s;return await this.openFindWidget({query:i?n:void 0,jsonPathMode:a,focus:!1!==e.focus,select:"boolean"==typeof e.select&&e.select,notify:!0===e.notify})?i&&a&&Array.isArray(this.lastJSONPathResults)?this.lastJSONPathResults:[]:(!1!==e.notify&&this.showNotification("Find widget is not available","error"),[])}async searchWithJSONPath(t,e,n={}){const{notify:i=!0,revealFirst:o=!0,fromWidget:r=!1}=n||{},s=++this.jsonPathSearchRequestId,a=e.getValue();if(!a||!a.trim())return this.resetJSONPathResults({keepQuery:!0}),this.lastJSONPathQuery=t,r&&this.updateFindWidgetMatchesCount(0,!1,-1,{noContent:!0}),i&&this.showNotification("No content to search","warning"),[];let l=null;if(this.canUseWorkerForJSONPath())try{l=await this.workerPool.execute("jsonpath",{text:a,path:t},5,1e4)}catch(c){}if(l&&"object"==typeof l&&Array.isArray(l.values)){const{matches:n,pointerLocator:c}=this.convertWorkerResultToMatches(l,t,a,e),d="number"==typeof l.count?l.count:n.length,u=Boolean(l.truncated);return s!==this.jsonPathSearchRequestId?n:(this.lastJSONPathPointerLocator=c,this.handleJSONPathMatches(t,n,e,d,u,{notify:i,revealFirst:o,fromWidget:r}))}try{const n=JSON.parse(a),l=this.evaluateJSONPath(n,t,a,e)||[];return s!==this.jsonPathSearchRequestId?l:(this.lastJSONPathPointerLocator=null,this.handleJSONPathMatches(t,l,e,l.length,!1,{notify:i,revealFirst:o,fromWidget:r}))}catch(d){return this.resetJSONPathResults({keepQuery:!0}),this.lastJSONPathPointerLocator=null,this.lastJSONPathQuery=t,r&&this.updateFindWidgetMatchesCount(0,!1,-1,{error:d.message}),i&&this.showNotification("Invalid JSON or JSONPath: "+d.message,"error"),[]}}isJSONPathQuery(t){return!!t&&t.trim().startsWith("$")}canUseWorkerForJSONPath(){return!(!this.workerPool||"function"!=typeof this.workerPool.execute)&&!!Array.isArray(this.workerPool.workers)&&this.workerPool.workers.length>0}convertWorkerResultToMatches(t,e,n,i){const o=Array.isArray(t.values)?t.values:[],r=this.extractJSONPathStrings(t,e,o.length),s=this.extractPointerPaths(t,o.length),a=s.some(t=>"string"==typeof t&&t.length>0)?this.createPointerLocator(n):null;return{matches:o.map((t,o)=>{const l=r[o]||e,c=s[o]||null;let d=null;if(c&&a){const t=a.getRange(c);t&&(d=t)}return d||(d=this.findValuePosition(t,n,i,l,a,c)),{value:t,path:l,pointer:c,position:d}}),pointerLocator:a,pointerPaths:s}}extractJSONPathStrings(t,e,n=0){return t?Array.isArray(t.jsonPaths)&&t.jsonPaths.length>0?t.jsonPaths:Array.isArray(t.paths)&&t.paths.length>0?t.paths.map(t=>Array.isArray(t)?function(t){if(!Array.isArray(t)||0===t.length)return"$";let e="$";for(let n=1;n<t.length;n++){const i=t[n];"number"==typeof i?e+=`[${i}]`:"string"==typeof i?H(i)?e+=`.${i}`:e+=`['${i.replace(/'/g,"\\'")}']`:null!=i&&(e+=`[${String(i)}]`)}return e}(t):String(t)):n>0?new Array(n).fill(e):[]:[]}extractPointerPaths(t,e=0){return t?Array.isArray(t.pointerPaths)&&t.pointerPaths.length>0?t.pointerPaths:Array.isArray(t.paths)&&t.paths.length>0?t.paths.map(t=>Array.isArray(t)?function(t){if(!Array.isArray(t)||0===t.length)return"$";let e="$";for(let n=1;n<t.length;n++)e=B(e,t[n]);return e}(t):null):e>0?new Array(e).fill(null):[]:[]}createPointerLocator(t){return function(t){if("string"!=typeof t||0===t.length)return null;try{const e=new Map,n=t.length,i=[0];for(let m=0;m<n;m++)"\n"===t[m]&&i.push(m+1);let o=0;const r=t=>{t<0&&(t=0),t>n&&(t=n);let e=0,o=i.length-1;for(;e<=o;){const r=Math.floor((e+o)/2),s=i[r],a=r+1<i.length?i[r+1]:n+1;if(t<s)o=r-1;else{if(!(t>=a))return{lineNumber:r+1,column:t-s+1};e=r+1}}const r=i.length-1;return{lineNumber:r+1,column:t-(i[r]||0)+1}},s=()=>{for(;o<n;){const e=t[o];if(" "!==e&&"\t"!==e&&"\n"!==e&&"\r"!==e)break;o++}},a=(t,n,i)=>{t&&n<=i&&e.set(t,{start:n,end:i})},l=e=>{if(s(),o>=n)throw new Error("Unexpected end of JSON input");const i=t[o];if("{"!==i){if("["!==i){if('"'===i){const{start:t,end:n}=u();return void a(e,t,n)}if("-"===i||p(i)){const{start:t,end:n}=h();return void a(e,t,n)}if(t.startsWith("true",o)){const{start:t,end:n}=f("true");return void a(e,t,n)}if(t.startsWith("false",o)){const{start:t,end:n}=f("false");return void a(e,t,n)}if(t.startsWith("null",o)){const{start:t,end:n}=f("null");return void a(e,t,n)}throw new Error(`Unexpected token ${i} at position ${o}`)}d(e)}else c(e)},c=e=>{const i=o;if(o++,s(),o<n&&"}"===t[o])return o++,void a(e,i,o);for(;o<n;){if('"'!==t[o])throw new Error("Expected string for object key");const{value:n}=u();if(s(),":"!==t[o])throw new Error("Expected colon after object key");o++;const r=B(e,n);l(r),s();const c=t[o];if(","!==c){if("}"===c)return o++,void a(e,i,o);throw new Error("Expected comma or closing brace in object")}o++,s()}throw new Error("Unterminated object literal")},d=e=>{const i=o;if(o++,s(),o<n&&"]"===t[o])return o++,void a(e,i,o);let r=0;for(;o<n;){const n=B(e,r);l(n),r++,s();const c=t[o];if(","!==c){if("]"===c)return o++,void a(e,i,o);throw new Error("Expected comma or closing bracket in array")}o++,s()}throw new Error("Unterminated array literal")},u=()=>{const e=o;o++;let i="";for(;o<n;){const r=t[o];if('"'===r)return o++,{value:i,start:e,end:o};if("\\"===r){if(o++,o>=n)throw new Error("Unterminated string literal");const e=t[o];switch(e){case'"':case"\\":case"/":default:i+=e;break;case"b":i+="\b";break;case"f":i+="\f";break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"u":const n=t.slice(o+1,o+5);if(!/^[0-9a-fA-F]{4}$/.test(n))throw new Error("Invalid Unicode escape sequence");i+=String.fromCharCode(parseInt(n,16)),o+=4}}else i+=r;o++}throw new Error("Unterminated string literal")},h=()=>{const e=o;if("-"===t[o]&&o++,"0"===t[o])o++;else{if(!p(t[o]))throw new Error("Invalid number literal");for(;o<n&&p(t[o]);)o++}if("."===t[o]){if(o++,!p(t[o]))throw new Error("Invalid number literal");for(;o<n&&p(t[o]);)o++}if("e"===t[o]||"E"===t[o]){if(o++,"+"!==t[o]&&"-"!==t[o]||o++,!p(t[o]))throw new Error("Invalid number literal");for(;o<n&&p(t[o]);)o++}return{start:e,end:o}},f=e=>{const n=o;if(t.slice(o,o+e.length)!==e)throw new Error(`Expected literal ${e}`);return o+=e.length,{start:n,end:o}},p=t=>t>="0"&&t<="9";return l("$"),s(),{getRange(t){if(!e.has(t))return null;const n=e.get(t),i=r(n.start),o=r(n.end);return{startLineNumber:i.lineNumber,startColumn:i.column,endLineNumber:o.lineNumber,endColumn:o.column}}}}catch(e){return null}}(t)}convertJSONPathToPointer(t){if("string"!=typeof t)return null;const e=t.trim();if(!e)return null;if("$"===e)return"$";if(!e.startsWith("$"))return null;let n="$",i=1;for(;i<e.length;){const t=e[i];if("."===t){if(i++,i>=e.length)break;if("."===e[i])return null;if("["===e[i])continue;let t=i;for(;i<e.length&&"."!==e[i]&&"["!==e[i];)i++;const o=e.slice(t,i);o&&(n=B(n,o));continue}if("["!==t)i++;else{if(i++,i>=e.length)break;if("'"===e[i]||'"'===e[i]){const t=e[i];i++;let o="";for(;i<e.length;){const n=e[i];if("\\"===n&&i+1<e.length)o+=e[i+1],i+=2;else{if(n===t)break;o+=n,i++}}if(i<e.length&&e[i]===t&&i++,i<e.length&&"]"===e[i]&&i++,!o)return null;n=B(n,o)}else{let t=i;for(;i<e.length&&"]"!==e[i];)i++;const o=e.slice(t,i);if(i<e.length&&"]"===e[i]&&i++,!o||"*"===o)return null;const r=Number(o);n=Number.isNaN(r)?B(n,o):B(n,r)}}}return n}handleJSONPathMatches(t,e,n,i,o,r={}){const{notify:s=!0,revealFirst:a=!0,fromWidget:l=!1}=r||{};if(!Array.isArray(e)||0===e.length)return this.resetJSONPathResults({keepQuery:!0}),this.lastJSONPathQuery=t,this.lastJSONPathMeta={totalCount:0,truncated:!1},l&&this.updateFindWidgetMatchesCount(0,o,-1,{query:t}),s&&this.showNotification(`JSONPath "${t}" not found`,"info"),[];if(this.lastJSONPathResults=e,this.lastJSONPathMeta={totalCount:i,truncated:o},this.lastJSONPathQuery=t,a?this.focusJSONPathMatch(0,n,{fromWidget:l,reveal:!0}):(this.currentJSONPathIndex<0||this.currentJSONPathIndex>=e.length)&&(this.currentJSONPathIndex=0),l&&this.updateFindWidgetMatchesCount(i,o,this.currentJSONPathIndex),s){const n=e[Math.max(0,this.currentJSONPathIndex)]||e[0];let r=`JSONPath "${t}" found ${i} match${1===i?"":"es"}`;o&&e.length<i&&(r+=` (showing first ${e.length})`),n&&Object.prototype.hasOwnProperty.call(n,"value")&&(r+=`: ${this.formatValuePreview(n.value)}`),this.showNotification(r,"success"),i>1&&this.showNotification(`Use Alt+N/Alt+P to navigate between ${i} matches`,"info")}return e}resetJSONPathResults(t={}){const{keepQuery:e=!1}=t||{};this.lastJSONPathResults=[],this.lastJSONPathMeta={totalCount:0,truncated:!1},this.lastJSONPathPointerLocator=null,this.currentJSONPathIndex=-1,e||(this.lastJSONPathQuery="")}focusJSONPathMatch(t,e=this.getActiveEditor(),n={}){const{reveal:i=!0,fromWidget:o=!1}=n||{};if(!e)return!1;const r=Array.isArray(this.lastJSONPathResults)?this.lastJSONPathResults:[];if(0===r.length)return this.currentJSONPathIndex=-1,o&&this.updateFindWidgetMatchesCount(0,!1,-1),!1;const s=Number(t);if(Number.isNaN(s)||s<0||s>=r.length)return!1;const a=r[s];if(!a)return!1;const l=e.getValue();let c=a.position,d=this.lastJSONPathPointerLocator;if(d||(d=this.createPointerLocator(l),this.lastJSONPathPointerLocator=d),(!c||"number"!=typeof c.startLineNumber)&&d){const t=a.pointer||this.convertJSONPathToPointer(a.path);if(t){const e=d.getRange(t);e&&(c=e,a.position=e)}}if(!c||"number"!=typeof c.startLineNumber){const t=a.pointer||null,n=this.findValuePosition(a.value,l,e,a.path,d,t);n&&(c=n,a.position=n)}if(!c||"number"!=typeof c.startLineNumber)return!1;const u=new monaco.Range(c.startLineNumber,c.startColumn,c.endLineNumber,c.endColumn);if(e.setSelection(u),i&&(monaco?.editor?.ScrollType?e.revealRangeInCenter(u,monaco.editor.ScrollType.Smooth):e.revealRangeInCenter(u)),this.currentJSONPathIndex=s,o||this.findWidgetIntegration&&this.findWidgetIntegration.enabled){const t=this.lastJSONPathMeta||{},e="number"==typeof t.totalCount&&t.totalCount>0?t.totalCount:r.length;this.updateFindWidgetMatchesCount(e,Boolean(t.truncated),s)}return!0}navigateJSONPathMatches(t=1,e=this.getActiveEditor(),n={}){const i=Array.isArray(this.lastJSONPathResults)?this.lastJSONPathResults:[];if(!e||0===i.length)return!1!==n.notify&&this.showNotification("No JSONPath matches to navigate","warning"),!1;let o=Number(t);(Number.isNaN(o)||0===o)&&(o=1);const r=i.length;let s="number"==typeof this.currentJSONPathIndex?this.currentJSONPathIndex:-1;s=s<0||s>=r?o>0?0:r-1:(s+o+r)%r;const a=this.focusJSONPathMatch(s,e,{fromWidget:n.fromWidget,reveal:!1!==n.reveal});return a||!1===n.notify||this.showNotification("Unable to navigate to JSONPath match","warning"),a}updateFindWidgetMatchesCount(t,e,n=this.currentJSONPathIndex,i={}){const o=this.findWidgetIntegration;if(!o||!o.matchesElement)return;const r=o.matchesElement;if(i.reset)return"string"==typeof o.originalMatchesText&&(r.textContent=o.originalMatchesText),r.removeAttribute("data-jsonpath"),r.removeAttribute("data-jsonpath-state"),r.removeAttribute("data-jsonpath-partial"),void r.removeAttribute("title");if(!o.enabled&&!i.force)return;const s=(t,e="status",n={})=>{r.dataset.jsonpath="true",r.dataset.jsonpathState=e,n.partial?r.dataset.jsonpathPartial="true":r.removeAttribute("data-jsonpath-partial"),r.innerHTML="";const i=document.createElement("span");if(i.className="jsonpath-chip",i.textContent="JSONPath",r.appendChild(i),t){const e=document.createElement("span");e.className="jsonpath-status",e.textContent=t,r.appendChild(e)}n.title?r.title=n.title:t?r.title=`JSONPath · ${t}`:r.removeAttribute("title")};if(i.searching)return void s("searching…");if(i.emptyQuery)return void s("enter path");if(i.noContent)return void s("no content");if(i.error)return void s("error","error");if(!t||t<=0)return void s("no results");const a="number"==typeof n&&n>=0?n+1:1,l=`${a}/${t}`,c=e&&Array.isArray(this.lastJSONPathResults)&&this.lastJSONPathResults.length<t;s(l,"count",{partial:c,title:c?`JSONPath results · ${a}/${t} (partial)`:`JSONPath results · ${a}/${t}`})}performFindWidgetJSONPathSearch(t,e={}){const n=this.findWidgetIntegration;if(!n||!n.enabled)return;const i="string"==typeof t?t.trim():"",o=Boolean(e.immediate),r="number"==typeof e.delay?e.delay:150;if(n.searchDebounce&&(clearTimeout(n.searchDebounce),n.searchDebounce=null),!i)return this.resetJSONPathResults({keepQuery:!1}),this.lastJSONPathQuery="",void this.updateFindWidgetMatchesCount(0,!1,-1,{emptyQuery:!0});const s=()=>{n.searchDebounce=null;const t=n.editor||this.getActiveEditor();t&&this.searchWithJSONPath(i,t,{notify:!1,revealFirst:!1!==e.revealFirst,fromWidget:!0})};this.updateFindWidgetMatchesCount(null,!1,-1,{searching:!0,force:!0}),o?s():n.searchDebounce=setTimeout(s,r)}setupFindWidgetIntegration(t){if("undefined"==typeof document)return;this.findWidgetIntegration?(this.findWidgetIntegration.editor=t,"resizeHandler"in this.findWidgetIntegration||(this.findWidgetIntegration.resizeHandler=null),"resizeObserver"in this.findWidgetIntegration||(this.findWidgetIntegration.resizeObserver=null),"layoutRaf"in this.findWidgetIntegration||(this.findWidgetIntegration.layoutRaf=null),"layoutScheduler"in this.findWidgetIntegration||(this.findWidgetIntegration.layoutScheduler="raf"),"lastLayoutWidth"in this.findWidgetIntegration||(this.findWidgetIntegration.lastLayoutWidth=null),"lastReservedPadding"in this.findWidgetIntegration||(this.findWidgetIntegration.lastReservedPadding=null)):this.findWidgetIntegration={editor:t,widget:null,toggleElement:null,matchesElement:null,inputElement:null,nextButton:null,prevButton:null,closeButton:null,enabled:!1,observer:null,searchDebounce:null,originalMatchesText:"",resizeHandler:null,resizeObserver:null,layoutRaf:null,layoutScheduler:"raf",lastLayoutWidth:null,lastReservedPadding:null};const e=this.findWidgetIntegration;(()=>{const t=document.querySelector(".editor-widget.find-widget");return!!t&&(this.decorateFindWidget(t,e),!0)})()||e.observer||(e.observer=new MutationObserver(t=>{for(const n of t){if(n.addedNodes)for(const t of n.addedNodes){if(!t||1!==t.nodeType)continue;const n=t;if(n.classList.contains("find-widget")){this.decorateFindWidget(n,e);continue}const i=n.querySelector?n.querySelector(".editor-widget.find-widget, .find-widget"):null;if(i){const t=i.classList&&i.classList.contains("find-widget")?i:i.querySelector(".find-widget");t&&this.decorateFindWidget(t,e)}}if(n.removedNodes&&e.widget)for(const t of n.removedNodes)t&&1===t.nodeType&&(t===e.widget||t.contains&&t.contains(e.widget))&&this.handleFindWidgetRemoval()}}),e.observer.observe(document.body,{childList:!0,subtree:!0}))}async openFindWidget(t={}){const e=this.getActiveEditor();if(!e)return null;this.setupFindWidgetIntegration(e);const n=e.getAction&&e.getAction("actions.find");try{n&&"function"==typeof n.run?await n.run():e.trigger("keyboard","actions.find",null)}catch(r){e.trigger("keyboard","actions.find",null)}const i=Date.now(),o="function"==typeof requestAnimationFrame?requestAnimationFrame:t=>setTimeout(t,30);return new Promise(e=>{const n=()=>{const r=this.findWidgetIntegration;if(r&&r.widget&&r.inputElement){const n=r.inputElement,i=!1!==t.focus,o=!1!==t.select,s=!0===t.notify,a="boolean"==typeof t.jsonPathMode,l=a?t.jsonPathMode:null,c="string"==typeof t.query,d=(c?t.query:"").trim();return c&&n.value!==d&&(n.value=d),a&&this.setFindWidgetJSONPathMode(l,{notify:s,focusInput:!1}),a&&!0===l||!c||n.dispatchEvent(new Event("input",{bubbles:!0})),i&&(n.focus(),o&&n.select()),void e(r)}Date.now()-i>1200?e(null):o(n)};n()})}decorateFindWidget(t,e=this.findWidgetIntegration){if(!e||!t||"function"!=typeof t.querySelector)return;t.dataset&&(t.dataset.jsonpathDecorated="true"),t.classList.add("jsonpath-extended"),e.widget=t,"undefined"!=typeof window&&(e.resizeHandler&&window.removeEventListener("resize",e.resizeHandler),e.resizeHandler=()=>{this.refreshFindWidgetLayout()},window.addEventListener("resize",e.resizeHandler,{passive:!0})),"undefined"!=typeof ResizeObserver&&(e.resizeObserver?e.resizeObserver.disconnect():e.resizeObserver=new ResizeObserver(()=>{this.refreshFindWidgetLayout()}),e.resizeObserver.observe(t));const n=t.querySelector(".matchesCount");n&&(e.matchesElement=n,e.originalMatchesText||(e.originalMatchesText=n.textContent||""));const i=t.querySelector(".controls");if(i&&i.classList.add("jsonpath-widget-controls"),i&&!t.querySelector("[data-jsonpath-toggle]")){const t=document.createElement("div");t.className="monaco-custom-toggle codicon codicon-symbol-structure",t.setAttribute("role","checkbox"),t.setAttribute("tabindex","0"),t.setAttribute("aria-checked","false"),t.setAttribute("aria-label","Use JSONPath (Alt+J)"),t.setAttribute("title","Use JSONPath (Alt+J)"),t.dataset.jsonpathToggle="true",t.classList.add("monaco-jsonpath-toggle");const n=t=>{t.preventDefault(),t.stopPropagation(),this.setFindWidgetJSONPathMode(!e.enabled,{notify:!0,focusInput:!0})};t.addEventListener("click",n),t.addEventListener("keydown",t=>{" "!==t.key&&"Enter"!==t.key||n(t)}),i.firstChild?i.insertBefore(t,i.firstChild):i.appendChild(t),e.toggleElement=t}else i&&(e.toggleElement||(e.toggleElement=i.querySelector("[data-jsonpath-toggle]")),e.toggleElement&&e.toggleElement.classList.add("monaco-jsonpath-toggle"));const o=t.querySelector(".find-part .input");o&&(e.inputElement=o,o.dataset.jsonpathBound||(o.dataset.jsonpathBound="true",o.addEventListener("input",()=>{e.enabled&&this.performFindWidgetJSONPathSearch(o.value)}),o.addEventListener("keydown",t=>{if(e.enabled&&"Enter"===t.key){t.preventDefault(),t.stopPropagation();const n=o.value.trim();if(!n)return void this.updateFindWidgetMatchesCount(0,!1,-1,{emptyQuery:!0});if(n!==this.lastJSONPathQuery)return void this.performFindWidgetJSONPathSearch(n,{immediate:!0});const i=t.shiftKey?-1:1;this.navigateJSONPathMatches(i,e.editor,{fromWidget:!0,notify:!1})}})));const r=t.querySelector(".codicon-find-next-match");r&&(e.nextButton=r,r.dataset.jsonpathBound||(r.dataset.jsonpathBound="true",r.addEventListener("mousedown",t=>{e.enabled&&(t.preventDefault(),t.stopPropagation())}),r.addEventListener("click",t=>{if(!e.enabled)return;t.preventDefault(),t.stopPropagation();const n=e.inputElement?e.inputElement.value.trim():"";n&&n!==this.lastJSONPathQuery?this.performFindWidgetJSONPathSearch(n,{immediate:!0}):this.navigateJSONPathMatches(1,e.editor,{fromWidget:!0,notify:!1})})));const s=t.querySelector(".codicon-find-previous-match");s&&(e.prevButton=s,s.dataset.jsonpathBound||(s.dataset.jsonpathBound="true",s.addEventListener("mousedown",t=>{e.enabled&&(t.preventDefault(),t.stopPropagation())}),s.addEventListener("click",t=>{if(!e.enabled)return;t.preventDefault(),t.stopPropagation();const n=e.inputElement?e.inputElement.value.trim():"";n&&n!==this.lastJSONPathQuery?this.performFindWidgetJSONPathSearch(n,{immediate:!0}):this.navigateJSONPathMatches(-1,e.editor,{fromWidget:!0,notify:!1})})));const a=t.querySelector(".codicon-widget-close");if(a&&(e.closeButton=a,a.dataset.jsonpathBound||(a.dataset.jsonpathBound="true",a.addEventListener("click",()=>{e.enabled&&this.setFindWidgetJSONPathMode(!1,{notify:!1})}))),e.enabled){const t=this.lastJSONPathMeta||{},e="number"==typeof t.totalCount&&t.totalCount>0?t.totalCount:Array.isArray(this.lastJSONPathResults)?this.lastJSONPathResults.length:0;e>0?this.updateFindWidgetMatchesCount(e,Boolean(t.truncated),this.currentJSONPathIndex,{force:!0}):this.updateFindWidgetMatchesCount(0,!1,-1,{emptyQuery:!this.lastJSONPathQuery})}this.refreshFindWidgetLayout({immediate:!0})}refreshFindWidgetLayout(t={}){const e=this.findWidgetIntegration;if(!e||!e.widget)return;const n=e.widget;n.classList.add("jsonpath-extended");const i="function"==typeof requestAnimationFrame?"raf":"timeout",o="raf"===i?requestAnimationFrame:t=>setTimeout(t,20);null!==e.layoutRaf&&("raf"===e.layoutScheduler&&"function"==typeof cancelAnimationFrame?cancelAnimationFrame(e.layoutRaf):clearTimeout(e.layoutRaf),e.layoutRaf=null),e.layoutScheduler=i;const r=()=>{e.layoutRaf=null;const t="undefined"!=typeof window&&window.innerWidth||0;let i=460;if(t>0){const e=t<600?24:48,n=t<1280?.62:.5,o=Math.round(t*n);i=Math.max(380,Math.min(720,t-e,o)),t<=520&&(i=Math.max(320,t-20))}let o=i;if(t>0){const e=Math.max(320,t-32);o=Math.min(i,e)}e.lastLayoutWidth!==o&&(n.style.width=`${o}px`,n.style.maxWidth="calc(100vw - 32px)",n.style.minWidth=`${Math.min(Math.max(o,320),420)}px`,e.lastLayoutWidth=o);const r=n.querySelector(".find-part");r&&(r.style.flex="1 1 auto",r.style.minWidth="0");const s=n.querySelector(".find-part .monaco-findInput");s&&(s.style.flex="1 1 auto",s.style.minWidth="0");const a=n.querySelector(".replace-part");a&&(a.style.flex="1 1 auto",a.style.minWidth="0");const l=n.querySelector(".find-part .controls");let c=88;if(l){l.classList.add("jsonpath-widget-controls");const t=l.getBoundingClientRect();t&&t.width?c=Math.max(72,Math.round(t.width)+12):l.children&&l.children.length&&(c=Math.max(72,24*l.children.length+12))}if(e.lastReservedPadding!==c){const t=(t,e,i)=>{const o=n.querySelector(t);if(!o)return;const r=o.querySelector(".input"),s=o.querySelector(".mirror"),a=Math.max(i,c-e);r&&(r.style.width=`calc(100% - ${a}px)`),s&&(s.style.paddingRight=`${a}px`)};t(".find-part .monaco-findInput",0,72),t(".replace-part .monaco-findInput",24,56),e.lastReservedPadding=c}const d=n.querySelector(".matchesCount");d&&(d.style.minWidth="96px",d.style.textAlign="right")};t.immediate&&r(),e.layoutRaf=o(()=>{r()})}toggleFindWidgetJSONPathMode(t){const e=this.getActiveEditor();if(!e)return;const n=this.findWidgetIntegration,i="boolean"==typeof t?t:!(n&&n.enabled),o=()=>{this.setupFindWidgetIntegration(e);const t=this.findWidgetIntegration;t&&t.widget&&this.setFindWidgetJSONPathMode(i,{notify:!0,focusInput:!0})};if(n&&n.widget)o();else{const t=e.getAction&&e.getAction("actions.find");t&&"function"==typeof t.run?t.run().then(()=>{setTimeout(o,0)}).catch(()=>{setTimeout(o,0)}):(e.trigger("keyboard","actions.find",null),setTimeout(o,0))}}setFindWidgetJSONPathMode(t,e={}){const n=this.findWidgetIntegration;if(!n)return;const i=n.enabled;if(n.enabled=Boolean(t),n.toggleElement){n.toggleElement.setAttribute("aria-checked",n.enabled?"true":"false"),n.toggleElement.classList.toggle("checked",n.enabled);const t=n.enabled?"Disable JSONPath (Alt+J)":"Use JSONPath (Alt+J)";n.toggleElement.setAttribute("aria-label",t),n.toggleElement.setAttribute("title",t)}if(n.widget&&n.widget.classList.toggle("jsonpath-mode",n.enabled),this.refreshFindWidgetLayout(),!n.enabled)return n.searchDebounce&&(clearTimeout(n.searchDebounce),n.searchDebounce=null),this.updateFindWidgetMatchesCount(null,!1,-1,{reset:!0}),void(e.notify&&i!==n.enabled&&this.showNotification("JSONPath mode disabled in find widget","info"));e.notify&&i!==n.enabled&&this.showNotification("JSONPath mode enabled in find widget","info");const o=n.inputElement;e.focusInput&&o&&(o.focus(),o.select());const r=o?o.value.trim():"";r?this.performFindWidgetJSONPathSearch(r,{immediate:!0}):this.updateFindWidgetMatchesCount(0,!1,-1,{emptyQuery:!0})}handleFindWidgetRemoval(){const t=this.findWidgetIntegration;if(t){if(t.searchDebounce&&(clearTimeout(t.searchDebounce),t.searchDebounce=null),null!==t.layoutRaf&&("raf"===t.layoutScheduler&&"function"==typeof cancelAnimationFrame?cancelAnimationFrame(t.layoutRaf):clearTimeout(t.layoutRaf),t.layoutRaf=null),t.resizeObserver&&"function"==typeof t.resizeObserver.disconnect&&(t.resizeObserver.disconnect(),t.resizeObserver=null),t.resizeHandler&&"undefined"!=typeof window&&(window.removeEventListener("resize",t.resizeHandler),t.resizeHandler=null),t.widget){t.widget.classList.remove("jsonpath-extended","jsonpath-mode"),t.widget.style.removeProperty("width"),t.widget.style.removeProperty("maxWidth"),t.widget.style.removeProperty("minWidth");const e=t.widget.querySelector(".find-part .input"),n=t.widget.querySelector(".find-part .mirror");e&&e.style.removeProperty("width"),n&&n.style.removeProperty("padding-right");const i=t.widget.querySelector(".replace-part .input"),o=t.widget.querySelector(".replace-part .mirror");i&&i.style.removeProperty("width"),o&&o.style.removeProperty("padding-right")}t.lastLayoutWidth=null,t.lastReservedPadding=null,t.widget=null,t.toggleElement=null,t.matchesElement=null,t.inputElement=null,t.nextButton=null,t.prevButton=null,t.closeButton=null,t.enabled=!1}}startHealthMonitoring(){this.healthMonitoring.enabled||(this.healthMonitoring.enabled=!0,this.healthMonitoring.interval=setInterval(()=>{this.updateHealthStats()},5e3))}updateHealthStats(){try{const t={timestamp:Date.now(),workerPool:this.workerPool?this.workerPool.getStats():null,searchIndex:this.searchIndex&&"function"==typeof this.searchIndex.getStats?this.searchIndex.getStats():null,performance:this.performanceController&&"function"==typeof this.performanceController.getStats?this.performanceController.getStats():null,memory:performance.memory?{used:Math.round(performance.memory.usedJSHeapSize/1024/1024),total:Math.round(performance.memory.totalJSHeapSize/1024/1024),limit:Math.round(performance.memory.jsHeapSizeLimit/1024/1024)}:null};this.healthMonitoring.stats=t,t.workerPool&&t.workerPool.queued,t.memory&&(t.memory.used,t.memory.limit)}catch(t){}}getHealthStats(){return this.healthMonitoring.stats}showPerformanceBadge(){const t=this.getHealthStats();if(!t)return;let e=document.getElementById("performanceBadge");e||(e=document.createElement("div"),e.id="performanceBadge",e.className="perf-monitor",document.body.appendChild(e));const n=[];t.workerPool&&(n.push(`Workers: ${t.workerPool.busy}/${t.workerPool.workers}`),t.workerPool.queued>0&&n.push(`Queue: ${t.workerPool.queued}`)),t.memory&&n.push(`RAM: ${t.memory.used}MB`),e.textContent=n.join(" | "),e.classList.add("show")}dispose(){this.healthMonitoring.interval&&(clearInterval(this.healthMonitoring.interval),this.healthMonitoring.interval=null,this.healthMonitoring.enabled=!1),this.editors.forEach(t=>{t.virtualRenderer&&t.virtualRenderer.dispose(),t.dispose()}),this.editors.clear(),this.diffEditor&&(this.diffEditor.dispose(),this.diffEditor=null),this.workerPool&&this.workerPool.terminate(),this.searchIndex&&"function"==typeof this.searchIndex.clear&&this.searchIndex.clear(),this.findWidgetIntegration&&(this.handleFindWidgetRemoval(),this.findWidgetIntegration.observer&&(this.findWidgetIntegration.observer.disconnect(),this.findWidgetIntegration.observer=null),this.findWidgetIntegration.searchDebounce&&(clearTimeout(this.findWidgetIntegration.searchDebounce),this.findWidgetIntegration.searchDebounce=null),this.findWidgetIntegration=null),this.isInitialized=!1}}function z(t,e=0){const n="  ".repeat(e);if(Array.isArray(t))return 0===t.length?`${n}[]`:t.map(t=>{if(F(t)||Array.isArray(t)){const i=z(t,e+1).split("\n"),o=i.shift()||"";let r=`${n}- ${o.trimStart()}`;return i.length>0&&(r+=`\n${i.join("\n")}`),r}return`${n}- ${D(t)}`}).join("\n");if(F(t)){const i=Object.keys(t);return 0===i.length?`${n}{}`:i.map(i=>{const o=function(t){return"string"==typeof t&&/^[A-Za-z0-9_\-]+$/.test(t)?t:JSON.stringify(t)}(i),r=t[i];if(F(r)||Array.isArray(r)){const t=z(r,e+1);return`${n}${o}:\n${t}`}return`${n}${o}: ${D(r)}`}).join("\n")}return`${n}${D(t)}`}function D(t){if(null==t)return"null";if("number"==typeof t||"boolean"==typeof t)return String(t);if(t instanceof Date)return JSON.stringify(t.toISOString());if("string"==typeof t){if(""===t)return'""';const e=/^(?:true|false|null|yes|no|on|off|~)$/i;return/^[A-Za-z0-9_\-]+$/.test(t)&&!e.test(t)?t:/[\n\r]/.test(t)||/^\s|\s$/.test(t)||/[#:>{}\[\],&*?]|!/.test(t)?JSON.stringify(t):t}return JSON.stringify(t)}function F(t){return"[object Object]"===Object.prototype.toString.call(t)}function B(t,e){return"number"==typeof e?`${t}/${e}`:`${t}/${function(t){return String(t).replace(/~/g,"~0").replace(/\//g,"~1")}(e)}`}function H(t){return/^[A-Za-z_][A-Za-z0-9_]*$/.test(t)}const U=new q;let V=null,K=!1;function _(){if(K)return;if(K=!0,"undefined"==typeof window||"function"!=typeof window.dispatchEvent)return;let t=null;"function"==typeof window.CustomEvent?t=new CustomEvent("monaco:ready",{detail:{initializer:U}}):"undefined"!=typeof document&&"function"==typeof document.createEvent&&(t=document.createEvent("Event"),t.initEvent("monaco:ready",!1,!1),t.detail={initializer:U}),t&&window.dispatchEvent(t)}function Q(){if(!V){try{V=U.initialize()}catch(t){V=Promise.reject(t)}V.then(_).catch(t=>{})}return V}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{Q()}):Q(),"undefined"!=typeof window&&(window.monacoInitializer=U,window.renderTemplateLibrary=function(){const t=document.getElementById("templateGrid");if(!t)return;const e=c();t.innerHTML="",I();const n=document.createElement("section");if(n.className="template-info",n.innerHTML='\n        <p class="template-info__lead">Browse ready-made WireMock snippets or treat this gallery as a quick reference:</p>\n        <ul>\n            <li><strong>Use template</strong> drops the JSON straight into the editor.</li>\n            <li><strong>Copy JSON</strong> copies the snippet so you can adapt it manually.</li>\n            <li>Each card highlights key features like matchers, templating, webhooks, or proxy settings.</li>\n        </ul>\n        <p>It\'s perfectly fine to just read through these examples—no need to apply a template if you only need guidance.</p>\n    ',t.appendChild(n),!e.length){const e=document.createElement("div");return e.className="history-empty",e.innerHTML="<p>No templates available</p><small>Add templates to MonacoTemplateLibrary to populate this view.</small>",void t.appendChild(e)}e.forEach(e=>{const n=document.createElement("article");n.className="template-card",n.dataset.templateId=e.id,n.setAttribute("role","button"),n.setAttribute("tabindex","0");const i=document.createElement("div");i.className="template-header";const o=document.createElement("h3");o.textContent=e.title,i.appendChild(o);const r=document.createElement("span"),s=e.category&&l[e.category]?e.category:"basic";r.className=`badge ${s}`,r.textContent=l[s]||"Template",i.appendChild(r);const a=document.createElement("p");a.className="template-description",a.textContent=e.description||"Ready-to-use WireMock template.";const c=document.createElement("span");c.className="template-highlight",c.textContent=x(e);const d=document.createElement("div");d.className="template-features";const u=k(e);if(u){const t=document.createElement("div");t.className="template-feature";const e=document.createElement("div");e.className="template-feature__key",e.textContent=u.label;const n=document.createElement("div");n.className="template-feature__value",n.textContent=u.value,t.appendChild(e),t.appendChild(n),d.appendChild(t)}const h=document.createElement("pre");h.className="history-preview",h.textContent=function(t){try{const e=t&&t.content?t.content:{};if("string"==typeof e)return e;const n=JSON.stringify(e,null,2).split("\n").slice(0,8).join("\n");return n.length>320?`${n.slice(0,319)}…`:n}catch(e){return"[unavailable template preview]"}}(e);const f=document.createElement("div");f.className="template-actions";const p=document.createElement("button");p.className="btn btn-primary btn-sm",p.type="button",p.textContent="Use template",p.addEventListener("click",t=>{t.stopPropagation(),L(e)});const m=document.createElement("button");m.className="btn btn-secondary btn-sm",m.type="button",m.textContent="Copy JSON",m.addEventListener("click",async t=>{t.stopPropagation();const n=e&&e.content&&"string"==typeof e.content?e.content:JSON.stringify(e.content,null,2),i=await A(n);initializer&&"function"==typeof initializer.showNotification&&initializer.showNotification(i?`Template "${e.title}" copied`:"Clipboard copy failed",i?"success":"error")}),f.appendChild(p),f.appendChild(m),n.addEventListener("click",()=>J(e)),n.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),J(e))}),n.appendChild(i),n.appendChild(a),c.textContent&&n.appendChild(c),d.childNodes.length&&n.appendChild(d),n.appendChild(h),n.appendChild(f),t.appendChild(n)})},window.renderHistoryModal=async function(t={}){const e=document.getElementById("historyModal");if(!e)return;const n=window.monacoInitializer;if(n)try{const i=e.querySelector(".modal-body"),o=i?i.querySelector("#historyList"):null;if(!i||!o)return;let r=i.querySelector("#historyStats");r||(r=document.createElement("div"),r.id="historyStats",r.className="history-stats",i.insertBefore(r,i.firstChild));const s=await n.getHistoryStats(),l=u(s.byteSize),c=s.latestTimestamp?`${d(s.latestTimestamp)} (${new Date(s.latestTimestamp).toLocaleString()})`:"—",h=s.latestLabel||"—",f=a(l),p=a(c),m=a(h),y="number"==typeof s.count?s.count:a(String(s.count||"—"));if(r.innerHTML=`\n            <div class="history-meta">\n                <span class="history-meta__label">Snapshots</span>\n                <span>${y}</span>\n            </div>\n            <div class="history-meta">\n                <span class="history-meta__label">Approx size</span>\n                <span>${f}</span>\n            </div>\n            <div class="history-meta">\n                <span class="history-meta__label">Last save</span>\n                <span>${p}</span>\n            </div>\n            <div class="history-meta">\n                <span class="history-meta__label">Latest label</span>\n                <span>${m}</span>\n            </div>\n            <div class="history-actions-row">\n                <button class="btn btn-secondary btn-sm" data-history-action="snapshot">Manual snapshot</button>\n                <button class="btn btn-secondary btn-sm" data-history-action="export">Copy history JSON</button>\n                <button class="btn btn-danger btn-sm" data-history-action="clear">Clear history</button>\n            </div>\n        `,r.dataset.bound||(r.dataset.bound="true",r.addEventListener("click",async t=>{const e=t.target instanceof HTMLElement?t.target.closest("[data-history-action]"):null;if(!e)return;t.preventDefault();const i=e.dataset.historyAction;if("snapshot"===i)return await n.recordHistorySnapshot("Manual snapshot",{label:"Manual snapshot",manual:!0,force:!0}),void(await n.refreshHistoryUI({force:!0}));if("export"===i){const t=await n.getHistoryEntries({newestFirst:!1}),e={exportedAt:(new Date).toISOString(),count:s.count,entries:t.map(t=>({id:t.id,timestamp:t.timestamp,label:t.label,reason:t.meta?.reason,occurrences:t.meta?.occurrences||1,firstRecordedAt:t.meta?.firstRecordedAt,lastRecordedAt:t.meta?.lastRecordedAt,size:t.byteSize,content:t.content}))},i=await A(JSON.stringify(e,null,2));return void n.showNotification(i?"History copied to clipboard":"Failed to copy history",i?"success":"error")}"clear"===i&&("function"!=typeof window.confirm||window.confirm("Clear history snapshots? The current document will remain as the first entry."))&&await n.clearHistory({keepLatest:!0,label:"Current document"})})),t.statsOnly)return void n.markHistoryRendered();const g=await n.getHistoryEntries({newestFirst:!0}),w=n.getCurrentHistoryEntryId();if(o.innerHTML="",!g.length){const t=document.createElement("div");return t.className="history-empty",t.innerHTML="<p>No history yet</p><small>Changes are tracked automatically – edit the document or create a manual snapshot.</small>",o.appendChild(t),void n.markHistoryRendered()}g.forEach((t,e)=>{const i=document.createElement("article");i.className="history-item",i.dataset.entryId=t.id,t.id===w&&i.classList.add("current");const r=g[e+1]||null,s=document.createElement("div");s.className="history-header";const a=document.createElement("div");a.className="history-title",a.textContent=t.label||"Snapshot";const l=document.createElement("div");l.className="history-time",l.textContent=`${d(t.timestamp)} · ${new Date(t.timestamp).toLocaleString()}`,s.appendChild(a),s.appendChild(l);const c=document.createElement("pre");c.className="history-preview is-clickable",c.textContent=j(t.content,r?r.content:null),c.title="View full snapshot",c.setAttribute("role","button"),c.tabIndex=0,c.addEventListener("click",e=>{e.stopPropagation(),W(t,r)}),c.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),W(t,r))});const u=document.createElement("div");u.className="history-meta";const h=t.meta?.reason||"edit",f=document.createElement("span");f.textContent=`Reason: ${h}`,u.appendChild(f);const p=t.meta?.occurrences||1;if(p>1){const e=document.createElement("span");e.className="history-meta__occurrences";const n=t.meta?.lastRecordedAt?new Date(t.meta.lastRecordedAt).toLocaleString():new Date(t.timestamp).toLocaleString();e.textContent=`Saved ${p}×`,e.title=`Captured ${p} times (last at ${n})`,u.appendChild(e)}const m=document.createElement("span");m.textContent=t.sizeLabel,u.appendChild(m);const y=document.createElement("div");y.className="history-action-buttons";const b=document.createElement("button");b.type="button",b.className=t.id===w?"btn btn-secondary btn-sm":"btn btn-primary btn-sm",b.textContent=t.id===w?"Current version":"Restore",b.disabled=t.id===w,b.addEventListener("click",e=>{e.stopPropagation(),n.restoreHistoryEntry(t.id,{forceRestore:!1,requireConfirm:!0}).catch(t=>{})});const v=document.createElement("button");v.type="button",v.className="btn btn-secondary btn-sm",v.textContent="Copy JSON",v.addEventListener("click",async e=>{e.stopPropagation();const i=await A(t.content);n.showNotification(i?"Snapshot copied to clipboard":"Failed to copy snapshot",i?"success":"error")}),y.appendChild(b),y.appendChild(v),i.appendChild(s),i.appendChild(c),i.appendChild(u),i.appendChild(y),o.appendChild(i)}),n.markHistoryRendered()}catch(i){}})}},function(){return e||(0,t[n(t)[0]])((e={exports:{}}).exports,e),e.exports});export default i();
