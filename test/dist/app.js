"use strict";const Logger=(function(){const e={DEBUG:0,INFO:1,WARN:2,ERROR:3,SILENT:4};let t=e.WARN;const n={API:"\u{1F517}",CACHE:"\u{1F9E9}",DEMO:"\u{1F9EA}",EDITOR:"\u{1F4DD}",EVENTS:"\u{1F4E2}",FEATURES:"\u{1F9E0}",FILTERS:"\u{1F50D}",HEALTH:"\u{1F493}",MANAGERS:"\u{1F9ED}",METADATA:"\u{1F4C5}",OPS:"\u{1F6E0}\uFE0F",OPTIMISTIC:"\u{1F3AF}",PAGINATION:"\u2194\uFE0F",QUERY:"\u2753",RECORDING:"\u23FA\uFE0F",REQUESTS:"\u{1F4E1}",SCENARIOS:"\u{1F3AC}",STATE:"\u{1F310}",STORE:"\u{1F5C2}\uFE0F",SYNC:"\u{1F504}",TEMPLATES:"\u{1F9FE}",UI:"\u{1F5A5}\uFE0F",DEFAULT:"\u{1F4CB}"};function a(){try{const s=localStorage.getItem("imock-log-level");s&&e[s.toUpperCase()]!==void 0&&(t=e[s.toUpperCase()])}catch{}}function r(s,...p){const w=n[s]||n.DEFAULT;return[`[${new Date().toISOString().substring(11,23)}] ${w} [${s}]`,...p]}function o(s){const p=(s||"").toUpperCase();if(e[p]!==void 0){t=e[p];try{localStorage.setItem("imock-log-level",p)}catch{}}}const c={LEVELS:e,setLevel:o,debug:(s,...p)=>{t<=e.DEBUG&&console.log(...r(s,...p))},info:(s,...p)=>{t<=e.INFO&&console.info(...r(s,...p))},warn:(s,...p)=>{t<=e.WARN&&console.warn(...r(s,...p))},error:(s,...p)=>{t<=e.ERROR&&console.error(...r(s,...p))},api:(...s)=>c.debug("API",...s),cache:(...s)=>c.debug("CACHE",...s),ui:(...s)=>c.debug("UI",...s)};return a(),c})();window.Logger=Logger,(function(t){const n=[{id:"happy-get-resource",title:"GET Resource",description:"Return a resource by id with templated fields.",category:"happy-path",highlight:"GET \xB7 /api/resources/{id}",feature:{path:["response","jsonBody","id"],label:"response.jsonBody.id"},content:{request:{method:"GET",urlPathPattern:"/api/resources/[a-f0-9-]+"},response:{status:200,headers:{"Content-Type":"application/json"},jsonBody:{id:"{{request.pathSegments.[2]}}",name:"Example Resource",createdAt:"{{now}}"},transformers:["response-template"]}}},{id:"happy-post-create",title:"POST Create (201)",description:"Create a new resource with Location header.",category:"happy-path",highlight:"POST \xB7 /api/resources",feature:{path:["response","headers","Location"],label:"response.headers.Location"},popular:!0,content:{request:{method:"POST",urlPath:"/api/resources",headers:{"Content-Type":{equalTo:"application/json"}}},response:{status:201,headers:{"Content-Type":"application/json",Location:"/api/resources/{{randomValue type='UUID'}}"},jsonBody:{id:"{{randomValue type='UUID'}}",message:"Resource created"},transformers:["response-template"]}}},{id:"error-400-validation",title:"400 Bad Request",description:"Validation error example for POST payloads.",category:"errors",highlight:"POST \xB7 /api/resources \xB7 400",content:{request:{method:"POST",urlPath:"/api/resources",bodyPatterns:[{matchesJsonPath:"$[?(!@.name)]"}]},response:{status:400,jsonBody:{error:"Bad Request",details:[{field:"name",error:"required"}]}}}},{id:"error-401-unauthorized",title:"401 Unauthorized",description:"Missing or invalid auth header.",category:"errors",highlight:"ANY \xB7 /api/* \xB7 401",content:{request:{method:"ANY",urlPathPattern:"/api/.*",headers:{Authorization:{absent:!0}}},response:{status:401,headers:{"WWW-Authenticate":'Bearer realm="api"'},jsonBody:{error:"Unauthorized"}}}},{id:"error-404-not-found",title:"404 Not Found",description:"Simple not-found stub for missing resources.",category:"errors",highlight:"GET \xB7 /api/resources/non-existent",content:{request:{method:"GET",urlPath:"/api/resources/non-existent"},response:{status:404,jsonBody:{error:"Not Found"}}}},{id:"error-429-rate-limit",title:"429 Rate Limit",description:"Throttle response with retry guidance.",category:"errors",highlight:"ANY \xB7 429 Too Many Requests",popular:!0,content:{request:{method:"ANY",urlPattern:"/api/.*"},response:{status:429,headers:{"Retry-After":"60","X-RateLimit-Remaining":"0"},jsonBody:{error:"Too Many Requests"}}}},{id:"fault-fixed-delay",title:"Fixed Delay",description:"Deterministic slow response.",category:"faults",highlight:"GET \xB7 /api/slow \xB7 delay",feature:{path:["response","fixedDelayMilliseconds"],label:"response.fixedDelayMilliseconds"},content:{request:{method:"GET",urlPath:"/api/slow"},response:{status:200,fixedDelayMilliseconds:5e3,jsonBody:{message:"Delayed"}}}},{id:"fault-random-delay-uniform",title:"Random Delay (Uniform)",description:"Variable latency within bounds.",category:"faults",highlight:"ANY \xB7 delayDistribution.uniform",content:{request:{method:"GET",urlPath:"/api/variable-latency"},response:{status:200,delayDistribution:{type:"uniform",lower:500,upper:2e3}}}},{id:"fault-random-delay-lognormal",title:"Random Delay (Lognormal)",description:"Realistic latency distribution.",category:"faults",highlight:"ANY \xB7 delayDistribution.lognormal",content:{request:{method:"GET",urlPath:"/api/realistic-latency"},response:{status:200,delayDistribution:{type:"lognormal",median:100,sigma:.4}}}},{id:"fault-chunked-dribble",title:"Chunked Dribble",description:"Slow streaming response.",category:"faults",highlight:"GET \xB7 /api/slow-download",content:{request:{method:"GET",urlPath:"/api/slow-download"},response:{status:200,body:"Slow response...",chunkedDribbleDelay:{numberOfChunks:10,totalDuration:5e3}}}},{id:"fault-connection-reset",title:"Connection Reset",description:"Simulate TCP reset failure.",category:"faults",highlight:"GET \xB7 /api/reset \xB7 fault",popular:!0,content:{request:{method:"GET",urlPath:"/api/reset"},response:{fault:"CONNECTION_RESET_BY_PEER"}}},{id:"fault-empty-response",title:"Empty Response",description:"Return no body to mimic dropped payloads.",category:"faults",highlight:"ANY \xB7 fault: EMPTY_RESPONSE",content:{request:{method:"GET",urlPath:"/api/empty"},response:{status:200,fault:"EMPTY_RESPONSE"}}},{id:"fault-malformed-response",title:"Malformed Response",description:"Corrupted chunk fault.",category:"faults",highlight:"ANY \xB7 fault: MALFORMED_RESPONSE_CHUNK",content:{request:{method:"GET",urlPath:"/api/corrupt"},response:{status:200,fault:"MALFORMED_RESPONSE_CHUNK"}}},{id:"scenario-retry-500-200",title:"Retry: 500 \u2192 200",description:"First call fails, retry succeeds.",category:"scenarios",highlight:"Scenario \xB7 /api/flaky",popular:!0,content:{mappings:[{scenarioName:"Retry_Scenario",requiredScenarioState:"Started",newScenarioState:"Recovered",request:{method:"GET",urlPath:"/api/flaky"},response:{status:500,jsonBody:{error:"Temporary failure"}}},{scenarioName:"Retry_Scenario",requiredScenarioState:"Recovered",request:{method:"GET",urlPath:"/api/flaky"},response:{status:200,jsonBody:{message:"Success"}}}]}},{id:"scenario-todo-workflow",title:"Todo List Workflow",description:"Create \u2192 Read \u2192 Update lifecycle.",category:"scenarios",highlight:"Scenario \xB7 /todo/items",content:{mappings:[{scenarioName:"todo_list",requiredScenarioState:"Started",request:{method:"GET",url:"/todo/items"},response:{status:200,jsonBody:{items:["Buy milk"]}}},{scenarioName:"todo_list",requiredScenarioState:"Started",newScenarioState:"Item added",request:{method:"POST",url:"/todo/items",bodyPatterns:[{contains:"Cancel subscription"}]},response:{status:201}},{scenarioName:"todo_list",requiredScenarioState:"Item added",request:{method:"GET",url:"/todo/items"},response:{status:200,jsonBody:{items:["Buy milk","Cancel subscription"]}}}]}},{id:"scenario-order-lifecycle",title:"Order Lifecycle",description:"Order status across states.",category:"scenarios",highlight:"Scenario \xB7 /orders/123/status",content:{mappings:[{scenarioName:"Order_Status",requiredScenarioState:"Started",newScenarioState:"Processing",request:{method:"GET",urlPath:"/orders/123/status"},response:{status:200,jsonBody:{status:"pending"}}},{scenarioName:"Order_Status",requiredScenarioState:"Processing",newScenarioState:"Shipped",request:{method:"GET",urlPath:"/orders/123/status"},response:{status:200,jsonBody:{status:"processing"}}},{scenarioName:"Order_Status",requiredScenarioState:"Shipped",request:{method:"GET",urlPath:"/orders/123/status"},response:{status:200,jsonBody:{status:"shipped"}}}]}},{id:"dynamic-echo-request",title:"Echo Request",description:"Reflect request values in the response.",category:"dynamic",highlight:"ANY \xB7 /api/echo/*",feature:{path:["response","jsonBody","path"],label:"response.jsonBody.*"},popular:!0,content:{request:{method:"ANY",urlPathPattern:"/api/echo/.*"},response:{status:200,jsonBody:{path:"{{request.path}}",query:"{{request.query.q}}",header:"{{request.headers.X-Custom}}",timestamp:"{{now}}"},transformers:["response-template"]}}},{id:"dynamic-jsonpath-extract",title:"JSONPath Extract",description:"Use JSONPath to pull fields from the request body.",category:"dynamic",highlight:"POST \xB7 /api/process",content:{request:{method:"POST",urlPath:"/api/process"},response:{status:200,body:`{"name": "{{jsonPath request.body '$.name'}}"}`,transformers:["response-template"]}}},{id:"dynamic-random-values",title:"Random Values",description:"Generate UUIDs, codes, and numbers in the response.",category:"dynamic",highlight:"ANY \xB7 response-template random values",content:{request:{method:"GET",urlPath:"/api/generate"},response:{status:200,jsonBody:{uuid:"{{randomValue type='UUID'}}",code:"{{randomValue length=8 type='ALPHANUMERIC'}}",number:"{{randomInt lower=1 upper=100}}",type:"ORDER_ACCEPTED",orderId:"{{jsonPath request.body '$.orderId'}}",occurredAt:`{{now offset='0' pattern=\\"yyyy-MM-dd'T'HH:mm:ssXXX\\"}}`},transformers:["response-template"]}}},{id:"match-url-regex",title:"URL Pattern (Regex)",description:"Regex path matcher for numeric IDs.",category:"matching",highlight:"GET \xB7 /api/users/{id}/orders/{orderId}",content:{request:{method:"GET",urlPathPattern:"/api/users/[0-9]+/orders/[a-f0-9-]+"}}},{id:"match-query-params",title:"Query Parameters",description:"Match search params with combinations.",category:"matching",highlight:"GET \xB7 /api/search?q=\u2026",popular:!0,content:{request:{method:"GET",urlPath:"/api/search",queryParameters:{q:{matches:".+"},page:{equalTo:"1"},limit:{or:[{equalTo:"10"},{equalTo:"20"}]}}},response:{status:200}}},{id:"match-headers",title:"Headers",description:"Match requests by required headers.",category:"matching",highlight:"ANY \xB7 header matchers",content:{request:{method:"ANY",urlPath:"/api/data",headers:{Accept:{contains:"application/json"},Authorization:{matches:"Bearer .+"}}},response:{status:200}}},{id:"match-json-equal",title:"JSON Body (equalToJson)",description:"Semantic JSON comparison with json-unit helpers.",category:"matching",highlight:"POST \xB7 equalToJson",content:{request:{method:"POST",urlPath:"/api/orders",bodyPatterns:[{equalToJson:{customerId:"${json-unit.any-string}",total:"${json-unit.any-number}"},ignoreArrayOrder:!0,ignoreExtraElements:!0}]},response:{status:201}}},{id:"match-jsonpath",title:"JSONPath",description:"Multiple JSONPath checks in one stub.",category:"matching",highlight:"POST \xB7 matchesJsonPath",content:{request:{method:"POST",urlPath:"/api/events",bodyPatterns:[{matchesJsonPath:"$.type"},{matchesJsonPath:"$[?(@.priority > 5)]"},{matchesJsonPath:{expression:"$.email",contains:"@example.com"}}]},response:{status:200}}},{id:"match-basic-auth",title:"Basic Auth",description:"Protect endpoints with HTTP Basic Auth.",category:"matching",highlight:"ANY \xB7 basicAuthCredentials",content:{request:{method:"GET",urlPath:"/api/secure",basicAuthCredentials:{username:"admin",password:"secret"}},response:{status:200}}},{id:"webhook-simple",title:"Simple Webhook",description:"Send a POST callback after accepting a request.",category:"webhooks",highlight:"POST \xB7 /api/trigger \xB7 webhook",popular:!0,content:{request:{method:"POST",urlPath:"/api/trigger"},response:{status:202},serveEventListeners:[{name:"webhook",parameters:{method:"POST",url:"http://callback-service/webhook",headers:{"Content-Type":"application/json"},body:'{"status": "complete"}'}}]}},{id:"webhook-templated",title:"Templated Webhook",description:"Populate webhook payload from the original request.",category:"webhooks",highlight:"POST \xB7 templated callback",content:{request:{method:"POST",urlPath:"/api/orders"},response:{status:202},serveEventListeners:[{name:"webhook",parameters:{url:"{{jsonPath originalRequest.body '$.callbackUrl'}}",body:`{"orderId": "{{jsonPath originalRequest.body '$.orderId'}}"}`}}]}},{id:"webhook-delayed",title:"Delayed Webhook",description:"Schedule a callback after a fixed delay.",category:"webhooks",highlight:"POST \xB7 delay \u2192 webhook",content:{request:{method:"POST",urlPath:"/api/async-job"},response:{status:202},serveEventListeners:[{name:"webhook",parameters:{url:"http://service/callback",delay:{type:"fixed",milliseconds:5e3}}}]}},{id:"proxy-full",title:"Full Proxy",description:"Pass all traffic through to an upstream API.",category:"proxy",highlight:"ANY \xB7 /api/* \u2192 proxy",popular:!0,content:{priority:10,request:{method:"ANY",urlPattern:"/api/.*"},response:{status:200,proxyBaseUrl:"https://api.example.com"}}},{id:"proxy-override",title:"Proxy + Override",description:"Forward with extra headers or overrides.",category:"proxy",highlight:"ANY \xB7 proxy with headers",content:{priority:100,request:{method:"ANY",urlPattern:"/api/.*"},response:{status:200,proxyBaseUrl:"https://api.example.com",additionalProxyRequestHeaders:{"X-Forwarded-By":"WireMock"}}}},{id:"proxy-start-recording",title:"Start Recording",description:"Record traffic for snapshotting stubs.",category:"proxy",highlight:"ADMIN \xB7 recording",content:{request:{method:"POST",urlPath:"/__admin/recordings/start"},response:{status:200},targetBaseUrl:"https://api.example.com",captureHeaders:{Accept:{},Authorization:{caseInsensitive:!0}},requestBodyPattern:{matcher:"equalToJson",ignoreArrayOrder:!0},persist:!0,repeatsAsScenarios:!0}}];function a(c){return JSON.parse(JSON.stringify(c))}function r(c){if(!c||typeof c!="object")throw new Error("Template must be an object");if(!c.id)throw new Error("Template requires an id");return JSON.parse(JSON.stringify(c))}const o={getAll(){return n.map(a)},findById(c){return n.find(s=>s.id===c)||null},register(c){const s=r(c),p=n.findIndex(w=>w.id===s.id);return p>=0?n[p]=s:n.push(s),this.getAll()},replaceAll(c){if(!Array.isArray(c))throw new Error("replaceAll expects an array of templates");n.length=0;for(const s of c)n.push(JSON.parse(JSON.stringify(s)));return this.getAll()}};Object.freeze(o),t.MonacoTemplateLibrary||Object.defineProperty(t,"MonacoTemplateLibrary",{value:o,configurable:!1,enumerable:!0,writable:!1})})(typeof window<"u"?window:globalThis);/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */(function(e,t){typeof exports=="object"&&typeof module<"u"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):t((e=typeof globalThis<"u"?globalThis:e||self).jsyaml={})})(this,(function(e){"use strict";function t(i){return i==null}var n={isNothing:t,isObject:function(i){return typeof i=="object"&&i!==null},toArray:function(i){return Array.isArray(i)?i:t(i)?[]:[i]},repeat:function(i,d){var f,h="";for(f=0;f<d;f+=1)h+=i;return h},isNegativeZero:function(i){return i===0&&Number.NEGATIVE_INFINITY===1/i},extend:function(i,d){var f,h,m,I;if(d)for(f=0,h=(I=Object.keys(d)).length;f<h;f+=1)i[m=I[f]]=d[m];return i}};function a(i,d){var f="",h=i.reason||"(unknown reason)";return i.mark?(i.mark.name&&(f+='in "'+i.mark.name+'" '),f+="("+(i.mark.line+1)+":"+(i.mark.column+1)+")",!d&&i.mark.snippet&&(f+=`

`+i.mark.snippet),h+" "+f):h}function r(i,d){Error.call(this),this.name="YAMLException",this.reason=i,this.mark=d,this.message=a(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.prototype.toString=function(i){return this.name+": "+a(this,i)};var o=r;function c(i,d,f,h,m){var I="",M="",A=Math.floor(m/2)-1;return h-d>A&&(d=h-A+(I=" ... ").length),f-h>A&&(f=h+A-(M=" ...").length),{str:I+i.slice(d,f).replace(/\t/g,"\u2192")+M,pos:h-d+I.length}}function s(i,d){return n.repeat(" ",d-i.length)+i}var p=function(i,d){if(d=Object.create(d||null),!i.buffer)return null;d.maxLength||(d.maxLength=79),typeof d.indent!="number"&&(d.indent=1),typeof d.linesBefore!="number"&&(d.linesBefore=3),typeof d.linesAfter!="number"&&(d.linesAfter=2);for(var f,h=/\r?\n|\r|\0/g,m=[0],I=[],M=-1;f=h.exec(i.buffer);)I.push(f.index),m.push(f.index+f[0].length),i.position<=f.index&&M<0&&(M=m.length-2);M<0&&(M=m.length-1);var A,L,x="",Y=Math.min(i.line+d.linesAfter,I.length).toString().length,V=d.maxLength-(d.indent+Y+3);for(A=1;A<=d.linesBefore&&!(M-A<0);A++)L=c(i.buffer,m[M-A],I[M-A],i.position-(m[M]-m[M-A]),V),x=n.repeat(" ",d.indent)+s((i.line-A+1).toString(),Y)+" | "+L.str+`
`+x;for(L=c(i.buffer,m[M],I[M],i.position,V),x+=n.repeat(" ",d.indent)+s((i.line+1).toString(),Y)+" | "+L.str+`
`,x+=n.repeat("-",d.indent+Y+3+L.pos)+`^
`,A=1;A<=d.linesAfter&&!(M+A>=I.length);A++)L=c(i.buffer,m[M+A],I[M+A],i.position-(m[M]-m[M+A]),V),x+=n.repeat(" ",d.indent)+s((i.line+A+1).toString(),Y)+" | "+L.str+`
`;return x.replace(/\n$/,"")},w=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],E=["scalar","sequence","mapping"],v=function(i,d){if(d=d||{},Object.keys(d).forEach((function(f){if(w.indexOf(f)===-1)throw new o('Unknown option "'+f+'" is met in definition of "'+i+'" YAML type.')})),this.options=d,this.tag=i,this.kind=d.kind||null,this.resolve=d.resolve||function(){return!0},this.construct=d.construct||function(f){return f},this.instanceOf=d.instanceOf||null,this.predicate=d.predicate||null,this.represent=d.represent||null,this.representName=d.representName||null,this.defaultStyle=d.defaultStyle||null,this.multi=d.multi||!1,this.styleAliases=(function(f){var h={};return f!==null&&Object.keys(f).forEach((function(m){f[m].forEach((function(I){h[String(I)]=m}))})),h})(d.styleAliases||null),E.indexOf(this.kind)===-1)throw new o('Unknown kind "'+this.kind+'" is specified for "'+i+'" YAML type.')};function C(i,d){var f=[];return i[d].forEach((function(h){var m=f.length;f.forEach((function(I,M){I.tag===h.tag&&I.kind===h.kind&&I.multi===h.multi&&(m=M)})),f[m]=h})),f}function N(i){return this.extend(i)}N.prototype.extend=function(i){var d=[],f=[];if(i instanceof v)f.push(i);else if(Array.isArray(i))f=f.concat(i);else{if(!i||!Array.isArray(i.implicit)&&!Array.isArray(i.explicit))throw new o("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");i.implicit&&(d=d.concat(i.implicit)),i.explicit&&(f=f.concat(i.explicit))}d.forEach((function(m){if(!(m instanceof v))throw new o("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(m.loadKind&&m.loadKind!=="scalar")throw new o("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(m.multi)throw new o("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),f.forEach((function(m){if(!(m instanceof v))throw new o("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var h=Object.create(N.prototype);return h.implicit=(this.implicit||[]).concat(d),h.explicit=(this.explicit||[]).concat(f),h.compiledImplicit=C(h,"implicit"),h.compiledExplicit=C(h,"explicit"),h.compiledTypeMap=(function(){var m,I,M={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function A(L){L.multi?(M.multi[L.kind].push(L),M.multi.fallback.push(L)):M[L.kind][L.tag]=M.fallback[L.tag]=L}for(m=0,I=arguments.length;m<I;m+=1)arguments[m].forEach(A);return M})(h.compiledImplicit,h.compiledExplicit),h};var J=N,G=new v("tag:yaml.org,2002:str",{kind:"scalar",construct:function(i){return i!==null?i:""}}),b=new v("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(i){return i!==null?i:[]}}),y=new v("tag:yaml.org,2002:map",{kind:"mapping",construct:function(i){return i!==null?i:{}}}),k=new J({explicit:[G,b,y]}),q=new v("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(i){if(i===null)return!0;var d=i.length;return d===1&&i==="~"||d===4&&(i==="null"||i==="Null"||i==="NULL")},construct:function(){return null},predicate:function(i){return i===null},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"}),X=new v("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(i){if(i===null)return!1;var d=i.length;return d===4&&(i==="true"||i==="True"||i==="TRUE")||d===5&&(i==="false"||i==="False"||i==="FALSE")},construct:function(i){return i==="true"||i==="True"||i==="TRUE"},predicate:function(i){return Object.prototype.toString.call(i)==="[object Boolean]"},represent:{lowercase:function(i){return i?"true":"false"},uppercase:function(i){return i?"TRUE":"FALSE"},camelcase:function(i){return i?"True":"False"}},defaultStyle:"lowercase"});function he(i){return 48<=i&&i<=55}function ce(i){return 48<=i&&i<=57}var Me=new v("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(i){if(i===null)return!1;var d,f,h=i.length,m=0,I=!1;if(!h)return!1;if((d=i[m])!=="-"&&d!=="+"||(d=i[++m]),d==="0"){if(m+1===h)return!0;if((d=i[++m])==="b"){for(m++;m<h;m++)if((d=i[m])!=="_"){if(d!=="0"&&d!=="1")return!1;I=!0}return I&&d!=="_"}if(d==="x"){for(m++;m<h;m++)if((d=i[m])!=="_"){if(!(48<=(f=i.charCodeAt(m))&&f<=57||65<=f&&f<=70||97<=f&&f<=102))return!1;I=!0}return I&&d!=="_"}if(d==="o"){for(m++;m<h;m++)if((d=i[m])!=="_"){if(!he(i.charCodeAt(m)))return!1;I=!0}return I&&d!=="_"}}if(d==="_")return!1;for(;m<h;m++)if((d=i[m])!=="_"){if(!ce(i.charCodeAt(m)))return!1;I=!0}return!(!I||d==="_")},construct:function(i){var d,f=i,h=1;if(f.indexOf("_")!==-1&&(f=f.replace(/_/g,"")),(d=f[0])!=="-"&&d!=="+"||(d==="-"&&(h=-1),d=(f=f.slice(1))[0]),f==="0")return 0;if(d==="0"){if(f[1]==="b")return h*parseInt(f.slice(2),2);if(f[1]==="x")return h*parseInt(f.slice(2),16);if(f[1]==="o")return h*parseInt(f.slice(2),8)}return h*parseInt(f,10)},predicate:function(i){return Object.prototype.toString.call(i)==="[object Number]"&&i%1==0&&!n.isNegativeZero(i)},represent:{binary:function(i){return i>=0?"0b"+i.toString(2):"-0b"+i.toString(2).slice(1)},octal:function(i){return i>=0?"0o"+i.toString(8):"-0o"+i.toString(8).slice(1)},decimal:function(i){return i.toString(10)},hexadecimal:function(i){return i>=0?"0x"+i.toString(16).toUpperCase():"-0x"+i.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Fe=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),F=/^[-+]?[0-9]+e/,B=new v("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(i){return i!==null&&!(!Fe.test(i)||i[i.length-1]==="_")},construct:function(i){var d,f;return f=(d=i.replace(/_/g,"").toLowerCase())[0]==="-"?-1:1,"+-".indexOf(d[0])>=0&&(d=d.slice(1)),d===".inf"?f===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:d===".nan"?NaN:f*parseFloat(d,10)},predicate:function(i){return Object.prototype.toString.call(i)==="[object Number]"&&(i%1!=0||n.isNegativeZero(i))},represent:function(i,d){var f;if(isNaN(i))switch(d){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===i)switch(d){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===i)switch(d){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(n.isNegativeZero(i))return"-0.0";return f=i.toString(10),F.test(f)?f.replace("e",".e"):f},defaultStyle:"lowercase"}),P=k.extend({implicit:[q,X,Me,B]}),D=P,oe=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),j=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$"),de=new v("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(i){return i!==null&&(oe.exec(i)!==null||j.exec(i)!==null)},construct:function(i){var d,f,h,m,I,M,A,L,x=0,Y=null;if((d=oe.exec(i))===null&&(d=j.exec(i)),d===null)throw new Error("Date resolve error");if(f=+d[1],h=+d[2]-1,m=+d[3],!d[4])return new Date(Date.UTC(f,h,m));if(I=+d[4],M=+d[5],A=+d[6],d[7]){for(x=d[7].slice(0,3);x.length<3;)x+="0";x=+x}return d[9]&&(Y=6e4*(60*+d[10]+ +(d[11]||0)),d[9]==="-"&&(Y=-Y)),L=new Date(Date.UTC(f,h,m,I,M,A,x)),Y&&L.setTime(L.getTime()-Y),L},instanceOf:Date,represent:function(i){return i.toISOString()}}),De=new v("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(i){return i==="<<"||i===null}}),Ee=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`,xe=new v("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(i){if(i===null)return!1;var d,f,h=0,m=i.length,I=Ee;for(f=0;f<m;f++)if(!((d=I.indexOf(i.charAt(f)))>64)){if(d<0)return!1;h+=6}return h%8==0},construct:function(i){var d,f,h=i.replace(/[\r\n=]/g,""),m=h.length,I=Ee,M=0,A=[];for(d=0;d<m;d++)d%4==0&&d&&(A.push(M>>16&255),A.push(M>>8&255),A.push(255&M)),M=M<<6|I.indexOf(h.charAt(d));return(f=m%4*6)===0?(A.push(M>>16&255),A.push(M>>8&255),A.push(255&M)):f===18?(A.push(M>>10&255),A.push(M>>2&255)):f===12&&A.push(M>>4&255),new Uint8Array(A)},predicate:function(i){return Object.prototype.toString.call(i)==="[object Uint8Array]"},represent:function(i){var d,f,h="",m=0,I=i.length,M=Ee;for(d=0;d<I;d++)d%3==0&&d&&(h+=M[m>>18&63],h+=M[m>>12&63],h+=M[m>>6&63],h+=M[63&m]),m=(m<<8)+i[d];return(f=I%3)===0?(h+=M[m>>18&63],h+=M[m>>12&63],h+=M[m>>6&63],h+=M[63&m]):f===2?(h+=M[m>>10&63],h+=M[m>>4&63],h+=M[m<<2&63],h+=M[64]):f===1&&(h+=M[m>>2&63],h+=M[m<<4&63],h+=M[64],h+=M[64]),h}}),_e=Object.prototype.hasOwnProperty,it=Object.prototype.toString,Ge=new v("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(i){if(i===null)return!0;var d,f,h,m,I,M=[],A=i;for(d=0,f=A.length;d<f;d+=1){if(h=A[d],I=!1,it.call(h)!=="[object Object]")return!1;for(m in h)if(_e.call(h,m)){if(I)return!1;I=!0}if(!I||M.indexOf(m)!==-1)return!1;M.push(m)}return!0},construct:function(i){return i!==null?i:[]}}),bt=Object.prototype.toString,at=new v("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(i){if(i===null)return!0;var d,f,h,m,I,M=i;for(I=new Array(M.length),d=0,f=M.length;d<f;d+=1){if(h=M[d],bt.call(h)!=="[object Object]"||(m=Object.keys(h)).length!==1)return!1;I[d]=[m[0],h[m[0]]]}return!0},construct:function(i){if(i===null)return[];var d,f,h,m,I,M=i;for(I=new Array(M.length),d=0,f=M.length;d<f;d+=1)h=M[d],m=Object.keys(h),I[d]=[m[0],h[m[0]]];return I}}),ht=Object.prototype.hasOwnProperty,dt=new v("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(i){if(i===null)return!0;var d,f=i;for(d in f)if(ht.call(f,d)&&f[d]!==null)return!1;return!0},construct:function(i){return i!==null?i:{}}}),rt=D.extend({implicit:[de,De],explicit:[xe,Ge,at,dt]}),ne=Object.prototype.hasOwnProperty,Te=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Re=/[\x85\u2028\u2029]/,je=/[,\[\]\{\}]/,Je=/^(?:!|!!|![a-z\-]+!)$/i,ot=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Ye(i){return Object.prototype.toString.call(i)}function be(i){return i===10||i===13}function Oe(i){return i===9||i===32}function Se(i){return i===9||i===32||i===10||i===13}function Le(i){return i===44||i===91||i===93||i===123||i===125}function We(i){var d;return 48<=i&&i<=57?i-48:97<=(d=32|i)&&d<=102?d-97+10:-1}function Qe(i){return i===48?"\0":i===97?"\x07":i===98?"\b":i===116||i===9?"	":i===110?`
`:i===118?"\v":i===102?"\f":i===114?"\r":i===101?"\x1B":i===32?" ":i===34?'"':i===47?"/":i===92?"\\":i===78?"\x85":i===95?"\xA0":i===76?"\u2028":i===80?"\u2029":""}function st(i){return i<=65535?String.fromCharCode(i):String.fromCharCode(55296+(i-65536>>10),56320+(i-65536&1023))}for(var ut=new Array(256),pt=new Array(256),Ue=0;Ue<256;Ue++)ut[Ue]=Qe(Ue)?1:0,pt[Ue]=Qe(Ue);function It(i,d){this.input=i,this.filename=d.filename||null,this.schema=d.schema||rt,this.onWarning=d.onWarning||null,this.legacy=d.legacy||!1,this.json=d.json||!1,this.listener=d.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=i.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Tt(i,d){var f={name:i.filename,buffer:i.input.slice(0,-1),position:i.position,line:i.line,column:i.position-i.lineStart};return f.snippet=p(f),new o(d,f)}function z(i,d){throw Tt(i,d)}function Ve(i,d){i.onWarning&&i.onWarning.call(null,Tt(i,d))}var ft={YAML:function(i,d,f){var h,m,I;i.version!==null&&z(i,"duplication of %YAML directive"),f.length!==1&&z(i,"YAML directive accepts exactly one argument"),(h=/^([0-9]+)\.([0-9]+)$/.exec(f[0]))===null&&z(i,"ill-formed argument of the YAML directive"),m=parseInt(h[1],10),I=parseInt(h[2],10),m!==1&&z(i,"unacceptable YAML version of the document"),i.version=f[0],i.checkLineBreaks=I<2,I!==1&&I!==2&&Ve(i,"unsupported YAML version of the document")},TAG:function(i,d,f){var h,m;f.length!==2&&z(i,"TAG directive accepts exactly two arguments"),h=f[0],m=f[1],Je.test(h)||z(i,"ill-formed tag handle (first argument) of the TAG directive"),ne.call(i.tagMap,h)&&z(i,'there is a previously declared suffix for "'+h+'" tag handle'),ot.test(m)||z(i,"ill-formed tag prefix (second argument) of the TAG directive");try{m=decodeURIComponent(m)}catch{z(i,"tag prefix is malformed: "+m)}i.tagMap[h]=m}};function Be(i,d,f,h){var m,I,M,A;if(d<f){if(A=i.input.slice(d,f),h)for(m=0,I=A.length;m<I;m+=1)(M=A.charCodeAt(m))===9||32<=M&&M<=1114111||z(i,"expected valid JSON character");else Te.test(A)&&z(i,"the stream contains non-printable characters");i.result+=A}}function wt(i,d,f,h){var m,I,M,A;for(n.isObject(f)||z(i,"cannot merge mappings; the provided source object is unacceptable"),M=0,A=(m=Object.keys(f)).length;M<A;M+=1)I=m[M],ne.call(d,I)||(d[I]=f[I],h[I]=!0)}function Ke(i,d,f,h,m,I,M,A,L){var x,Y;if(Array.isArray(m))for(x=0,Y=(m=Array.prototype.slice.call(m)).length;x<Y;x+=1)Array.isArray(m[x])&&z(i,"nested arrays are not supported inside keys"),typeof m=="object"&&Ye(m[x])==="[object Object]"&&(m[x]="[object Object]");if(typeof m=="object"&&Ye(m)==="[object Object]"&&(m="[object Object]"),m=String(m),d===null&&(d={}),h==="tag:yaml.org,2002:merge")if(Array.isArray(I))for(x=0,Y=I.length;x<Y;x+=1)wt(i,d,I[x],f);else wt(i,d,I,f);else i.json||ne.call(f,m)||!ne.call(d,m)||(i.line=M||i.line,i.lineStart=A||i.lineStart,i.position=L||i.position,z(i,"duplicated mapping key")),m==="__proto__"?Object.defineProperty(d,m,{configurable:!0,enumerable:!0,writable:!0,value:I}):d[m]=I,delete f[m];return d}function Xe(i){var d;(d=i.input.charCodeAt(i.position))===10?i.position++:d===13?(i.position++,i.input.charCodeAt(i.position)===10&&i.position++):z(i,"a line break is expected"),i.line+=1,i.lineStart=i.position,i.firstTabInLine=-1}function we(i,d,f){for(var h=0,m=i.input.charCodeAt(i.position);m!==0;){for(;Oe(m);)m===9&&i.firstTabInLine===-1&&(i.firstTabInLine=i.position),m=i.input.charCodeAt(++i.position);if(d&&m===35)do m=i.input.charCodeAt(++i.position);while(m!==10&&m!==13&&m!==0);if(!be(m))break;for(Xe(i),m=i.input.charCodeAt(i.position),h++,i.lineIndent=0;m===32;)i.lineIndent++,m=i.input.charCodeAt(++i.position)}return f!==-1&&h!==0&&i.lineIndent<f&&Ve(i,"deficient indentation"),h}function ct(i){var d,f=i.position;return!((d=i.input.charCodeAt(f))!==45&&d!==46||d!==i.input.charCodeAt(f+1)||d!==i.input.charCodeAt(f+2)||(f+=3,(d=i.input.charCodeAt(f))!==0&&!Se(d)))}function yt(i,d){d===1?i.result+=" ":d>1&&(i.result+=n.repeat(`
`,d-1))}function Mt(i,d){var f,h,m=i.tag,I=i.anchor,M=[],A=!1;if(i.firstTabInLine!==-1)return!1;for(i.anchor!==null&&(i.anchorMap[i.anchor]=M),h=i.input.charCodeAt(i.position);h!==0&&(i.firstTabInLine!==-1&&(i.position=i.firstTabInLine,z(i,"tab characters must not be used in indentation")),h===45)&&Se(i.input.charCodeAt(i.position+1));)if(A=!0,i.position++,we(i,!0,-1)&&i.lineIndent<=d)M.push(null),h=i.input.charCodeAt(i.position);else if(f=i.line,Ze(i,d,3,!1,!0),M.push(i.result),we(i,!0,-1),h=i.input.charCodeAt(i.position),(i.line===f||i.lineIndent>d)&&h!==0)z(i,"bad indentation of a sequence entry");else if(i.lineIndent<d)break;return!!A&&(i.tag=m,i.anchor=I,i.kind="sequence",i.result=M,!0)}function Ct(i){var d,f,h,m,I=!1,M=!1;if((m=i.input.charCodeAt(i.position))!==33)return!1;if(i.tag!==null&&z(i,"duplication of a tag property"),(m=i.input.charCodeAt(++i.position))===60?(I=!0,m=i.input.charCodeAt(++i.position)):m===33?(M=!0,f="!!",m=i.input.charCodeAt(++i.position)):f="!",d=i.position,I){do m=i.input.charCodeAt(++i.position);while(m!==0&&m!==62);i.position<i.length?(h=i.input.slice(d,i.position),m=i.input.charCodeAt(++i.position)):z(i,"unexpected end of the stream within a verbatim tag")}else{for(;m!==0&&!Se(m);)m===33&&(M?z(i,"tag suffix cannot contain exclamation marks"):(f=i.input.slice(d-1,i.position+1),Je.test(f)||z(i,"named tag handle cannot contain such characters"),M=!0,d=i.position+1)),m=i.input.charCodeAt(++i.position);h=i.input.slice(d,i.position),je.test(h)&&z(i,"tag suffix cannot contain flow indicator characters")}h&&!ot.test(h)&&z(i,"tag name cannot contain such characters: "+h);try{h=decodeURIComponent(h)}catch{z(i,"tag name is malformed: "+h)}return I?i.tag=h:ne.call(i.tagMap,f)?i.tag=i.tagMap[f]+h:f==="!"?i.tag="!"+h:f==="!!"?i.tag="tag:yaml.org,2002:"+h:z(i,'undeclared tag handle "'+f+'"'),!0}function Nt(i){var d,f;if((f=i.input.charCodeAt(i.position))!==38)return!1;for(i.anchor!==null&&z(i,"duplication of an anchor property"),f=i.input.charCodeAt(++i.position),d=i.position;f!==0&&!Se(f)&&!Le(f);)f=i.input.charCodeAt(++i.position);return i.position===d&&z(i,"name of an anchor node must contain at least one character"),i.anchor=i.input.slice(d,i.position),!0}function Ze(i,d,f,h,m){var I,M,A,L,x,Y,V,ge,_,pe=1,ue=!1,fe=!1;if(i.listener!==null&&i.listener("open",i),i.tag=null,i.anchor=null,i.kind=null,i.result=null,I=M=A=f===4||f===3,h&&we(i,!0,-1)&&(ue=!0,i.lineIndent>d?pe=1:i.lineIndent===d?pe=0:i.lineIndent<d&&(pe=-1)),pe===1)for(;Ct(i)||Nt(i);)we(i,!0,-1)?(ue=!0,A=I,i.lineIndent>d?pe=1:i.lineIndent===d?pe=0:i.lineIndent<d&&(pe=-1)):A=!1;if(A&&(A=ue||m),pe!==1&&f!==4||(ge=f===1||f===2?d:d+1,_=i.position-i.lineStart,pe===1?A&&(Mt(i,_)||(function(u,Z,K){var W,ie,H,se,ae,le,me,te=u.tag,ye=u.anchor,ve={},Ae=Object.create(null),ke=null,$e=null,lt=null,Pe=!1,gt=!1;if(u.firstTabInLine!==-1)return!1;for(u.anchor!==null&&(u.anchorMap[u.anchor]=ve),me=u.input.charCodeAt(u.position);me!==0;){if(Pe||u.firstTabInLine===-1||(u.position=u.firstTabInLine,z(u,"tab characters must not be used in indentation")),W=u.input.charCodeAt(u.position+1),H=u.line,me!==63&&me!==58||!Se(W)){if(se=u.line,ae=u.lineStart,le=u.position,!Ze(u,K,2,!1,!0))break;if(u.line===H){for(me=u.input.charCodeAt(u.position);Oe(me);)me=u.input.charCodeAt(++u.position);if(me===58)Se(me=u.input.charCodeAt(++u.position))||z(u,"a whitespace character is expected after the key-value separator within a block mapping"),Pe&&(Ke(u,ve,Ae,ke,$e,null,se,ae,le),ke=$e=lt=null),gt=!0,Pe=!1,ie=!1,ke=u.tag,$e=u.result;else{if(!gt)return u.tag=te,u.anchor=ye,!0;z(u,"can not read an implicit mapping pair; a colon is missed")}}else{if(!gt)return u.tag=te,u.anchor=ye,!0;z(u,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else me===63?(Pe&&(Ke(u,ve,Ae,ke,$e,null,se,ae,le),ke=$e=lt=null),gt=!0,Pe=!0,ie=!0):Pe?(Pe=!1,ie=!0):z(u,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),u.position+=1,me=W;if((u.line===H||u.lineIndent>Z)&&(Pe&&(se=u.line,ae=u.lineStart,le=u.position),Ze(u,Z,4,!0,ie)&&(Pe?$e=u.result:lt=u.result),Pe||(Ke(u,ve,Ae,ke,$e,lt,se,ae,le),ke=$e=lt=null),we(u,!0,-1),me=u.input.charCodeAt(u.position)),(u.line===H||u.lineIndent>Z)&&me!==0)z(u,"bad indentation of a mapping entry");else if(u.lineIndent<Z)break}return Pe&&Ke(u,ve,Ae,ke,$e,null,se,ae,le),gt&&(u.tag=te,u.anchor=ye,u.kind="mapping",u.result=ve),gt})(i,_,ge))||(function(u,Z){var K,W,ie,H,se,ae,le,me,te,ye,ve,Ae,ke=!0,$e=u.tag,lt=u.anchor,Pe=Object.create(null);if((Ae=u.input.charCodeAt(u.position))===91)se=93,me=!1,H=[];else{if(Ae!==123)return!1;se=125,me=!0,H={}}for(u.anchor!==null&&(u.anchorMap[u.anchor]=H),Ae=u.input.charCodeAt(++u.position);Ae!==0;){if(we(u,!0,Z),(Ae=u.input.charCodeAt(u.position))===se)return u.position++,u.tag=$e,u.anchor=lt,u.kind=me?"mapping":"sequence",u.result=H,!0;ke?Ae===44&&z(u,"expected the node content, but found ','"):z(u,"missed comma between flow collection entries"),ve=null,ae=le=!1,Ae===63&&Se(u.input.charCodeAt(u.position+1))&&(ae=le=!0,u.position++,we(u,!0,Z)),K=u.line,W=u.lineStart,ie=u.position,Ze(u,Z,1,!1,!0),ye=u.tag,te=u.result,we(u,!0,Z),Ae=u.input.charCodeAt(u.position),!le&&u.line!==K||Ae!==58||(ae=!0,Ae=u.input.charCodeAt(++u.position),we(u,!0,Z),Ze(u,Z,1,!1,!0),ve=u.result),me?Ke(u,H,Pe,ye,te,ve,K,W,ie):ae?H.push(Ke(u,null,Pe,ye,te,ve,K,W,ie)):H.push(te),we(u,!0,Z),(Ae=u.input.charCodeAt(u.position))===44?(ke=!0,Ae=u.input.charCodeAt(++u.position)):ke=!1}z(u,"unexpected end of the stream within a flow collection")})(i,ge)?fe=!0:(M&&(function(u,Z){var K,W,ie,H,se,ae=1,le=!1,me=!1,te=Z,ye=0,ve=!1;if((H=u.input.charCodeAt(u.position))===124)W=!1;else{if(H!==62)return!1;W=!0}for(u.kind="scalar",u.result="";H!==0;)if((H=u.input.charCodeAt(++u.position))===43||H===45)ae===1?ae=H===43?3:2:z(u,"repeat of a chomping mode identifier");else{if(!((ie=48<=(se=H)&&se<=57?se-48:-1)>=0))break;ie===0?z(u,"bad explicit indentation width of a block scalar; it cannot be less than one"):me?z(u,"repeat of an indentation width identifier"):(te=Z+ie-1,me=!0)}if(Oe(H)){do H=u.input.charCodeAt(++u.position);while(Oe(H));if(H===35)do H=u.input.charCodeAt(++u.position);while(!be(H)&&H!==0)}for(;H!==0;){for(Xe(u),u.lineIndent=0,H=u.input.charCodeAt(u.position);(!me||u.lineIndent<te)&&H===32;)u.lineIndent++,H=u.input.charCodeAt(++u.position);if(!me&&u.lineIndent>te&&(te=u.lineIndent),be(H))ye++;else{if(u.lineIndent<te){ae===3?u.result+=n.repeat(`
`,le?1+ye:ye):ae===1&&le&&(u.result+=`
`);break}for(W?Oe(H)?(ve=!0,u.result+=n.repeat(`
`,le?1+ye:ye)):ve?(ve=!1,u.result+=n.repeat(`
`,ye+1)):ye===0?le&&(u.result+=" "):u.result+=n.repeat(`
`,ye):u.result+=n.repeat(`
`,le?1+ye:ye),le=!0,me=!0,ye=0,K=u.position;!be(H)&&H!==0;)H=u.input.charCodeAt(++u.position);Be(u,K,u.position,!1)}}return!0})(i,ge)||(function(u,Z){var K,W,ie;if((K=u.input.charCodeAt(u.position))!==39)return!1;for(u.kind="scalar",u.result="",u.position++,W=ie=u.position;(K=u.input.charCodeAt(u.position))!==0;)if(K===39){if(Be(u,W,u.position,!0),(K=u.input.charCodeAt(++u.position))!==39)return!0;W=u.position,u.position++,ie=u.position}else be(K)?(Be(u,W,ie,!0),yt(u,we(u,!1,Z)),W=ie=u.position):u.position===u.lineStart&&ct(u)?z(u,"unexpected end of the document within a single quoted scalar"):(u.position++,ie=u.position);z(u,"unexpected end of the stream within a single quoted scalar")})(i,ge)||(function(u,Z){var K,W,ie,H,se,ae,le;if((ae=u.input.charCodeAt(u.position))!==34)return!1;for(u.kind="scalar",u.result="",u.position++,K=W=u.position;(ae=u.input.charCodeAt(u.position))!==0;){if(ae===34)return Be(u,K,u.position,!0),u.position++,!0;if(ae===92){if(Be(u,K,u.position,!0),be(ae=u.input.charCodeAt(++u.position)))we(u,!1,Z);else if(ae<256&&ut[ae])u.result+=pt[ae],u.position++;else if((se=(le=ae)===120?2:le===117?4:le===85?8:0)>0){for(ie=se,H=0;ie>0;ie--)(se=We(ae=u.input.charCodeAt(++u.position)))>=0?H=(H<<4)+se:z(u,"expected hexadecimal character");u.result+=st(H),u.position++}else z(u,"unknown escape sequence");K=W=u.position}else be(ae)?(Be(u,K,W,!0),yt(u,we(u,!1,Z)),K=W=u.position):u.position===u.lineStart&&ct(u)?z(u,"unexpected end of the document within a double quoted scalar"):(u.position++,W=u.position)}z(u,"unexpected end of the stream within a double quoted scalar")})(i,ge)?fe=!0:(function(u){var Z,K,W;if((W=u.input.charCodeAt(u.position))!==42)return!1;for(W=u.input.charCodeAt(++u.position),Z=u.position;W!==0&&!Se(W)&&!Le(W);)W=u.input.charCodeAt(++u.position);return u.position===Z&&z(u,"name of an alias node must contain at least one character"),K=u.input.slice(Z,u.position),ne.call(u.anchorMap,K)||z(u,'unidentified alias "'+K+'"'),u.result=u.anchorMap[K],we(u,!0,-1),!0})(i)?(fe=!0,i.tag===null&&i.anchor===null||z(i,"alias node should not have any properties")):(function(u,Z,K){var W,ie,H,se,ae,le,me,te,ye=u.kind,ve=u.result;if(Se(te=u.input.charCodeAt(u.position))||Le(te)||te===35||te===38||te===42||te===33||te===124||te===62||te===39||te===34||te===37||te===64||te===96||(te===63||te===45)&&(Se(W=u.input.charCodeAt(u.position+1))||K&&Le(W)))return!1;for(u.kind="scalar",u.result="",ie=H=u.position,se=!1;te!==0;){if(te===58){if(Se(W=u.input.charCodeAt(u.position+1))||K&&Le(W))break}else if(te===35){if(Se(u.input.charCodeAt(u.position-1)))break}else{if(u.position===u.lineStart&&ct(u)||K&&Le(te))break;if(be(te)){if(ae=u.line,le=u.lineStart,me=u.lineIndent,we(u,!1,-1),u.lineIndent>=Z){se=!0,te=u.input.charCodeAt(u.position);continue}u.position=H,u.line=ae,u.lineStart=le,u.lineIndent=me;break}}se&&(Be(u,ie,H,!1),yt(u,u.line-ae),ie=H=u.position,se=!1),Oe(te)||(H=u.position+1),te=u.input.charCodeAt(++u.position)}return Be(u,ie,H,!1),!!u.result||(u.kind=ye,u.result=ve,!1)})(i,ge,f===1)&&(fe=!0,i.tag===null&&(i.tag="?")),i.anchor!==null&&(i.anchorMap[i.anchor]=i.result)):pe===0&&(fe=A&&Mt(i,_))),i.tag===null)i.anchor!==null&&(i.anchorMap[i.anchor]=i.result);else if(i.tag==="?"){for(i.result!==null&&i.kind!=="scalar"&&z(i,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+i.kind+'"'),L=0,x=i.implicitTypes.length;L<x;L+=1)if((V=i.implicitTypes[L]).resolve(i.result)){i.result=V.construct(i.result),i.tag=V.tag,i.anchor!==null&&(i.anchorMap[i.anchor]=i.result);break}}else if(i.tag!=="!"){if(ne.call(i.typeMap[i.kind||"fallback"],i.tag))V=i.typeMap[i.kind||"fallback"][i.tag];else for(V=null,L=0,x=(Y=i.typeMap.multi[i.kind||"fallback"]).length;L<x;L+=1)if(i.tag.slice(0,Y[L].tag.length)===Y[L].tag){V=Y[L];break}V||z(i,"unknown tag !<"+i.tag+">"),i.result!==null&&V.kind!==i.kind&&z(i,"unacceptable node kind for !<"+i.tag+'> tag; it should be "'+V.kind+'", not "'+i.kind+'"'),V.resolve(i.result,i.tag)?(i.result=V.construct(i.result,i.tag),i.anchor!==null&&(i.anchorMap[i.anchor]=i.result)):z(i,"cannot resolve a node with !<"+i.tag+"> explicit tag")}return i.listener!==null&&i.listener("close",i),i.tag!==null||i.anchor!==null||fe}function Rt(i){var d,f,h,m,I=i.position,M=!1;for(i.version=null,i.checkLineBreaks=i.legacy,i.tagMap=Object.create(null),i.anchorMap=Object.create(null);(m=i.input.charCodeAt(i.position))!==0&&(we(i,!0,-1),m=i.input.charCodeAt(i.position),!(i.lineIndent>0||m!==37));){for(M=!0,m=i.input.charCodeAt(++i.position),d=i.position;m!==0&&!Se(m);)m=i.input.charCodeAt(++i.position);for(h=[],(f=i.input.slice(d,i.position)).length<1&&z(i,"directive name must not be less than one character in length");m!==0;){for(;Oe(m);)m=i.input.charCodeAt(++i.position);if(m===35){do m=i.input.charCodeAt(++i.position);while(m!==0&&!be(m));break}if(be(m))break;for(d=i.position;m!==0&&!Se(m);)m=i.input.charCodeAt(++i.position);h.push(i.input.slice(d,i.position))}m!==0&&Xe(i),ne.call(ft,f)?ft[f](i,f,h):Ve(i,'unknown document directive "'+f+'"')}we(i,!0,-1),i.lineIndent===0&&i.input.charCodeAt(i.position)===45&&i.input.charCodeAt(i.position+1)===45&&i.input.charCodeAt(i.position+2)===45?(i.position+=3,we(i,!0,-1)):M&&z(i,"directives end mark is expected"),Ze(i,i.lineIndent-1,4,!1,!0),we(i,!0,-1),i.checkLineBreaks&&Re.test(i.input.slice(I,i.position))&&Ve(i,"non-ASCII line breaks are interpreted as content"),i.documents.push(i.result),i.position===i.lineStart&&ct(i)?i.input.charCodeAt(i.position)===46&&(i.position+=3,we(i,!0,-1)):i.position<i.length-1&&z(i,"end of the stream or a document separator is expected")}function Ie(i,d){d=d||{},(i=String(i)).length!==0&&(i.charCodeAt(i.length-1)!==10&&i.charCodeAt(i.length-1)!==13&&(i+=`
`),i.charCodeAt(0)===65279&&(i=i.slice(1)));var f=new It(i,d),h=i.indexOf("\0");for(h!==-1&&(f.position=h,z(f,"null byte is not allowed in input")),f.input+="\0";f.input.charCodeAt(f.position)===32;)f.lineIndent+=1,f.position+=1;for(;f.position<f.length-1;)Rt(f);return f.documents}var St={loadAll:function(i,d,f){d!==null&&typeof d=="object"&&f===void 0&&(f=d,d=null);var h=Ie(i,f);if(typeof d!="function")return h;for(var m=0,I=h.length;m<I;m+=1)d(h[m])},load:function(i,d){var f=Ie(i,d);if(f.length!==0){if(f.length===1)return f[0];throw new o("expected a single document in the stream, but found more")}}},vt=Object.prototype.toString,Et=Object.prototype.hasOwnProperty,l=65279,g={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},S=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],T=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function R(i){var d,f,h;if(d=i.toString(16).toUpperCase(),i<=255)f="x",h=2;else if(i<=65535)f="u",h=4;else{if(!(i<=4294967295))throw new o("code point within a string may not be greater than 0xFFFFFFFF");f="U",h=8}return"\\"+f+n.repeat("0",h-d.length)+d}function O(i){this.schema=i.schema||rt,this.indent=Math.max(1,i.indent||2),this.noArrayIndent=i.noArrayIndent||!1,this.skipInvalid=i.skipInvalid||!1,this.flowLevel=n.isNothing(i.flowLevel)?-1:i.flowLevel,this.styleMap=(function(d,f){var h,m,I,M,A,L,x;if(f===null)return{};for(h={},I=0,M=(m=Object.keys(f)).length;I<M;I+=1)A=m[I],L=String(f[A]),A.slice(0,2)==="!!"&&(A="tag:yaml.org,2002:"+A.slice(2)),(x=d.compiledTypeMap.fallback[A])&&Et.call(x.styleAliases,L)&&(L=x.styleAliases[L]),h[A]=L;return h})(this.schema,i.styles||null),this.sortKeys=i.sortKeys||!1,this.lineWidth=i.lineWidth||80,this.noRefs=i.noRefs||!1,this.noCompatMode=i.noCompatMode||!1,this.condenseFlow=i.condenseFlow||!1,this.quotingType=i.quotingType==='"'?2:1,this.forceQuotes=i.forceQuotes||!1,this.replacer=typeof i.replacer=="function"?i.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function U(i,d){for(var f,h=n.repeat(" ",d),m=0,I=-1,M="",A=i.length;m<A;)(I=i.indexOf(`
`,m))===-1?(f=i.slice(m),m=A):(f=i.slice(m,I+1),m=I+1),f.length&&f!==`
`&&(M+=h),M+=f;return M}function Q(i,d){return`
`+n.repeat(" ",i.indent*d)}function re(i){return i===32||i===9}function $(i){return 32<=i&&i<=126||161<=i&&i<=55295&&i!==8232&&i!==8233||57344<=i&&i<=65533&&i!==l||65536<=i&&i<=1114111}function ee(i){return $(i)&&i!==l&&i!==13&&i!==10}function Ce(i,d,f){var h=ee(i),m=h&&!re(i);return(f?h:h&&i!==44&&i!==91&&i!==93&&i!==123&&i!==125)&&i!==35&&!(d===58&&!m)||ee(d)&&!re(d)&&i===35||d===58&&m}function qe(i,d){var f,h=i.charCodeAt(d);return h>=55296&&h<=56319&&d+1<i.length&&(f=i.charCodeAt(d+1))>=56320&&f<=57343?1024*(h-55296)+f-56320+65536:h}function et(i){return/^\n* /.test(i)}function Ne(i,d,f,h,m,I,M,A){var L,x,Y=0,V=null,ge=!1,_=!1,pe=h!==-1,ue=-1,fe=$(x=qe(i,0))&&x!==l&&!re(x)&&x!==45&&x!==63&&x!==58&&x!==44&&x!==91&&x!==93&&x!==123&&x!==125&&x!==35&&x!==38&&x!==42&&x!==33&&x!==124&&x!==61&&x!==62&&x!==39&&x!==34&&x!==37&&x!==64&&x!==96&&(function(u){return!re(u)&&u!==58})(qe(i,i.length-1));if(d||M)for(L=0;L<i.length;Y>=65536?L+=2:L++){if(!$(Y=qe(i,L)))return 5;fe=fe&&Ce(Y,V,A),V=Y}else{for(L=0;L<i.length;Y>=65536?L+=2:L++){if((Y=qe(i,L))===10)ge=!0,pe&&(_=_||L-ue-1>h&&i[ue+1]!==" ",ue=L);else if(!$(Y))return 5;fe=fe&&Ce(Y,V,A),V=Y}_=_||pe&&L-ue-1>h&&i[ue+1]!==" "}return ge||_?f>9&&et(i)?5:M?I===2?5:2:_?4:3:!fe||M||m(i)?I===2?5:2:1}function mt(i,d,f,h,m){i.dump=(function(){if(d.length===0)return i.quotingType===2?'""':"''";if(!i.noCompatMode&&(S.indexOf(d)!==-1||T.test(d)))return i.quotingType===2?'"'+d+'"':"'"+d+"'";var I=i.indent*Math.max(1,f),M=i.lineWidth===-1?-1:Math.max(Math.min(i.lineWidth,40),i.lineWidth-I),A=h||i.flowLevel>-1&&f>=i.flowLevel;switch(Ne(d,A,i.indent,M,(function(L){return(function(x,Y){var V,ge;for(V=0,ge=x.implicitTypes.length;V<ge;V+=1)if(x.implicitTypes[V].resolve(Y))return!0;return!1})(i,L)}),i.quotingType,i.forceQuotes&&!h,m)){case 1:return d;case 2:return"'"+d.replace(/'/g,"''")+"'";case 3:return"|"+He(d,i.indent)+tt(U(d,I));case 4:return">"+He(d,i.indent)+tt(U((function(L,x){for(var Y,V,ge=/(\n+)([^\n]*)/g,_=(ue=L.indexOf(`
`),ue=ue!==-1?ue:L.length,ge.lastIndex=ue,nt(L.slice(0,ue),x)),pe=L[0]===`
`||L[0]===" ",ue;V=ge.exec(L);){var fe=V[1],u=V[2];Y=u[0]===" ",_+=fe+(pe||Y||u===""?"":`
`)+nt(u,x),pe=Y}return _})(d,M),I));case 5:return'"'+(function(L){for(var x,Y="",V=0,ge=0;ge<L.length;V>=65536?ge+=2:ge++)V=qe(L,ge),!(x=g[V])&&$(V)?(Y+=L[ge],V>=65536&&(Y+=L[ge+1])):Y+=x||R(V);return Y})(d)+'"';default:throw new o("impossible error: invalid scalar style")}})()}function He(i,d){var f=et(i)?String(d):"",h=i[i.length-1]===`
`;return f+(h&&(i[i.length-2]===`
`||i===`
`)?"+":h?"":"-")+`
`}function tt(i){return i[i.length-1]===`
`?i.slice(0,-1):i}function nt(i,d){if(i===""||i[0]===" ")return i;for(var f,h,m=/ [^ ]/g,I=0,M=0,A=0,L="";f=m.exec(i);)(A=f.index)-I>d&&(h=M>I?M:A,L+=`
`+i.slice(I,h),I=h+1),M=A;return L+=`
`,i.length-I>d&&M>I?L+=i.slice(I,M)+`
`+i.slice(M+1):L+=i.slice(I),L.slice(1)}function At(i,d,f,h){var m,I,M,A="",L=i.tag;for(m=0,I=f.length;m<I;m+=1)M=f[m],i.replacer&&(M=i.replacer.call(f,String(m),M)),(ze(i,d+1,M,!0,!0,!1,!0)||M===void 0&&ze(i,d+1,null,!0,!0,!1,!0))&&(h&&A===""||(A+=Q(i,d)),i.dump&&i.dump.charCodeAt(0)===10?A+="-":A+="- ",A+=i.dump);i.tag=L,i.dump=A||"[]"}function Lt(i,d,f){var h,m,I,M,A,L;for(I=0,M=(m=f?i.explicitTypes:i.implicitTypes).length;I<M;I+=1)if(((A=m[I]).instanceOf||A.predicate)&&(!A.instanceOf||typeof d=="object"&&d instanceof A.instanceOf)&&(!A.predicate||A.predicate(d))){if(f?A.multi&&A.representName?i.tag=A.representName(d):i.tag=A.tag:i.tag="?",A.represent){if(L=i.styleMap[A.tag]||A.defaultStyle,vt.call(A.represent)==="[object Function]")h=A.represent(d,L);else{if(!Et.call(A.represent,L))throw new o("!<"+A.tag+'> tag resolver accepts not "'+L+'" style');h=A.represent[L](d,L)}i.dump=h}return!0}return!1}function ze(i,d,f,h,m,I,M){i.tag=null,i.dump=f,Lt(i,f,!1)||Lt(i,f,!0);var A,L=vt.call(i.dump),x=h;h&&(h=i.flowLevel<0||i.flowLevel>d);var Y,V,ge=L==="[object Object]"||L==="[object Array]";if(ge&&(V=(Y=i.duplicates.indexOf(f))!==-1),(i.tag!==null&&i.tag!=="?"||V||i.indent!==2&&d>0)&&(m=!1),V&&i.usedDuplicates[Y])i.dump="*ref_"+Y;else{if(ge&&V&&!i.usedDuplicates[Y]&&(i.usedDuplicates[Y]=!0),L==="[object Object]")h&&Object.keys(i.dump).length!==0?((function(_,pe,ue,fe){var u,Z,K,W,ie,H,se="",ae=_.tag,le=Object.keys(ue);if(_.sortKeys===!0)le.sort();else if(typeof _.sortKeys=="function")le.sort(_.sortKeys);else if(_.sortKeys)throw new o("sortKeys must be a boolean or a function");for(u=0,Z=le.length;u<Z;u+=1)H="",fe&&se===""||(H+=Q(_,pe)),W=ue[K=le[u]],_.replacer&&(W=_.replacer.call(ue,K,W)),ze(_,pe+1,K,!0,!0,!0)&&((ie=_.tag!==null&&_.tag!=="?"||_.dump&&_.dump.length>1024)&&(_.dump&&_.dump.charCodeAt(0)===10?H+="?":H+="? "),H+=_.dump,ie&&(H+=Q(_,pe)),ze(_,pe+1,W,!0,ie)&&(_.dump&&_.dump.charCodeAt(0)===10?H+=":":H+=": ",se+=H+=_.dump));_.tag=ae,_.dump=se||"{}"})(i,d,i.dump,m),V&&(i.dump="&ref_"+Y+i.dump)):((function(_,pe,ue){var fe,u,Z,K,W,ie="",H=_.tag,se=Object.keys(ue);for(fe=0,u=se.length;fe<u;fe+=1)W="",ie!==""&&(W+=", "),_.condenseFlow&&(W+='"'),K=ue[Z=se[fe]],_.replacer&&(K=_.replacer.call(ue,Z,K)),ze(_,pe,Z,!1,!1)&&(_.dump.length>1024&&(W+="? "),W+=_.dump+(_.condenseFlow?'"':"")+":"+(_.condenseFlow?"":" "),ze(_,pe,K,!1,!1)&&(ie+=W+=_.dump));_.tag=H,_.dump="{"+ie+"}"})(i,d,i.dump),V&&(i.dump="&ref_"+Y+" "+i.dump));else if(L==="[object Array]")h&&i.dump.length!==0?(i.noArrayIndent&&!M&&d>0?At(i,d-1,i.dump,m):At(i,d,i.dump,m),V&&(i.dump="&ref_"+Y+i.dump)):((function(_,pe,ue){var fe,u,Z,K="",W=_.tag;for(fe=0,u=ue.length;fe<u;fe+=1)Z=ue[fe],_.replacer&&(Z=_.replacer.call(ue,String(fe),Z)),(ze(_,pe,Z,!1,!1)||Z===void 0&&ze(_,pe,null,!1,!1))&&(K!==""&&(K+=","+(_.condenseFlow?"":" ")),K+=_.dump);_.tag=W,_.dump="["+K+"]"})(i,d,i.dump),V&&(i.dump="&ref_"+Y+" "+i.dump));else{if(L!=="[object String]"){if(L==="[object Undefined]"||i.skipInvalid)return!1;throw new o("unacceptable kind of an object to dump "+L)}i.tag!=="?"&&mt(i,i.dump,d,I,x)}i.tag!==null&&i.tag!=="?"&&(A=encodeURI(i.tag[0]==="!"?i.tag.slice(1):i.tag).replace(/!/g,"%21"),A=i.tag[0]==="!"?"!"+A:A.slice(0,18)==="tag:yaml.org,2002:"?"!!"+A.slice(18):"!<"+A+">",i.dump=A+" "+i.dump)}return!0}function Yt(i,d){var f,h,m=[],I=[];for(Pt(i,m,I),f=0,h=I.length;f<h;f+=1)d.duplicates.push(m[I[f]]);d.usedDuplicates=new Array(h)}function Pt(i,d,f){var h,m,I;if(i!==null&&typeof i=="object")if((m=d.indexOf(i))!==-1)f.indexOf(m)===-1&&f.push(m);else if(d.push(i),Array.isArray(i))for(m=0,I=i.length;m<I;m+=1)Pt(i[m],d,f);else for(m=0,I=(h=Object.keys(i)).length;m<I;m+=1)Pt(i[h[m]],d,f)}function Ot(i,d){return function(){throw new Error("Function yaml."+i+" is removed in js-yaml 4. Use yaml."+d+" instead, which is now safe by default.")}}var qt=v,Ft=J,kt=k,$t=P,Dt=D,Ut=rt,Bt=St.load,xt=St.loadAll,_t=function(i,d){var f=new O(d=d||{});f.noRefs||Yt(i,f);var h=i;return f.replacer&&(h=f.replacer.call({"":h},"",h)),ze(f,0,h,!0,!0)?f.dump+`
`:""},jt=o,Ht={binary:xe,float:B,map:y,null:q,pairs:at,set:dt,timestamp:de,bool:X,int:Me,merge:De,omap:Ge,seq:b,str:G},zt=Ot("safeLoad","load"),Gt=Ot("safeLoadAll","loadAll"),Jt=Ot("safeDump","dump"),Wt={Type:qt,Schema:Ft,FAILSAFE_SCHEMA:kt,JSON_SCHEMA:$t,CORE_SCHEMA:Dt,DEFAULT_SCHEMA:Ut,load:Bt,loadAll:xt,dump:_t,YAMLException:jt,types:Ht,safeLoad:zt,safeLoadAll:Gt,safeDump:Jt};e.CORE_SCHEMA=Dt,e.DEFAULT_SCHEMA=Ut,e.FAILSAFE_SCHEMA=kt,e.JSON_SCHEMA=$t,e.Schema=Ft,e.Type=qt,e.YAMLException=jt,e.default=Wt,e.dump=_t,e.load=Bt,e.loadAll=xt,e.safeDump=Jt,e.safeLoad=zt,e.safeLoadAll=Gt,e.types=Ht,Object.defineProperty(e,"__esModule",{value:!0})})),window.SELECTORS={PAGES:{MAPPINGS:"mappings-page",REQUESTS:"requests-page",SCENARIOS:"scenarios-page","IMPORT-EXPORT":"import-export-page",RECORDING:"recording-page",SETTINGS:"settings-page"},REQUEST_FILTERS:{METHOD:"req-filter-method",STATUS:"req-filter-status",URL:"req-filter-url",DATE_FROM:"req-filter-from",DATE_TO:"req-filter-to",QUICK:"req-filter-quick"},MAPPING_FILTERS:{QUERY:"filter-query"},LISTS:{MAPPINGS:"mappings-list",REQUESTS:"requests-list",SCENARIOS:"scenarios-list"},EMPTY:{MAPPINGS:"mappings-empty",REQUESTS:"requests-empty"},UI:{STATS:"stats",SEARCH_FILTERS:"search-filters",UPTIME:"uptime",DATA_SOURCE_INDICATOR:"data-source-indicator",REQUESTS_SOURCE_INDICATOR:"requests-source-indicator"},LOADING:{MAPPINGS:"mappings-loading",REQUESTS:"requests-loading"},COUNTERS:{MAPPINGS:"mappings-count",REQUESTS:"requests-count"},CONNECTION:{SETUP:"connection-setup",HOST:"wiremock-host",PORT:"wiremock-port",CONNECT_BTN:"connect-btn",STATUS_DOT:"status-dot",STATUS_TEXT:"status-text",UPTIME:"uptime"},MODAL:{FORM:"mapping-form",ID:"mapping-id",TITLE:"modal-title"},FORM_FIELDS:{METHOD:"mapping-method",URL:"mapping-url",STATUS:"mapping-status",HEADERS:"mapping-headers",BODY:"mapping-body",PRIORITY:"mapping-priority",NAME:"mapping-name"},BUTTONS:{ADD_MAPPING:"add-mapping-btn",START_RECORDING:"start-recording-btn"},RECORDING:{URL:"recording-url",CAPTURE_HEADERS:"capture-headers",CAPTURE_BODY:"capture-body",URL_FILTER:"url-filter",INDICATOR:"recording-indicator",TARGET:"recording-target",COUNT:"recording-count",STOP_BTN:"stop-recording-btn"},SETTINGS:{HOST:"settings-host",PORT:"settings-port",TIMEOUT:"settings-timeout",AUTO_REFRESH:"auto-refresh",THEME:"theme-select",CUSTOM_HEADERS:"custom-headers",CACHE_ENABLED:"cache-enabled"},IMPORT:{FILE:"import-file",DISPLAY:"file-display",ACTIONS:"import-actions",RESULT:"import-result",MODE:"import-mode"},EXPORT:{FORMAT:"export-format",RESULT:"export-result"},STATS:{TOTAL_MAPPINGS:"total-mappings",TOTAL_REQUESTS:"total-requests"},HEALTH:{INDICATOR:"health-indicator"}},window.Icons={render(e,t={}){if(!e)return"";const n=["icon",`icon-${e}`];return t.className&&n.push(t.className),`<svg class="${n.join(" ")}" aria-hidden="true" focusable="false"><use href="#icon-${e}"></use></svg>`}},window.ENDPOINTS={HEALTH:"/health",MAPPINGS:"/mappings",MAPPINGS_RESET:"/mappings/reset",MAPPINGS_SAVE:"/mappings/save",MAPPINGS_IMPORT:"/mappings/import",MAPPINGS_FIND_BY_METADATA:"/mappings/find-by-metadata",MAPPINGS_REMOVE_BY_METADATA:"/mappings/remove-by-metadata",MAPPINGS_UNMATCHED:"/mappings/unmatched",REQUESTS:"/requests",REQUESTS_COUNT:"/requests/count",REQUESTS_REMOVE:"/requests/remove",REQUESTS_FIND:"/requests/find",REQUESTS_UNMATCHED:"/requests/unmatched",REQUESTS_UNMATCHED_NEAR_MISSES:"/requests/unmatched/near-misses",RECORDINGS_START:"/recordings/start",RECORDINGS_STOP:"/recordings/stop",RECORDINGS_STATUS:"/recordings/status",RECORDINGS_SNAPSHOT:"/recordings/snapshot",SCENARIOS:"/scenarios",SCENARIOS_RESET:"/scenarios/reset"},(function(){const t=new Map,n=new Map,a=new Set,r=new Map,o=(p,w,E)=>t.set(p,{name:w,delay:E,createdAt:Date.now()}),c=(p,w,E)=>n.set(p,{name:w,delay:E,createdAt:Date.now()}),s={setInterval(p,w,E){const v=window.setInterval(p,w);return o(v,E,w),v},setNamedInterval(p,w,E){return this.setInterval(w,E,p)},clearInterval(p){p!=null&&(window.clearInterval(p),t.delete(p))},setTimeout(p,w,E){const v=window.setTimeout(()=>{n.delete(v),p()},w);return c(v,E,w),v},clearTimeout(p){p!=null&&(window.clearTimeout(p),n.delete(p))},requestAnimationFrame(p){const w=window.requestAnimationFrame(p);return a.add(w),w},cancelAnimationFrame(p){p!=null&&(window.cancelAnimationFrame(p),a.delete(p))},addEventListener(p,w,E,v){!p||!w||!E||(p.addEventListener(w,E,v),r.has(p)||r.set(p,new Set),r.get(p).add({type:w,handler:E,options:v}))},removeEventListener(p,w,E,v){if(!p||!w||!E)return;p.removeEventListener(w,E,v);const C=r.get(p);if(C){for(const N of C)if(N.type===w&&N.handler===E&&JSON.stringify(N.options)===JSON.stringify(v)){C.delete(N);break}C.size===0&&r.delete(p)}},clearAll(){t.forEach((p,w)=>window.clearInterval(w)),t.clear(),n.forEach((p,w)=>window.clearTimeout(w)),n.clear(),a.forEach(p=>window.cancelAnimationFrame(p)),a.clear(),r.forEach((p,w)=>{p.forEach(({type:E,handler:v,options:C})=>{w.removeEventListener(E,v,C)})}),r.clear()},getStats(){return{intervals:t.size,timeouts:n.size,rafs:a.size,eventTargets:r.size,details:{intervals:Array.from(t.entries()),timeouts:Array.from(n.entries())}}}};window.LifecycleManager=s,window.addEventListener("beforeunload",()=>s.clearAll())})(),window.debounce=function(t,n=150,a={}){let r,o,c,s;const{leading:p=!1,trailing:w=!0}=a,E=()=>{r=void 0,w&&o&&(s=t.apply(c,o),o=c=void 0)};return Object.assign(function(...C){return o=C,c=this,r===void 0?(p&&(s=t.apply(c,o),o=c=void 0),r=window.setTimeout(E,n)):(window.clearTimeout(r),r=window.setTimeout(E,n)),s},{cancel(){r!==void 0&&window.clearTimeout(r),r=void 0,o=c=void 0},flush(){return r!==void 0&&(window.clearTimeout(r),E()),s}})},(function(){const t=new WeakMap;function n(a){if(typeof a!="string"||!a.trim())return null;const r=document.createElement("template");return r.innerHTML=a.trim(),r.content.firstElementChild}window.renderList=function(r,o,c={}){if(!(r instanceof Element)||!Array.isArray(o))return;const{renderItem:s,getKey:p,getSignature:w,onItemChanged:E,onItemRemoved:v}=c;if(typeof s!="function")return;const C=new Map;Array.from(r.children).forEach(G=>{G instanceof HTMLElement&&G.dataset&&G.dataset.id&&C.set(G.dataset.id,G)});const N=document.createDocumentFragment();o.forEach(G=>{const b=typeof p=="function"?p(G):G&&(G.id||G.uuid);if(!b)return;const y=String(b),k=typeof w=="function"?w(G):y,q=C.get(y);if(q&&q.dataset.renderSignature===k){q.dataset.renderSignature=k,N.appendChild(q),C.delete(y);return}const X=q&&q.dataset.renderSignature||null;if(q&&typeof E=="function"&&X!==k)try{E(y,G,k)}catch(Me){Logger.warn("UI","renderList onItemChanged failed:",Me)}const he=s(G),ce=n(he);if(!ce){C.delete(y);return}ce.dataset.id=y,ce.dataset.renderSignature=k,N.appendChild(ce),C.delete(y)}),C.forEach((G,b)=>{if(G.remove(),typeof v=="function")try{v(String(b),G)}catch(y){Logger.warn("UI","renderList onItemRemoved failed:",y)}});const J=()=>{r.replaceChildren(N)};if(window.LifecycleManager&&typeof window.LifecycleManager.requestAnimationFrame=="function"){const G=t.get(r);G&&window.LifecycleManager.cancelAnimationFrame(G);const b=window.LifecycleManager.requestAnimationFrame(()=>{J(),t.delete(r)});b!==null&&t.set(r,b)}else if(typeof window.requestAnimationFrame=="function"){const G=window.requestAnimationFrame(J);t.set(r,G)}else J()}})();const ensureCustomHeaderObject=e=>!e||typeof e!="object"||Array.isArray(e)?{}:Object.keys(e).reduce((t,n)=>{const a=String(n).trim();return a&&(t[a]=e[n]),t},{}),migrateLegacySettings=e=>{if(!e||typeof e!="object"||Array.isArray(e))return{};const t={...e},n=ensureCustomHeaderObject(t.customHeaders);if(typeof t.authHeader=="string"&&t.authHeader.trim()){const a=t.authHeader.trim();if(Object.prototype.hasOwnProperty.call(n,"Authorization")||(n.Authorization=a),delete t.authHeader,!t.customHeadersRaw||typeof t.customHeadersRaw!="string"||!t.customHeadersRaw.trim())try{t.customHeadersRaw=JSON.stringify(n,null,2)}catch(r){Logger.warn("API","Failed to serialize migrated custom headers:",r),t.customHeadersRaw=""}}return t.customHeaders=n,typeof t.customHeadersRaw!="string"&&(t.customHeadersRaw=""),t.autoConnect=t.autoConnect!==!1,t};window.normalizeWiremockSettings=e=>migrateLegacySettings(e),window.readWiremockSettings=()=>{try{const e=localStorage.getItem("wiremock-settings");if(!e)return{};const t=JSON.parse(e);return migrateLegacySettings(t)}catch(e){return Logger.warn("UI","Failed to read stored settings, returning empty object:",e),{}}},window.buildScenarioStateEndpoint=e=>{const t=typeof e=="string"?e:"";return t.trim()?`${ENDPOINTS.SCENARIOS}/${encodeURIComponent(t)}/state`:""};let wiremockBaseUrl="",requestTimeout=window.DEFAULT_SETTINGS?.requestTimeout?parseInt(window.DEFAULT_SETTINGS.requestTimeout):69e3;window.customHeaders=ensureCustomHeaderObject(window.DEFAULT_SETTINGS?.customHeaders||{}),window.startTime=null,window.uptimeInterval=null;let autoRefreshInterval=null;window.allRequests=[],window.allScenarios=[],window.isRecording=!1,window.recordedCount=0,window.normalizeWiremockBaseUrl=(e,t)=>{let n=(e||"").trim()||"localhost",a=(t||"").trim(),r="http",o="";try{const c=new URL(n.includes("://")?n:`http://${n}`);r=c.protocol.replace(":","")||"http",o=c.hostname,a||(a=c.port)}catch{const s=n.match(/^([^:/]+)(?::(\d+))?$/);o=s?s[1]:n,a||(a=s?.[2])}return`${r}://${o||"localhost"}:${a||(r==="https"?"443":"8080")}/__admin`},window.apiFetch=async(e,t={})=>{const n=new AbortController,a=Utils.safeCall(window.readWiremockSettings)||{},r=a.requestTimeout?parseInt(a.requestTimeout):window.DEFAULT_SETTINGS?.requestTimeout?parseInt(window.DEFAULT_SETTINGS.requestTimeout):69e3,o=setTimeout(()=>n.abort(),r),c=`${window.wiremockBaseUrl}${e}`,s=t.method||"GET",p={"Content-Type":"application/json",...ensureCustomHeaderObject(a.customHeaders||window.customHeaders),...t.headers},E=!(e===window.ENDPOINTS?.HEALTH||e===window.ENDPOINTS?.MAPPINGS);E&&Logger.api(`${s} ${e}`);try{const v=await fetch(c,{...t,signal:n.signal,headers:p});if(clearTimeout(o),!v.ok){const N=await v.text();E&&Logger.error("API",`HTTP ${v.status}: ${N||v.statusText}`,{endpoint:e,method:s});const J=new Error(`HTTP ${v.status}: ${N||v.statusText}`);throw J.status=v.status,J.statusText=v.statusText,J}const C=v.headers.get("content-type")?.includes("application/json")?await v.json():await v.text();E&&Logger.api(`${s} ${e} - OK`);try{(e===window.ENDPOINTS?.HEALTH||e===window.ENDPOINTS?.MAPPINGS)&&(window.lastWiremockSuccess=Date.now(),Utils.safeCall(window.updateLastSuccessUI))}catch{}return C}catch(v){throw clearTimeout(o),E&&Logger.error("API",`${s} ${e} - ${v.name}: ${v.message}`),v.name==="AbortError"?new Error(`Request timeout after ${r}ms`):v}},window.showPage=(e,t)=>{Logger.info("UI",`Switching to tab: ${e}`),document.querySelectorAll('.main-content > div[id$="-page"]').forEach(a=>a.classList.add("hidden"));const n=document.getElementById(SELECTORS.PAGES[e.toUpperCase()]);if(!n){Logger.warn("UI",`Page not found: ${e}`);return}if(n.classList.remove("hidden"),document.querySelectorAll(".sidebar .nav-item").forEach(a=>a.classList.remove("active")),t&&t.classList.add("active"),window.history&&window.history.replaceState){const a=new URL(window.location.href),r=a.searchParams.get("tab");a.searchParams.set("tab",e);const o=a.toString();Logger.api(`showPage: ${r} \u2192 ${e}`),Logger.api(`showPage URL: ${o}`),window.history.replaceState({},"",o)}else Logger.warn("UI","history.replaceState not available")};const SIDEBAR_COLLAPSED_CLASS="sidebar-collapsed",SIDEBAR_STATE_STORAGE_KEY="imock-sidebar-state",applySidebarState=(e,{persist:t=!0}={})=>{if(!document.body)return;document.body.classList.toggle(SIDEBAR_COLLAPSED_CLASS,e);const n=document.querySelector(".sidebar-toggle");if(n){const a=e?"Expand sidebar":"Collapse sidebar";n.setAttribute("aria-expanded",String(!e)),n.setAttribute("aria-label",a),n.setAttribute("title",a),n.querySelector("use")?.setAttribute("href",e?"#icon-sidebar-expand":"#icon-sidebar-collapse")}if(t)try{localStorage.setItem(SIDEBAR_STATE_STORAGE_KEY,e?"collapsed":"expanded")}catch(a){Logger.warn("UI","Unable to persist sidebar state:",a)}};window.toggleSidebar=()=>{const e=document.body?.classList.contains(SIDEBAR_COLLAPSED_CLASS);applySidebarState(!e)},window.initializeSidebarPreference=()=>{let e=null;try{e=localStorage.getItem(SIDEBAR_STATE_STORAGE_KEY)}catch(t){Logger.warn("UI","Unable to read sidebar state from storage:",t)}applySidebarState(e==="collapsed",{persist:!1})};const resolveModalElement=e=>{if(!e)return Logger.warn("UI","Modal ID is required to resolve modal element"),null;const t=document.getElementById(e);return t||Logger.warn("UI",`Modal element not found for id: ${e}`),t};window.showModal=e=>{const t=resolveModalElement(e);if(!t)return;t.classList.remove("hidden"),t.style.display="flex";const n=t.querySelector("input, select, textarea");n&&LifecycleManager.requestAnimationFrame(()=>n.focus())},window.openAddMappingModal=()=>{if(window.TemplateManager?.openGalleryForTarget){window.TemplateManager.openGalleryForTarget("create-inline");return}const e=document.querySelector('[data-template-trigger][data-template-target="create-inline"]');e?e.click():window.showModal("template-gallery-modal")},window.hideModal=e=>{const t=typeof e=="string"?resolveModalElement(e):e;if(t&&(t.classList.add("hidden"),t.style.display="none",t.querySelector("form")?.reset(),t.id==="edit-mapping-modal"&&(typeof UIComponents?.clearCardState=="function"&&UIComponents.clearCardState("mapping","is-editing"),window.editor&&typeof window.editor.setValue=="function")))try{window.editor.setValue("")}catch(n){Logger.warn("UI","Failed to clear editor:",n)}},window.showTab=(e,t)=>{if(document.querySelectorAll(".tab-content").forEach(n=>n.classList.add("hidden")),document.querySelectorAll(".tab-button").forEach(n=>n.classList.remove("active")),document.getElementById(`${e}-tab`).classList.remove("hidden"),t.classList.add("active"),window.history&&window.history.replaceState){const n=new URL(window.location.href);n.searchParams.set("tab",e),window.history.replaceState({},"",n.toString())}};const applyThemeToDom=e=>{if(!document.body)return;document.body.setAttribute("data-theme",e);const t=[document.getElementById("theme-icon"),document.getElementById("editor-theme-icon")].filter(Boolean);if(t.length){const n=e==="dark"?"#icon-sun":"#icon-moon";t.forEach(a=>{a.setAttribute("href",n),a.setAttribute("xlink:href",n)})}},persistThemePreference=e=>{localStorage.setItem("theme",e);try{localStorage.setItem("wiremock-settings",JSON.stringify({...Utils.safeCall(window.readWiremockSettings)||{},theme:e}))}catch{}};window.toggleTheme=()=>{if(!document.body)return;const e=(document.body.getAttribute("data-theme")||"dark")==="dark"?"light":"dark";applyThemeToDom(e),persistThemePreference(e),window.NotificationManager&&NotificationManager.show(`Switched to ${e} theme`,"success")},window.changeTheme=()=>{const e=document.getElementById("theme-select");if(!e)return;const t=e.value,n=t==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":t;applyThemeToDom(n),persistThemePreference(t),window.NotificationManager&&NotificationManager.show(`Theme changed to ${t}`,"success")},window.initializeTheme=()=>{const e=localStorage.getItem("theme")||"dark",t=e==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;applyThemeToDom(t);const n=document.getElementById("theme-select");n&&(n.value=e)},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",initializeTheme):initializeTheme(),LifecycleManager.addEventListener(document,"click",e=>{e.target.classList.contains("modal")&&hideModal(e.target)}),LifecycleManager.addEventListener(document,"keydown",e=>{if(e.key==="Escape"){const t=document.querySelector(".modal:not(.hidden)");t&&hideModal(t)}}),window.elementCache=new Map,window.invalidateElementCache=e=>e?window.elementCache.delete(e):window.elementCache.clear(),Logger.info("UI","Core.js loaded - Constants, API client, basic UI functions"),window.NotificationManager||(window.NotificationManager={TYPES:{INFO:"info",SUCCESS:"success",ERROR:"error",WARNING:"warning"},ICONS:{info:"\u2139\uFE0F",success:"\u2705",warning:"\u26A0\uFE0F",error:"\u26D4"},queue:[],visibleToasts:[],dedupeMap:new Map,toastContainer:null,cooldownTimer:null,lastShownAt:0,maxVisible:3,cooldownMs:650,dedupeWindowMs:4e3,defaultDuration:4e3,motionQuery:null,_boundHandleKeydown:null,init(){this.toastContainer||(this.toastContainer=document.getElementById("toast-container"),this.toastContainer||(this.toastContainer=document.createElement("div"),this.toastContainer.id="toast-container",this.toastContainer.setAttribute("aria-live","polite"),this.toastContainer.setAttribute("aria-atomic","false"),document.body.appendChild(this.toastContainer))),!this.motionQuery&&window.matchMedia&&(this.motionQuery=window.matchMedia("(prefers-reduced-motion: reduce)")),this._boundHandleKeydown||(this._boundHandleKeydown=this.handleKeydown.bind(this),window.LifecycleManager?window.LifecycleManager.addEventListener(document,"keydown",this._boundHandleKeydown):document.addEventListener("keydown",this._boundHandleKeydown))},cleanup(){this._boundHandleKeydown&&(window.LifecycleManager?window.LifecycleManager.removeEventListener(document,"keydown",this._boundHandleKeydown):document.removeEventListener("keydown",this._boundHandleKeydown),this._boundHandleKeydown=null)},normalizePayload(e,t=this.TYPES.INFO,n=void 0){if(e==null)return null;const a={message:String(e).trim(),type:this.TYPES.INFO,duration:this.defaultDuration,action:null};return typeof t=="object"&&t!==null?Object.assign(a,t):(a.type=typeof t=="string"?t:this.TYPES.INFO,typeof n=="number"?a.duration=n:typeof n=="object"&&n!==null&&Object.assign(a,n)),a.message?(Object.values(this.TYPES).includes(a.type)||(a.type=this.TYPES.INFO),a.action&&typeof a.action!="object"&&(a.action=null),a.action&&typeof a.action?.label!="string"&&(a.action=null),a.action&&typeof a.action?.handler!="function"&&(a.action.handler=()=>{}),a.action?a.duration=null:(typeof a.duration!="number"||a.duration<=0)&&(a.duration=this.defaultDuration),a.createdAt=Date.now(),a.count=a.count&&Number.isInteger(a.count)?a.count:1,a.dedupeKey=this.getDedupeKey(a),a):null},show(e,t=this.TYPES.INFO,n=void 0){this.init();const a=this.normalizePayload(e,t,n);if(!a)return;const r=this.dedupeMap.get(a.dedupeKey);if(r&&Date.now()-r.timestamp<=this.dedupeWindowMs){r.count+=1,r.timestamp=Date.now(),r.payload.count=r.count,this.updateToastCount(r),clearTimeout(r.cleanupTimer),r.cleanupTimer=setTimeout(()=>{this.dedupeMap.delete(a.dedupeKey)},this.dedupeWindowMs);return}this.queue.push(a),this.dedupeMap.set(a.dedupeKey,{count:a.count,timestamp:Date.now(),payload:a,toastEl:null,cleanupTimer:setTimeout(()=>{this.dedupeMap.delete(a.dedupeKey)},this.dedupeWindowMs)}),this.processQueue()},success(e,t){this.show(e,{type:this.TYPES.SUCCESS,...typeof t=="object"?t:{duration:t}})},error(e,t){this.show(e,{type:this.TYPES.ERROR,...typeof t=="object"?t:{duration:t}})},warning(e,t){this.show(e,{type:this.TYPES.WARNING,...typeof t=="object"?t:{duration:t}})},info(e,t){this.show(e,{type:this.TYPES.INFO,...typeof t=="object"?t:{duration:t}})},handleKeydown(e){if(e.key!=="Escape"||!this.visibleToasts.length)return;const t=this.visibleToasts[this.visibleToasts.length-1];t&&this.dismissToast(t.toastEl,t.payload,"escape")},processQueue(){if(!this.queue.length||this.visibleToasts.length>=this.maxVisible)return;const t=Date.now()-this.lastShownAt;if(t<this.cooldownMs){this.cooldownTimer||(this.cooldownTimer=setTimeout(()=>{this.cooldownTimer=null,this.processQueue()},this.cooldownMs-t));return}const n=this.getNextToastIndex();if(n===-1)return;const a=this.queue.splice(n,1)[0];this.displayToast(a)},getNextToastIndex(){if(!this.queue.length)return-1;const e={[this.TYPES.ERROR]:3,[this.TYPES.WARNING]:2,[this.TYPES.INFO]:1,[this.TYPES.SUCCESS]:1};let t=0,n=-1/0,a=1/0;for(let r=0;r<this.queue.length;r+=1){const o=this.queue[r],c=e[o.type]||0;(c>n||c===n&&o.createdAt<a)&&(n=c,a=o.createdAt,t=r)}return t},displayToast(e){const t=document.createElement("div");t.className=`toast toast-${e.type}`,t.setAttribute("role",e.type===this.TYPES.ERROR?"alert":"status"),t.setAttribute("aria-live",e.type===this.TYPES.ERROR?"assertive":"polite"),t.setAttribute("aria-atomic","true"),t.dataset.key=e.dedupeKey;const n=document.createElement("span");n.className="toast-icon",n.setAttribute("aria-hidden","true"),n.textContent=this.ICONS[e.type]||this.ICONS.info;const a=document.createElement("div");a.className="toast-content";const r=document.createElement("p");r.className="toast-message",r.textContent=e.message;const o=document.createElement("span");o.className="toast-count",e.count>1&&(o.textContent=`\xD7${e.count}`,o.setAttribute("aria-label",`${e.count} occurrences`));const c=document.createElement("div");c.className="toast-actions";const s=document.createElement("button");if(s.type="button",s.className="toast-close",s.setAttribute("aria-label","Dismiss notification"),s.textContent="\u2715",s.addEventListener("click",()=>this.dismissToast(t,e,"close")),e.action){const C=document.createElement("button");C.type="button",C.className="toast-action",C.textContent=e.action.label,C.addEventListener("click",N=>{N.preventDefault(),N.stopPropagation();try{e.action.handler()}finally{this.dismissToast(t,e,"action")}}),c.appendChild(C)}c.appendChild(s),a.appendChild(r),e.count>1&&a.appendChild(o),t.appendChild(n),t.appendChild(a),t.appendChild(c),this.toastContainer.firstChild?this.toastContainer.insertBefore(t,this.toastContainer.firstChild):this.toastContainer.appendChild(t);const p=this.dedupeMap.get(e.dedupeKey);p&&(p.toastEl=t,p.payload=e);const w={toastEl:t,payload:e,remaining:e.duration,hideTimer:null,startedAt:null};this.visibleToasts.push(w),this.lastShownAt=Date.now(),requestAnimationFrame(()=>{t.classList.add("show")});const E=()=>{w.hideTimer&&(clearTimeout(w.hideTimer),w.hideTimer=null,w.startedAt&&w.remaining&&(w.remaining-=Date.now()-w.startedAt))},v=()=>{w.hideTimer||e.duration===null||((typeof w.remaining!="number"||w.remaining<=0)&&(w.remaining=this.defaultDuration),w.startedAt=Date.now(),w.hideTimer=setTimeout(()=>{this.dismissToast(t,e,"timeout")},w.remaining))};t.addEventListener("mouseenter",E),t.addEventListener("focusin",E),t.addEventListener("mouseleave",v),t.addEventListener("focusout",v),e.duration!==null&&(w.remaining=e.duration,v()),this.motionQuery&&this.motionQuery.matches&&t.classList.add("toast-reduced-motion"),this.processQueue()},dismissToast(e,t,n){if(!e||e.dataset.dismissed==="true")return;e.dataset.dismissed="true",e.classList.remove("show");const a=this.visibleToasts.findIndex(o=>o.toastEl===e);if(a!==-1){const o=this.visibleToasts[a];o.hideTimer&&clearTimeout(o.hideTimer),this.visibleToasts.splice(a,1)}const r=this.dedupeMap.get(t.dedupeKey);r&&r.toastEl===e&&(r.toastEl=null),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),this.processQueue()},this.motionQuery&&this.motionQuery.matches?0:250)},updateToastCount(e){if(e)if(e.toastEl){const t=e.toastEl.querySelector(".toast-count"),n=e.toastEl.querySelector(".toast-content");if(e.count>1){if(t)t.textContent=`\xD7${e.count}`,t.setAttribute("aria-label",`${e.count} occurrences`);else if(n){const r=document.createElement("span");r.className="toast-count",r.textContent=`\xD7${e.count}`,r.setAttribute("aria-label",`${e.count} occurrences`),n.appendChild(r)}}else t&&t.parentNode&&t.parentNode.removeChild(t);const a=this.visibleToasts.find(r=>r.toastEl===e.toastEl);a&&a.payload.duration!==null&&(a.hideTimer&&clearTimeout(a.hideTimer),a.remaining=Math.max(a.payload.duration,this.defaultDuration),a.startedAt=Date.now(),a.hideTimer=setTimeout(()=>{this.dismissToast(a.toastEl,a.payload,"timeout")},a.remaining))}else e.payload&&(e.payload.count=e.count)},getDedupeKey(e){return`${e.type}::${e.message}::${e.action?e.action.label:""}`}}),window.TabManager={configs:{mappings:{name:"Mappings",loadFunction:"loadMappings",clearFunction:"clearMappingFilters"},requests:{name:"Requests",loadFunction:"loadRequests",clearFunction:"clearRequestFilters"},scenarios:{name:"Scenarios",loadFunction:"loadScenarios",clearFunction:null}},getCurrentTab(){const e=document.querySelector(".tab-link.active");if(e){const t=e.getAttribute("onclick");if(t){const n=t.match(/showTab\(['"](\w+)['"]\)/);if(n)return n[1]}}return"mappings"},async refresh(e){const t=this.configs[e];if(!t){Logger.warn("MANAGERS",`Tab config not found: ${e}`);return}try{const n=window[t.loadFunction];typeof n=="function"?(await n(),Logger.info("MANAGERS",`${t.name} refreshed`)):Logger.warn("MANAGERS",`Load function not found: ${t.loadFunction}`)}catch(n){Logger.error("MANAGERS",`Error refreshing ${t.name}:`,n),NotificationManager.error(`Failed to refresh ${t.name}: ${n.message}`)}},clearFilters(e){const t=this.configs[e];if(!(!t||!t.clearFunction))try{const n=window[t.clearFunction];typeof n=="function"&&(n(),Logger.info("MANAGERS",`${t.name} filters cleared`))}catch(n){Logger.error("MANAGERS",`Error clearing ${t.name} filters:`,n)}}},window.FilterManager={saveFilterState(e,t){try{const n=`imock-filters-${e}`;localStorage.setItem(n,JSON.stringify(t))}catch(n){Logger.warn("MANAGERS","Failed to save filter state:",n)}},loadFilterState(e){try{const t=`imock-filters-${e}`,n=localStorage.getItem(t);return n?JSON.parse(n):{}}catch(t){return Logger.warn("MANAGERS","Failed to load filter state:",t),{}}},applyMappingFilters(){typeof this._applyMappingFilters=="function"&&this._applyMappingFilters()},flushMappingFilters(){this._applyMappingFilters&&typeof this._applyMappingFilters.flush=="function"&&this._applyMappingFilters.flush()},applyRequestFilters(){typeof this._applyRequestFilters=="function"&&this._applyRequestFilters()},flushRequestFilters(){this._applyRequestFilters&&typeof this._applyRequestFilters.flush=="function"&&this._applyRequestFilters.flush()},restoreFilters(e){if(e==="mappings"){const t=getFilterFromURL("mappings");if(t){const n=document.getElementById("filter-query");return n&&(n.value=t),{query:t}}else{const n=this.loadFilterState(e);if(n.query){const a=document.getElementById("filter-query");a&&(a.value=n.query)}return n}}else if(e==="requests"){const t=getFilterFromURL("requests");if(t){const c=document.getElementById("req-filter-query");if(c)return c.value=t,{query:t}}const n=this.loadFilterState(e),a=document.getElementById("req-filter-query");a&&n.query&&(a.value=n.query);const r=document.getElementById("req-filter-from"),o=document.getElementById("req-filter-to");return r&&(r.value=n.from||""),o&&(o.value=n.to||""),n}return{}},hasURLFilters(e){const t=this.getFiltersFromURL(e);return Object.values(t).some(n=>n!=="")}},window.FilterPresetsManager={getAllPresets(){try{const e=localStorage.getItem("imock-filter-presets-custom");return e?JSON.parse(e):{}}catch(e){return Logger.warn("MANAGERS","Failed to load custom presets:",e),{}}},applyPreset(e,t="mappings"){const a=this.getAllPresets()[e];if(!a){Logger.warn("MANAGERS",`Preset not found: ${e}`);return}if(t==="mappings"){const r=document.getElementById("filter-method"),o=document.getElementById("filter-url"),c=document.getElementById("filter-status");r&&(r.value=a.filters.method||""),o&&(o.value=a.filters.query||""),c&&(c.value=a.filters.status||""),typeof window.applyFilters=="function"&&window.applyFilters(),a.filters.method&&typeof window.syncFilterTabsFromSelect=="function"&&window.syncFilterTabsFromSelect("mapping",a.filters.method),typeof NotificationManager<"u"&&NotificationManager.info(`Applied preset: ${a.name}`)}},saveCustomPreset(e,t){try{const n=this.getCustomPresets();n[e]=t,localStorage.setItem("imock-filter-presets-custom",JSON.stringify(n)),typeof NotificationManager<"u"&&NotificationManager.success(`Preset "${t.name}" saved`),typeof window.renderFilterPresets=="function"&&window.renderFilterPresets()}catch(n){Logger.error("MANAGERS","Failed to save preset:",n),typeof NotificationManager<"u"&&NotificationManager.error("Failed to save preset")}},getCustomPresets(){try{const e=localStorage.getItem("imock-filter-presets-custom");return e?JSON.parse(e):{}}catch(e){return Logger.warn("MANAGERS","Failed to load custom presets:",e),{}}},deleteCustomPreset(e){try{const t=this.getCustomPresets();delete t[e],localStorage.setItem("imock-filter-presets-custom",JSON.stringify(t)),typeof NotificationManager<"u"&&NotificationManager.success("Preset deleted"),typeof window.renderFilterPresets=="function"&&window.renderFilterPresets()}catch(t){Logger.error("MANAGERS","Failed to delete preset:",t),typeof NotificationManager<"u"&&NotificationManager.error("Failed to delete preset")}},getCurrentFiltersAsPreset(e="mappings"){return e==="mappings"?{method:document.getElementById("filter-method")?.value||"",query:document.getElementById("filter-url")?.value||"",status:document.getElementById("filter-status")?.value||""}:{}}};function updateURLFilterParams(e,t="mappings"){if(!window.history||!window.history.replaceState)return;const n=new URL(window.location.href),a=`${t}_filter`;e?n.searchParams.set(a,e):n.searchParams.delete(a),window.history.replaceState({},"",n.toString())}function getFilterFromURL(e="mappings"){const t=new URLSearchParams(window.location.search),n=`${e}_filter`;return t.get(n)}function getActiveTabFromURL(){return new URLSearchParams(window.location.search).get("tab")}window.updateURLFilterParams=updateURLFilterParams,window.getFilterFromURL=getFilterFromURL,window.getActiveTabFromURL=getActiveTabFromURL,Logger.info("MANAGERS","Managers.js loaded - NotificationManager, TabManager, FilterManager"),(function(){const e=Date.now(),t=(c=0)=>new Date(e-c).toISOString(),n=[{id:"demo-mapping-products-list",name:"List products",priority:1,request:{method:"GET",urlPath:"/api/products",headers:{Accept:"application/json"}},response:{status:200,headers:{"Content-Type":"application/json"},jsonBody:{items:[{id:"sku-1000",name:"Demo Sneakers",price:129.99},{id:"sku-1001",name:"Demo Backpack",price:89.5}]}},metadata:{created:t(1e3*60*60*6),edited:t(1e3*60*60*2),source:"demo-seed",tags:["catalog","demo"]}},{id:"demo-mapping-create-order",name:"Create order",priority:2,persistent:!0,request:{method:"POST",urlPath:"/api/orders",bodyPatterns:[{matchesJsonPath:"$.items[*].sku"}]},response:{status:201,fixedDelayMilliseconds:120,headers:{"Content-Type":"application/json",Location:"/api/orders/90001"},jsonBody:{orderId:"90001",status:"processing",estimatedDelivery:t(-1e3*60*15)}},metadata:{created:t(1e3*60*60*12),edited:t(1e3*60*45),scenarioName:"checkout-flow",source:"demo-seed"}},{id:"demo-mapping-update-profile",name:"Update profile",priority:3,request:{method:"PUT",urlPattern:"/api/users/\\d+",headers:{"X-Demo-Auth":"Bearer ***"}},response:{status:204,headers:{"X-Demo-Trace":"profile-update"}},metadata:{created:t(1e3*60*30),edited:t(1e3*60*15),source:"demo-seed",tags:["profile"]}},{id:"demo-mapping-delete-session",name:"Delete session",priority:4,request:{method:"DELETE",urlPathPattern:"/api/sessions/.*"},response:{status:202,headers:{"Retry-After":"30"},jsonBody:{status:"scheduled"}},metadata:{created:t(1e3*60*60*3),source:"demo-seed"}}],a=[{id:"demo-request-001",wasMatched:!0,request:{method:"GET",url:"/api/products",urlPath:"/api/products",loggedDate:t(1e3*60*8),headers:{Accept:["application/json"],Host:["demo.wiremock.local"]},clientIp:"192.168.10.14"},responseDefinition:{status:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({items:[{id:"sku-1000"},{id:"sku-1001"}]})}},{id:"demo-request-002",wasMatched:!1,request:{method:"POST",url:"/api/orders",loggedDate:t(1e3*60*5),body:JSON.stringify({items:[]}),headers:{"Content-Type":["application/json"],Host:["demo.wiremock.local"]},clientIp:"192.168.10.18"},responseDefinition:{status:404,body:"No matching mapping found",headers:{"Content-Type":"text/plain"}}},{id:"demo-request-003",wasMatched:!0,request:{method:"PATCH",url:"/api/orders/90001",loggedDate:t(1e3*60*3),body:JSON.stringify({status:"cancelled"}),headers:{"Content-Type":["application/json"],"X-Demo-Auth":["Bearer demo-token"]},clientIp:"192.168.10.20"},responseDefinition:{status:409,body:JSON.stringify({message:"Order already fulfilled"}),headers:{"Content-Type":"application/json"}}},{id:"demo-request-004",wasMatched:!0,request:{method:"DELETE",url:"/api/sessions/abc123",loggedDate:t(1e3*60*2),headers:{"X-Demo-Auth":["Bearer demo-token"],Host:["demo.wiremock.local"]},clientIp:"192.168.10.22"},responseDefinition:{status:202,body:"Session deletion scheduled",headers:{"Retry-After":"30"}}}],r={generatedAt:t()},o=c=>JSON.parse(JSON.stringify(c));window.DemoData={isAvailable(){return n.length>0||a.length>0},getMappingsPayload(){return{mappings:o(n),meta:{...r},__source:"demo"}},getRequestsPayload(){return{requests:o(a),meta:{...r},__source:"demo"}},getDataset(){return{mappings:o(n),requests:o(a),meta:{...r},__source:"demo"}}}})(),(function(t){const n=t,a=n.FeaturesState||{},r=1e3;n.mappingIndex instanceof Map||(n.mappingIndex=new Map),n.mappingTabTotals??(n.mappingTabTotals={all:0,get:0,post:0,put:0,patch:0,delete:0}),n.requestTabTotals??(n.requestTabTotals={all:0,matched:0,unmatched:0}),n.pendingDeletedIds instanceof Set||(n.pendingDeletedIds=new Set),n.deletionTimeouts instanceof Map||(n.deletionTimeouts=new Map),n.isDemoMode??(n.isDemoMode=!1),n.demoModeAnnounced??(n.demoModeAnnounced=!1),n.demoModeLastError??(n.demoModeLastError=null);let o=null;function c(b="automatic"){n.isDemoMode=!0,n.demoModeReason=b,!n.demoModeAnnounced&&n.NotificationManager?.info&&(n.NotificationManager.info("WireMock API unreachable. Showing demo data so the interface stays interactive."),n.demoModeAnnounced=!0)}function s(b){if(!b||typeof b!="object")return;n.mappingIndex instanceof Map||(n.mappingIndex=new Map);const y=new Set;["id","uuid","stubMappingId","stubId","mappingId"].forEach(k=>{b[k]&&y.add(String(b[k]).trim())}),b.metadata?.id&&y.add(String(b.metadata.id).trim()),y.forEach(k=>{k&&n.mappingIndex.set(k,b)})}function p(b){n.mappingIndex instanceof Map?n.mappingIndex.clear():n.mappingIndex=new Map,Array.isArray(b)&&b.forEach(s)}function w(b=[]){const y={all:0,get:0,post:0,put:0,patch:0,delete:0};return(!Array.isArray(b)||b.length===0)&&(b=n.MappingsStore?.getAll?n.MappingsStore.getAll():[]),!Array.isArray(b)||b.length===0||(y.all=b.length,b.forEach(k=>{const q=(k?.request?.method||"").toLowerCase();Object.prototype.hasOwnProperty.call(y,q)&&(y[q]+=1)})),y}function E(){const b=n.MappingsStore?.getAll?n.MappingsStore.getAll():[];n.mappingTabTotals=w(b)}function v(b=[]){const y={all:0,matched:0,unmatched:0};return!Array.isArray(b)||b.length===0||(y.all=b.length,b.forEach(k=>{k?.wasMatched!==!1?y.matched+=1:y.unmatched+=1})),y}function C(){const b=n.MappingsStore?.getAllRequests?n.MappingsStore.getAllRequests():[];n.requestTabTotals=v(b),typeof n.updateRequestTabCounts=="function"&&n.updateRequestTabCounts()}function N(b){if(!(n.mappingIndex instanceof Map))return;const y=typeof b=="object"?b:n.mappingIndex.get(b);if(y)for(const[k,q]of n.mappingIndex.entries())(q===y||k===b)&&n.mappingIndex.delete(k)}async function J({force:b=!1}={}){if(o){if(!b)return Logger.debug("STATE","fetchMappingsFromServer: reusing in-flight request"),o;try{Logger.debug("STATE","fetchMappingsFromServer: waiting for in-flight request before force refresh");const k=await o;if(Date.now()-(n._lastMappingsFetchTime||0)<r)return Logger.debug("STATE","fetchMappingsFromServer: reusing just-completed result"),k}catch(k){Logger.warn("STATE","fetchMappingsFromServer: previous request failed, starting a new one",k)}}const y=(async()=>{try{const k=await n.apiFetch(n.ENDPOINTS.MAPPINGS);return n._lastMappingsFetchTime=Date.now(),k}catch(k){throw n.demoModeLastError=k,k}finally{o===y&&(o=null)}})();return o=y,y}function G(b,y,k={}){try{if(!b){Logger.warn("STATE","updateOptimisticCache: no mapping provided");return}const q=b.id||b.uuid;if(y==="delete"){if(!q){Logger.warn("STATE","updateOptimisticCache: delete operation requires mapping ID");return}n.MappingsStore?.items instanceof Map&&(n.MappingsStore.items.delete(q),typeof n.MappingsStore?.addPending=="function"&&n.MappingsStore.addPending({id:q,type:"delete",payload:null,optimisticMapping:null}),typeof n.MappingsStore.rebuildIndexes=="function"&&n.MappingsStore.rebuildIndexes()),n.cacheLastUpdate=Date.now(),typeof n.refreshMappingsFromCache=="function"&&n.refreshMappingsFromCache(),Logger.info("STATE","Deleted mapping from optimistic cache:",q);return}if(!q){Logger.warn("STATE","updateOptimisticCache: mapping must have an id or uuid");return}if(n.MappingsStore?.items instanceof Map){const X=n.MappingsStore.items.get(q),he=X&&y==="update"?{...X,...b}:b;n.MappingsStore.items.set(q,he),k.queueMode==="add"&&typeof n.MappingsStore?.addPending=="function"?n.MappingsStore.addPending({id:q,type:y,payload:b,optimisticMapping:he}):k.queueMode==="confirm"&&typeof n.MappingsStore?.confirmPending=="function"&&n.MappingsStore.confirmPending(q),typeof n.MappingsStore.rebuildIndexes=="function"&&n.MappingsStore.rebuildIndexes()}n.cacheLastUpdate=Date.now(),typeof n.refreshMappingsFromCache=="function"&&n.refreshMappingsFromCache(),Logger.info("STATE",`[updateOptimisticCache] ${y} mapping:`,q)}catch(q){Logger.error("STATE","updateOptimisticCache failed:",q)}}if(a.markDemoModeActive=c,a.addMappingToIndex=s,a.rebuildMappingIndex=p,a.computeMappingTabTotals=w,a.refreshMappingTabSnapshot=E,a.computeRequestTabTotals=v,a.refreshRequestTabSnapshot=C,a.removeMappingFromIndex=N,a.fetchMappingsFromServer=J,a.updateOptimisticCache=G,n.markDemoModeActive=c,n.addMappingToIndex=s,n.rebuildMappingIndex=p,n.computeMappingTabTotals=w,n.refreshMappingTabSnapshot=E,n.computeRequestTabTotals=v,n.refreshRequestTabSnapshot=C,n.removeMappingFromIndex=N,n.fetchMappingsFromServer=J,n.updateOptimisticCache=G,n.FeaturesState=a,Logger.info("STATE","state.js loaded - State management functions registered"),typeof n.dispatchEvent=="function"){let b;typeof n.CustomEvent=="function"?b=new CustomEvent("features:state-ready",{detail:{state:a}}):typeof document<"u"&&document.createEvent&&(b=document.createEvent("Event"),b.initEvent("features:state-ready",!1,!1),b.detail={state:a}),b&&n.dispatchEvent(b)}})(typeof window<"u"?window:globalThis);const Utils={escapeHtml:e=>typeof e!="string"?String(e):e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[t]),normalizeScenarioName:(e,t="_")=>{if(e==null)return{original:e,normalized:e,changed:!1,cleared:!1,hadWhitespace:!1};const n=typeof e=="string"?e:String(e),a=/\s/.test(n),r=n.trim().replace(/\s+/g,t);return{original:n,normalized:r,changed:r!==n,cleared:!!n&&!r,hadWhitespace:a}},formatJson:(e,t="Invalid JSON",n=1e3)=>{try{const a=JSON.stringify(e,null,2);return a.length>n?a.substring(0,n)+`
... (truncated - `+(a.length-n)+" more characters)":a}catch{return t}},parseRequestTime:e=>{if(!e)return new Date().toLocaleString("en-US");try{const t=new Date(typeof e=="number"?e>1e12?e:e*1e3:e);return isNaN(t.getTime())?`Invalid: ${e}`:t.toLocaleString("en-US")}catch{return`Invalid: ${e}`}},getStatusClass:e=>{const t=parseInt(e)||0;return t>=200&&t<300?"success":t>=300&&t<400?"redirect":t>=400&&t<500?"client-error":t>=500?"server-error":"unknown"},formatDateTime:e=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${t}-${n}-${a}T${r}:${o}`},isFunction:e=>typeof e=="function",safeCall:(e,...t)=>{if(typeof e=="function")return e(...t)},toggleElement:(e,t)=>{e&&(t?e.classList.remove("hidden"):e.classList.add("hidden"))},showElement:e=>{e&&e.classList.remove("hidden")},hideElement:e=>{e&&e.classList.add("hidden")}},escapeHtml=Utils.escapeHtml;window.Utils=Utils,window.escapeHtml=escapeHtml,(function(t){const n="imock-custom-templates",a={FORM:"template-selector",EDITOR:"editor-template-selector"},r={GALLERY:"template-gallery-modal",PREVIEW:"template-preview-modal"},o=[{id:"happy-path",icon:"\u2713",title:"Happy path",subtitle:"Client flows succeed",color:"#10b981",description:"Standard successful API responses"},{id:"errors",icon:"\u26A0",title:"Errors",subtitle:"Client handles failures correctly",color:"#f59e0b",description:"HTTP errors and validation cases"},{id:"faults",icon:"\u26A1",title:"Network issues",subtitle:"Timeouts, disconnects, slow responses",color:"#ef4444",description:"Network fault simulation"},{id:"scenarios",icon:"\u21BB",title:"Scenarios",subtitle:"Stateful steps and retries",color:"#8b5cf6",description:"Changing service behaviour"},{id:"dynamic",icon:"\u2387",title:"Dynamic response",subtitle:"Response templating and conditions",color:"#3b82f6",description:"Response depends on request"},{id:"matching",icon:"\u{1F3AF}",title:"Request Matching",subtitle:"URL, headers, body, JSONPath",color:"#06b6d4",description:"Advanced request matching"},{id:"webhooks",icon:"\u{1F4E4}",title:"Webhooks",subtitle:"Asynchronous callbacks",color:"#ec4899",description:"Outgoing HTTP callbacks"},{id:"proxy",icon:"\u21C4",title:"Proxy & Record",subtitle:"Proxying and recording",color:"#14b8a6",description:"Working against real APIs"},{id:"custom",icon:"\u2605",title:"My templates",subtitle:"Saved by you",color:"#0ea5e9",description:"Personal templates you created"}],c="empty-mapping-skeleton",s={step:"goals",goalId:null,selectedTemplateId:null,searchQuery:"",activeTags:[],showPopularOnly:!1};let p="form";const w={templateId:null,target:null};let E="",v=null;const C={handler:null,label:null,mode:"mapping"};function N(){const l=document.getElementById("method"),g=document.getElementById("url-pattern"),S=document.getElementById("editor-method"),T=document.getElementById("editor-url"),R=l?.value||S?.value,O=g?.value||T?.value;return{method:(R||"GET").toUpperCase(),urlPath:O||"/api/example"}}function J(l=N()){const g={method:(l?.method||"GET").toUpperCase(),urlPath:l?.urlPath||"/api/example"};return{name:"Empty mapping",request:{method:g.method,urlPath:g.urlPath},response:{status:200}}}function G(l){return k(J(l))}function b(){const l=N(),g=G(l);return{id:c,title:"Empty mapping",description:"Create a minimal stub and fill in the request/response yourself.",category:"happy-path",highlight:`${g.request.method} \xB7 ${g.request.urlPath}`,feature:{path:["response","status"],label:"response.status"},content:g}}function y(l,g="info"){const S=t.NotificationManager;if(S&&typeof S[g]=="function"){S[g](l);return}console[g==="error"?"error":"log"](`[TEMPLATES] ${l}`)}function k(l){try{if(typeof structuredClone=="function")return structuredClone(l)}catch(g){Logger.warn("TEMPLATES","Failed to structuredClone, falling back to JSON:",g)}try{return JSON.parse(JSON.stringify(l))}catch(g){if(Logger.warn("TEMPLATES","Failed to JSON clone value, returning shallow copy:",g),l&&typeof l=="object")return Array.isArray(l)?[...l]:{...l}}return l}function q(l,g){w.templateId=l||null,w.target=l?g:null,he()}function X(){return!!w.templateId&&(!w.target||w.target==="editor")}function he(){ce(X())}function ce(l){const g=document.getElementById("update-mapping-btn");if(!g)return;const S=g.querySelector?.(".btn-label")||g;if(l){if(C.mode==="template-save")return;C.handler||(C.handler=g.onclick||(typeof t.updateMapping=="function"?T=>t.updateMapping(T):null)),!C.label&&S&&(C.label=S.textContent||"Update Mapping"),g.onclick=T=>(T?.preventDefault?.(),Le({skipNamePrompt:!0,reuseExistingMetadata:!0})),S&&(S.textContent="Save template"),g.setAttribute("data-template-edit-mode","true"),C.mode="template-save";return}C.mode==="template-save"&&(g.onclick=C.handler||g.onclick,S&&C.label&&(S.textContent=C.label),g.removeAttribute("data-template-edit-mode"),C.mode="mapping")}function Me(l){["id","uuid","stubMappingId","stubId","mappingId"].forEach(g=>delete l[g]),l.metadata&&delete l.metadata.id}function Fe(l){if(!l||typeof l!="object"||!Object.prototype.hasOwnProperty.call(l,"scenarioName"))return null;const g=R=>{if(R==null)return{original:R,normalized:R,changed:!1,cleared:!1,hadWhitespace:!1};const O=typeof R=="string"?R:String(R),U=/\s/.test(O),Q=O.trim().replace(/\s+/g,"_");return{original:O,normalized:Q,changed:Q!==O,cleared:!!O&&!Q,hadWhitespace:U}},T=(typeof t?.Utils?.normalizeScenarioName=="function"?t.Utils.normalizeScenarioName:g)(l.scenarioName);return!T?.changed||!T?.hadWhitespace?null:(T.cleared?delete l.scenarioName:l.scenarioName=T.normalized,{original:T.original,normalized:T.normalized,cleared:T.cleared})}function F(l,g={}){if(!l||typeof l!="object")return null;const{source:S="ui",seed:T=N(),scenarioFixes:R}=g,O=new Date().toISOString(),U=k(l);Me(U),ft(U,T);const Q=Fe(U);return Q&&R instanceof Map&&!R.has(Q.original)&&R.set(Q.original,Q),U.metadata={...U.metadata||{},created:U.metadata?.created||O,edited:O,source:U.metadata?.source||S},U}async function B(l,g={}){const{openMode:S="inline",source:T="ui",successMessageFactory:R}=g,O=Array.isArray(l)?l:[l],U=new Map,Q=O.map($=>F($,{source:T,scenarioFixes:U})).filter(Boolean);if(U.size){const $=Array.from(U.values()).slice(0,3).map(ee=>ee.cleared?"cleared":`"${ee.original}" \u2192 "${ee.normalized}"`).join(", ");y(`Scenario name cannot contain spaces. Normalized: ${$}`,"warning")}if(!Q.length)return y("No valid mapping payloads to create","warning"),{success:!1,createdIds:[]};const re=Q.map(($,ee)=>({index:ee,error:wt($)})).filter($=>!!$.error);if(re.length){const $=re[0];return y(`Mapping payload is missing required fields (entry ${$.index+1}): ${$.error}`,"error"),{success:!1,createdIds:[]}}try{const $=[],ee=[];for(let Ne=0;Ne<Q.length;Ne+=1){const mt=Q[Ne];try{const He=await apiFetch("/mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(mt)}),tt=He?.mapping||He,nt=tt?.id;if(nt&&typeof updateOptimisticCache=="function")try{updateOptimisticCache(tt,"create")}catch(At){Logger.warn("TEMPLATES","Failed to update optimistic cache after create:",At)}nt&&$.push(nt)}catch(He){ee.push({index:Ne,error:He});break}}if(ee.length){const Ne=[];for(const tt of $)try{await apiFetch(`/mappings/${tt}`,{method:"DELETE"}),typeof updateOptimisticCache=="function"&&updateOptimisticCache({id:tt},"delete")}catch(nt){Ne.push(nt)}const mt=ee[0],He=Ne.length?` Rollback issues: ${Ne.length} delete${Ne.length===1?"":"s"} failed.`:"";return y(`Failed to create mapping ${mt.index+1}/${Q.length}: ${mt.error.message}.${He}`,"error"),Logger.error("TEMPLATES","Mapping create failed",{errors:ee,rollbackErrors:Ne}),{success:!1,createdIds:[]}}const Ce=$.length||Q.length,qe=typeof R=="function"?R(Ce):`Created ${Ce} mapping${Ce===1?"":"s"}`;y(qe,"success");const et=$[0];return et&&(S==="studio"&&typeof t.editMapping=="function"?t.editMapping(et):typeof t.openEditModal=="function"&&t.openEditModal(et)),{success:!0,createdIds:$}}catch($){return y(`Failed to create mapping: ${$.message}`,"error"),Logger.error("TEMPLATES","Failed to create mapping from payloads",$),{success:!1,createdIds:[]}}}function P(){let l=document.getElementById("template-name-modal");if(l)return l;l=document.createElement("div"),l.id="template-name-modal",l.className="modal hidden",l.innerHTML=`
            <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="template-name-title">
                <div class="modal-header">
                    <div class="modal-header-main">
                        <h3 id="template-name-title" class="modal-title">Save as template</h3>
                        <p class="modal-subtitle">Name your template to reuse it later.</p>
                    </div>
                    <button type="button" class="modal-close" aria-label="Close" data-action="close-template-name">\xD7</button>
                </div>
                <div class="modal-body">
                    <label class="form-label" for="template-name-input">Template name</label>
                    <input id="template-name-input" class="form-control" type="text" name="template-name" placeholder="My template" />
                    <p class="form-hint">Titles help you find templates quickly in the gallery.</p>
                </div>
                <div class="modal-footer">
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" data-action="cancel-template-name">Cancel</button>
                        <button type="button" class="btn btn-primary" data-action="confirm-template-name">Save template</button>
                    </div>
                </div>
            </div>
        `,document.body.appendChild(l),l.addEventListener("click",T=>{T.target===l&&D(null)}),l.querySelectorAll('[data-action="close-template-name"], [data-action="cancel-template-name"]').forEach(T=>T.addEventListener("click",()=>D(null))),l.querySelector('[data-action="confirm-template-name"]').addEventListener("click",()=>{const R=l.querySelector("#template-name-input")?.value?.trim();D(R||null)});const S=l.querySelector("#template-name-input");return S?.addEventListener("keydown",T=>{T.key==="Enter"&&(T.preventDefault(),D(S.value.trim()||null))}),l}function D(l){document.getElementById("template-name-modal")?.classList.add("hidden"),typeof v=="function"&&(v(l),v=null)}function oe(l=""){const g=P(),S=g.querySelector("#template-name-input");return S&&(S.value=l||"",setTimeout(()=>S.focus(),0)),g.classList.remove("hidden"),v&&D(null),new Promise(T=>{v=T})}const j={builtIn:null,user:null,userSignature:"",merged:null,mergedSignature:"",enriched:null,enrichedSignature:""};function de(l="all"){(l==="all"||l==="user")&&(j.user=null),j.merged=null,j.mergedSignature="",j.enriched=null,j.enrichedSignature=""}function De(){if(j.builtIn)return[...j.builtIn];try{const l=t.MonacoTemplateLibrary?.getAll?.();return Array.isArray(l)?(j.builtIn=l.map(g=>({...g,source:"built-in"})),[...j.builtIn]):[]}catch(l){return Logger.warn("TEMPLATES","Unable to read Monaco template library:",l),[]}}function Ee(){const l=localStorage.getItem(n);if(j.user&&j.userSignature===l)return[...j.user];try{const g=l?JSON.parse(l):[];return j.user=Array.isArray(g)?g.map(S=>xe(S)):[],j.userSignature=l||"",[...j.user]}catch(g){return Logger.warn("TEMPLATES","Failed to read user templates from storage:",g),[]}}function xe(l){return{category:"custom",source:"user",...l,category:l?.category||"custom",source:l?.source||"user"}}function _e(l){try{const g=(l||[]).filter(Boolean).map(T=>xe(T)),S=JSON.stringify(g);localStorage.setItem(n,S),j.user=[...g],j.userSignature=S,de("user")}catch(g){Logger.warn("TEMPLATES","Failed to persist user templates:",g)}}function it(){const l=[...De(),...Ee()],g=b();l.some(T=>T.id===g.id)||l.unshift(g);const S=l.map(T=>`${T.id}:${T.source||""}:${T.title||""}`).join("|");return j.merged&&j.mergedSignature===S?j.merged:(j.merged=l,j.mergedSignature=S,j.enriched=null,j.enrichedSignature="",l)}function Ge(){return it()}function bt(l){return Ge().find(g=>g.id===l)||null}function at(l){const g=new Set,S=l.content||{},T=S.request||{},R=S.response||{},O=T.method||"ANY";return g.add(O),S.category&&g.add(S.category),l.category&&g.add(l.category),l.source==="user"&&g.add("custom"),(T.bodyPatterns||T.multipartPatterns)&&g.add("matching"),T.headers&&g.add("headers"),T.queryParameters&&g.add("query"),T.cookies&&g.add("cookies"),(T.urlPathPattern||T.urlPattern||T.urlPathTemplate)&&g.add("pattern"),Array.isArray(T.bodyPatterns)&&T.bodyPatterns.some(Q=>Q.matchesJsonPath||Q.matchesXPath)&&g.add("jsonpath"),(R.proxyBaseUrl||S.proxyBaseUrl)&&g.add("proxy"),(R.serveEventListeners||S.serveEventListeners||R.postServeActions)&&g.add("webhook"),(R.transformers||S.transformers)&&g.add("templating"),(R.fixedDelayMilliseconds||R.delayDistribution||R.chunkedDribbleDelay)&&g.add("delay"),R.fault&&g.add("fault"),S.mappings&&g.add("scenario"),l.popular&&g.add("popular"),Array.from(g)}function ht(l){const g=l.content||{},S=g.response||{};return S.proxyBaseUrl||g.proxyBaseUrl?"proxy":S.fault?"fault":S.status?`${S.status}`:Array.isArray(g.mappings)&&g.mappings.length?"scenario":"200"}function dt(l){const g=l.content||{},S=g.request||{};return S.method?S.method:Array.isArray(g.mappings)&&g.mappings[0]?.request?.method?g.mappings[0].request.method:"ANY"}function rt(l){const g=dt(l),S=ht(l),T=at(l),R=!!l.popular||["basic","integration","proxy"].includes(l.category),O=Array.isArray(l.content?.mappings)&&l.content.mappings.length>0;return{...l,method:g,outcome:S,tags:T,popular:R,isScenario:O}}function ne(){const l=it();return j.enriched&&j.enrichedSignature===j.mergedSignature||(j.enriched=l.map(rt),j.enrichedSignature=j.mergedSignature),j.enriched}function Te(l){const g=document.createElement("option");g.value=l.id;const S=l.title||l.name||l.id;return g.textContent=l.source==="user"?`${S} (yours)`:S,g.dataset.source=l.source||"built-in",g}function Re(){const l=Ge();[a.FORM,a.EDITOR].forEach(g=>{const S=document.getElementById(g);if(!S)return;const T=S.value;S.innerHTML='<option value="">Select a template</option>',l.forEach(R=>S.appendChild(Te(R))),T&&l.some(R=>R.id===T)&&(S.value=T)})}function je(l){if(l==null||l==="")return null;if(typeof l=="object")return{jsonBody:l};try{return{jsonBody:JSON.parse(l)}}catch{return{body:l}}}function Je(l){if(!l){y("Select a template first","warning");return}const g=l.content||{},S=g.request||{},T=g.response||{},R=document.getElementById("mapping-name"),O=document.getElementById("method"),U=document.getElementById("url-pattern"),Q=document.getElementById("response-status"),re=document.getElementById("response-body");R&&(R.value=g.name||l.title||l.id||""),O&&S.method&&(O.value=S.method),U&&(U.value=S.url||S.urlPath||""),Q&&typeof T.status<"u"&&(Q.value=T.status);const $=T.jsonBody??T.body;if(re&&typeof $<"u"){const ee=typeof $=="object"?JSON.stringify($,null,2):String($);re.value=ee}y(`Template "${l.title||l.id}" applied to form`,"success")}async function ot(){if(t.monacoInitializer?.isInitialized)return t.monacoInitializer;if(t.monacoInitializationPromise?.then)try{if(await t.monacoInitializationPromise,t.monacoInitializer?.isInitialized)return t.monacoInitializer}catch(l){Logger.warn("TEMPLATES","Monaco initializer failed to load in time",l)}return t.monacoInitializer}async function Ye(l){if(!l){y("Select a template first","warning");return}const g=l.content??{},S=await ot();if(S&&(typeof S.applyTemplate=="function"||typeof S.applyTemplateById=="function")){let O=!1;typeof S.applyTemplate=="function"?O=S.applyTemplate(l):O=S.applyTemplateById?.(l.id),y(O?`Template "${l.title||l.id}" applied to editor`:"Template could not be applied",O?"success":"error");return}const T=typeof g=="string"?g:JSON.stringify(g,null,2),R=document.getElementById("json-editor");if(R){R.value=T;try{const U=JSON.parse(typeof g=="string"?g:JSON.stringify(g));t.editorState&&(t.editorState.currentMapping=U,t.editorState.isDirty=!0)}catch(U){Logger.warn("TEMPLATES","Failed to parse template content into editorState:",U)}const O=document.getElementById("editor-dirty-indicator");O&&(O.style.display="inline")}y(`Template "${l.title||l.id}" applied to editor`,"success")}async function be(l,g={}){const{openMode:S="inline"}=g;if(!l){y("Select a template first","warning");return}const T=Be(l);if(!T){y("Template content is not available","error");return}const R=Array.isArray(T)?T:[T],O=R.map((U,Q)=>({index:Q,error:wt(U)})).filter(U=>!!U.error);if(O.length){const U=O[0];y(`Template is missing required fields (entry ${U.index+1}): ${U.error}`,"error");return}try{await B(R,{openMode:S,source:"template",successMessageFactory:U=>`Created ${U} mapping${U===1?"":"s"} from template`})}catch(U){y(`Failed to create mapping: ${U.message}`,"error"),Logger.error("TEMPLATES","Failed to create mapping from template",U)}finally{t.hideModal?.(r.GALLERY),t.hideModal?.(r.PREVIEW)}}function Oe(){const l=b();if(Ve()){be(l,{openMode:p==="create-studio"?"studio":"inline"});return}Xe(l,p)}async function Se(){const l=await oe(document.getElementById("mapping-name")?.value||"")||"";if(!l.trim()){y("Template name is required","warning");return}const g=document.getElementById("method")?.value||"GET",S=document.getElementById("url-pattern")?.value||"/api/example",T=parseInt(document.getElementById("response-status")?.value,10)||200,R=document.getElementById("response-body")?.value||"",O=!!w.templateId&&(!w.target||w.target==="form"),U=O?Ee().find(re=>re.id===w.templateId):null,Q={id:O&&U?U.id:`user-${Date.now()}`,title:l.trim(),description:U?.description||"User template saved from mapping form",category:"custom",source:"user",content:{name:l.trim(),request:{method:g,urlPath:S},response:{status:T,...je(R)||{}}}};if(O&&U)We(U.id,Q),q(null),y(`Template "${l.trim()}" updated`,"success");else{const re=Ee();re.push(Q),_e(re),Ie({force:!0}),Re(),y(`Template "${l.trim()}" saved`,"success"),q(null)}}async function Le(l={}){const{skipNamePrompt:g=!1,reuseExistingMetadata:S=!1}=l,T=document.getElementById("json-editor");if(!T){y("Editor not available","warning");return}const R=!!w.templateId&&(!w.target||w.target==="editor"),O=R?Ee().find($=>$.id===w.templateId):null;let U="";if(R&&O&&(g||S)?U=O.title||"":U=await oe(O?.title||"")||"",!U.trim()){y("Template name is required","warning");return}let Q;try{Q=JSON.parse(T.value)}catch{y("Cannot save template: current JSON is invalid","error");return}const re={id:R&&O?O.id:`user-${Date.now()}`,title:U.trim(),description:S&&O?.description||O?.description||"User template saved from JSON editor",category:"custom",source:"user",content:Q};if(R&&O)We(O.id,re),q(null),y(`Template "${U.trim()}" updated`,"success");else{const $=Ee();$.push(re),_e($),Ie({force:!0}),Re(),y(`Template "${U.trim()}" saved`,"success"),q(null)}}function We(l,g={}){if(!l)return null;const S=Ee(),T=S.findIndex(U=>U.id===l);if(T===-1)return null;const R=S[T],O=xe({...R,...g.title?{title:g.title}:{},...g.description?{description:g.description}:{},...g.content?{content:g.content}:{}});return S[T]=O,_e(S),Ie({force:!0}),Re(),O}async function Qe(l,g={}){const S=Ee().find(R=>R.id===l);if(!S)return y("Template not found","warning"),!1;const T=g.target||(document.getElementById("json-editor")?"editor":"form");return q(l,T),T==="editor"?(Xe(S,"editor"),y("Template loaded into JSON Studio. Save to keep changes.","info"),document.getElementById("update-mapping-btn")?.focus?.()):(Xe(S,"form"),y("Template loaded into mapping form. Update and save to keep changes.","info"),document.getElementById("save-template-btn")?.focus?.()),!0}function st(l,g={}){const{skipConfirm:S=!1}=g;if(!l)return!1;const T=Ee(),R=T.find(U=>U.id===l);if(!R||!S&&typeof t.confirm=="function"&&!t.confirm(`Delete template "${R.title||R.id}"? This cannot be undone.`))return!1;const O=T.filter(U=>U.id!==l);return _e(O),Ie({force:!0}),Re(),y(`Template "${R.title||R.id}" deleted`,"info"),w.templateId===l&&q(null),!0}function ut(l,g){return g?(Array.isArray(g)?g:String(g).split(".").map(T=>T.match(/^\d+$/)?Number(T):T)).reduce((T,R)=>T&&typeof T=="object"?T[R]:void 0,l):void 0}function pt(l){if(l===null)return"null";if(typeof l>"u")return"";if(typeof l=="string")return l.length>64?`${l.slice(0,61)}\u2026`:l;if(typeof l=="number"||typeof l=="boolean")return String(l);try{const g=JSON.stringify(l);return g.length>80?`${g.slice(0,77)}\u2026`:g}catch(g){return Logger.warn("TEMPLATES","Failed to serialise feature value",g),""}}function Ue(l){if(!l||!l.feature)return null;const g=l.feature.path||l.feature,S=l.feature.label||(Array.isArray(g)?g.join("."):String(g)),T=ut(l.content,g);return typeof T>"u"?null:{label:S,value:pt(T)}}function It(l){if(!l)return"";if(l.highlight)return l.highlight;const g=[];return l.content?.request?.method&&g.push(l.content.request.method),(l.content?.request?.url||l.content?.request?.urlPath)&&g.push(l.content.request.url||l.content.request.urlPath),g.join(" \xB7 ")}function Tt(l){try{const g=l.content?l.content:{};if(typeof g=="string")return g;const R=JSON.stringify(g,null,2).split(`
`).slice(0,24).join(`
`);return R.length>1280?`${R.slice(0,1279)}\u2026`:R}catch{return"[unavailable template preview]"}}function z(l){const g=typeof l=="string"?l:String(l??"");if(typeof navigator<"u"&&navigator.clipboard?.writeText)return navigator.clipboard.writeText(g).then(()=>!0).catch(()=>S(g));return Promise.resolve(S(g));function S(T){try{const R=document.createElement("textarea");return R.value=T,R.setAttribute("readonly",""),R.style.position="absolute",R.style.left="-9999px",document.body.appendChild(R),R.select(),document.execCommand("copy"),document.body.removeChild(R),!0}catch(R){return Logger.warn("TEMPLATES","Clipboard fallback failed:",R),!1}}}function Ve(l=p){return typeof l=="string"&&l.startsWith("create")}function ft(l,g){l.request||(l.request={}),l.response||(l.response={}),l.request.method||(l.request.method=g.method||"ANY"),l.request.url||l.request.urlPath||l.request.urlPattern||l.request.urlPathPattern||l.request.urlPathTemplate||(l.request.urlPath=g.urlPath||g.url||"/api/example"),typeof l.response.status!="number"&&!("fault"in l.response)&&(l.response.status=200)}function Be(l){if(!l)return null;let g=l.content??{};if(typeof g=="string")try{g=JSON.parse(g)}catch(U){Logger.warn("TEMPLATES","Failed to parse string template content:",U),g={}}const S=new Date().toISOString(),T=U=>{["id","uuid","stubMappingId","stubId","mappingId"].forEach(Q=>delete U[Q])},R=N();if(Array.isArray(g?.mappings))return g.mappings.map((Q,re)=>{const $=JSON.parse(JSON.stringify(Q||{}));return T($),$.name=$.name||`${l.title||l.id||"Scenario mapping"} #${re+1}`,ft($,R),Fe($),$.metadata={...$.metadata||{},created:$.metadata?.created||S,edited:S,source:$.metadata?.source||"template"},$});const O=JSON.parse(JSON.stringify(g||{}));return T(O),O.name||(O.name=l.title||l.id||"New mapping"),ft(O,R),Fe(O),O.metadata={...O.metadata||{},created:O.metadata?.created||S,edited:S,source:O.metadata?.source||"template"},O}function wt(l){if(!l||typeof l!="object")return"Mapping payload is empty";const g=l.request||{},S=l.response||{};if(!g.method)return"request.method is required";if(!!!(g.url||g.urlPath||g.urlPattern||g.urlPathPattern||g.urlPathTemplate))return"request URL or pattern is required";const R=typeof S.status=="number",O=!!S.fault;return!R&&!O?"response.status is required":null}function Ke(){const l=document.getElementById("edit-mapping-modal");return l?(typeof t.showModal=="function"?t.showModal("edit-mapping-modal"):(l.classList.remove?.("hidden"),l.style.display="flex"),!0):!1}function Xe(l,g=p){if(l){if(g==="create-inline"){be(l,{openMode:"inline"});return}if(g==="create-studio"){be(l,{openMode:"studio"});return}g==="editor"?(Ke(),Ye(l)):Je(l),t.hideModal?.(r.GALLERY),t.hideModal?.(r.PREVIEW)}}function we(l){const g=l.map(S=>`${S.id}:${S.source||""}:${S.title||""}:${S.method}:${S.outcome}`).join("|");return[p,s.goalId||"none",s.searchQuery,s.activeTags.join(","),s.showPopularOnly,g].join("|")}function ct(l,g){return g?g==="happy-path"?l.outcome.startsWith("2"):g==="errors"?["4","5"].includes(l.outcome.charAt(0)):g==="faults"?l.tags.includes("fault")||l.tags.includes("delay"):g==="scenarios"?l.isScenario:g==="dynamic"?l.tags.includes("templating"):g==="matching"?l.tags.includes("matching")||l.tags.includes("pattern")||l.tags.includes("jsonpath"):g==="webhooks"?l.tags.includes("webhook"):g==="proxy"?l.tags.includes("proxy"):g==="custom"?l.source==="user":!0:!0}function yt(l){return ne().filter(g=>ct(g,l))}function Mt(l,g){l.innerHTML=`
            <div class="template-wizard__grid template-wizard__goals"></div>
            <div class="template-wizard__actions">
                <button type="button" class="btn btn-ghost" data-action="show-all">Show all templates</button>
                <div class="template-wizard__actions-right">
                    <button type="button" class="btn btn-primary" data-action="create-empty">Create empty</button>
                </div>
            </div>
        `;const S=l.querySelector(".template-wizard__grid");o.forEach(T=>{const R=g.filter(U=>ct(U,T.id)).length,O=document.createElement("button");O.type="button",O.className="template-goal",O.dataset.goalId=T.id,O.innerHTML=`
                <span class="template-goal__icon" aria-hidden="true">${T.icon}</span>
                <span class="template-goal__title">${T.title}</span>
                <span class="template-goal__subtitle">${T.subtitle}</span>
                <span class="template-goal__count">${R} templates</span>
            `,O.style.setProperty("--goal-color",T.color),O.disabled=R===0,O.addEventListener("click",()=>{s.goalId=T.id,s.step="templates",s.activeTags=[],s.searchQuery="",s.showPopularOnly=!1,Ie({force:!0})}),S.appendChild(O)}),l.querySelectorAll('[data-action="show-all"]').forEach(T=>{T.addEventListener("click",()=>{s.goalId=null,s.step="templates",Ie({force:!0})})}),l.querySelectorAll('[data-action="create-empty"]').forEach(T=>{T.addEventListener("click",()=>{Oe()})})}function Ct(l,g){const S=l.outcome==="proxy"?"proxy":l.outcome==="fault"?"fault":l.outcome,T=Ve(p),R=document.createElement("div");return R.className="template-card template-card--wizard",R.dataset.templateId=l.id,R.setAttribute("role","button"),R.tabIndex=0,R.innerHTML=`
            <div class="template-card__header">
                <span class="badge badge-soft" data-method="${l.method}">${l.method}</span>
                <span class="badge badge-soft" data-outcome="${l.outcome}">${S}</span>
                ${l.isScenario?`<span class="badge badge-soft badge-scenario">${l.content?.mappings?.length||0} steps</span>`:""}
                ${l.popular?'<span class="template-card__star" aria-hidden="true">\u2B50</span>':""}
            </div>
            <div class="template-card__title">${l.title||l.name||l.id}</div>
            <div class="template-card__desc">${l.description||"WireMock template"}</div>
            <div class="template-card__meta">${It(l)}</div>
            <div class="template-card__tags">
                ${l.tags.slice(0,4).map(O=>`<span class="chip">${O}</span>`).join("")}
            </div>
            <div class="template-card__actions">
                <button class="btn btn-primary btn-sm" type="button" data-card-action="select">${T?"Create":"Select"}</button>
                <button class="btn btn-secondary btn-sm" type="button" data-card-action="details">Details</button>
                ${l.source==="user"?'<button class="btn btn-ghost btn-sm" type="button" data-card-action="edit-template">Edit</button>':""}
                ${l.source==="user"?'<button class="btn btn-ghost btn-sm" type="button" data-card-action="delete-template">Delete</button>':""}
            </div>
        `,R.addEventListener("click",O=>{const U=O.target instanceof HTMLElement?O.target.closest("[data-card-action]"):null;if(U){O.stopPropagation();const Q=U.dataset.cardAction;if(Q==="edit-template"){Qe(l.id);return}if(Q==="delete-template"){st(l.id);return}}g(l)}),R.addEventListener("keydown",O=>{(O.key==="Enter"||O.key===" ")&&(O.preventDefault(),g(l))}),R}function Nt(l,g){const S=yt(s.goalId),T=Array.from(new Set(S.flatMap($=>$.tags))).sort(),R=!s.goalId;let O=S.filter($=>{if(s.showPopularOnly&&!$.popular||s.activeTags.length&&!s.activeTags.every(Ce=>$.tags.includes(Ce)))return!1;if(!s.searchQuery)return!0;const ee=s.searchQuery.toLowerCase();return($.title||$.id).toLowerCase().includes(ee)||($.description||"").toLowerCase().includes(ee)||$.tags.some(Ce=>Ce.toLowerCase().includes(ee))});l.innerHTML=`
            <div class="template-toolbar template-toolbar--wizard">
                <div class="template-toolbar__search">
                    <svg class="icon icon-16" aria-hidden="true" focusable="false"><use href="#icon-search"></use></svg>
                    <input type="search" placeholder="Search templates..." value="${s.searchQuery}" aria-label="Search templates" />
                </div>
                <div class="template-toolbar__actions">
                    <button type="button" class="btn btn-ghost btn-sm" data-action="show-all" ${R?"disabled":""}>Show all</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-action="toggle-popular" aria-pressed="${s.showPopularOnly}">\u2B50 Popular</button>
                    <button type="button" class="btn btn-primary btn-sm" data-action="create-empty">Create empty</button>
                </div>
            </div>
            <div class="template-tags" aria-label="Tags">
                ${T.map($=>`<button type="button" class="chip chip--toggle ${s.activeTags.includes($)?"is-active":""}" data-tag="${$}">${$}</button>`).join("")}
            </div>
            <div class="template-wizard__grid template-wizard__cards" id="template-wizard-cards"></div>
            <div class="template-info template-info--inline">
                <p class="template-info__lead">Need more examples? Visit the <a href="https://library.wiremock.org/" target="_blank" rel="noopener">official WireMock Template Library</a> and import JSON via Import/Export \u2192 Import Data.</p>
            </div>
        `;const U=l.querySelector("#template-wizard-cards"),Q=document.createElement("div");Q.className="history-empty",Q.innerHTML="<p>No templates found</p><small>Adjust filters or import JSON from the WireMock Template Library.</small>",O.length?O.forEach($=>{U.appendChild(Ct($,ee=>{s.selectedTemplateId=ee.id,s.step="preview",Ie({force:!0})}))}):U.replaceWith(Q);const re=l.querySelector('input[type="search"]');re&&re.addEventListener("input",$=>{s.searchQuery=$.target.value,Ie({force:!0})}),l.querySelectorAll('[data-action="toggle-popular"]').forEach($=>{$.addEventListener("click",()=>{s.showPopularOnly=!s.showPopularOnly,Ie({force:!0})})}),l.querySelectorAll('[data-action="show-all"]').forEach($=>{$.addEventListener("click",()=>{s.goalId=null,s.step="templates",Ie({force:!0})})}),l.querySelectorAll('[data-action="create-empty"]').forEach($=>{$.addEventListener("click",()=>{Oe()})}),l.querySelectorAll("[data-tag]").forEach($=>{$.addEventListener("click",()=>{const ee=$.dataset.tag;s.activeTags.includes(ee)?s.activeTags=s.activeTags.filter(Ce=>Ce!==ee):s.activeTags=[...s.activeTags,ee],Ie({force:!0})})})}function Ze(l,g){const S=g.find(ee=>ee.id===s.selectedTemplateId);if(!S){s.step="templates",Ie({force:!0});return}const T=Ve(p),R=It(S),O=Ue(S),U=Tt(S),Q=S.tags||[];l.innerHTML=`
            <div class="template-preview-card">
                <div class="template-preview-card__meta">
                    <div class="template-preview-card__badges">
                        <span class="badge badge-soft" data-method="${S.method}">${S.method}</span>
                        <span class="badge badge-soft" data-outcome="${S.outcome}">${S.outcome==="proxy"?"proxy":S.outcome}</span>
                        ${S.isScenario?`<span class="badge badge-soft badge-scenario">${S.content?.mappings?.length||0} steps</span>`:""}
                    </div>
                    <h4 class="template-preview-card__title">${S.title||S.name||S.id}</h4>
                    <p class="template-preview-card__desc">${S.description||""}</p>
                    <div class="template-preview-card__summary">${R||"\u2014"}</div>
                    ${O?`<div class="template-preview-meta__row"><span class="template-preview-meta__label">${O.label}</span><code class="template-preview-meta__code">${O.value}</code></div>`:""}
                    <div class="template-preview-card__tags">${Q.map(ee=>`<span class="chip">${ee}</span>`).join("")}</div>
                </div>
                <pre class="template-preview-card__code" id="template-preview-code-inline"></pre>
            </div>
            <div class="template-preview-actions template-preview-actions--wizard" id="template-preview-actions">
                <div class="template-preview-actions__primary">
                    ${T?'<button class="btn btn-primary btn-sm" type="button" data-template-action="apply">Create and open editor</button>':'<button class="btn btn-primary btn-sm" type="button" data-template-action="apply">Use template</button>'}
                    ${T?'<button class="btn btn-secondary btn-sm" type="button" data-template-action="create-studio">Create in JSON Studio</button>':""}
                    <button class="btn btn-secondary btn-sm" type="button" data-template-action="copy">Copy JSON</button>
                </div>
                ${S.source==="user"?`<div class="template-preview-actions__secondary">
                        <button class="btn btn-ghost btn-sm" type="button" data-template-action="edit-template">Edit template</button>
                        <button class="btn btn-ghost btn-sm" type="button" data-template-action="delete-template">Delete</button>
                    </div>`:""}
            </div>
        `;const re=l.querySelector("#template-preview-code-inline");re&&(re.textContent=U);const $=l.querySelector("#template-preview-actions");$&&$.addEventListener("click",async ee=>{const Ce=ee.target instanceof HTMLElement?ee.target.closest("[data-template-action]"):null;if(!Ce)return;const qe=Ce.dataset.templateAction;if(qe==="apply"){Xe(S,p);return}if(qe==="create-studio"){be(S,{openMode:"studio"});return}if(qe==="copy"){const et=typeof S.content=="string"?S.content:JSON.stringify(S.content,null,2),Ne=await z(et);y(Ne?`Template "${S.title}" copied`:"Clipboard copy failed",Ne?"success":"error")}if(qe==="edit-template"){await Qe(S.id);return}qe==="delete-template"&&st(S.id)})}function Rt(){if(s.step==="preview"){s.step="templates";return}s.step="goals",s.goalId=null,s.selectedTemplateId=null}function Ie(l={}){const{force:g=!1}=l,S=document.getElementById("template-gallery-shell");if(S)try{const T=ne(),R=we(T);if(!g&&R===E)return;E=R;const O=s.step==="goals"?1:s.step==="templates"?2:3,U=o.find(ee=>ee.id===s.goalId),Q=s.step!=="goals";S.innerHTML=`
                <div class="template-wizard">
                    <div class="template-wizard__header">
                        <div>
                            <p class="template-wizard__eyebrow">Step ${O}/3</p>
                            <h3 class="template-wizard__title">${s.step==="goals"?"Create a mapping":U?.title||"Pick a template"}</h3>
                            <p class="template-wizard__subtitle">${s.step==="goals"?"Choose the scenario that fits your testing goal":U?.description||""}</p>
                        </div>
                        <div class="template-wizard__header-actions">
                            <div class="template-wizard__progress" role="progressbar" aria-label="Wizard progress" aria-valuemin="1" aria-valuemax="3" aria-valuenow="${O}">
                                <span class="sr-only">Step ${O} of 3</span>
                                ${[1,2,3].map(ee=>`<span class="template-wizard__dot ${ee<=O?"is-active":""}" aria-current="${ee===O?"step":"false"}" aria-label="Step ${ee}"></span>`).join("")}
                            </div>
                            ${Q?'<button type="button" class="btn btn-ghost btn-sm" id="template-wizard-back">\u2190 Back</button>':""}
                        </div>
                    </div>
                    <div class="template-wizard__body" id="template-wizard-body"></div>
                </div>
            `;const re=S.querySelector("#template-wizard-body");if(!re)return;T.length?s.step==="goals"?Mt(re,T):s.step==="templates"?Nt(re,T):Ze(re,T):re.innerHTML='<div class="history-empty"><p>No templates available</p><small>Add or import templates to populate this view.</small></div>';const $=S.querySelector("#template-wizard-back");$&&$.addEventListener("click",()=>{Rt(),Ie({force:!0})})}catch(T){Logger.error("TEMPLATES","Failed to render template wizard",T),S.innerHTML='<div class="history-empty"><p>Templates unavailable</p><small>Reload the page or try again later.</small></div>'}}function St(l="form"){p=l,s.step="goals",s.goalId=null,s.selectedTemplateId=null,s.searchQuery="",s.activeTags=[],s.showPopularOnly=!1;try{Ie({force:!0})}catch(T){Logger.error("TEMPLATES","Unable to prepare template gallery",T);const R=document.getElementById("template-gallery-shell");R&&(R.innerHTML='<div class="history-empty"><p>Templates unavailable</p><small>Reload the page or try again later.</small></div>')}if(typeof t.showModal=="function"){t.showModal(r.GALLERY);return}const S=document.getElementById(r.GALLERY);S&&(S.classList.remove("hidden"),S.style.display="flex")}function vt(){document.querySelectorAll("[data-template-trigger]").forEach(l=>{l.addEventListener("click",g=>{g.preventDefault(),St(l.dataset.templateTarget||"form")})})}function Et(){try{Re(),Ie()}catch(l){Logger.error("TEMPLATES","Template manager failed to initialize",l);const g=document.getElementById("template-gallery-shell");g&&(g.innerHTML='<div class="history-empty"><p>Templates unavailable</p><small>Reload the page or try again later.</small></div>')}vt(),document.getElementById("save-template-btn")?.addEventListener("click",l=>{l.preventDefault(),Se()}),document.getElementById("editor-save-template")?.addEventListener("click",l=>{l.preventDefault(),Le()})}t.TemplateManager={getTemplates:Ge,refresh:Re,openGallery:Ie,openGalleryForTarget:St,getTemplatesWithMeta:ne,getEmptyTemplateSeed:N,getEmptyMappingContent:G,applyTemplateToForm:Je,applyTemplateToEditor:Ye,createMappingFromTemplate:be,createMappingsFromPayloads:B,prepareMappingForCreation:F,createEmptyMapping:Oe,saveFormAsTemplate:Se,saveEditorAsTemplate:Le,updateUserTemplate:We,editUserTemplate:Qe,deleteUserTemplate:st},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Et):Et()})(typeof window<"u"?window:globalThis);const KEYWORDS=["method","url","status","name","scenario","matched","client"],RANGE_KEYWORDS=["priority"];function parseQuery(e){if(!e||typeof e!="string")return null;const t=e.trim();if(!t)return null;try{const n={},a=/(-?)(\w+):([\w\/\*.,\-]+|"[^"]*")/g;let r;const o=[];for(;(r=a.exec(t))!==null;){const c=r[1]==="-",s=r[2];let p=r[3];if(p.startsWith('"')&&p.endsWith('"')&&(p=p.slice(1,-1)),!KEYWORDS.includes(s)&&!RANGE_KEYWORDS.includes(s))continue;if(o.push({start:r.index,end:r.index+r[0].length}),RANGE_KEYWORDS.includes(s)){const E=p.match(/^(\d+)-(\d+)$/);E?n[s]={from:E[1],to:E[2]}:/^\d+$/.test(p)&&(n[s]={from:p,to:p});continue}if(c){const E=p.split(",");n[s]={exclude:E.length>1?E:E[0]};continue}const w=p.split(",");n[s]=w.length>1?w:w[0]}if(o.length>0){let c=[],s=0;o.sort((w,E)=>w.start-E.start);for(const w of o){if(w.start>s){const E=t.slice(s,w.start).trim();E&&c.push(E)}s=w.end}if(s<t.length){const w=t.slice(s).trim();w&&c.push(w)}const p=c.join(" ").trim();p&&(n.text=p)}else n.text=t;return Object.keys(n).length>0?n:null}catch(n){return Logger.error("QUERY","Query parse error:",n),null}}function matchesCondition(e,t){if(!e&&e!==0)return!1;const n=String(e).toLowerCase();if(t&&typeof t=="object"&&t.exclude){const r=Array.isArray(t.exclude)?t.exclude:[t.exclude];for(const o of r)if(n.includes(String(o).toLowerCase()))return!1;return!0}const a=Array.isArray(t)?t:[t];for(const r of a){const o=String(r).toLowerCase();if(n.includes(o))return!0}return!1}function matchesRange(e,t){const n=Number(e);if(isNaN(n))return!1;const a=t.from!==void 0?Number(t.from):-1/0,r=t.to!==void 0?Number(t.to):1/0;return n>=a&&n<=r}function filterMappings(e,t){return Array.isArray(e)?!t||typeof t!="object"?e:e.filter(n=>{if(!n)return!1;if(t.method){const a=n.request?.method||"";if(!matchesCondition(a,t.method))return!1}if(t.url){const a=n.request?.url||n.request?.urlPattern||n.request?.urlPath||"";if(!matchesCondition(a,t.url))return!1}if(t.status){const a=n.response?.status??"";if(!matchesCondition(a,t.status))return!1}if(t.name){const a=n.name||"";if(!matchesCondition(a,t.name))return!1}if(t.scenario){const a=n.scenarioName||"";if(!matchesCondition(a,t.scenario))return!1}if(t.priority){const a=n.priority??1;if(!matchesRange(a,t.priority))return!1}if(t.text){const a=String(t.text).toLowerCase(),r=(n.request?.url||n.request?.urlPattern||n.request?.urlPath||"").toLowerCase(),o=(n.name||"").toLowerCase(),c=(n.request?.method||"").toLowerCase();if(!r.includes(a)&&!o.includes(a)&&!c.includes(a))return!1}return!0}):[]}function filterMappingsByQuery(e,t){const n=parseQuery(t);return filterMappings(e,n)}function filterRequests(e,t){return Array.isArray(e)?!t||typeof t!="object"?e:e.filter(n=>{if(!n)return!1;if(t.method){const a=n.request?.method||"";if(!matchesCondition(a,t.method))return!1}if(t.url){const a=n.request?.url||n.request?.urlPath||"";if(!matchesCondition(a,t.url))return!1}if(t.status){const a=n.response?.status??n.responseDefinition?.status??"";if(!matchesCondition(a,t.status))return!1}if(t.matched!==void 0){const a=n.wasMatched!==!1,r=Array.isArray(t.matched)?t.matched:[t.matched];let o=!1;for(const c of r){const s=String(c).toLowerCase();if((s==="true"||s==="yes"||s==="1")&&a){o=!0;break}if((s==="false"||s==="no"||s==="0")&&!a){o=!0;break}}if(!o)return!1}if(t.client){const a=n.request?.clientIp||"";if(!matchesCondition(a,t.client))return!1}if(t.text){const a=String(t.text).toLowerCase(),r=(n.request?.url||n.request?.urlPath||"").toLowerCase(),o=(n.request?.method||"").toLowerCase(),c=(n.request?.clientIp||"").toLowerCase();if(!r.includes(a)&&!o.includes(a)&&!c.includes(a))return!1}return!0}):[]}function filterRequestsByQuery(e,t){const n=parseQuery(t);return filterRequests(e,n)}window.QueryParser={parseQuery,filterMappings,filterMappingsByQuery,filterRequests,filterRequestsByQuery,matchesCondition,matchesRange};function executeMappingFilters(){const t=document.getElementById("filter-query")?.value?.trim()||"";window.FilterManager.saveFilterState("mappings",{query:t}),updateURLFilterParams(t,"mappings");const n=window.originalMappings;if(!Array.isArray(n)||n.length===0){const p=document.getElementById(SELECTORS.EMPTY.MAPPINGS),w=document.getElementById(SELECTORS.LISTS.MAPPINGS);p&&(p.classList.remove("hidden"),p.removeAttribute("aria-hidden")),w&&(w.style.display="none"),typeof updateMappingsCounter=="function"&&updateMappingsCounter();return}let a;t?window.QueryParser&&typeof window.QueryParser.filterMappingsByQuery=="function"?a=window.QueryParser.filterMappingsByQuery(n,t):(Logger.warn("MANAGERS","[Mapping Filter] QueryParser or filterMappingsByQuery is not available. Showing all mappings."),a=n):a=n,window._filteredMappings=a;const r=document.getElementById(SELECTORS.LISTS.MAPPINGS),o=document.getElementById(SELECTORS.EMPTY.MAPPINGS),c=document.getElementById(SELECTORS.LOADING.MAPPINGS);if(!r)return;const s=[...a].sort((p,w)=>{const E=p?.priority??1,v=w?.priority??1;if(E!==v)return E-v;const C={GET:1,POST:2,PUT:3,PATCH:4,DELETE:5},N=C[p?.request?.method]||999,J=C[w?.request?.method]||999;if(N!==J)return N-J;const G=p?.request?.url||p?.request?.urlPattern||p?.request?.urlPath||"",b=w?.request?.url||w?.request?.urlPattern||w?.request?.urlPath||"";return G.localeCompare(b)});if(window.PaginationManager){window.PaginationManager.updateState(s.length);const p=window.PaginationManager.getCurrentPageItems(s);renderList(r,p,{renderItem:renderMappingMarkup,getKey:getMappingRenderKey,getSignature:getMappingRenderSignature});const w=document.getElementById("mappings-pagination");w&&(w.innerHTML=window.PaginationManager.renderControls())}else renderList(r,s,{renderItem:renderMappingMarkup,getKey:getMappingRenderKey,getSignature:getMappingRenderSignature});c&&c.classList.add("hidden"),s.length===0?(o&&(o.classList.remove("hidden"),o.removeAttribute("aria-hidden")),r.style.display="none"):(o&&(o.classList.add("hidden"),o.setAttribute("aria-hidden","true")),r.style.display="block"),typeof updateMappingsCounter=="function"&&updateMappingsCounter()}function executeRequestFilters(){const t=document.getElementById("req-filter-query")?.value?.trim()||"",n=document.getElementById("req-filter-from"),a=document.getElementById("req-filter-to"),r=n?.value||"",o=a?.value||"";if(window.FilterManager.saveFilterState("requests",{query:t,from:r,to:o}),updateURLFilterParams(t,"requests"),!Array.isArray(window.originalRequests)||window.originalRequests.length===0){window.allRequests=[];const C=document.getElementById(SELECTORS.EMPTY.REQUESTS),N=document.getElementById(SELECTORS.LISTS.REQUESTS);C&&C.classList.remove("hidden"),N&&(N.style.display="none"),typeof updateRequestsCounter=="function"&&updateRequestsCounter();return}let c=t&&window.QueryParser?window.QueryParser.filterRequestsByQuery(window.originalRequests,t):window.originalRequests;const s=r?new Date(r).getTime():null,p=o?new Date(o).getTime():null;(s!==null||p!==null)&&(c=c.filter(C=>{if(!C)return!1;const N=new Date(C.request?.loggedDate||C.loggedDate).getTime();return!(s!==null&&Number.isFinite(s)&&(!Number.isFinite(N)||N<s)||p!==null&&Number.isFinite(p)&&(!Number.isFinite(N)||N>p))})),window.allRequests=c;const w=document.getElementById(SELECTORS.LISTS.REQUESTS),E=document.getElementById(SELECTORS.EMPTY.REQUESTS),v=document.getElementById(SELECTORS.LOADING.REQUESTS);w&&(renderList(w,window.allRequests,{renderItem:renderRequestMarkup,getKey:getRequestRenderKey,getSignature:getRequestRenderSignature}),v&&v.classList.add("hidden"),window.allRequests.length===0?(E&&E.classList.remove("hidden"),w.style.display="none"):(E&&E.classList.add("hidden"),w.style.display="block"),typeof updateRequestsCounter=="function"&&updateRequestsCounter(),Logger.debug("MANAGERS",`Filtered requests: ${window.allRequests.length} items`))}function getRenderKey(e,...t){if(!e||typeof e!="object")return"";for(const n of t){const a=n.includes(".")?n.split(".").reduce((r,o)=>r?.[o],e):e[n];if(a!=null)return String(a)}return""}function getMappingRenderKey(e){return getRenderKey(e,"id","uuid","stubId")}function getMappingRenderSignature(e){if(!e||typeof e!="object")return"";const t=e.request||{},n=e.response||{},a=e.metadata||{},r=o=>{if(o==null)return"";try{const c=typeof o=="string"?o:JSON.stringify(o);return c.length>300?`${c.slice(0,300)}\u2026`:c}catch{return""}};return[t.method||"",t.url||t.urlPattern||t.urlPath||t.urlPathPattern||"",n.status||"",n.fixedDelayMilliseconds||"",e.name||a.name||"",e.priority??"",e.scenarioName||"",a.edited||a.created||"",a.source||"",r(t.headers),r(t.bodyPatterns||t.body||""),r(t.queryParameters),r(n.headers),r(n.jsonBody!==void 0?n.jsonBody:n.body||""),r(a.additionalMetadata||a.tags||a.description||"")].join("|")}function renderMappingMarkup(e){return typeof window.renderMappingCard=="function"?window.renderMappingCard(e):""}function getRequestRenderKey(e){return getRenderKey(e,"id","requestId","mappingUuid","request.id","request.loggedDate","loggedDate")}function getRequestRenderSignature(e){if(!e||typeof e!="object")return"";const t=e.request||{},n=e.responseDefinition||{};return[t.method||"",t.url||t.urlPath||"",t.loggedDate||e.loggedDate||"",e.wasMatched===!1?"unmatched":"matched",n.status??"",(n.body||n.jsonBody||"").length,(t.body||"").length].join("|")}function renderRequestMarkup(e){return typeof window.renderRequestCard=="function"?window.renderRequestCard(e):""}window.FilterManager._applyMappingFilters=window.debounce(executeMappingFilters,180),window.FilterManager._applyRequestFilters=window.debounce(executeRequestFilters,180),window.applyFilters=()=>{FilterManager.applyMappingFilters(),typeof window._updateActiveFiltersDisplayDebounced=="function"?window._updateActiveFiltersDisplayDebounced():typeof window.updateActiveFiltersDisplay=="function"&&window.updateActiveFiltersDisplay()},window.clearMappingFilters=()=>{const e=document.getElementById("filter-query");e&&(e.value=""),FilterManager.applyMappingFilters(),typeof FilterManager.flushMappingFilters=="function"&&FilterManager.flushMappingFilters(),typeof window.updateActiveFiltersDisplay=="function"&&window.updateActiveFiltersDisplay(),typeof window.updateURLFilterParams=="function"&&window.updateURLFilterParams("","mappings")},window.toggleQueryHelp=(e="mappings")=>{const t=e==="requests"?"req-query-help":"query-help",n=document.getElementById(t);if(!n)return;const a=n.classList.contains("hidden"),r=document.querySelector(`[aria-controls="${t}"]`);a?(n.classList.remove("hidden"),r&&(r.textContent="\xD7",r.setAttribute("aria-expanded","true"))):(n.classList.add("hidden"),r&&(r.textContent="?",r.setAttribute("aria-expanded","false")))},window.applyQuickMethodFilter=e=>{const t=document.getElementById("filter-query");if(!t)return;const n=t.value.trim(),a=/method:[^\s]+/;a.test(n)?t.value=n.replace(a,`method:${e}`):t.value=n?`method:${e} ${n}`:`method:${e}`,applyFilters(),updateActiveFiltersDisplay()},window.updateActiveFiltersDisplay=()=>{const e=document.getElementById("filter-query"),t=document.getElementById("active-filters"),n=document.getElementById("active-filters-list");if(!e||!t||!n)return;const a=e.value.trim();if(!a){t.classList.add("filter-hidden");return}const r=window.QueryParser?window.QueryParser.parseQuery(a):null;if(!r||Object.keys(r).length===0){t.classList.add("filter-hidden");return}const o=[];for(const[c,s]of Object.entries(r)){if(c==="text")continue;let p="";if(typeof s=="object"&&s.exclude){const w=Array.isArray(s.exclude)?s.exclude.join(","):s.exclude;p=`-${c}:${w}`}else typeof s=="object"&&s.from&&s.to?p=`${c}:${s.from}-${s.to}`:Array.isArray(s)?p=`${c}:${s.join(",")}`:p=`${c}:${s}`;o.push(`
            <button type="button"
                    class="filter-chip filter-chip-active"
                    data-action="remove-active-filter"
                    data-filter-key="${Utils.escapeHtml(c)}"
                    title="Click to remove">
                ${Utils.escapeHtml(p)}
                <span class="filter-chip-remove" aria-hidden="true">\xD7</span>
            </button>
        `)}n.innerHTML=o.join(""),o.length>0?t.classList.remove("filter-hidden"):t.classList.add("filter-hidden")},window._updateActiveFiltersDisplayDebounced=window.debounce?window.debounce(window.updateActiveFiltersDisplay,200):window.updateActiveFiltersDisplay,window.removeActiveFilter=e=>{const t=document.getElementById("filter-query");if(!t)return;const n=t.value.trim(),a=[new RegExp(`-?${e}:[^\\s]+`,"g"),new RegExp(`\\s+${e}:[^\\s]+`,"g"),new RegExp(`${e}:[^\\s]+\\s+`,"g")];let r=n;for(const o of a)r=r.replace(o," ");r=r.replace(/\s+/g," ").trim(),t.value=r,applyFilters(),updateActiveFiltersDisplay()},window.applyRequestFilters=()=>FilterManager.applyRequestFilters();function applyDateRange(e,t,n,a){e&&(e.value=Utils.formatDateTime(n)),t&&(t.value=Utils.formatDateTime(a)),FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters()}window.applyQuickFilter=()=>{const e=document.getElementById(SELECTORS.REQUEST_FILTERS.QUICK);if(!e)return;const t=e.value,n=document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_FROM),a=document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_TO);if(!t){n&&(n.value=""),a&&(a.value=""),FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters();return}const r=new Date,o=new Date(r),c=t.match(/^(\d+)([mhd])$/);if(!c)return;const s=parseInt(c[1]);switch(c[2]){case"m":o.setMinutes(o.getMinutes()-s);break;case"h":o.setHours(o.getHours()-s);break;case"d":o.setDate(o.getDate()-s);break;default:return}applyDateRange(n,a,o,r)},window.clearQuickTimeFilter=()=>{const e=document.getElementById("req-filter-quick");e&&(e.value="")},window.applyQuickTimeFilter=()=>{const e=document.getElementById("req-filter-quick"),t=document.getElementById("req-filter-from"),n=document.getElementById("req-filter-to");if(!e||!t||!n)return;const a=e.value;if(!a){t.value="",n.value="",FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters();return}const r=new Date;let o=new Date(r);const c=a.match(/^(\d+)([mhd])$/);if(c){const s=parseInt(c[1],10);switch(c[2]){case"m":o.setMinutes(o.getMinutes()-s);break;case"h":o.setHours(o.getHours()-s);break;case"d":o.setDate(o.getDate()-s);break}}applyDateRange(t,n,o,r)},window.clearRequestFilters=()=>{const e=document.getElementById("req-filter-query");e&&(e.value="");const t=document.getElementById("req-filter-from"),n=document.getElementById("req-filter-to"),a=document.getElementById("req-filter-quick");t&&(t.value=""),n&&(n.value=""),a&&(a.value=""),FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters(),typeof window.updateRequestActiveFiltersDisplay=="function"&&window.updateRequestActiveFiltersDisplay(),typeof window.updateURLFilterParams=="function"&&window.updateURLFilterParams("","requests")},window.applyQuickRequestFilter=e=>{const t=document.getElementById("req-filter-query");if(!t)return;const n=t.value.trim();if(/^[A-Z]+$/.test(e)){const a=/method:[\w,]+/i;a.test(n)?t.value=n.replace(a,`method:${e}`):t.value=n?`method:${e} ${n}`:`method:${e}`}else{const a=e.match(/^(\w+):/);if(a){const r=a[1],o=new RegExp(`${r}:[^\\s]+`,"i");o.test(n)?t.value=n.replace(o,e):t.value=n?`${e} ${n}`:e}else t.value=n?`${e} ${n}`:e}FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters(),typeof window._updateRequestActiveFiltersDisplayDebounced=="function"?window._updateRequestActiveFiltersDisplayDebounced():typeof window.updateRequestActiveFiltersDisplay=="function"&&window.updateRequestActiveFiltersDisplay()},window.updateRequestActiveFiltersDisplay=()=>{const e=document.getElementById("req-active-filters"),t=document.getElementById("req-filter-query");if(!e||!t)return;const n=t.value.trim();if(!n||!window.QueryParser){e.innerHTML="",e.classList.add("filter-hidden");return}const a=window.QueryParser.parseQuery(n);if(!a){e.innerHTML="",e.classList.add("filter-hidden");return}const r=[];for(const[o,c]of Object.entries(a)){if(o==="text")continue;let s="";if(o==="matched"){const p=Array.isArray(c)?c:[c],w=String(p[0]).toLowerCase();w==="true"||w==="yes"||w==="1"?s="Matched":s="Unmatched"}else if(Array.isArray(c))s=`${o}: ${c.join(", ")}`;else if(typeof c=="object"&&c.exclude){const p=Array.isArray(c.exclude)?c.exclude:[c.exclude];s=`NOT ${o}: ${p.join(", ")}`}else s=`${o}: ${c}`;r.push(`<button type="button" class="filter-chip filter-chip-active" data-action="remove-request-active-filter" data-filter-key="${Utils.escapeHtml(o)}" title="Remove filter">${Utils.escapeHtml(s)} \xD7</button>`)}e.innerHTML=r.join(""),r.length>0?e.classList.remove("filter-hidden"):e.classList.add("filter-hidden")},window._updateRequestActiveFiltersDisplayDebounced=window.debounce?window.debounce(window.updateRequestActiveFiltersDisplay,200):window.updateRequestActiveFiltersDisplay,window.removeRequestActiveFilter=e=>{const t=document.getElementById("req-filter-query");if(!t)return;const n=t.value.trim();if(!n)return;const a=new RegExp(`-?${e}:[\\w\\/\\*.,\\-]+(\\s+|$)`,"gi"),r=n.replace(a,"").replace(/\s+/g," ").trim();t.value=r,FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters(),typeof window.updateRequestActiveFiltersDisplay=="function"&&window.updateRequestActiveFiltersDisplay()};function getSavedFilters(e){const t=`saved-filters-${e}`;try{const n=localStorage.getItem(t);return n?JSON.parse(n):[]}catch(n){return Logger.warn("FILTERS",`Failed to load saved filters for ${e}:`,n),[]}}function setSavedFilters(e,t){const n=`saved-filters-${e}`;try{localStorage.setItem(n,JSON.stringify(t))}catch(a){Logger.error("FILTERS",`Failed to save filters for ${e}:`,a)}}window.saveCurrentMappingFilter=()=>{const e=document.getElementById("filter-query");if(!e)return;const t=e.value.trim();if(!t){typeof NotificationManager<"u"&&NotificationManager.warning("No filter to save");return}const n=prompt("Enter a name for this filter:",t.substring(0,30));if(!n)return;const a=getSavedFilters("mappings"),r=a.findIndex(o=>o.name===n);if(r>=0){if(!confirm(`Filter "${n}" already exists. Overwrite?`))return;a[r]={name:n,query:t}}else a.push({name:n,query:t});setSavedFilters("mappings",a),updateSavedFiltersDisplay("mappings"),typeof NotificationManager<"u"&&NotificationManager.success(`Filter "${n}" saved`)},window.saveCurrentRequestFilter=()=>{const e=document.getElementById("req-filter-query");if(!e)return;const t=e.value.trim();if(!t){typeof NotificationManager<"u"&&NotificationManager.warning("No filter to save");return}const n=prompt("Enter a name for this filter:",t.substring(0,30));if(!n)return;const a=getSavedFilters("requests"),r=a.findIndex(o=>o.name===n);if(r>=0){if(!confirm(`Filter "${n}" already exists. Overwrite?`))return;a[r]={name:n,query:t}}else a.push({name:n,query:t});setSavedFilters("requests",a),updateSavedFiltersDisplay("requests"),typeof NotificationManager<"u"&&NotificationManager.success(`Filter "${n}" saved`)},window.applySavedFilter=(e,t)=>{const a=getSavedFilters(e).find(r=>r.name===t);if(!a){Logger.warn("FILTERS",`Saved filter "${t}" not found`);return}if(e==="mappings"){const r=document.getElementById("filter-query");r&&(r.value=a.query,applyFilters(),updateActiveFiltersDisplay())}else if(e==="requests"){const r=document.getElementById("req-filter-query");r&&(r.value=a.query,FilterManager.applyRequestFilters(),updateRequestActiveFiltersDisplay())}},window.deleteSavedFilter=(e,t)=>{const a=getSavedFilters(e).filter(r=>r.name!==t);setSavedFilters(e,a),updateSavedFiltersDisplay(e),typeof NotificationManager<"u"&&NotificationManager.info(`Filter "${t}" deleted`)};function updateSavedFiltersDisplay(e){const t=getSavedFilters(e);let n,a;if(e==="mappings")n="saved-filters-list",a="saved-filters-separator";else if(e==="requests")n="req-saved-filters-list",a="req-saved-filters-separator";else return;const r=document.getElementById(n),o=document.getElementById(a);if(!r)return;if(t.length===0){r.classList.add("filter-hidden"),o&&o.classList.add("filter-hidden");return}const c=t.map(s=>`
        <button type="button"
                class="filter-chip filter-chip-saved"
                data-action="apply-saved-filter"
                data-filter-tab="${Utils.escapeHtml(e)}"
                data-filter-name="${Utils.escapeHtml(s.name)}"
                title="${Utils.escapeHtml(s.query)}">
            <span class="filter-chip-text">${Utils.escapeHtml(s.name)}</span>
            <span class="filter-chip-remove"
                  data-action="delete-saved-filter"
                  data-filter-tab="${Utils.escapeHtml(e)}"
                  data-filter-name="${Utils.escapeHtml(s.name)}"
                  title="Delete filter"
                  aria-label="Delete filter">\xD7</span>
        </button>
    `);r.innerHTML=c.join(""),r.classList.remove("filter-hidden"),o&&o.classList.remove("filter-hidden")}if(window.loadAllSavedFilters=()=>{updateSavedFiltersDisplay("mappings"),updateSavedFiltersDisplay("requests")},!window._filterChipDelegationInitialized){let e=function(n){const a=n.target.closest('[data-action="delete-saved-filter"]');if(a){n.stopPropagation();const s=a.dataset.filterTab,p=a.dataset.filterName;s&&p&&window.deleteSavedFilter(s,p);return}const r=n.target.closest('[data-action="apply-saved-filter"]');if(r){const s=r.dataset.filterTab,p=r.dataset.filterName;s&&p&&window.applySavedFilter(s,p);return}const o=n.target.closest('[data-action="remove-active-filter"]');if(o){const s=o.dataset.filterKey;s&&window.removeActiveFilter(s);return}const c=n.target.closest('[data-action="remove-request-active-filter"]');if(c){const s=c.dataset.filterKey;s&&window.removeRequestActiveFilter(s);return}};window._filterChipDelegationInitialized=!0,["active-filters-list","req-active-filters","saved-filters-list","req-saved-filters-list"].forEach(n=>{const a=document.getElementById(n);a&&a.addEventListener("click",e)})}window.renderFilterPresets=()=>{const e=document.getElementById("filter-presets-list");if(!e)return;const t=window.FilterPresetsManager.getAllPresets();e.innerHTML="";const n=Object.entries(t);if(n.length===0){e.innerHTML='<span class="filter-presets-hint">No saved presets. Set filters and click \u{1F4BE} to save.</span>';return}n.forEach(([a,r])=>{const o=document.createElement("button");o.type="button",o.className="filter-preset-btn",o.onclick=()=>window.FilterPresetsManager.applyPreset(a,"mappings"),o.title=`Apply ${r.name}`,o.innerHTML=`
            <span class="preset-icon">${r.icon||"\u2B50"}</span>
            <span class="preset-name">${r.name}</span>
            <span class="preset-delete" onclick="event.stopPropagation(); deletePreset('${a}');" title="Delete preset">\xD7</span>
        `,e.appendChild(o)})},window.showSavePresetDialog=()=>{const e=prompt("Enter preset name:");if(!e||!e.trim())return;const t=prompt("Enter emoji icon (optional):")||"\u2B50",n=window.FilterPresetsManager.getCurrentFiltersAsPreset("mappings");if(!n.method&&!n.query&&!n.status){typeof NotificationManager<"u"&&NotificationManager.warning("No active filters to save");return}const a=`custom-${Date.now()}`;window.FilterPresetsManager.saveCustomPreset(a,{name:e.trim(),icon:t.trim(),filters:n})},window.deletePreset=e=>{confirm("Delete this preset?")&&window.FilterPresetsManager.deleteCustomPreset(e)},window.renderFilterPills=()=>{const e=document.getElementById("filter-pills-container"),t=document.getElementById("filter-pills");if(!e||!t)return;const n=document.getElementById("filter-method")?.value||"",a=document.getElementById("filter-url")?.value||"",r=document.getElementById("filter-status")?.value||"",o=!!(n||a||r);if(t.style.display=o?"flex":"none",!o){e.innerHTML="";return}const c=[];n&&c.push({label:"Method",value:n,onRemove:()=>{document.getElementById("filter-method").value="",window.applyFilters()}}),a&&c.push({label:"Search",value:a,onRemove:()=>{document.getElementById("filter-url").value="",window.applyFilters()}}),r&&c.push({label:"Status",value:r,onRemove:()=>{document.getElementById("filter-status").value="",window.applyFilters()}}),e.innerHTML=c.map((s,p)=>`
        <div class="filter-pill">
            <span class="filter-pill-label">${s.label}:</span>
            <span class="filter-pill-value">${s.value}</span>
            <button type="button" class="filter-pill-remove" onclick="window.removeFilterPill(${p})" title="Remove filter">
                \xD7
            </button>
        </div>
    `).join(""),window._filterPillCallbacks=c.map(s=>s.onRemove)},window.removeFilterPill=e=>{window._filterPillCallbacks&&window._filterPillCallbacks[e]&&window._filterPillCallbacks[e]()};const originalApplyFilters=window.applyFilters;window.applyFilters=()=>{typeof originalApplyFilters=="function"&&originalApplyFilters(),typeof window.renderFilterPills=="function"&&window.renderFilterPills()},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{typeof window.renderFilterPresets=="function"&&window.renderFilterPresets(),typeof window.renderFilterPills=="function"&&window.renderFilterPills()}):(typeof window.renderFilterPresets=="function"&&window.renderFilterPresets(),typeof window.renderFilterPills=="function"&&window.renderFilterPills()),Logger.info("FILTERS","Filter Presets and Pills UI loaded"),window.MappingsStore={items:new Map,metadata:{serverVersion:null,lastFullSync:null,lastIncrementalSync:null,isSyncing:!1,syncError:null},pending:new Map,indexes:{byMethod:new Map,byUrl:new Map,byPriority:new Map,byScenario:new Map},stats:{totalMappings:0,pendingOperations:0,lastSyncDuration:0},requests:new Map,getAllRequests(){return Array.from(this.requests.values())},setRequests(e){this.requests.clear(),Array.isArray(e)&&e.forEach(t=>{const n=t.id||t.uuid||t.request&&t.request.url||Date.now().toString();n&&this.requests.set(n,t)})},init(){Logger.info("STORE","Initializing MappingsStore"),this.clear(),Logger.info("STORE","MappingsStore initialized")},get(e){if(!e)return null;const t=this.pending.get(e);return t&&t.type!=="delete"?t.optimisticMapping:this.items.get(e)||null},getAll(){const e=[];return this.items.forEach((t,n)=>{const a=this.pending.get(n);a&&a.type==="delete"||(a&&a.type==="update"?e.push(a.optimisticMapping):e.push(t))}),this.pending.forEach((t,n)=>{t.type==="create"&&!this.items.has(n)&&e.push(t.optimisticMapping)}),e},setFromServer(e,t={}){Logger.info("STORE",`Setting ${e.length} mappings from server`),this.items.clear(),e.forEach(n=>{const a=n.id||n.uuid;a&&this.items.set(a,n)}),this.metadata.serverVersion=t.version||t.etag||null,this.metadata.lastFullSync=Date.now(),this.rebuildIndexes(),this._updateStats(),Logger.info("STORE",`Loaded ${this.items.size} mappings`)},applyChanges({added:e=[],updated:t=[],deleted:n=[]}){Logger.info("STORE",`Applying changes: +${e.length} ~${t.length} -${n.length}`);const a=[];return t.forEach(r=>{const o=r.id||r.uuid,c=this.pending.get(o);if(c&&c.type==="update"){a.push({id:o,type:"update",local:c.optimisticMapping,server:r,localTimestamp:c.timestamp});return}this.items.set(o,r),this._addToIndexes(o,r)}),n.forEach(r=>{this.pending.has(r)&&a.push({id:r,type:"delete",local:this.pending.get(r).optimisticMapping,server:null}),this.items.delete(r),this._removeFromIndexes(r)}),e.forEach(r=>{const o=r.id||r.uuid;this.items.set(o,r),this._addToIndexes(o,r)}),this.metadata.lastIncrementalSync=Date.now(),this._updateStats(),a},addPending(e){const{id:t,type:n,payload:a,optimisticMapping:r}=e;this.pending.set(t,{id:t,type:n,payload:a,optimisticMapping:r,timestamp:Date.now(),retries:0}),Logger.debug("STORE",`Added pending ${n}: ${t}`),this._updateStats()},confirmPending(e,t=null){const n=this.pending.get(e);if(n){if(Logger.info("STORE",`Confirmed pending ${n.type}: ${e}`),n.type==="create"&&t){const a=t.id||t.uuid;this.items.set(a,t),this._addToIndexes(a,t)}else n.type==="update"&&t?(this.items.set(e,t),this._addToIndexes(e,t)):n.type==="delete"&&(this.items.delete(e),this._removeFromIndexes(e));this.pending.delete(e),this._updateStats()}},rollbackPending(e,t=null){const n=this.pending.get(e);n&&(Logger.warn("STORE",`Rolling back pending ${n.type}: ${e}`),n.type==="create"?this.items.delete(e):n.type==="update"&&t?(this.items.set(e,t),this._addToIndexes(e,t)):n.type==="delete"&&t&&(this.items.set(e,t),this._addToIndexes(e,t)),this.pending.delete(e),this._updateStats())},rebuildIndexes(){Object.values(this.indexes).forEach(e=>e.clear()),this.items.forEach((e,t)=>{this._addToIndexes(t,e)}),Logger.debug("STORE",`Rebuilt indexes for ${this.items.size} mappings`)},filter({method:e,url:t,priority:n,scenario:a}){let r=new Set(this.items.keys());if(e){const o=this.indexes.byMethod.get(e.toUpperCase());if(o)r=this._intersect(r,o);else return[]}if(t){const o=this.indexes.byUrl.get(t);o?r=this._intersect(r,o):r=new Set([...r].filter(c=>{const s=this.items.get(c);return this._matchesUrl(s,t)}))}if(n!==void 0){const o=this.indexes.byPriority.get(n);if(o)r=this._intersect(r,o);else return[]}if(a){const o=this.indexes.byScenario.get(a);if(o)r=this._intersect(r,o);else return[]}return Array.from(r).map(o=>this.get(o)).filter(Boolean)},clear(){this.items.clear(),this.pending.clear(),Object.values(this.indexes).forEach(e=>e.clear()),this.metadata={serverVersion:null,lastFullSync:null,lastIncrementalSync:null,isSyncing:!1,syncError:null},this._updateStats(),Logger.info("STORE","Cleared all data")},_addToIndexes(e,t){const n=t.request?.method||"GET";this.indexes.byMethod.has(n)||this.indexes.byMethod.set(n,new Set),this.indexes.byMethod.get(n).add(e);const a=t.request?.urlPattern||t.request?.url||t.request?.urlPath;a&&(this.indexes.byUrl.has(a)||this.indexes.byUrl.set(a,new Set),this.indexes.byUrl.get(a).add(e));const r=t.priority||1;this.indexes.byPriority.has(r)||this.indexes.byPriority.set(r,new Set),this.indexes.byPriority.get(r).add(e),t.scenarioName&&(this.indexes.byScenario.has(t.scenarioName)||this.indexes.byScenario.set(t.scenarioName,new Set),this.indexes.byScenario.get(t.scenarioName).add(e))},_removeFromIndexes(e){Object.values(this.indexes).forEach(t=>{t.forEach((n,a)=>{n.delete(e),n.size===0&&t.delete(a)})})},_intersect(e,t){const n=new Set;return e.forEach(a=>{t.has(a)&&n.add(a)}),n},_matchesUrl(e,t){const n=e.request?.urlPattern||e.request?.url||e.request?.urlPath||"";if(n===t)return!0;try{return new RegExp(t).test(n)}catch{return n.includes(t)}},_updateStats(){this.stats.totalMappings=this.items.size,this.stats.pendingOperations=this.pending.size}},typeof window<"u"&&(window.MappingsStore.init(),Object.defineProperty(window,"originalMappings",{get:function(){return window.MappingsStore?window.MappingsStore.getAll():[]},configurable:!0,enumerable:!0}),Object.defineProperty(window,"allMappings",{get:function(){return window._filteredMappings?window._filteredMappings:window.MappingsStore?window.MappingsStore.getAll():[]},configurable:!0,enumerable:!0}),Object.defineProperty(window,"originalRequests",{get:function(){return window.MappingsStore?window.MappingsStore.getAllRequests():[]},set:function(e){window.MappingsStore&&typeof window.MappingsStore.setRequests=="function"&&window.MappingsStore.setRequests(e);try{delete window._filteredRequests}catch{}},configurable:!0,enumerable:!0}),Object.defineProperty(window,"allRequests",{get:function(){return window._filteredRequests?window._filteredRequests:window.MappingsStore?window.MappingsStore.getAllRequests():[]},set:function(e){window._filteredRequests=Array.isArray(e)?e:[]},configurable:!0,enumerable:!0})),window.SyncEngine={config:{incrementalInterval:3e4,fullSyncInterval:3e5,fullSyncTimeout:6e4,cacheRebuildInterval:6e4,cacheMaxAge:36e5,maxRetries:3,retryDelay:2e3},timers:{incremental:null,fullSync:null,cacheRebuild:null},isStarted:!1,lastCacheHash:null,isIncrementalSyncing:!1,isFullSyncing:!1,useServiceCache:!0,init(){Logger.info("SYNC","Initializing SyncEngine"),this.stop(),Logger.info("SYNC","SyncEngine initialized")},start(){if(this.isStarted){Logger.debug("SYNC","Sync timers already running, skipping start");return}Logger.info("SYNC","Starting sync timers"),this.isStarted=!0,this.timers.incremental=window.LifecycleManager.setInterval(()=>this.incrementalSync(),this.config.incrementalInterval),this.timers.fullSync=window.LifecycleManager.setInterval(()=>this.fullSync({background:!0}),this.config.fullSyncInterval),this.useServiceCache&&(this.timers.cacheRebuild=window.LifecycleManager.setInterval(()=>this.rebuildServiceCache(),this.config.cacheRebuildInterval)),Logger.info("SYNC","Sync timers started")},stop(){Logger.info("SYNC","Stopping sync timers"),Object.keys(this.timers).forEach(e=>{this.timers[e]&&(window.LifecycleManager.clearInterval(this.timers[e]),this.timers[e]=null)}),this.isStarted=!1},async coldStart(e={}){const t=e.useCache===!0;this.useServiceCache=t,Logger.info("SYNC",`Cold start - loading from ${t?"cache or server":"server only"}`),typeof window.showLoadingState=="function"&&window.showLoadingState();try{if(t){const n=await this.loadFromServiceCache();n&&n.items&&n.items.length>0&&(Logger.info("SYNC",`Loaded ${n.items.length} mappings from cache`),window.MappingsStore.setFromServer(n.items,{version:n.version}),typeof window.fetchAndRenderMappings=="function"&&window.fetchAndRenderMappings(window.MappingsStore.getAll(),{source:"cache"}),window.FilterManager&&typeof window.FilterManager.applyMappingFilters=="function"&&window.FilterManager.applyMappingFilters(),typeof window.updateDataSourceIndicator=="function"&&window.updateDataSourceIndicator("cache"),Logger.info("SYNC","Initial UI rendered from cache"))}Logger.info("SYNC","Starting background full sync for latest data"),await this.fullSync({background:!0})}catch(n){Logger.error("SYNC","Cold start failed:",n);try{await this.fullSync({background:!1})}catch(a){throw Logger.error("SYNC","Fallback full sync also failed:",a),a}}},async fullSync({background:e=!1}={}){if(this.isFullSyncing){Logger.debug("SYNC","Full sync already in progress, skipping overlapping run");return}if(window.MappingsStore.metadata.isSyncing||window.MappingsStore.metadata.isOptimisticUpdate){Logger.debug("SYNC","Already syncing or optimistic update in progress, skipping full sync");return}this.isFullSyncing=!0,Logger.info("SYNC",`Starting full sync (background: ${e})`),e&&this._showSyncIndicator(),window.MappingsStore.metadata.isSyncing=!0,window.MappingsStore.metadata.syncStartTime=Date.now();const t=Date.now();try{const n=await this._fetchWithTimeout(typeof window.fetchMappingsFromServer=="function"?window.fetchMappingsFromServer({force:!0}):fetch(`${window.wiremockBaseUrl}/mappings`).then(s=>s.json()),this.config.fullSyncTimeout),a=n.mappings||[],r=n.meta?.version||n.meta?.etag||null;Logger.info("SYNC",`Received ${a.length} mappings from server`);const o=a.filter(s=>(s.id||s.uuid)!=="00000000-0000-0000-0000-00000000cace"&&!this._isServiceCacheMapping(s));window.MappingsStore.setFromServer(o,{version:r}),typeof window.fetchAndRenderMappings=="function"&&window.fetchAndRenderMappings(window.MappingsStore.getAll(),{source:"direct",skipSyncCheck:!0}),window.FilterManager&&typeof window.FilterManager.applyMappingFilters=="function"&&window.FilterManager.applyMappingFilters(),typeof window.updateDataSourceIndicator=="function"&&window.updateDataSourceIndicator("synced");const c=Date.now()-t;window.MappingsStore.stats.lastSyncDuration=c,Logger.info("SYNC",`Full sync completed in ${c}ms`)}catch(n){if(Logger.error("SYNC","Full sync failed:",n),window.MappingsStore.metadata.syncError=n.message,!e)throw n}finally{this.isFullSyncing=!1,window.MappingsStore.metadata.isSyncing=!1,window.MappingsStore.metadata.syncStartTime=null,this._hideSyncIndicator()}},async incrementalSync(){if(this.isIncrementalSyncing){Logger.debug("SYNC","Incremental sync already in progress, skipping overlapping run");return}this.isIncrementalSyncing=!0;try{if(window.MappingsStore.metadata.isSyncing||window.MappingsStore.metadata.isOptimisticUpdate){Logger.debug("SYNC","Already syncing or optimistic update in progress, skipping incremental sync");return}if(this.isFullSyncing){Logger.debug("SYNC","Full sync in progress, skipping incremental");return}if(!window.MappingsStore.metadata.lastFullSync){Logger.debug("SYNC","No full sync yet, skipping incremental");return}Logger.debug("SYNC","Starting lightweight incremental sync check");const e=Date.now()-(window.MappingsStore.metadata.lastFullSync||0),t=this.config.fullSyncInterval/2;e>t?Logger.debug("SYNC",`Data approaching staleness (${Math.round(e/1e3)}s since last sync), will refresh on next full sync`):Logger.debug("SYNC",`Data is fresh (${Math.round(e/1e3)}s since last sync), skipping server check`)}finally{this.isIncrementalSyncing=!1}},async loadFromServiceCache(){if(!this.useServiceCache)return null;try{Logger.debug("SYNC","Attempting to load from Service Cache");let e;try{e=await window.apiFetch("/mappings/00000000-0000-0000-0000-00000000cace")}catch(o){if(o.status===404)return Logger.debug("SYNC","Service Cache not found"),null;throw o}const t=e.response?.jsonBody||e,n=t.items||t.mappings;if(!n||!Array.isArray(n))return Logger.warn("SYNC","Invalid cache format"),null;const a={...t,items:n},r=Date.now()-(a.timestamp||0);return r>this.config.cacheMaxAge?(Logger.info("SYNC",`Cache is stale (${Math.round(r/1e3)}s old), skipping`),null):(Logger.info("SYNC",`Service Cache loaded (${a.items.length} items, ${Math.round(r/1e3)}s old)`),a)}catch(e){return Logger.warn("SYNC","Failed to load Service Cache:",e),null}},async rebuildServiceCache(){if(!this.useServiceCache)return;if(window.MappingsStore.pending.size>0||window.MappingsStore.metadata.isOptimisticUpdate){Logger.debug("SYNC","Skipping cache rebuild - pending operations or optimistic updates exist");return}const e=this._hashMappings(window.MappingsStore.items);if(e===this.lastCacheHash){Logger.debug("SYNC","Skipping cache rebuild - no changes");return}Logger.info("SYNC","Rebuilding Service Cache");try{const t={timestamp:Date.now(),version:window.MappingsStore.metadata.serverVersion,items:Array.from(window.MappingsStore.items.values()),count:window.MappingsStore.items.size},n={...t,items:t.items.map(r=>{if(!r||typeof r!="object")return r;const o={...r};return delete o._pending,delete o._operation,delete o._deleted,delete o.__optimisticTs,o.request&&(delete o.request._pending,delete o.request._operation,delete o.request._deleted),o.response&&(delete o.response._pending,delete o.response._operation,delete o.response._deleted),o})},a={id:"00000000-0000-0000-0000-00000000cace",priority:1e3,request:{method:"GET",url:"/__imock/cache/v2"},response:{status:200,jsonBody:n}};try{await window.apiFetch(`/mappings/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}catch(r){if(r.status===404)await window.apiFetch("/mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});else throw r}this.lastCacheHash=e,Logger.info("SYNC",`Service Cache saved (${t.count} mappings)`)}catch(t){Logger.warn("SYNC","Failed to rebuild Service Cache:",t)}},_detectChanges(e){const t=new Set(e.map(c=>c.id||c.uuid)),n=new Set(window.MappingsStore.items.keys()),a=[],r=[],o=[];return e.forEach(c=>{const s=c.id||c.uuid;if(!n.has(s))a.push(c);else{const p=window.MappingsStore.items.get(s);this._hasChanged(p,c)&&r.push(c)}}),n.forEach(c=>{t.has(c)||o.push(c)}),{added:a,updated:r,deleted:o,hasChanges:a.length>0||r.length>0||o.length>0}},_hasChanged(e,t){try{return JSON.stringify(e)!==JSON.stringify(t)}catch{return!0}},_handleConflicts(e){Logger.warn("SYNC",`Handling ${e.length} conflicts`),e.forEach(t=>{if(t.type==="delete"){if(Logger.warn("SYNC",`Conflict: mapping ${t.id} was deleted on server`),window.NotificationManager&&typeof window.NotificationManager.warning=="function"){const n=t.local?.name||t.id;window.NotificationManager.warning(`Mapping "${n}" was deleted by another user`)}window.MappingsStore.pending.delete(t.id)}else if(t.type==="update"){const n=this._getTimestamp(t.server),a=t.localTimestamp||Date.now();if(n>a){if(Logger.warn("SYNC",`Conflict: server version is newer for ${t.id}`),window.NotificationManager&&typeof window.NotificationManager.warning=="function"){const r=t.server?.name||t.id;window.NotificationManager.warning(`Your changes to "${r}" were overwritten by another user`)}window.MappingsStore.rollbackPending(t.id,t.server)}else Logger.warn("SYNC",`Conflict: local version is newer for ${t.id}, keeping local`)}})},_getTimestamp(e){return e?.metadata?.edited||e?.metadata?.updated||e?.metadata?.created||0},_formatChangesSummary(e){const t=[];return e.added.length>0&&t.push(`+${e.added.length} added`),e.updated.length>0&&t.push(`~${e.updated.length} updated`),e.deleted.length>0&&t.push(`-${e.deleted.length} deleted`),t.join(", ")},_hashMappings(e){if(e.size===0)return"0:";const t=Array.from(e.keys());if(t.length>1e3){const n=t.slice(0,50).sort().join("|").substring(0,100),a=t.slice(-50).sort().join("|").substring(0,100),r=`${n}...${a}`;return`${e.size}:${this._simpleHash(r)}`}else{const n=t.sort().join(",");return`${e.size}:${n}`}},_simpleHash(e){let t=0;for(let n=0;n<e.length;n++){const a=e.charCodeAt(n);t=(t<<5)-t+a,t|=0}return Math.abs(t).toString(36)},_isServiceCacheMapping(e){return(e.id||e.uuid)==="00000000-0000-0000-0000-00000000cace"||e.request?.url?.includes("/__imock/cache")},_fetchWithTimeout(e,t){return Promise.race([e,new Promise((n,a)=>setTimeout(()=>a(new Error("Request timeout")),t))])},_showSyncIndicator(){const e=document.getElementById("sync-indicator");e&&e.classList.add("is-active")},_hideSyncIndicator(){const e=document.getElementById("sync-indicator");e&&e.classList.remove("is-active")}},typeof window<"u"&&window.SyncEngine.init();function normalizeScenarioNameValue(e){if(e==null)return{original:e,normalized:e,changed:!1,cleared:!1,hadWhitespace:!1};const t=typeof e=="string"?e:String(e),n=/\s/.test(t),a=t.trim().replace(/\s+/g,"_");return{original:t,normalized:a,changed:a!==t,cleared:!!t&&!a,hadWhitespace:n}}function normalizeScenarioNameField(e,{notify:t}={}){if(!e||typeof e!="object")return{changed:!1};if(!Object.prototype.hasOwnProperty.call(e,"scenarioName"))return{changed:!1};const a=(typeof window.Utils?.normalizeScenarioName=="function"?window.Utils.normalizeScenarioName:normalizeScenarioNameValue)(e.scenarioName);return!a?.changed||!a?.hadWhitespace?{changed:!1}:(a.cleared?(delete e.scenarioName,t?.("Scenario name contained only whitespace and was cleared")):(e.scenarioName=a.normalized,t?.(`Scenario name cannot contain spaces. Replaced with "${a.normalized}"`)),{changed:!0,original:a.original,normalized:a.normalized,cleared:a.cleared})}window.MappingsOperations={async create(e){const t={...e||{}};normalizeScenarioNameField(t,{notify:r=>window.NotificationManager?.warning?.(r)});const n=typeof crypto?.randomUUID=="function"?`temp-${crypto.randomUUID()}`:`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;Logger.info("OPS",`Creating mapping with temp ID: ${n}`);const a={...t,id:n,_pending:!0,_operation:"create"};try{window.MappingsStore.addPending({id:n,type:"create",payload:t,optimisticMapping:a}),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.info=="function"&&window.NotificationManager.info("Creating mapping...");const r=await this._sendCreateRequest(t),o=r.id||r.uuid;if(Logger.info("OPS",`Mapping created on server with ID: ${o}`),window.MappingsStore.confirmPending(n,r),this._refreshUI(),this._broadcastUpdate("created",r),window.NotificationManager&&typeof window.NotificationManager.success=="function"){const c=r.name||r.id.substring(0,8);window.NotificationManager.success(`Mapping "${c}" created successfully`)}return r}catch(r){throw Logger.error("OPS","Failed to create mapping:",r),window.MappingsStore.rollbackPending(n,null),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.error=="function"&&window.NotificationManager.error(`Failed to create mapping: ${r.message}`),r}},async update(e,t){Logger.info("OPS",`Updating mapping: ${e}`);const n=window.MappingsStore.get(e);if(!n)throw new Error(`Mapping ${e} not found`);if(window.MappingsStore.pending.has(e))throw Logger.warn("OPS",`Mapping ${e} already has pending operation`),new Error("Mapping has pending changes");const a={...t||{}},r={...n,...a,_pending:!0,_operation:"update",metadata:{...n.metadata,...a.metadata,edited:Date.now()}};normalizeScenarioNameField(r,{notify:o=>window.NotificationManager?.warning?.(o)});try{window.MappingsStore.addPending({id:e,type:"update",payload:a,optimisticMapping:r,original:n}),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.info=="function"&&window.NotificationManager.info("Saving changes...");const o=await this._sendUpdateRequest(e,r);if(Logger.info("OPS",`Mapping updated on server: ${e}`),window.MappingsStore.confirmPending(e,o),this._refreshUI(),this._broadcastUpdate("updated",o),window.NotificationManager&&typeof window.NotificationManager.success=="function"){const c=o.name||e.substring(0,8);window.NotificationManager.success(`Mapping "${c}" updated successfully`)}return o}catch(o){throw Logger.error("OPS","Failed to update mapping:",o),window.MappingsStore.rollbackPending(e,n),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.error=="function"&&window.NotificationManager.error(`Failed to update mapping: ${o.message}`),o}},async delete(e){Logger.info("OPS",`Deleting mapping: ${e}`);const t=window.MappingsStore.get(e);if(!t){Logger.warn("OPS",`Mapping ${e} not found, skipping delete`);return}const n={...t,_deleted:!0,_pending:!0,_operation:"delete"};try{if(window.MappingsStore.addPending({id:e,type:"delete",payload:null,optimisticMapping:n,original:t}),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.info=="function"){const a=t.name||e.substring(0,8);window.NotificationManager.info(`Deleting "${a}"...`)}if(await this._sendDeleteRequest(e),Logger.info("OPS",`Mapping deleted on server: ${e}`),window.MappingsStore.confirmPending(e,null),this._refreshUI(),this._broadcastUpdate("deleted",t),window.NotificationManager&&typeof window.NotificationManager.success=="function"){const a=t.name||e.substring(0,8);window.NotificationManager.success(`Mapping "${a}" deleted successfully`)}}catch(a){throw Logger.error("OPS","Failed to delete mapping:",a),window.MappingsStore.rollbackPending(e,t),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.error=="function"&&window.NotificationManager.error(`Failed to delete mapping: ${a.message}`),a}},async batchDelete(e){Logger.info("OPS",`Batch deleting ${e.length} mappings`);const t={success:[],failed:[]};for(const n of e)try{await this.delete(n),t.success.push(n)}catch(a){Logger.error("OPS",`Failed to delete ${n}:`,a),t.failed.push({id:n,error:a.message})}return Logger.info("OPS",`Batch delete complete: ${t.success.length} succeeded, ${t.failed.length} failed`),window.NotificationManager&&(t.failed.length===0?window.NotificationManager.success(`Deleted ${t.success.length} mappings`):window.NotificationManager.warning(`Deleted ${t.success.length} mappings, ${t.failed.length} failed`)),t},async _sendCreateRequest(e){const t=this._cleanMappingData(e);return await window.apiFetch("/mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})},async _sendUpdateRequest(e,t){const n=this._cleanMappingData(t);return await window.apiFetch(`/mappings/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})||n},async _sendDeleteRequest(e){await window.apiFetch(`/mappings/${e}`,{method:"DELETE"})},_cleanMappingData(e){const t={...e};return delete t._pending,delete t._operation,delete t._deleted,t},_refreshUI(){if(!window.MappingsStore){Logger.warn("OPS","MappingsStore not available for UI refresh");return}if(typeof window.refreshMappingTabSnapshot=="function"&&window.refreshMappingTabSnapshot(),window.FilterManager&&typeof window.FilterManager.applyMappingFilters=="function")window.FilterManager.applyMappingFilters(),typeof window.FilterManager.flushMappingFilters=="function"&&window.FilterManager.flushMappingFilters();else{Logger.warn("OPS","FilterManager not available, rendering without filters");const e=window.MappingsStore.getAll();typeof window.fetchAndRenderMappings=="function"&&window.fetchAndRenderMappings(e,{source:"optimistic"})}},_broadcastUpdate(e,t){if(typeof BroadcastChannel<"u")try{new BroadcastChannel("imock-optimistic-updates").postMessage({type:"mapping-"+e,operation:e,mapping:t,source:"mappings-operations",timestamp:Date.now()}),Logger.debug("OPS",`Broadcasted ${e} update:`,t.id)}catch(n){Logger.warn("OPS","Failed to broadcast update:",n)}try{const n="imock-optimistic-update",a={type:"mapping-"+e,operation:e,mapping:t,source:"mappings-operations",timestamp:Date.now()};localStorage.setItem(n,JSON.stringify(a)),setTimeout(()=>{try{localStorage.removeItem(n)}catch{}},1e3)}catch(n){Logger.warn("OPS","Failed to update localStorage:",n)}}};function isCacheEnabled(){try{const e=document.getElementById("cache-enabled"),t=typeof window.readWiremockSettings=="function"?window.readWiremockSettings():{},n=e&&typeof e.checked=="boolean"?e.checked:!0;return t.cacheEnabled!==!1&&n}catch(e){return Logger.warn("CACHE","Failed to resolve cache enabled state. Defaulting to cache disabled. Check settings configuration.",e),!1}}window.isCacheEnabled=isCacheEnabled,window.connectToWireMock=async()=>{const e=document.getElementById("wiremock-host")||document.getElementById(SELECTORS.CONNECTION.HOST),t=document.getElementById("wiremock-port")||document.getElementById(SELECTORS.CONNECTION.PORT);let n,a;if(e&&t)n=e.value.trim()||"localhost",a=t.value.trim()||"8080";else if(window.wiremockBaseUrl)Logger.api("Using existing wiremockBaseUrl for connection"),n="localhost",a="8080";else{const s=typeof window.readWiremockSettings=="function"?window.readWiremockSettings():{};n=s.host||"localhost",a=s.port||"8080",Logger.api("Using settings for connection:",{host:n,port:a})}Logger.api("Connecting with:",{host:n,port:a});const r=document.getElementById(SELECTORS.CONNECTION.STATUS_DOT),o=document.getElementById(SELECTORS.CONNECTION.STATUS_TEXT),c=document.getElementById(SELECTORS.LOADING.MAPPINGS);if(r&&(r.className="status-dot connecting"),o&&(o.textContent="Connecting..."),c&&c.classList.remove("hidden"),!window.wiremockBaseUrl||e){if(typeof window.normalizeWiremockBaseUrl=="function")window.wiremockBaseUrl=window.normalizeWiremockBaseUrl(n,a);else{const s=/^(https?:)\/\//i.test(n),p=s?n.split(":")[0]:"http",w=s?n.replace(/^(https?:)\/\//i,""):n,E=a&&String(a).trim()||(p==="https"?"443":"8080");window.wiremockBaseUrl=`${p}://${w}:${E}/__admin`}Logger.api("Updated wiremockBaseUrl:",window.wiremockBaseUrl)}else Logger.api("Using pre-configured wiremockBaseUrl:",window.wiremockBaseUrl);try{await checkHealthAndStartUptime(),Logger.info("API","Online mode - proceeding with data loading");const s=document.getElementById(SELECTORS.CONNECTION.SETUP),p=document.getElementById(SELECTORS.BUTTONS.ADD_MAPPING);r&&(r.className="status-dot connected"),o&&(window.lastWiremockSuccess||(window.lastWiremockSuccess=Date.now()),typeof window.updateLastSuccessUI=="function"&&window.updateLastSuccessUI()),s&&(s.style.display="none"),p&&(p.disabled=!1);const w=document.getElementById(SELECTORS.UI.STATS),E=document.getElementById("stats-spacer"),v=document.getElementById(SELECTORS.UI.SEARCH_FILTERS);w&&(w.style.display="flex"),E&&(E.style.display="none"),v&&(v.style.display="block"),startHealthCheck(),Logger.info("API","Using new optimized sync engine");const C=isCacheEnabled();Logger.info("CACHE",`Service cache is ${C?"enabled":"disabled"} for this session`),window.SyncEngine.stop(),await window.SyncEngine.coldStart({useCache:C}),window.SyncEngine.start(),await loadScenarios(),typeof window.hideOnboardingOverlay=="function"&&window.hideOnboardingOverlay(),typeof window.FilterManager?.restoreFilters=="function"&&window.FilterManager.restoreFilters("mappings")?.query&&typeof window.FilterManager.applyMappingFilters=="function"&&(window.FilterManager.applyMappingFilters(),typeof window.FilterManager.flushMappingFilters=="function"&&window.FilterManager.flushMappingFilters()),NotificationManager.success("Connected to WireMock successfully!")}catch(s){Logger.error("API","Connection error - entering offline mode:",s),Logger.warn("API","Offline mode - no server requests will be made"),stopUptime(),r&&(r.className="status-dot disconnected"),o&&(o.textContent="Offline"),c&&c.classList.add("hidden"),NotificationManager.warning("WireMock server is offline. Retrying connection in background..."),startHealthCheck()}};let healthCheckTimeout=null,healthCheckFailureCount=0;window.startHealthCheck=()=>{healthCheckTimeout&&(clearTimeout(healthCheckTimeout),healthCheckTimeout=null);let e;window.isOnline?e=3e4:e=Math.min(2e3*Math.pow(2,healthCheckFailureCount),6e4),Logger.info("HEALTH",`Scheduling next check in ${e}ms (${window.isOnline?"online":`offline, attempt ${healthCheckFailureCount+1}`})`),healthCheckTimeout=setTimeout(async()=>{try{const t=performance.now();let n=!1,a=0;try{const o=await apiFetch(ENDPOINTS.HEALTH);a=Math.round(performance.now()-t),n=typeof o=="object"&&(typeof o.status=="string"&&["up","healthy","ok"].includes(o.status.toLowerCase())||o.healthy===!0)}catch(o){if(o?.message?.includes("404")||o?.status===404){Logger.warn("HEALTH","/health not found (404), trying /mappings fallback for older WireMock");try{const s=await window.apiFetch(window.ENDPOINTS.MAPPINGS);a=Math.round(performance.now()-t),n=typeof s=="object"&&s!==null&&!s.__isDemo}catch{n=!1}}else n=!1}const r=window.isOnline;if(window.isOnline=n,n){healthCheckFailureCount=0;const o=document.getElementById(SELECTORS.HEALTH.INDICATOR);o&&(o.innerHTML=`<span>Response Time: </span><span class="healthy">${a}ms</span>`),r?Logger.info("HEALTH",`Server is healthy (${a}ms)`):(Logger.info("HEALTH",`Server is back online (${a}ms)`),NotificationManager.success("WireMock server is back online! Reconnecting..."),await window.connectToWireMock())}else{healthCheckFailureCount++;const o=document.getElementById(SELECTORS.HEALTH.INDICATOR);if(o&&(o.innerHTML='<span>Response Time: </span><span class="unhealthy">Offline</span>'),r){Logger.warn("HEALTH","Server went offline"),stopUptime();const c=document.getElementById(SELECTORS.CONNECTION.STATUS_DOT),s=document.getElementById(SELECTORS.CONNECTION.STATUS_TEXT);c&&(c.className="status-dot disconnected"),s&&(s.textContent="Offline"),NotificationManager.warning("WireMock server went offline. Retrying in background...")}else Logger.warn("HEALTH",`Server still offline (attempt ${healthCheckFailureCount})`)}startHealthCheck()}catch(t){Logger.error("HEALTH","Check error:",t),window.isOnline=!1,healthCheckFailureCount++,startHealthCheck()}},e)},window.stopHealthCheck=()=>{healthCheckTimeout&&(clearTimeout(healthCheckTimeout),healthCheckTimeout=null,healthCheckFailureCount=0,Logger.info("HEALTH","Health check stopped"))},window.checkHealthAndStartUptime=async()=>{try{const e=performance.now();let t=0,n=!1;try{const a=await apiFetch(ENDPOINTS.HEALTH);t=Math.round(performance.now()-e),n=typeof a=="object"&&(typeof a.status=="string"&&["up","healthy","ok"].includes(a.status.toLowerCase())||a.healthy===!0),Logger.info("HEALTH","initial check:",{rawStatus:a?.status,healthyFlag:a?.healthy,isHealthy:n})}catch(a){if(a?.message?.includes("404")||a?.status===404){Logger.warn("HEALTH","/health not found (404), trying /mappings fallback for older WireMock");try{const o=await window.apiFetch(window.ENDPOINTS.MAPPINGS);t=Math.round(performance.now()-e),n=typeof o=="object"&&o!==null&&!o.__isDemo,Logger.info("HEALTH","fallback check (mappings):",{isHealthy:n,responseTime:t})}catch{Logger.warn("HEALTH","fallback failed - offline mode"),n=!1}}else Logger.warn("HEALTH","connection failed - offline mode"),n=!1}if(n){if(window.isOnline=!0,window.startTime=Date.now(),window.uptimeInterval&&window.LifecycleManager.clearInterval(window.uptimeInterval),window.uptimeInterval=window.LifecycleManager.setNamedInterval("uptime-display",updateUptime,1e3),typeof window.applyHealthUI=="function")try{window.applyHealthUI(!0,t)}catch(r){Logger.warn("HEALTH","applyHealthUI failed:",r)}const a=document.getElementById(SELECTORS.HEALTH.INDICATOR);a&&(a.style.display="inline",a.innerHTML=`<span>Response Time: </span><span class="healthy">${t}ms</span>`),Logger.info("HEALTH",`WireMock health check passed (${t}ms), uptime started, online mode`)}else throw window.isOnline=!1,new Error("WireMock is not reachable - offline mode")}catch(e){throw window.isOnline=!1,Logger.error("HEALTH","Health check failed - entering offline mode:",e),e}};function isOptimisticShadowMap(e){return e&&typeof e=="object"&&typeof e.forEach=="function"&&typeof e.size=="number"&&Object.prototype.toString.call(e)==="[object Map]"}window.mappingPreviewState instanceof Set||(window.mappingPreviewState=new Set),window.mappingPreviewToastState instanceof Map||(window.mappingPreviewToastState=new Map),isOptimisticShadowMap(window.optimisticShadowMappings)||(window.optimisticShadowMappings=new Map);const UIComponents={createCard:(e,t,n=[])=>{const{id:a,method:r,url:o,status:c,name:s,time:p,extras:w={},expanded:E=!1}=t,v={editMapping:"edit-external",openEditModal:"edit-mapping",deleteMapping:"delete-mapping",duplicateMapping:"duplicate-mapping",viewRequestDetails:"view-request"};return`
            <div class="${e}-card${E?" is-expanded":""}" data-id="${Utils.escapeHtml(a)}">
                <div class="${e}-header" data-action="toggle-details">
                    <div class="${e}-info">
                        <div class="${e}-top-line">
                            <span class="method-badge ${r.toLowerCase()}">
                                <span class="collapse-arrow" id="arrow-${Utils.escapeHtml(a)}">${E?"\u25BC":"\u25B6"}</span> ${r}
                            </span>
                            ${s?`<span class="${e}-name">${Utils.escapeHtml(s)}</span>`:""}
                            ${p?`<span class="${e}-time">${p}</span>`:""}
                        </div>
                        <div class="${e}-url-line">
                            <span class="status-badge ${Utils.getStatusClass(c)}">${c}</span>
                            <span class="${e}-url">${Utils.escapeHtml(o)}</span>
                            ${w.badges||""}
                        </div>
                    </div>
                    <div class="${e}-actions">
                        ${n.map(C=>{const N=v[C.handler]||C.handler;return`
                            <button class="btn btn-sm btn-${C.class}"
                                    data-action="${N}"
                                    data-${e}-id="${Utils.escapeHtml(a)}"
                                    title="${Utils.escapeHtml(C.title)}">
                                ${C.icon?Icons.render(C.icon,{className:"action-icon"}):""}
                                <span class="sr-only">${Utils.escapeHtml(C.title)}</span>
                            </button>
                        `}).join("")}
                    </div>
                </div>
                <div class="${e}-preview" id="preview-${Utils.escapeHtml(a)}" style="display: ${E?"block":"none"};">
                    ${w.preview||""}
                </div>
            </div>`},getCardElement(e,t){const n=document.querySelectorAll(`.${e}-card`),a=String(t??"");for(const r of n)if((r.dataset?.id||"")===a)return r;return null},setCardState(e,t,n,a=!0){const r=this.getCardElement(e,t);r&&r.classList.toggle(n,!!a)},clearCardState(e,t){document.querySelectorAll(`.${e}-card.${t}`).forEach(n=>{n.classList.remove(t)})},createPreviewSection:(e,t)=>`
        <div class="preview-section">
            <h4>${e}</h4>
            ${Object.entries(t).map(([n,a])=>{if(!a)return"";if(typeof a=="object")if(JSON.stringify(a).length>500){const o=Utils.formatJson(a,"Invalid JSON",200),c=`full-${Math.random().toString(36).substr(2,9)}`;return`<div class="preview-value">
                            <strong>${n}:</strong>
                            <pre>${o}</pre>
                            <button class="btn btn-secondary btn-small" data-action="show-full-content" data-target-id="${c}" data-json="${Utils.escapeHtml(JSON.stringify(a))}" style="margin-top: 0.5rem; font-size: 0.8rem;">
                                Show Full Content
                            </button>
                            <div id="${c}" style="display: none;"></div>
                        </div>`}else return`<div class="preview-value"><strong>${n}:</strong><pre>${Utils.formatJson(a)}</pre></div>`;else if(typeof a=="string"){const r=a.trim();if(r.startsWith("{")&&r.endsWith("}"))try{const s=JSON.parse(r);if(JSON.stringify(s).length>500){const w=Utils.formatJson(s,"Invalid JSON",200),E=`full-${Math.random().toString(36).substr(2,9)}`;return`<div class="preview-value">
                                    <strong>${n}:</strong>
                                    <pre>${w}</pre>
                                    <button class="btn btn-secondary btn-small" data-action="show-full-content" data-target-id="${E}" data-json="${Utils.escapeHtml(JSON.stringify(s))}" style="margin-top: 0.5rem; font-size: 0.8rem;">
                                        Show Full Content
                                    </button>
                                    <div id="${E}" style="display: none;"></div>
                                </div>`}return`<div class="preview-value"><strong>${n}:</strong><pre>${Utils.formatJson(s)}</pre></div>`}catch{}const o=Utils.escapeHtml(a),c=o.includes(`
`)?`<pre>${o}</pre>`:o;return`<div class="preview-value"><strong>${n}:</strong> ${c}</div>`}else{const r=Utils.escapeHtml(String(a));return`<div class="preview-value"><strong>${n}:</strong> ${r}</div>`}}).join("")}
        </div>`,toggleDetails:(e,t)=>{const n=String(e??""),a=document.getElementById(`preview-${e}`),r=document.getElementById(`arrow-${e}`),o=a?a.style.display==="none":!1;if(a&&(a.style.display=o?"block":"none"),r&&(r.textContent=o?"\u25BC":"\u25B6"),t==="mapping"){const c=a?a.closest(`.${t}-card`):null;c&&c.classList.toggle("is-expanded",o),window.mappingPreviewState instanceof Set&&(o?window.mappingPreviewState.add(n):window.mappingPreviewState.delete(n))}UIComponents.setCardState(t,e,"is-expanded",o)},toggleFullContent:e=>{const t=document.getElementById(e),n=t.previousElementSibling;if(t.style.display==="none")try{const a=n.getAttribute("data-json"),r=JSON.parse(a);t.innerHTML=`<pre style="max-height: 300px; overflow-y: auto; background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-sm); margin-top: 0.5rem;">${Utils.escapeHtml(JSON.stringify(r,null,2))}</pre>`,t.style.display="block",n.textContent="Hide Full Content"}catch(a){t.innerHTML=`<div class="preview-value warning">Error parsing JSON: ${Utils.escapeHtml(a.message)}</div>`,t.style.display="block",n.textContent="Hide"}else t.style.display="none",n.textContent="Show Full Content"}};window.toggleFullContent=UIComponents.toggleFullContent,window.toggleDetails=UIComponents.toggleDetails;function getOptimisticShadowTtl(){const e=Number(window.DEFAULT_SETTINGS?.optimisticCacheAgeLimit);return Number.isFinite(e)&&e>0?Math.max(e,45e3):6e4}function cloneMappingForOptimisticShadow(e){if(!e||typeof e!="object")return null;try{return typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}catch{return{...e}}}function rememberOptimisticShadowMapping(e,t){if(isOptimisticShadowMap(window.optimisticShadowMappings)||(window.optimisticShadowMappings=new Map),!e||typeof e!="object")return;const n=e.id||e.uuid;if(!n)return;const a=typeof t=="string"?t.toLowerCase():"update";if(a==="delete"){window.optimisticShadowMappings.delete(String(n));return}const r=cloneMappingForOptimisticShadow(e);r&&(typeof r.__optimisticTs!="number"&&Object.defineProperty(r,"__optimisticTs",{value:Date.now(),writable:!1,enumerable:!1,configurable:!0}),window.optimisticShadowMappings.set(String(n),{ts:Date.now(),op:a==="create"?"create":"update",mapping:r}))}function getOptimisticShadowTimestamp(e){if(!e||typeof e!="object")return Number.NaN;const t=e.metadata||{},n=[t.edited,t.updated,t.updatedAt,t.created,t.timestamp];for(const a of n){if(!a)continue;if(a instanceof Date){const c=a.getTime();if(Number.isFinite(c))return c}const r=Date.parse(a);if(Number.isFinite(r))return r;const o=Number(a);if(Number.isFinite(o))return o}return typeof e.__optimisticTs=="number"?e.__optimisticTs:Number.NaN}function applyOptimisticShadowMappings(e){if(!Array.isArray(e)||!isOptimisticShadowMap(window.optimisticShadowMappings)||window.optimisticShadowMappings.size===0)return e;const t=Date.now(),n=getOptimisticShadowTtl(),a=[...e];for(const[r,o]of Array.from(window.optimisticShadowMappings.entries())){const c=String(r||"");if(!o||typeof o!="object"){window.optimisticShadowMappings.delete(c);continue}if(o.mapping==null){const p=a.findIndex(w=>String(w?.id||w?.uuid||"")===c);p!==-1&&a.splice(p,1),window.optimisticShadowMappings.delete(c);continue}if(!Number.isFinite(o.ts)||t-o.ts>n){window.optimisticShadowMappings.delete(c);continue}const s=a.findIndex(p=>String(p?.id||p?.uuid||"")===c);if(s!==-1){let p=!1,w=!0;if(typeof getMappingRenderSignature=="function")try{const E=getMappingRenderSignature(a[s]),v=getMappingRenderSignature(o.mapping);if(E===v){window.optimisticShadowMappings.delete(c);continue}}catch{}if((o.op||"update")==="create")w=!1;else{const E=getOptimisticShadowTimestamp(a[s]),v=getOptimisticShadowTimestamp(o.mapping);Number.isFinite(v)&&(!Number.isFinite(E)||v>E)?p=!0:w=!1}p?(o.ts=t,a[s]=o.mapping):w?o.ts=t:window.optimisticShadowMappings.delete(c)}else a.unshift(o.mapping),Number.isFinite(o.ts)||(o.ts=t)}return a}function pruneOptimisticShadowMappings(e){if(!isOptimisticShadowMap(window.optimisticShadowMappings)||window.optimisticShadowMappings.size===0||!Array.isArray(e)||e.length===0)return;const t=new Map;e.forEach(n=>{if(n&&typeof n=="object"){const a=String(n.id||n.uuid||"");a&&t.set(a,n)}});for(const[n,a]of Array.from(window.optimisticShadowMappings.entries())){if(!t.has(n))continue;if(!a||typeof a!="object"){window.optimisticShadowMappings.delete(n);continue}if((a.op||"update")==="create")continue;if(!a.mapping||typeof a.mapping!="object"){window.optimisticShadowMappings.delete(n);continue}const r=t.get(n);if(!r){window.optimisticShadowMappings.delete(n);continue}try{if(typeof getMappingRenderSignature=="function"&&a.mapping){const s=getMappingRenderSignature(r),p=getMappingRenderSignature(a.mapping);if(s===p){window.optimisticShadowMappings.delete(n);continue}}}catch{}const o=getOptimisticShadowTimestamp(r),c=getOptimisticShadowTimestamp(a.mapping);Number.isFinite(o)&&(!Number.isFinite(c)||o>=c)&&window.optimisticShadowMappings.delete(n)}}window.fetchAndRenderMappings=async(e=null,t={})=>{const n=document.getElementById(SELECTORS.LISTS.MAPPINGS),a=document.getElementById(SELECTORS.EMPTY.MAPPINGS),r=document.getElementById(SELECTORS.LOADING.MAPPINGS);if(!n||!a||!r)return Logger.error("UI","Required DOM elements not found for mappings rendering"),!1;if(!(t?.skipSyncCheck===!0)&&(window.MappingsStore?.metadata?.isSyncing||window.MappingsStore?.metadata?.isRendering))return Logger.debug("UI","Sync or render in progress, skipping render to avoid race condition"),!0;window.MappingsStore?.metadata&&(window.MappingsStore.metadata.isRendering=!0);let c=null;try{if(e===null){r.classList.remove("hidden"),n.style.display="none",a.classList.add("hidden"),a.setAttribute("aria-hidden","true");let C,N="direct";if(t&&t.useCache){const y=await loadImockCacheBestOf3();if(y&&y.data&&Array.isArray(y.data.mappings)){Logger.cache("Cache hit - using cached data for quick start"),N="cache";const k=typeof y.data.timestamp=="number"?y.data.timestamp:(y.data.mappings||[]).reduce((X,he)=>{const ce=he?.metadata?.imock?.timestamp;return typeof ce=="number"&&ce>X?ce:X},0);Date.now()-k>3e4&&(async()=>{try{const X=typeof window<"u"&&typeof window.optimisticUpdateDelayMs=="number"?window.optimisticUpdateDelayMs:500;await new Promise(ce=>setTimeout(ce,X));const he=await fetchMappingsFromServer({force:!0});if(he&&he.mappings){const ce=he.mappings.filter(F=>!isImockCacheMapping(F)),Me=(y.data.mappings||[]).filter(F=>!isImockCacheMapping(F));if(Me.length!==ce.length){if(window.MappingsStore&&window.MappingsStore.setFromServer(ce),refreshMappingTabSnapshot(),syncCacheWithMappings(ce),rebuildMappingIndex(ce),typeof NotificationManager<"u"){const F=ce.length-Me.length;F>0?NotificationManager.info(`${F} new mapping${F===1?"":"s"} from server`,3e3):F<0&&NotificationManager.info(`${Math.abs(F)} mapping${Math.abs(F)===1?"":"s"} removed on server`,3e3),Logger.cache("Cache updated with server data:",{cachedCount:Me.length,serverCount:ce.length})}}else Logger.debug("CACHE","No changes detected, skipping cache update")}}catch(X){Logger.warn("CACHE","Background cache validation failed:",X)}})(),C=y.data}else{Logger.cache("Cache miss - loading from server"),typeof NotificationManager<"u"&&NotificationManager.info("Loading mappings from server...",2e3),C=await fetchMappingsFromServer({force:!0}),N="direct";try{Logger.cache("Async regenerate after cache miss"),regenerateImockCache()}catch{}}}else C=await fetchMappingsFromServer({force:!0}),N="direct";if(C&&C.__source){N=C.__source,N==="demo"&&markDemoModeActive("mappings-fallback");try{delete C.__source}catch{}}let J=C.mappings||[];const G=window.MappingsStore?.pending?Array.from(window.MappingsStore.pending.values()):[];G.length>0&&(Logger.debug("OPTIMISTIC","Applying optimistic updates to incoming data:",G.length,"updates"),J=J.map(y=>{const k=y.id||y.uuid,q=window.MappingsStore?.pending?window.MappingsStore.pending.get(k):null;return q?q.type==="delete"?(Logger.debug("OPTIMISTIC","Removing deleted mapping from results:",y.id),null):(Logger.debug("OPTIMISTIC","Using optimistic version for:",y.id),q.optimisticMapping):y}).filter(y=>y!==null),G.forEach(y=>{y.type!=="delete"&&!J.some(k=>(k.id||k.uuid)===y.id)&&(Logger.debug("OPTIMISTIC","Adding new optimistic mapping:",y.id),J.unshift(y.optimisticMapping))})),J=applyOptimisticShadowMappings(J);try{if(window.pendingDeletedIds&&window.pendingDeletedIds.size>0){const y=J.length;J=J.filter(k=>!window.pendingDeletedIds.has(k.id||k.uuid)),y!==J.length&&Logger.cache("filtered pending-deleted from render:",y-J.length)}}catch{}const b=Array.isArray(J)?J.filter(y=>!isImockCacheMapping(y)):[];window.MappingsStore&&window.MappingsStore.setFromServer(b),refreshMappingTabSnapshot(),syncCacheWithMappings(b),rebuildMappingIndex(b),pruneOptimisticShadowMappings(b),c=N}else{const C=typeof t?.source=="string"?t.source:null,N=Array.isArray(e)?[...e]:[];window.MappingsStore&&window.MappingsStore.setFromServer(N),refreshMappingTabSnapshot(),rebuildMappingIndex(N),pruneOptimisticShadowMappings(N),c=C,c==="demo"&&markDemoModeActive("manual-mappings")}r.classList.add("hidden");const s=document.getElementById(SELECTORS.MAPPING_FILTERS.QUERY)?.value?.trim()||"";let p=window.MappingsStore?window.MappingsStore.getAll():Array.isArray(e)?e:[];if(s&&window.QueryParser&&typeof window.QueryParser.filterMappingsByQuery=="function"&&(Logger.debug("UI","Applying filters before render:",s),p=window.QueryParser.filterMappingsByQuery(p,s)),window._filteredMappings=p,p.length===0)return a.classList.remove("hidden"),a.setAttribute("aria-hidden","false"),n.style.display="none",updateMappingsCounter(),c&&updateDataSourceIndicator(c),!0;a.classList.add("hidden"),a.setAttribute("aria-hidden","true"),n.style.display="block",window.invalidateElementCache(SELECTORS.LISTS.MAPPINGS);const E=[...p].sort((C,N)=>{const J=C.priority||1,G=N.priority||1;if(J!==G)return J-G;const b={GET:1,POST:2,PUT:3,PATCH:4,DELETE:5},y=b[C.request?.method]||999,k=b[N.request?.method]||999;if(y!==k)return y-k;const q=C.request?.url||C.request?.urlPattern||C.request?.urlPath||"",X=N.request?.url||N.request?.urlPattern||N.request?.urlPath||"";return q.localeCompare(X)}),v=c||"previous";Logger.info("UI",`Mappings render from: ${v} \u2014 ${E.length} items`);try{if(n.style.willChange="contents",window.PaginationManager){window.PaginationManager.updateState(E.length);const N=window.PaginationManager.getCurrentPageItems(E);Logger.debug("UI",`Rendering page ${window.PaginationManager.currentPage}/${window.PaginationManager.totalPages} (${N.length} items)`),renderList(n,N,{renderItem:renderMappingMarkup,getKey:getMappingRenderKey,getSignature:getMappingRenderSignature,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});const J=document.getElementById("mappings-pagination");J&&(J.innerHTML=window.PaginationManager.renderControls())}else renderList(n,E,{renderItem:renderMappingMarkup,getKey:getMappingRenderKey,getSignature:getMappingRenderSignature,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});const C=()=>{updateMappingsCounter(),c&&updateDataSourceIndicator(c),n.style.willChange="auto";try{document.getElementById(SELECTORS.MAPPING_FILTERS.QUERY)?.value?.trim()&&typeof window.updateActiveFiltersDisplay=="function"&&window.updateActiveFiltersDisplay()}catch{}};typeof requestAnimationFrame=="function"?requestAnimationFrame(C):C()}catch(C){if(Logger.error("UI","DOM batch update failed:",C),window.PaginationManager){window.PaginationManager.updateState(E.length);const N=window.PaginationManager.getCurrentPageItems(E);renderList(n,N,{renderItem:renderMappingMarkup,getKey:getMappingRenderKey,getSignature:getMappingRenderSignature,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});const J=document.getElementById("mappings-pagination");J&&(J.innerHTML=window.PaginationManager.renderControls())}else renderList(n,E,{renderItem:renderMappingMarkup,getKey:getMappingRenderKey,getSignature:getMappingRenderSignature,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});updateMappingsCounter(),c&&updateDataSourceIndicator(c)}return!0}catch(s){Logger.error("UI","Error in fetchAndRenderMappings:",s);let p="Failed to load mappings";return s.status===401||s.message&&s.message.includes("401")?p="Authorization error: Please check your credentials":s.status===403||s.message&&s.message.includes("403")?p="Access forbidden: Check your permissions":s.status===404||s.message&&s.message.includes("404")?p="Server endpoint not found":s.message&&s.message.includes("timeout")?p="Request timeout: Server not responding":s.message&&(p=`Failed to load mappings: ${s.message}`),NotificationManager.error(p),r.classList.add("hidden"),a.classList.remove("hidden"),n.style.display="none",!1}finally{window.MappingsStore?.metadata&&(window.MappingsStore.metadata.isRendering=!1)}},window.refreshMappingsFromCache=async(e="cache")=>{try{if(!window.MappingsStore)return Logger.warn("CACHE","MappingsStore not available"),!1;const n=window.MappingsStore.getAll().filter(r=>!isImockCacheMapping(r));window.MappingsStore.setFromServer(n),typeof refreshMappingTabSnapshot=="function"&&refreshMappingTabSnapshot(),typeof rebuildMappingIndex=="function"&&rebuildMappingIndex(n),typeof pruneOptimisticShadowMappings=="function"&&pruneOptimisticShadowMappings(n),typeof updateDataSourceIndicator=="function"&&updateDataSourceIndicator(e||"cache");const a=window.MappingsStore?window.MappingsStore.getAll():[];return await fetchAndRenderMappings(a,{source:e||"cache"})}catch(t){return Logger.warn("CACHE","refreshMappingsFromCache failed:",t),!1}},window.initMappingPagination=function(){if(!window.PaginationManager){Logger.warn("UI","PaginationManager not available");return}window.PaginationManager.init("#mappings-pagination",20),window.PaginationManager.attachListeners(e=>{Logger.debug("UI",`Page changed to: ${e}`);const t=document.getElementById(SELECTORS.LISTS.MAPPINGS),n=window.MappingsStore?window.MappingsStore.getAll():[];if(!t||!Array.isArray(n)){Logger.warn("UI","Cannot render page: container or data not available");return}const a=[...n].sort((s,p)=>{const w=s.priority||1,E=p.priority||1;if(w!==E)return w-E;const v={GET:1,POST:2,PUT:3,PATCH:4,DELETE:5},C=v[s.request?.method]||999,N=v[p.request?.method]||999;if(C!==N)return C-N;const J=s.request?.url||s.request?.urlPattern||s.request?.urlPath||"",G=p.request?.url||p.request?.urlPattern||p.request?.urlPath||"";return J.localeCompare(G)}),r=window.PaginationManager.getCurrentPageItems(a);window.invalidateElementCache(SELECTORS.LISTS.MAPPINGS),renderList(t,r,{renderItem:renderMappingMarkup,getKey:getMappingRenderKey,getSignature:getMappingRenderSignature,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});const o=document.getElementById("mappings-pagination");o&&(o.innerHTML=window.PaginationManager.renderControls());const c=document.getElementById("mappings-page");c&&c.scrollIntoView({behavior:"smooth",block:"start"})}),Logger.info("UI","Mapping pagination initialized")},window.getMappingById=async e=>{try{if(!e)throw new Error("Mapping ID is required");Logger.debug("CACHE",`Fetching mapping with ID: ${e}`),Logger.debug("CACHE","Current wiremockBaseUrl:",window.wiremockBaseUrl);const t=window.MappingsStore?window.MappingsStore.getAll():[];Logger.debug("CACHE","MappingsStore available:",!!window.MappingsStore),Logger.debug("CACHE","Cache size:",t?.length||0);let n=window.MappingsStore?window.MappingsStore.get(e):null;if(n||(n=t.find(o=>o.id===e||o.uuid===e)||null),n)return Logger.cache(`Found mapping in cache: ${e}`,n),n;Logger.cache("Mapping not found in cache, will fetch from API"),Logger.api(`Making API call to: /mappings/${e}`);const a=await apiFetch(`/mappings/${e}`);Logger.api("Raw API response:",a);const r=a&&typeof a=="object"&&a.mapping?a.mapping:a;if(Logger.debug("CACHE","Processed mapping:",r),!r||typeof r!="object")throw Logger.error("CACHE",`API returned invalid data for mapping ${e}`),new Error(`Mapping with ID ${e} not found or invalid response`);return Logger.info("CACHE",`Successfully fetched mapping: ${e}`,r),addMappingToIndex(r),r}catch(t){throw Logger.error("CACHE",`Error fetching mapping ${e}:`,t),Logger.error("CACHE","Error details:",{message:t.message,status:t.status,statusText:t.statusText,url:`${window.wiremockBaseUrl}/mappings/${e}`}),t}},window.duplicateMapping=async e=>{const t=(e??"").toString().trim();if(!t){NotificationManager.error("Invalid mapping identifier");return}if(!window.TemplateManager?.createMappingsFromPayloads){NotificationManager.error("Mapping duplication is not available");return}try{const n=await window.getMappingById(t);if(!n)throw new Error("Mapping not found");await window.TemplateManager.createMappingsFromPayloads([n],{openMode:"inline",source:"duplicate",successMessageFactory:a=>`Duplicated ${a} mapping${a===1?"":"s"}`})}catch(n){Logger.error("OPTIMISTIC","Failed to duplicate mapping:",n),NotificationManager.error(`Failed to duplicate mapping: ${n.message}`)}},window.applyOptimisticMappingUpdate=e=>{try{if(!e){Logger.warn("OPTIMISTIC","No mapping data provided");return}const t=e.mapping||e,n=t?.id||t?.uuid;if(!t||!n){Logger.warn("OPTIMISTIC","Invalid mapping data - missing id:",t);return}if(isImockCacheMapping(t)){Logger.debug("OPTIMISTIC","Skipping cache mapping update");return}const a=window.MappingsStore&&window.MappingsStore.items instanceof Map,r=a&&window.MappingsStore.items.has(n)?"update":"create";if(rememberOptimisticShadowMapping(t,r),typeof updateOptimisticCache=="function")updateOptimisticCache(t,r,{queueMode:"add"});else{if(a){try{window.MappingsStore.addPending({id:n,type:r,payload:t,optimisticMapping:t})}catch(c){Logger.warn("OPTIMISTIC","Failed to enqueue optimistic update:",c)}const o=cloneMappingForCache(t);if(!o)Logger.warn("OPTIMISTIC","Failed to clone mapping for store:",n);else{if(!o.id&&n&&(o.id=n),!o.uuid&&(t.uuid||n)&&(o.uuid=t.uuid||n),window.MappingsStore.items.has(n)){const c=mergeMappingData(window.MappingsStore.items.get(n),o);window.MappingsStore.items.set(n,c)}else window.MappingsStore.items.set(n,o);typeof window.MappingsStore.rebuildIndexes=="function"&&window.MappingsStore.rebuildIndexes()}}window.cacheLastUpdate=Date.now(),window.MappingsStore.metadata.isOptimisticUpdate||(window.MappingsStore.metadata.isOptimisticUpdate=!0,setTimeout(()=>{window.MappingsStore.metadata.isOptimisticUpdate=!1},1e3)),refreshMappingsFromCache()}Logger.debug("OPTIMISTIC","Applied update for mapping:",n)}catch(t){Logger.warn("OPTIMISTIC","Update failed:",t)}},window.backgroundRefreshMappings=async(e=!1)=>{try{if(!window.MappingsStore){Logger.warn("CACHE","MappingsStore not available for background refresh");return}let t,n="direct";if(e){const o=await loadImockCacheBestOf3();o&&o.data&&Array.isArray(o.data.mappings)?(t=o.data,n="cache"):(t=await fetchMappingsFromServer({force:!0}),n="direct")}else t=await fetchMappingsFromServer({force:!0}),n="direct";let a=t.mappings||[];a=applyOptimisticShadowMappings(a);try{if(window.pendingDeletedIds instanceof Set&&window.pendingDeletedIds.size>0){const o=a.length;a=a.filter(c=>{if(!c||typeof c!="object")return!0;const s=c.id||c.uuid;return!window.pendingDeletedIds.has(s)}),o!==a.length&&Logger.cache("background refresh filtered pending-deleted mappings:",o-a.length)}}catch(o){Logger.warn("CACHE","Failed to filter pending deletions during background refresh:",o)}const r=Array.isArray(a)?a.filter(o=>!isImockCacheMapping(o)):[];window.MappingsStore&&window.MappingsStore.setFromServer(r),refreshMappingTabSnapshot(),syncCacheWithMappings(r),rebuildMappingIndex(r),pruneOptimisticShadowMappings(r),updateDataSourceIndicator(n),setTimeout(()=>{const o=window.MappingsStore?window.MappingsStore.getAll():[];fetchAndRenderMappings(o)},0)}catch(t){Logger.warn("CACHE","Background refresh failed:",t)}},window.renderMappingCard=function(e){if(!e||!e.id)return Logger.warn("CACHE","Invalid mapping data:",e),"";const t=[{class:"secondary",handler:"duplicateMapping",title:"Duplicate",icon:"clipboard"},{class:"secondary",handler:"editMapping",title:"Edit in Editor",icon:"open-external"},{class:"primary",handler:"openEditModal",title:"Edit",icon:"pencil"},{class:"danger",handler:"deleteMapping",title:"Delete",icon:"trash"}],n=String(e.id||e.uuid||""),a=window.mappingPreviewState instanceof Set&&window.mappingPreviewState.has(n),r={id:e.id,method:e.request?.method||"GET",url:e.request?.urlPath||e.request?.urlPathPattern||e.request?.urlPattern||e.request?.url||"N/A",status:e.response?.status||200,name:e.name||e.metadata?.name||`Mapping ${e.id.substring(0,8)}`,expanded:a,extras:{preview:a?UIComponents.createPreviewSection(`${Icons.render("request-in",{className:"icon-inline"})} Request`,{Method:e.request?.method||"GET",URL:e.request?.url||e.request?.urlPattern||e.request?.urlPath||e.request?.urlPathPattern,Headers:e.request?.headers,Body:e.request?.bodyPatterns||e.request?.body,"Query Parameters":e.request?.queryParameters})+UIComponents.createPreviewSection(`${Icons.render("response-out",{className:"icon-inline"})} Response`,{Status:e.response?.status,Headers:e.response?.headers,Body:e.response?.jsonBody||e.response?.body,Delay:e.response?.fixedDelayMilliseconds?`${e.response.fixedDelayMilliseconds}ms`:null})+UIComponents.createPreviewSection(`${Icons.render("info",{className:"icon-inline"})} Overview`,{ID:e.id||e.uuid,Name:e.name||e.metadata?.name,Priority:e.priority,Persistent:e.persistent,Scenario:e.scenarioName,"Required State":e.requiredScenarioState,"New State":e.newScenarioState,Created:window.showMetaTimestamps!==!1&&e.metadata?.created?new Date(e.metadata.created).toLocaleString():null,Edited:window.showMetaTimestamps!==!1&&e.metadata?.edited?new Date(e.metadata.edited).toLocaleString():null,Source:e.metadata?.source?`Edited from ${e.metadata.source}`:null}):"",badges:[e.id||e.uuid?`<span class="badge badge-secondary" title="Mapping ID">${Utils.escapeHtml((e.id||e.uuid).length>12?(e.id||e.uuid).slice(0,8)+"\u2026"+(e.id||e.uuid).slice(-4):e.id||e.uuid)}</span>`:"",typeof e.priority=="number"?`<span class="badge badge-secondary" title="Priority">P${e.priority}</span>`:"",e.scenarioName?`<span class="badge badge-secondary" title="Scenario">${Utils.escapeHtml(e.scenarioName)}</span>`:"",window.showMetaTimestamps!==!1&&e.metadata?.created?`<span class="badge badge-secondary" title="Created">C: ${new Date(e.metadata.created).toLocaleString()}</span>`:"",window.showMetaTimestamps!==!1&&e.metadata?.edited?`<span class="badge badge-secondary" title="Edited">E: ${new Date(e.metadata.edited).toLocaleString()}</span>`:"",e.metadata?.source?`<span class="badge badge-info" title="Last edited from">${e.metadata.source.toUpperCase()}</span>`:""].filter(Boolean).join(" ")}};return UIComponents.createCard("mapping",r,t)},window.updateMappingsCounter=function(){const e=document.getElementById(SELECTORS.COUNTERS.MAPPINGS);if(e){const t=window.MappingsStore?window.MappingsStore.getAll():[];e.textContent=Array.isArray(t)?t.length:0}};function updateDataSourceIndicator(e){const t=document.getElementById("data-source-indicator");if(!t)return;let n="Source: direct",a="badge badge-secondary";switch(e){case"cache":n="Source: cache",a="badge badge-success";break;case"cache_rebuilding":n="Source: cache (rebuilding\u2026)",a="badge badge-success";break;case"synced":n="Source: synced",a="badge badge-success";break;case"demo":n="Source: demo data",a="badge badge-info";break;case"custom":n="Source: custom",a="badge badge-secondary";break;case"remote":n="Source: remote",a="badge badge-warning";break;case"remote_error":n="Source: remote (error/CORS)",a="badge badge-danger";break;default:n="Source: direct",a="badge badge-secondary"}t.textContent=n,t.className=a}function updateRequestsSourceIndicator(e){const t=document.getElementById("requests-source-indicator");if(!t)return;let n="Requests: direct",a="badge badge-secondary";switch(e){case"custom":n="Requests: custom",a="badge badge-secondary";break;case"demo":n="Requests: demo data",a="badge badge-info";break;case"remote":n="Requests: remote",a="badge badge-warning";break;case"remote_error":n="Requests: remote (error/CORS)",a="badge badge-danger";break;default:n="Requests: direct",a="badge badge-secondary"}t.textContent=n,t.className=a}function handleMappingItemChanged(e,t){const n=String(e||"");if(!(window.mappingPreviewState instanceof Set)||!window.mappingPreviewState.has(n))return;if(window.mappingPreviewToastState instanceof Map){const r=Date.now(),o=window.mappingPreviewToastState.get(n)||0;if(r-o<4e3)return;window.mappingPreviewToastState.set(n,r)}const a=t?.name||t?.metadata?.name||n;window.NotificationManager&&typeof window.NotificationManager.info=="function"&&window.NotificationManager.info(`Mapping "${a}" refreshed with latest data.`)}function handleMappingItemRemoved(e){const t=String(e||"");window.mappingPreviewState instanceof Set&&window.mappingPreviewState.delete(t),window.mappingPreviewToastState instanceof Map&&window.mappingPreviewToastState.delete(t),isOptimisticShadowMap(window.optimisticShadowMappings)&&window.optimisticShadowMappings.delete(t)}window.toggleMappingDetails=e=>UIComponents.toggleDetails(e,"mapping"),window.toggleRequestDetails=e=>UIComponents.toggleDetails(e,"request"),window.UIComponents=UIComponents,window.updateDataSourceIndicator=updateDataSourceIndicator,window.updateRequestsSourceIndicator=updateRequestsSourceIndicator;class PaginationManager{constructor(){this.itemsPerPage=20,this.currentPage=1,this.totalItems=0,this.totalPages=1,this.containerSelector=null}init(t,n=20){this.containerSelector=t,this.itemsPerPage=n,this.currentPage=1,Logger.info("PAGINATION","Pagination initialized:",{itemsPerPage:n,containerSelector:t})}updateState(t){this.totalItems=t,this.totalPages=Math.ceil(t/this.itemsPerPage),this.currentPage>this.totalPages&&(this.currentPage=1),Logger.debug("PAGINATION","Pagination state updated:",{totalItems:t,totalPages:this.totalPages,currentPage:this.currentPage,itemsPerPage:this.itemsPerPage})}getCurrentPageItems(t){if(!Array.isArray(t))return[];const n=(this.currentPage-1)*this.itemsPerPage,a=n+this.itemsPerPage;return t.slice(n,a)}goToPage(t){return t<1||t>this.totalPages?(Logger.warn("PAGINATION","Invalid page number:",t),!1):(this.currentPage=t,Logger.debug("PAGINATION",`Navigated to page ${t}/${this.totalPages}`),!0)}nextPage(){return this.currentPage<this.totalPages?(this.currentPage++,!0):!1}prevPage(){return this.currentPage>1?(this.currentPage--,!0):!1}renderControls(){if(this.totalPages<=1)return"";const t=(this.currentPage-1)*this.itemsPerPage+1,n=Math.min(this.currentPage*this.itemsPerPage,this.totalItems),a=this.generatePageNumbers();return`
            <div class="pagination-controls">
                <div class="pagination-info">
                    Showing ${t}-${n} of ${this.totalItems}
                </div>
                <div class="pagination-buttons">
                    <button class="pagination-btn"
                            data-action="prev-page"
                            ${this.currentPage===1?"disabled":""}
                            title="Previous page">
                        \u2039
                    </button>
                    ${a.map(r=>r==="..."?'<span class="pagination-ellipsis">...</span>':`<button class="pagination-btn ${r===this.currentPage?"active":""}"
                                        data-action="goto-page"
                                        data-page="${r}"
                                        ${r===this.currentPage?"disabled":""}>${r}</button>`).join("")}
                    <button class="pagination-btn"
                            data-action="next-page"
                            ${this.currentPage===this.totalPages?"disabled":""}
                            title="Next page">
                        \u203A
                    </button>
                </div>
            </div>
        `}generatePageNumbers(){const t=[];if(this.totalPages<=7)for(let a=1;a<=this.totalPages;a++)t.push(a);else{t.push(1);const a=Math.max(2,this.currentPage-2),r=Math.min(this.totalPages-1,this.currentPage+2);a>2&&t.push("...");for(let o=a;o<=r;o++)t.push(o);r<this.totalPages-1&&t.push("..."),t.push(this.totalPages)}return t}attachListeners(t){if(!this.containerSelector){Logger.warn("PAGINATION","Pagination container not set");return}const n=document.querySelector(this.containerSelector);if(!n){Logger.warn("PAGINATION","Pagination container not found:",this.containerSelector);return}n.addEventListener("click",a=>{const r=a.target.closest("[data-action]");if(!r)return;const o=r.dataset.action;let c=!1;if(o==="prev-page")c=this.prevPage();else if(o==="next-page")c=this.nextPage();else if(o==="goto-page"){const s=parseInt(r.dataset.page,10);c=this.goToPage(s)}c&&typeof t=="function"&&t(this.currentPage)}),Logger.info("PAGINATION","Pagination event listeners attached")}}window.PaginationManager=new PaginationManager,Logger.info("PAGINATION","Pagination module loaded");class EventDelegationManager{constructor(){this.initialized=!1,this.handlers=new Map,this.debounceTimers=new Map}debounce(t,n,a=100){this.debounceTimers.has(t)&&clearTimeout(this.debounceTimers.get(t));const r=setTimeout(()=>{n(),this.debounceTimers.delete(t)},a);this.debounceTimers.set(t,r)}init(){if(this.initialized){Logger.debug("EVENTS","EventDelegation already initialized");return}const t=document.getElementById(SELECTORS.LISTS.MAPPINGS);t&&(t.addEventListener("click",a=>this.handleMappingClick(a)),Logger.info("EVENTS","Event delegation initialized for mappings"));const n=document.getElementById(SELECTORS.LISTS.REQUESTS);n&&(n.addEventListener("click",a=>this.handleRequestClick(a)),Logger.info("EVENTS","Event delegation initialized for requests")),this.initialized=!0}handleMappingClick(t){const n=t.target.closest('[data-action="edit-mapping"]');if(n){t.stopPropagation();const p=n.dataset.mappingId;p&&typeof window.openEditModal=="function"&&window.openEditModal(p);return}const a=t.target.closest('[data-action="edit-external"]');if(a){t.stopPropagation();const p=a.dataset.mappingId;p&&typeof window.editMapping=="function"&&window.editMapping(p);return}const r=t.target.closest('[data-action="duplicate-mapping"]');if(r){t.stopPropagation();const p=r.dataset.mappingId;p&&typeof window.duplicateMapping=="function"&&window.duplicateMapping(p);return}const o=t.target.closest('[data-action="delete-mapping"]');if(o){t.stopPropagation();const p=o.dataset.mappingId;p&&typeof window.deleteMapping=="function"&&window.deleteMapping(p);return}const c=t.target.closest('[data-action="show-full-content"]');if(c){t.stopPropagation();const p=c.dataset.targetId;p&&typeof window.toggleFullContent=="function"&&window.toggleFullContent(p);return}if(t.target.closest(".mapping-actions, .request-actions")){t.stopPropagation();return}if(t.target.closest('[data-action="toggle-details"]')){const p=t.target.closest(".mapping-card");if(!p)return;const w=p.dataset.id;if(!w)return;this.handleToggleDetails(w,"mapping",p);return}}handleRequestClick(t){if(t.target.closest('[data-action="toggle-details"]')){const r=t.target.closest(".request-card");if(!r)return;const o=r.dataset.id;if(!o)return;this.handleToggleDetails(o,"request",r);return}const a=t.target.closest('[data-action="view-request"]');if(a){const r=a.dataset.requestId;r&&typeof window.viewRequestDetails=="function"&&window.viewRequestDetails(r);return}}handleToggleDetails(t,n,a){const r=`toggle-${n}-${t}`;this.debounce(r,()=>{const o=document.getElementById(`preview-${t}`),c=document.getElementById(`arrow-${t}`);if(!o)return;const s=o.style.display==="none";o.style.display=s?"block":"none",c&&(c.textContent=s?"\u25BC":"\u25B6"),a.classList.toggle("is-expanded",s),s&&!a.dataset.previewLoaded&&o.innerHTML.trim()===""&&setTimeout(()=>{this.loadPreviewContent(t,n,a,o),a.dataset.previewLoaded="true"},0),n==="mapping"&&window.mappingPreviewState instanceof Set&&(s?window.mappingPreviewState.add(String(t)):window.mappingPreviewState.delete(String(t))),typeof window.UIComponents?.setCardState=="function"&&window.UIComponents.setCardState(n,t,"is-expanded",s)},50)}loadPreviewContent(t,n,a,r){const o=`preview-${n}-${t}`;this.debounce(o,()=>{const c=performance.now();try{if(n==="mapping"){const s=window.MappingsStore.get(t)||window.mappingIndex?.get(t);if(!s){r.innerHTML='<div class="preview-section"><p>Mapping data not found</p></div>';return}const p=this.generateMappingPreview(s);r.innerHTML=p;const w=performance.now()-c;Logger.debug("EVENTS",`Lazy loaded preview for mapping: ${t} (${Math.round(w)}ms)`),w>100&&Logger.warn("EVENTS",`Slow preview load for mapping: ${t} (${Math.round(w)}ms)`)}else if(n==="request"){const s=window.allRequests?.find(E=>(E.id||E.requestId||E.request?.id)===t);if(!s){r.innerHTML='<div class="preview-section"><p>Request data not found</p></div>';return}const p=this.generateRequestPreview(s);r.innerHTML=p;const w=performance.now()-c;Logger.debug("EVENTS",`Lazy loaded preview for request: ${t} (${Math.round(w)}ms)`),w>100&&Logger.warn("EVENTS",`Slow preview load for request: ${t} (${Math.round(w)}ms)`)}}catch(s){Logger.error("EVENTS",`Failed to load preview for ${n} ${t}:`,s),r.innerHTML='<div class="preview-section"><p>Error loading preview</p></div>'}},50)}generateMappingPreview(t){if(typeof window.UIComponents?.createPreviewSection!="function")return'<div class="preview-section"><p>Preview generator not available</p></div>';const n=[],a=this._createSimplePreviewSection("Request",{Method:t.request?.method||"GET",URL:t.request?.url||t.request?.urlPattern||t.request?.urlPath||t.request?.urlPathPattern,Headers:t.request?.headers,Body:t.request?.bodyPatterns||t.request?.body,"Query Parameters":t.request?.queryParameters}),r=this._createSimplePreviewSection("Response",{Status:t.response?.status,Headers:t.response?.headers,Body:t.response?.jsonBody||t.response?.body,Delay:t.response?.fixedDelayMilliseconds?`${t.response.fixedDelayMilliseconds}ms`:null}),o=this._createSimplePreviewSection("Overview",{ID:t.id||t.uuid,Name:t.name||t.metadata?.name,Priority:t.priority,Persistent:t.persistent,Scenario:t.scenarioName,"Required State":t.requiredScenarioState,"New State":t.newScenarioState,Created:window.showMetaTimestamps!==!1&&t.metadata?.created?new Date(t.metadata.created).toLocaleString():null,Edited:window.showMetaTimestamps!==!1&&t.metadata?.edited?new Date(t.metadata.edited).toLocaleString():null,Source:t.metadata?.source?`Edited from ${t.metadata.source}`:null});return`${a}${r}${o}`}_createSimplePreviewSection(t,n){const a=Object.entries(n).filter(([o,c])=>c!=null);if(a.length===0)return"";const r=a.map(([o,c])=>{if(!c)return"";if(typeof c=="object"){const s=JSON.stringify(c);if(s.length>500){const p=s.substring(0,200)+"...";return`<div class="preview-value"><strong>${o}:</strong> <pre>${this._escapeHtml(p)}</pre></div>`}else return`<div class="preview-value"><strong>${o}:</strong> <pre>${this._escapeHtml(s)}</pre></div>`}else{const s=this._escapeHtml(String(c)),p=s.includes(`
`)?`<pre>${s}</pre>`:s;return`<div class="preview-value"><strong>${o}:</strong> ${p}</div>`}}).join("");return`<div class="preview-section"><h4>${t}</h4>${r}</div>`}_escapeHtml(t){return typeof t!="string"?String(t):t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}generateRequestPreview(t){if(typeof window.UIComponents?.createPreviewSection!="function")return'<div class="preview-section"><p>Preview generator not available</p></div>';const n=t.request||{},a=t.responseDefinition||{},r=[];return r.push(window.UIComponents.createPreviewSection("Request Details",{Method:n.method,URL:n.url,Headers:n.headers,Body:n.body,"Logged At":n.loggedDate?new Date(n.loggedDate).toLocaleString():null})),r.push(window.UIComponents.createPreviewSection("Response Details",{Status:a.status,Headers:a.headers,Body:a.body||a.jsonBody,Matched:t.wasMatched?"Yes":"No","Mapping ID":t.stubMapping?.id||t.stubMapping?.uuid})),r.join("")}destroy(){this.initialized=!1,Logger.info("EVENTS","Event delegation destroyed")}}const eventDelegation=new EventDelegationManager;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{eventDelegation.init()}):eventDelegation.init(),window.EventDelegation=eventDelegation,Logger.info("EVENTS","Event delegation module loaded"),window.fetchAndRenderRequests=async(e=null,t={})=>{const n=document.getElementById(SELECTORS.LISTS.REQUESTS),a=document.getElementById(SELECTORS.EMPTY.REQUESTS),r=document.getElementById(SELECTORS.LOADING.REQUESTS);if(!n||!a||!r)return Logger.error("REQUESTS","Required DOM elements not found for requests rendering"),!1;try{let o="direct";if(e===null){r.classList.remove("hidden"),n.style.display="none",a.classList.add("hidden");let c;try{c=await apiFetch(ENDPOINTS.REQUESTS)}catch(p){const w=p?.message||"",E=/^HTTP\s+404\b/.test(w),v=p?.name==="SyntaxError"||/Unexpected end of JSON input/i.test(w);if(E||v)Logger.warn("REQUESTS","Requests endpoint returned no payload; treating as empty list.",p),c={requests:[],__source:"empty"};else throw window.demoModeLastError=p,p}if(c&&c.__source){o=c.__source,o==="demo"&&markDemoModeActive("requests-fallback");try{delete c.__source}catch{}}(!c||typeof c!="object")&&(c={requests:[]});const s=Array.isArray(c.requests)?c.requests:[];window.originalRequests=s,refreshRequestTabSnapshot(),window.allRequests=[...s]}else{const c=t?.source;window.allRequests=Array.isArray(e)?[...e]:[],window.originalRequests=[...window.allRequests],refreshRequestTabSnapshot(),o=c||"custom",o==="demo"&&markDemoModeActive("manual-requests")}return r.classList.add("hidden"),window.allRequests.length===0?(a.classList.remove("hidden"),n.style.display="none",updateRequestsCounter(),!0):(a.classList.add("hidden"),n.style.display="block",window.invalidateElementCache(SELECTORS.LISTS.REQUESTS),renderList(n,window.allRequests,{renderItem:renderRequestMarkup,getKey:getRequestRenderKey,getSignature:getRequestRenderSignature}),updateRequestsCounter(),typeof updateRequestsSourceIndicator=="function"&&updateRequestsSourceIndicator(o),Logger.info("REQUESTS",`Requests render from: ${o} \u2014 ${window.allRequests.length} items`),!0)}catch(o){return Logger.error("REQUESTS","Error in fetchAndRenderRequests:",o),NotificationManager.error(`Failed to load requests: ${o.message}`),r.classList.add("hidden"),a.classList.remove("hidden"),n.style.display="none",!1}},window.renderRequestCard=function(e){if(!e)return Logger.warn("REQUESTS","Invalid request data:",e),"";const t=e.wasMatched!==!1,n=e.request?.clientIp||"Unknown",a={id:e.id||"",method:e.request?.method||"GET",url:e.request?.url||e.request?.urlPath||"N/A",status:e.responseDefinition?.status||(t?200:404),time:`${Utils.parseRequestTime(e.request.loggedDate)} <span class="request-ip">IP: ${Utils.escapeHtml(n)}</span>`,extras:{badges:`
                ${t?`<span class="badge badge-success">${Icons.render("check-circle",{className:"badge-icon"})}<span>Matched</span></span>`:`<span class="badge badge-danger">${Icons.render("x-circle",{className:"badge-icon"})}<span>Unmatched</span></span>`}
            `,preview:UIComponents.createPreviewSection(`${Icons.render("request-in",{className:"icon-inline"})} Request`,{Method:e.request?.method,URL:e.request?.url||e.request?.urlPath,"Client IP":n,Headers:e.request?.headers,Body:e.request?.body})+UIComponents.createPreviewSection(`${Icons.render("response-out",{className:"icon-inline"})} Response`,{Status:e.responseDefinition?.status,Matched:t?"Yes":"No",Headers:e.responseDefinition?.headers,Body:e.responseDefinition?.jsonBody||e.responseDefinition?.body})}};return UIComponents.createCard("request",a,[])};function updateRequestsCounter(){const e=document.getElementById(SELECTORS.COUNTERS.REQUESTS);e&&(e.textContent=Array.isArray(window.allRequests)?window.allRequests.length:0),updateRequestTabCounts()}window.updateRequestsCounter=updateRequestsCounter;function updateRequestTabCounts(){const e=window.requestTabTotals||computeRequestTabTotals(window.originalRequests),t={all:document.getElementById("requests-tab-all"),matched:document.getElementById("requests-tab-matched"),unmatched:document.getElementById("requests-tab-unmatched")};Object.entries(t).forEach(([n,a])=>{a&&(a.textContent=e?.[n]??0)})}function setActiveFilterTab(e){if(!e)return;const t=e.dataset.filterGroup;t&&document.querySelectorAll(`.filter-tab[data-filter-group="${t}"]`).forEach(n=>{n.classList.toggle("active",n===e)})}window.syncFilterTabsFromSelect=function(t,n){const a=(n||"").toString().toLowerCase(),r=document.querySelectorAll(`.filter-tab[data-filter-group="${t}"]`);let o=!1;r.forEach(c=>{const s=(c.dataset.filterValue||"").toLowerCase();s===a||!s&&!a?(c.classList.add("active"),o=!0):c.classList.remove("active")}),!o&&r.length>0&&r[0].classList.add("active")},window.handleRequestTabClick=(e,t)=>{setActiveFilterTab(e);const n=document.getElementById("req-filter-status");n&&(n.value=t||"",typeof applyRequestFilters=="function"&&applyRequestFilters())},window.initializeFilterTabs=()=>{const e=document.getElementById("filter-method");e&&(e.addEventListener("change",()=>{syncFilterTabsFromSelect("mapping",e.value)}),syncFilterTabsFromSelect("mapping",e.value));const t=document.getElementById("req-filter-status");t&&(t.addEventListener("change",()=>{syncFilterTabsFromSelect("requests",t.value)}),syncFilterTabsFromSelect("requests",t.value)),updateRequestTabCounts()},window.openEditModal=async e=>{const n=(r=>typeof r=="string"?r.trim():r==null?"":String(r).trim())(e);if(!n){NotificationManager.show("Invalid mapping identifier",NotificationManager.TYPES.ERROR);return}if(typeof UIComponents?.clearCardState=="function"&&UIComponents.clearCardState("mapping","is-editing"),n&&typeof UIComponents?.setCardState=="function"&&UIComponents.setCardState("mapping",n,"is-editing",!0),typeof window.showModal=="function")window.showModal("edit-mapping-modal");else{Logger.warn("REQUESTS","showModal function not found");return}typeof window.setMappingEditorBusyState=="function"&&window.setMappingEditorBusyState(!0,"Loading\u2026");const a=document.getElementById(SELECTORS.MODAL.TITLE);a&&(a.textContent="Edit Mapping"),Logger.debug("REQUESTS","openEditModal called for mapping identifier:",e);try{const r=await apiFetch(`/mappings/${encodeURIComponent(n)}`),o=r?.mapping||r;if(!o||!o.id)throw new Error("Invalid mapping response from server");if(Logger.debug("REQUESTS","Loaded mapping from server:",o),typeof window.populateEditMappingForm=="function")window.populateEditMappingForm(o);else{Logger.error("REQUESTS","populateEditMappingForm function not found!");return}addMappingToIndex(o),Logger.debug("REQUESTS","openEditModal completed successfully")}catch(r){Logger.error("REQUESTS","Failed to load mapping:",r),NotificationManager.show("Failed to load mapping: "+r.message,NotificationManager.TYPES.ERROR),typeof window.hideModal=="function"&&window.hideModal("edit-mapping-modal")}finally{typeof window.setMappingEditorBusyState=="function"&&window.setMappingEditorBusyState(!1)}},window.deleteMapping=async e=>{if(confirm("Delete this mapping?"))try{await apiFetch(`/mappings/${e}`,{method:"DELETE"}),NotificationManager.success("Mapping deleted!"),removeMappingFromIndex(e),updateOptimisticCache({id:e},"delete")}catch(t){t.message.includes("404")?(Logger.info("REQUESTS","Mapping already deleted from server (404), updating cache locally"),removeMappingFromIndex(e),updateOptimisticCache({id:e},"delete"),NotificationManager.success("Mapping was already deleted")):NotificationManager.error(`Delete failed: ${t.message}`)}},window.clearRequests=async()=>{if(confirm("Clear all requests?"))try{await apiFetch("/requests",{method:"DELETE"}),NotificationManager.success("Requests cleared!"),await fetchAndRenderRequests()}catch(e){NotificationManager.error(`Clear failed: ${e.message}`)}},Array.isArray(window.allScenarios)||(window.allScenarios=[]);let allScenarios=window.allScenarios,scenarioListHandlerAttached=!1;(!window.scenarioExpansionState||typeof window.scenarioExpansionState!="object")&&(window.scenarioExpansionState={});let scenarioExpansionState=window.scenarioExpansionState;(!window.scenarioUiState||typeof window.scenarioUiState!="object")&&(window.scenarioUiState={});const scenarioUiState=window.scenarioUiState;typeof scenarioUiState.searchTerm!="string"&&(scenarioUiState.searchTerm=""),scenarioUiState.selected instanceof Set||(scenarioUiState.selected=new Set),typeof scenarioUiState.bulkMenuOpen!="boolean"&&(scenarioUiState.bulkMenuOpen=!1),Array.isArray(scenarioUiState.lastVisibleSelectable)||(scenarioUiState.lastVisibleSelectable=[]);let scenarioToolbarHandlersAttached=!1;function renderIcon(e,t={}){return typeof window.Icons?.render=="function"?window.Icons.render(e,t):""}function downloadFile(e,t,n){const a=new Blob([t],{type:n}),r=URL.createObjectURL(a),o=document.createElement("a");o.href=r,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(r),0)}function safeDecode(e){if(typeof e!="string")return"";const t=e.trim();if(!t)return"";if(!/%[0-9a-fA-F]{2}/.test(t))return t;try{return decodeURIComponent(t)}catch(n){return Logger.warn("SCENARIOS","safeDecode failed, returning original value",{value:e,error:n}),t}}function normalizeScenarioLink(e){if(typeof e!="string")return"";let t=e.trim();if(!t)return"";if(/^https?:\/\//i.test(t))try{t=new URL(t).pathname}catch(a){Logger.warn("SCENARIOS","normalizeScenarioLink failed to parse absolute URL",{link:e,error:a})}const n="/__admin";return t.startsWith(n)&&(t=t.slice(n.length)||"/"),t=t.replace(/^\/+/,""),t?`/${t}`:""}function normalizeScenario(e,t){if(!e||typeof e!="object")return null;const n=typeof e.id=="string"?e.id:"",a=typeof e.name=="string"?e.name:"",r=safeDecode(n),o=safeDecode(a),c=r||o||n||a||"",s=o||r||a||n||`Scenario ${t+1}`,p=safeDecode(e.state)||e.state||"Started",w=Array.isArray(e.possibleStates)?e.possibleStates.map(N=>safeDecode(N)||N).filter(Boolean):[],E=Array.isArray(e.mappings)?e.mappings.map(N=>!N||typeof N!="object"?N:{...N,requiredScenarioState:safeDecode(N.requiredScenarioState)||N.requiredScenarioState||"",newScenarioState:safeDecode(N.newScenarioState)||N.newScenarioState||""}):[],v=normalizeScenarioLink(e.stateEndpoint||e?._links?.["update-state"]?.href||e?._links?.updateState?.href||e?._links?.state?.href),C=normalizeScenarioLink(e.resetEndpoint||e?._links?.["reset-state"]?.href||e?._links?.resetState?.href||e?._links?.reset?.href);return{...e,id:c||r||n,name:s,displayName:s,identifier:c,originalId:n,originalName:a||o,decodedId:r,decodedName:o,state:p,possibleStates:w,mappings:E,stateEndpoint:v,resetEndpoint:C}}function normalizeScenarioList(e){return Array.isArray(e)?e.map((t,n)=>normalizeScenario(t,n)).filter(Boolean):[]}function getScenarioByIdentifier(e){if(typeof e!="string")return null;const t=e.trim();return t&&(Array.isArray(allScenarios)?allScenarios:[]).find(a=>[a?.identifier,a?.id,a?.name,a?.decodedId,a?.decodedName,a?.originalId,a?.originalName].some(o=>typeof o!="string"?!1:o.trim()===t))||null}function resolveScenarioTarget(e){const t=typeof e=="string"?e.trim():"",n=t?getScenarioByIdentifier(t):null,a=n?.identifier||n?.decodedId||n?.decodedName||t,r=safeDecode(a)||a,o=n?.displayName||n?.decodedName||n?.name||n?.decodedId||n?.id||safeDecode(t)||t,c=typeof n?.stateEndpoint=="string"?n.stateEndpoint:"",s=typeof n?.resetEndpoint=="string"?n.resetEndpoint:"",p=typeof window.buildScenarioStateEndpoint=="function"?window.buildScenarioStateEndpoint:C=>`${ENDPOINTS.SCENARIOS}/${encodeURIComponent(C)}/state`,w=c||(r?p(r):"");return{rawCandidate:t,targetScenario:n,endpointIdentifier:r,displayName:o,stateEndpoint:w,resetEndpoint:s||w,resetMethod:s?"POST":"PUT"}}function setScenariosLoading(e){const t=document.getElementById("scenarios-loading");if(t&&t.classList.toggle("hidden",!e),e){const n=document.getElementById(SELECTORS.LISTS.SCENARIOS);n&&(n.style.display="none")}}window.loadScenarios=async()=>{const e=document.getElementById("scenarios-empty");e&&e.classList.add("hidden"),setScenariosLoading(!0);try{const t=await apiFetch(ENDPOINTS.SCENARIOS),n=Array.isArray(t?.scenarios)?t.scenarios:[];allScenarios=normalizeScenarioList(n),window.allScenarios=allScenarios}catch(t){allScenarios=[],window.allScenarios=allScenarios,Logger.error("SCENARIOS","Load scenarios error:",t),NotificationManager.error(`Failed to load scenarios: ${t.message}`)}finally{setScenariosLoading(!1),renderScenarios()}},window.refreshScenarios=async()=>{await TabManager.refresh("scenarios")},window.resetAllScenarios=async()=>{if(confirm("Reset all scenarios to the initial state?")){setScenariosLoading(!0);try{await apiFetch(ENDPOINTS.SCENARIOS_RESET,{method:"POST"}),NotificationManager.success("All scenarios have been reset!"),await loadScenarios()}catch(e){NotificationManager.error(`Scenario reset failed: ${e.message}`),setScenariosLoading(!1)}}};function updateScenarioStateSuggestions(e){const t=document.getElementById("scenario-state-options"),n=document.getElementById("scenario-state");if(!t)return;const a=Array.isArray(allScenarios)?allScenarios:[],r=getScenarioByIdentifier(e),o=new Set,c=w=>{if(typeof w!="string")return;const E=w.trim();E&&o.add(E)};c("Started");const s=w=>{w&&(c(w.state),(w.possibleStates||[]).forEach(c),(w.mappings||[]).forEach(E=>{c(E?.requiredScenarioState),c(E?.newScenarioState)}))};r&&s(r),o.size===0&&a.forEach(s);const p=Array.from(o).sort((w,E)=>w.localeCompare(E));t.innerHTML=p.map(w=>`
        <option value="${escapeHtml(w)}"></option>
    `).join(""),n&&(p.length>0?n.setAttribute("placeholder",`Enter state (e.g. ${p[0]})`):n.setAttribute("placeholder","Enter state name"))}window.setScenarioState=async(e,t,n={})=>{const a=document.getElementById("scenario-select"),r=document.getElementById("scenario-state"),o=typeof e=="string"?e:"",c=typeof t=="string"?t.trim():"",s=n&&typeof n=="object"?n:{},p=s.refresh!==!1,w=s.silent===!0,E=s.manageLoading!==!1,v=s.syncForm!==!1;let C=o;!C&&a&&(C=a.value||"");const N=resolveScenarioTarget(C),J=N.endpointIdentifier,G=N.displayName,b=c||r?.value?.trim()||"";if(!J||!J.trim()||!b)return w||NotificationManager.warning("Please select scenario and enter state"),!1;const y=N.stateEndpoint;if(!y)return w||NotificationManager.error("Unable to determine the scenario state endpoint."),!1;if(N.targetScenario&&Array.isArray(N.targetScenario.possibleStates)&&N.targetScenario.possibleStates.length===0)return w||NotificationManager.warning(`Scenario "${G}" does not expose any states to switch to.`),!1;if(v)if(a){const q=N.targetScenario?.identifier||N.targetScenario?.decodedId||N.targetScenario?.decodedName||J;a.value=q,updateScenarioStateSuggestions(q)}else updateScenarioStateSuggestions(J);E&&setScenariosLoading(!0);const k=!!N.targetScenario;try{return await apiFetch(y,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:b})}),w||NotificationManager.success(`Scenario "${G}" switched to state "${b}"`),v&&!c&&r&&(r.value=""),v&&updateScenarioStateSuggestions(J),p?await loadScenarios():E&&setScenariosLoading(!1),!0}catch(q){Logger.error("SCENARIOS","Change scenario state error:",q);const X=/HTTP\s+404/.test(q?.message||""),he=/does not support state/i.test(q?.message||"");return w||(X&&!k?NotificationManager.error(`Scenario "${G}" was not found on the server.`):he?NotificationManager.error(`Scenario "${G}" does not allow state changes.`):NotificationManager.error(`Scenario state change failed: ${q.message}`)),E&&setScenariosLoading(!1),!1}};async function resetScenarioState(e,t={}){const n=t&&typeof t=="object"?t:{},a=n.refresh!==!1,r=n.silent===!0,o=n.manageLoading!==!1;if(typeof e!="string"||!e.trim())return r||NotificationManager.warning("Unable to determine which scenario to reset."),!1;const c=resolveScenarioTarget(e),s=c.resetEndpoint,p=c.resetMethod,w=c.displayName;if(!s)return r||NotificationManager.error("Unable to determine the scenario reset endpoint."),!1;o&&setScenariosLoading(!0);try{return await apiFetch(s,{method:p}),r||NotificationManager.success(`Scenario "${w}" has been reset to its initial state.`),a?await loadScenarios():o&&setScenariosLoading(!1),!0}catch(E){if(p==="PUT"&&c.stateEndpoint)try{return await apiFetch(c.stateEndpoint,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"Started"})}),r||NotificationManager.success(`Scenario "${w}" has been reset to its initial state.`),a?await loadScenarios():o&&setScenariosLoading(!1),!0}catch(v){return Logger.error("SCENARIOS","Reset scenario state error:",v),r||NotificationManager.error(`Scenario reset failed: ${v.message}`),o&&setScenariosLoading(!1),!1}return Logger.error("SCENARIOS","Reset scenario state error:",E),r||NotificationManager.error(`Scenario reset failed: ${E.message}`),o&&setScenariosLoading(!1),!1}}function normalizeSearchTerm(e){return typeof e!="string"?"":e.trim().toLowerCase()}function scenarioMatchesSearch(e,t){return t?!e||typeof e!="object"?!1:[e.displayName,e.name,e.identifier,e.id,e.state,e.description].filter(r=>typeof r=="string"&&r.trim()).map(r=>r.toLowerCase()).some(r=>r.includes(t))?!0:(Array.isArray(e.mappings)?e.mappings:[]).some(r=>!r||typeof r!="object"?!1:[r.name,r.id,r.uuid,r.stubId,r.stubMappingId,r.requiredScenarioState,r.newScenarioState,r.request?.method,r.request?.url,r.request?.urlPattern,r.request?.urlPath,r.request?.urlPathPattern].filter(c=>typeof c=="string"&&c.trim()).map(c=>c.toLowerCase()).some(c=>c.includes(t))):!0}function setScenarioBulkMenuOpen(e){scenarioUiState.bulkMenuOpen=!!e;const t=document.getElementById("scenario-bulk-menu");t&&(t.classList.toggle("is-open",scenarioUiState.bulkMenuOpen),t.setAttribute("aria-hidden",scenarioUiState.bulkMenuOpen?"false":"true"))}function updateScenarioHeaderUI(e,t){const n=document.getElementById("scenario-stats");if(n){const w=Array.isArray(e)?e.reduce((v,C)=>v+(Array.isArray(C?.mappings)?C.mappings.length:0),0):0,E=Array.isArray(e)?e.length:0;n.textContent=`${E}/${t} scenarios \u2022 ${w} mappings`}const a=document.getElementById("scenario-select-all-row"),r=document.getElementById("scenario-select-all-btn"),o=Array.isArray(e)?e.map(w=>{const E=typeof w?.identifier=="string"?w.identifier:typeof w?.decodedId=="string"?w.decodedId:typeof w?.id=="string"?w.id:"";return(typeof E=="string"?E.trim():"")||""}).filter(Boolean):[];scenarioUiState.lastVisibleSelectable=o;const c=scenarioUiState.selected instanceof Set?scenarioUiState.selected.size:0,s=document.getElementById("scenario-bulk-wrap"),p=document.getElementById("scenario-bulk-count");if(p&&(p.textContent=String(c)),s&&s.classList.toggle("is-hidden",c===0),a&&(a.style.display=o.length>0?"":"none"),r){const w=o.length>0&&o.every(E=>scenarioUiState.selected.has(E));r.classList.toggle("is-selected",w),r.setAttribute("aria-checked",w?"true":"false")}c===0&&scenarioUiState.bulkMenuOpen&&setScenarioBulkMenuOpen(!1)}async function bulkResetSelectedScenarios(){const e=scenarioUiState.selected instanceof Set?Array.from(scenarioUiState.selected):[];if(e.length===0||!confirm(`Reset ${e.length} selected scenarios to their initial state?`))return;setScenarioBulkMenuOpen(!1),setScenariosLoading(!0);const t=[];for(const n of e)try{const a=resolveScenarioTarget(n);if(!a.resetEndpoint){t.push({id:n,name:a.displayName||n,error:"No reset endpoint resolved"});continue}try{await apiFetch(a.resetEndpoint,{method:a.resetMethod})}catch(r){if(a.resetMethod==="PUT"&&a.stateEndpoint)await apiFetch(a.stateEndpoint,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"Started"})});else throw r}}catch(a){t.push({id:n,name:n,error:a?.message||String(a)})}if(t.length>0){scenarioUiState.selected=new Set(t.map(a=>a.id).filter(Boolean));const n=t.slice(0,3).map(a=>a.name||a.id).join(", ");NotificationManager.warning(`Bulk reset: ${t.length} failed${n?` (e.g. ${n})`:""}.`)}else scenarioUiState.selected.clear(),NotificationManager.success("Bulk reset complete.");await loadScenarios()}async function bulkSetScenarioState(){const e=scenarioUiState.selected instanceof Set?Array.from(scenarioUiState.selected):[];if(e.length===0)return;const t=e.length===1&&getScenarioByIdentifier(e[0])?.state||"Started",n=prompt(`Set state for ${e.length} selected scenarios:`,t);if(!n||!n.trim())return;setScenarioBulkMenuOpen(!1),setScenariosLoading(!0);const a=[],r=n.trim();for(const o of e)try{const c=resolveScenarioTarget(o);if(!c.stateEndpoint){a.push({id:o,name:c.displayName||o,error:"No state endpoint resolved"});continue}await apiFetch(c.stateEndpoint,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:r})})}catch(c){a.push({id:o,name:o,error:c?.message||String(c)})}if(a.length>0){scenarioUiState.selected=new Set(a.map(c=>c.id).filter(Boolean));const o=a.slice(0,3).map(c=>c.name||c.id).join(", ");NotificationManager.warning(`Bulk state update: ${a.length} failed${o?` (e.g. ${o})`:""}.`)}else scenarioUiState.selected.clear(),NotificationManager.success(`Bulk state updated: "${r}"`);await loadScenarios()}async function fetchFullMappingById(e){const t=(e??"").toString().trim();if(!t)return null;if(typeof window.getMappingById=="function")try{const o=await window.getMappingById(t);if(o&&typeof o=="object")return o}catch(o){Logger.warn("SCENARIOS","getMappingById failed, falling back to direct fetch",{mappingId:t,error:o})}const n=`/mappings/${encodeURIComponent(t)}`,a=await apiFetch(n),r=a&&typeof a=="object"&&a.mapping?a.mapping:a;return r&&typeof r=="object"?r:null}async function bulkExportSelectedMappings(){const e=scenarioUiState.selected instanceof Set?Array.from(scenarioUiState.selected):[];if(e.length===0)return;setScenarioBulkMenuOpen(!1);const t=[],n=new Set;if(e.forEach(s=>{const p=getScenarioByIdentifier(s);(Array.isArray(p?.mappings)?p.mappings:[]).forEach(E=>{const v=(E?.id||E?.uuid||E?.stubMappingId||E?.stubId||E?.mappingId||"").toString().trim();!v||n.has(v)||(n.add(v),t.push(v))})}),t.length===0){NotificationManager.warning("No mappings found for selected scenarios.");return}setScenariosLoading(!0);const a=[],r=[];for(const s of t)try{const p=await fetchFullMappingById(s);if(!p){r.push({id:s,error:"Empty mapping payload"});continue}a.push(p)}catch(p){r.push({id:s,error:p?.message||String(p)})}const c=`wiremock-mappings-${new Date().toISOString().replace(/[:.]/g,"-")}.json`;if(downloadFile(c,`${JSON.stringify({mappings:a},null,2)}
`,"application/json"),r.length>0){const s=r.slice(0,3).map(p=>p.id).join(", ");NotificationManager.warning(`Exported ${a.length}/${t.length} mapping(s). Failed: ${r.length}${s?` (e.g. ${s})`:""}.`)}else NotificationManager.success(`Exported ${a.length} mapping(s).`);setScenariosLoading(!1)}function clearScenarioSelection(){scenarioUiState.selected instanceof Set&&scenarioUiState.selected.clear(),setScenarioBulkMenuOpen(!1),renderScenarios()}function toggleSelectAllVisibleScenarios(){const e=Array.isArray(scenarioUiState.lastVisibleSelectable)?scenarioUiState.lastVisibleSelectable:[];scenarioUiState.selected instanceof Set||(scenarioUiState.selected=new Set),e.length>0&&e.every(n=>scenarioUiState.selected.has(n))?e.forEach(n=>scenarioUiState.selected.delete(n)):e.forEach(n=>scenarioUiState.selected.add(n)),renderScenarios()}window.renderScenarios=()=>{const e=document.getElementById(SELECTORS.LISTS.SCENARIOS),t=document.getElementById("scenarios-empty"),n=document.getElementById("scenarios-count"),a=document.getElementById("scenario-select"),r=document.getElementById("scenario-state-options"),o=document.getElementById("scenario-search"),c=document.getElementById("scenario-bulk-btn"),s=document.getElementById("scenario-bulk-reset"),p=document.getElementById("scenario-bulk-set-state"),w=document.getElementById("scenario-bulk-export"),E=document.getElementById("scenario-bulk-clear"),v=document.getElementById("scenario-select-all-btn");if(!e)return;n&&(n.textContent=Array.isArray(allScenarios)?allScenarios.length:0);const C=Array.isArray(allScenarios)?allScenarios:[];if(C.length===0){e.innerHTML="",e.style.display="none",t&&t.classList.remove("hidden"),a&&(a.innerHTML='<option value="">Select Scenario</option>'),r&&(r.innerHTML=""),updateScenarioStateSuggestions(""),updateScenarioHeaderUI([],0);return}if(t&&t.classList.add("hidden"),scenarioUiState.selected instanceof Set&&scenarioUiState.selected.size>0){const b=new Set(C.map(y=>{const k=typeof y?.identifier=="string"?y.identifier:typeof y?.decodedId=="string"?y.decodedId:typeof y?.id=="string"?y.id:"";return typeof k=="string"?k.trim():""}).filter(Boolean));for(const y of Array.from(scenarioUiState.selected))b.has(y)||scenarioUiState.selected.delete(y)}o&&(o.value||"")!==scenarioUiState.searchTerm&&(o.value=scenarioUiState.searchTerm),scenarioToolbarHandlersAttached||(o&&o.addEventListener("input",b=>{scenarioUiState.searchTerm=typeof b.target?.value=="string"?b.target.value:"",renderScenarios()}),c&&c.addEventListener("click",b=>{b.stopPropagation(),setScenarioBulkMenuOpen(!scenarioUiState.bulkMenuOpen)}),s&&s.addEventListener("click",()=>{bulkResetSelectedScenarios()}),p&&p.addEventListener("click",()=>{bulkSetScenarioState()}),w&&w.addEventListener("click",()=>{bulkExportSelectedMappings()}),E&&E.addEventListener("click",clearScenarioSelection),v&&v.addEventListener("click",toggleSelectAllVisibleScenarios),document.addEventListener("click",b=>{const y=document.getElementById("scenario-bulk-wrap");y&&scenarioUiState.bulkMenuOpen&&(typeof y.contains=="function"&&y.contains(b.target)||setScenarioBulkMenuOpen(!1))}),document.addEventListener("keydown",b=>{scenarioUiState.bulkMenuOpen&&b.key==="Escape"&&setScenarioBulkMenuOpen(!1)}),scenarioToolbarHandlersAttached=!0);const N=a?.value||"";if(a){const b=['<option value="">Select Scenario</option>'].concat(C.map(y=>{const k=typeof y?.identifier=="string"?y.identifier:typeof y?.decodedId=="string"?y.decodedId:typeof y?.id=="string"?y.id:"",q=typeof y?.displayName=="string"?y.displayName:typeof y?.name=="string"?y.name:typeof y?.decodedName=="string"?y.decodedName:"Unnamed scenario";return`
                <option value="${escapeHtml(k)}">${escapeHtml(q)}</option>
            `}));if(a.innerHTML=b.join(""),N){const y=getScenarioByIdentifier(N);y&&(a.value=y.identifier||y.decodedId||y.decodedName||y.id||y.name||"")}}r&&updateScenarioStateSuggestions(a?.value||N||""),a&&!a.dataset.scenarioHandlerAttached&&(a.addEventListener("change",b=>{updateScenarioStateSuggestions(b.target.value)}),a.dataset.scenarioHandlerAttached="1"),e.style.display="";const J=normalizeSearchTerm(scenarioUiState.searchTerm),G=C.filter(b=>scenarioMatchesSearch(b,J));if(G.length===0){if(e.innerHTML="",e.style.display="none",t){t.classList.remove("hidden");const b=typeof t.querySelector=="function"?t.querySelector("h3"):null,y=typeof t.querySelector=="function"?t.querySelector("p"):null;b&&(b.textContent="No scenarios match your filter"),y&&(y.textContent="Try clearing the filter or searching by mapping URL/state.")}updateScenarioHeaderUI([],C.length);return}if(t){const b=typeof t.querySelector=="function"?t.querySelector("h3"):null,y=typeof t.querySelector=="function"?t.querySelector("p"):null;b&&(b.textContent="No scenarios found"),y&&(y.textContent="Create mappings with scenarios to manage state here."),t.classList.add("hidden")}updateScenarioHeaderUI(G,C.length),e.innerHTML=G.map((b,y)=>{const k=typeof b?.identifier=="string"?b.identifier:typeof b?.decodedId=="string"?b.decodedId:typeof b?.id=="string"?b.id:"",q=escapeHtml(k),X=typeof b?.displayName=="string"?b.displayName:typeof b?.name=="string"?b.name:typeof b?.decodedName=="string"?b.decodedName:"Unnamed scenario",he=escapeHtml(X),ce=escapeHtml(b.state||"Started"),Me=Array.isArray(b.possibleStates)?b.possibleStates.filter(Boolean):[],Fe=k||b?.decodedId||b?.decodedName||b?.id||b?.name||`scenario-${y}`,F=typeof Fe=="string"&&Fe.trim()?Fe.trim():`scenario-${y}`,B=scenarioExpansionState[F]===!0,P=escapeHtml(F),D=typeof k=="string"&&k.trim().length>0,oe=D?k.trim():"",j=oe&&scenarioUiState.selected instanceof Set?scenarioUiState.selected.has(oe):!1,de=D?`
            <button
                type="button"
                class="scenario-select-btn${j?" is-selected":""}"
                data-scenario-action="select"
                data-scenario="${q}"
                role="checkbox"
                aria-checked="${j?"true":"false"}"
                aria-label="Select scenario ${he}"
                title="Select"
            >
                <span class="scenario-select-box" aria-hidden="true"></span>
            </button>
        `:`
            <span style="width:18px;height:18px;display:inline-block;"></span>
        `,De=new Set,Ee=[],xe=ne=>{if(typeof ne!="string")return;const Te=ne.trim();!Te||De.has(Te)||(De.add(Te),Ee.push(Te))};xe(b.state||""),Me.forEach(xe);const _e=Ee.map(ne=>{const Te=escapeHtml(ne),Re=ne===b.state,je="scenario-state-pill";return Re?`<span class="${je} is-active" data-current="true">${Te}</span>`:D?`
                <button
                    type="button"
                    class="${je}"
                    data-scenario-action="transition"
                    data-scenario="${q}"
                    data-state="${Te}"
                >
                    ${Te}
                </button>
            `:`<span class="${je}">${Te}</span>`}).join(""),it=D?`
            <button
                type="button"
                class="scenario-reset-btn"
                data-scenario-action="reset"
                data-scenario="${q}"
            >
                ${renderIcon("refresh",{className:"icon-inline"})} Reset
            </button>
        `:"",Ge=_e||it?`
            <div class="scenario-summary-controls">
                <div class="scenario-state-pill-list">${_e}</div>
                ${it}
            </div>
        `:"",bt=b.description?`
            <div class="scenario-info">
                <div class="scenario-description">${escapeHtml(b.description)}</div>
            </div>
        `:"",at=Array.isArray(b.mappings)?b.mappings:[],ht=at.length?`
            <ul class="scenario-mapping-list">
                ${at.map(ne=>{const Te=ne?.id||ne?.uuid||ne?.stubMappingId||ne?.stubId||ne?.mappingId||"",Re=Te?escapeHtml(Te):"",je=escapeHtml(ne?.name||Te||"Unnamed mapping"),Je=ne?.request?.method||ne?.method||ne?.requestMethod||"",ot=ne?.request?.urlPattern||ne?.request?.urlPath||ne?.request?.url||ne?.url||ne?.requestUrl||"",Ye=Je?`<span class="scenario-mapping-method">${escapeHtml(Je)}</span>`:"",be=ot?`<span class="scenario-mapping-url">${escapeHtml(ot)}</span>`:"",Oe=Ye||be?`
                        <div class="scenario-mapping-meta">
                            ${[Ye,be].filter(Boolean).join(" \xB7 ")}
                        </div>
                    `:"",Se=ne?.requiredScenarioState||ne?.requiredState||"",Le=ne?.newScenarioState||ne?.newState||"",We=[Se?`<span class="badge badge-warning" title="Required scenario state">Requires: ${escapeHtml(Se)}</span>`:"",Le?`<span class="badge badge-info" title="Next scenario state">\u2192 ${escapeHtml(Le)}</span>`:""].filter(Boolean).join(" "),Qe=We?`
                        <div class="scenario-mapping-states">${We}</div>
                    `:"",st=renderIcon("pencil",{className:"action-icon"}),ut=renderIcon("clipboard",{className:"action-icon"}),pt=renderIcon("trash",{className:"action-icon"}),Ue=Te?`
                        <div class="scenario-mapping-actions">
                            <button
                                class="btn btn-sm btn-secondary"
                                data-scenario-action="edit-mapping"
                                data-mapping-id="${Re}"
                                title="Edit mapping"
                            >
                                ${st||""}<span>Edit</span>
                            </button>
                            <button
                                class="btn btn-sm btn-secondary"
                                data-scenario-action="duplicate-mapping"
                                data-mapping-id="${Re}"
                                title="Duplicate mapping"
                            >
                                ${ut||""}<span>Duplicate</span>
                            </button>
                            <button
                                class="btn btn-sm btn-danger"
                                data-scenario-action="delete-mapping"
                                data-mapping-id="${Re}"
                                title="Delete mapping"
                            >
                                ${pt||""}<span>Delete</span>
                            </button>
                        </div>
                    `:"";return`
                        <li class="scenario-mapping-item">
                            <div class="scenario-mapping-name">${je}</div>
                            ${Oe}
                            ${Qe}
                            ${Ue}
                        </li>
                    `}).join("")}
            </ul>
        `:`
            <div class="scenario-mapping-empty">No stub mappings are bound to this scenario yet.</div>
        `,dt=`<span class="collapse-arrow" aria-hidden="true">${B?"\u25BC":"\u25B6"}</span>`,rt=`${B?"Collapse":"Expand"} scenario ${X}`;return`
            <div class="scenario-item ${B?"expanded":"collapsed"}${j?" is-selected":""}" data-scenario="${q}" data-scenario-key="${P}">
                <div class="scenario-summary">
                    ${de}
                    <button
                        type="button"
                        class="scenario-toggle-btn"
                        data-scenario-action="toggle"
                        data-scenario-key="${P}"
                        aria-expanded="${B?"true":"false"}"
                        aria-label="${escapeHtml(rt)}"
                    >
                        ${dt}
                    </button>
                    <div class="scenario-summary-main">
                        <div class="scenario-summary-header">
                            <div class="scenario-name">${he}</div>
                            <div class="scenario-state">State: ${ce}</div>
                        </div>
                        ${Ge}
                    </div>
                </div>
                <div class="scenario-body">
                    ${bt}
                    <div class="scenario-mappings">
                        <div class="scenario-section-title">Stub mappings</div>
                        ${ht}
                    </div>
                </div>
            </div>
        `}).join(""),scenarioListHandlerAttached||(e.addEventListener("click",async b=>{const y=b.target.closest("[data-scenario-action]");if(!y||typeof e.contains=="function"&&!e.contains(y))return;const k=y.dataset.scenarioAction;if(k==="toggle"){b.preventDefault();const q=y.dataset.scenarioKey||y.dataset.scenario||"";if(!q.trim())return;const X=scenarioExpansionState[q]===!0;scenarioExpansionState[q]=!X,renderScenarios()}else if(k==="select"){b.preventDefault();const q=y.dataset.scenario||"",X=typeof q=="string"?q.trim():"";if(!X)return;scenarioUiState.selected instanceof Set||(scenarioUiState.selected=new Set),scenarioUiState.selected.has(X)?scenarioUiState.selected.delete(X):scenarioUiState.selected.add(X),renderScenarios()}else if(k==="transition"){const q=y.dataset.scenario||"",X=y.dataset.state||"";if(!q.trim()||!X.trim())return;y.disabled=!0;try{await setScenarioState(q,X)}finally{y.disabled=!1}}else if(k==="reset"){const q=y.dataset.scenario||"";if(!q.trim())return;y.disabled=!0;try{await resetScenarioState(q)}finally{y.disabled=!1}}else if(k==="edit-mapping"){const q=y.dataset.mappingId;q&&typeof window.openEditModal=="function"&&window.openEditModal(q)}else if(k==="duplicate-mapping"){const q=y.dataset.mappingId;if(q&&typeof window.duplicateMapping=="function"){y.disabled=!0;try{await window.duplicateMapping(q),await loadScenarios()}finally{y.disabled=!1}}}else if(k==="delete-mapping"){const q=y.dataset.mappingId;if(q&&typeof window.deleteMapping=="function"){y.disabled=!0;try{await window.deleteMapping(q),await loadScenarios()}finally{y.disabled=!1}}}}),scenarioListHandlerAttached=!0)},window.startRecording=async(e={})=>{try{const n={...{targetBaseUrl:"https://example.com",filters:{urlPathPatterns:[".*"],method:"ANY",headers:{}},captureHeaders:{},requestBodyPattern:{},persist:!0,repeatsAsScenarios:!1,transformers:["response-template"],transformerParameters:{}},...e};await apiFetch(ENDPOINTS.RECORDINGS_START,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),NotificationManager.success("Recording started!"),window.isRecording=!0;const a=document.getElementById(SELECTORS.RECORDING.INDICATOR);a&&(a.style.display="block")}catch(t){Logger.error("RECORDING","Start recording error:",t),NotificationManager.error(`Failed to start recording: ${t.message}`)}},window.stopRecording=async()=>{try{const e=await apiFetch(ENDPOINTS.RECORDINGS_STOP,{method:"POST"});window.isRecording=!1,window.recordedCount=0;const t=document.getElementById(SELECTORS.RECORDING.INDICATOR);t&&(t.style.display="none");const n=e.mappings?e.mappings.length:0;NotificationManager.success(`Recording stopped! Captured ${n} mappings`);const a=window.MappingsStore.getAll();return await fetchAndRenderMappings(a),e.mappings||[]}catch(e){return Logger.error("RECORDING","Stop recording error:",e),NotificationManager.error(`Failed to stop recording: ${e.message}`),[]}},window.getRecordingStatus=async()=>{try{return(await apiFetch(ENDPOINTS.RECORDINGS_STATUS)).status||"Unknown"}catch(e){return Logger.error("RECORDING","Recording status error:",e),"Unknown"}},window.takeRecordingSnapshot=async(e={})=>{try{const t=await apiFetch(ENDPOINTS.RECORDINGS_SNAPSHOT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=t.mappings?t.mappings.length:0;return NotificationManager.success(`Snapshot created! Captured ${n} mappings`),t.mappings||[]}catch(t){return Logger.error("RECORDING","Recording snapshot error:",t),NotificationManager.error(`Snapshot failed: ${t.message}`),[]}},window.clearRecordings=async()=>{if(confirm("Clear all recorded requests?"))try{await apiFetch(ENDPOINTS.REQUESTS,{method:"DELETE"}),window.recordedCount=0;const e=document.getElementById("recordings-list");e&&(e.innerHTML=""),typeof fetchAndRenderRequests=="function"&&await fetchAndRenderRequests(),NotificationManager.success("Recording log cleared.")}catch(e){Logger.error("RECORDING","Clear recordings error:",e),NotificationManager.error(`Failed to clear recordings: ${e.message}`)}},window.refreshRequests=async()=>{await fetchAndRenderRequests(),(document.getElementById(SELECTORS.REQUEST_FILTERS.METHOD)?.value||document.getElementById(SELECTORS.REQUEST_FILTERS.URL)?.value||document.getElementById(SELECTORS.REQUEST_FILTERS.STATUS)?.value||document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_FROM)?.value||document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_TO)?.value)&&FilterManager.applyRequestFilters()},window.applyQuickTimeFilter=()=>{const e=new Date,t=new Date(e.getTime()-1440*60*1e3),n=document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_FROM),a=document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_TO);n&&(n.value=Utils.formatDateTime(t)),a&&(a.value=Utils.formatDateTime(e)),FilterManager.applyRequestFilters()},window.cleanupPendingDeletions=()=>{for(const[e,t]of window.deletionTimeouts)clearTimeout(t);window.deletionTimeouts.clear(),window.pendingDeletedIds.clear()},window.addEventListener("beforeunload",window.cleanupPendingDeletions),window.toggleElementById=e=>document.getElementById(e)?.classList.toggle("hidden"),window.togglePreview=e=>window.toggleElementById(`preview-${e}`),window.toggleRequestPreview=e=>window.toggleElementById(`request-preview-${e}`),window.getRequestCount=async(e={})=>{try{return(await apiFetch(ENDPOINTS.REQUESTS_COUNT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).count||0}catch(t){return Logger.error("REQUESTS","Request count error:",t),NotificationManager.error(`Request count failed: ${t.message}`),0}},window.findRequests=async e=>{try{return(await apiFetch(ENDPOINTS.REQUESTS_FIND,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).requests||[]}catch(t){return Logger.error("REQUESTS","Find requests error:",t),NotificationManager.error(`Request search failed: ${t.message}`),[]}},window.getUnmatchedRequests=async()=>{try{return(await apiFetch(ENDPOINTS.REQUESTS_UNMATCHED)).requests||[]}catch(e){return Logger.error("REQUESTS","Unmatched requests error:",e),[]}},window.findMappingsByMetadata=async e=>{try{return(await apiFetch(ENDPOINTS.MAPPINGS_FIND_BY_METADATA,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).mappings||[]}catch(t){return Logger.error("METADATA","Find mappings by metadata error:",t),[]}},Logger.info("UI","Features.js loaded - Business functions for mappings, requests, scenarios + WireMock 3.9.1+ API fixes"),window.updateLastSuccessUI=()=>{try{const e=document.getElementById(SELECTORS.CONNECTION.STATUS_TEXT);if(!e)return;const t=window.lastWiremockSuccess||Date.now(),n=new Date(t).toLocaleTimeString();e.textContent=`Last OK: ${n}`,Logger.info("HEALTH","last success UI updated:",{ts:t,time:n})}catch{}},window.applyHealthUI=(e,t)=>{try{window.healthState=window.healthState||{isHealthy:null,lastCheckAt:null,lastOkAt:null,lastLatencyMs:null},window.healthState.lastCheckAt=Date.now(),e===!0?(window.healthState.isHealthy=!0,window.healthState.lastOkAt=Date.now(),window.healthState.lastLatencyMs=typeof t=="number"?t:null):e===!1&&(window.healthState.isHealthy=!1,window.healthState.lastLatencyMs=null);const n=document.getElementById(SELECTORS.HEALTH.INDICATOR);if(n)if(n.style.display="inline",e===!0){const a=typeof t=="number"?`${t}ms`:"OK";n.innerHTML=`<span>Response Time: </span><span class="healthy">${a}</span>`}else e===!1?n.innerHTML='<span>Response Time: </span><span class="unhealthy">Unhealthy</span>':n.innerHTML='<span>Response Time: </span><span class="error">Error</span>';e===!0&&(window.lastWiremockSuccess=Date.now(),typeof window.updateLastSuccessUI=="function"&&window.updateLastSuccessUI())}catch(n){Logger.warn("HEALTH","applyHealthUI failed:",n)}};try{const e=localStorage.getItem("imock-show-meta-timestamps");e!==null&&(window.showMetaTimestamps=e==="1")}catch{}window.toggleMetaTimestamps=()=>{try{window.showMetaTimestamps=window.showMetaTimestamps===!1,localStorage.setItem("imock-show-meta-timestamps",window.showMetaTimestamps?"1":"0");const e=window.MappingsStore.getAll();Array.isArray(e)&&fetchAndRenderMappings(e)}catch(e){Logger.warn("METADATA","toggleMetaTimestamps failed:",e)}};const IMOCK_CACHE_ID="00000000-0000-0000-0000-00000000cace",IMOCK_CACHE_URL="/__imock/cache";function isImockCacheMapping(e){try{const t=(e?.id||e?.uuid)===IMOCK_CACHE_ID,n=e?.metadata?.imock?.type==="cache",a=(e?.name||"").toLowerCase()==="imock cache",r=(e?.request?.url||e?.request?.urlPath)===IMOCK_CACHE_URL;return!!(t||n||a||r)}catch{return!1}}function slimMapping(e){return{id:e.id||e.uuid,name:e.name||e.metadata?.name,priority:e.priority,persistent:e.persistent,scenarioName:e.scenarioName,requiredScenarioState:e.requiredScenarioState,newScenarioState:e.newScenarioState,request:{method:e.request?.method,url:e.request?.urlPath||e.request?.urlPathPattern||e.request?.urlPattern||e.request?.url||"N/A"},response:{status:e.response?.status},metadata:{created:e.metadata?.created,edited:e.metadata?.edited,source:e.metadata?.source}}}function buildSlimList(e){return{mappings:(e||[]).filter(n=>!isImockCacheMapping(n)).map(slimMapping)}}async function getCacheByFixedId(){try{Logger.cache("Trying fixed ID lookup...");const e=await apiFetch(`/mappings/${IMOCK_CACHE_ID}`);if(e&&isImockCacheMapping(e))return e;Logger.cache("Fixed ID miss")}catch(e){e.status===401||e.message&&e.message.includes("401")?Logger.warn("CACHE","Authorization error loading cache by fixed ID - check credentials"):e.status===404||e.message&&e.message.includes("404")?Logger.debug("CACHE","Cache mapping not found by fixed ID (404)"):Logger.debug("CACHE","Error loading cache by fixed ID:",e.message)}return null}async function upsertImockCacheMapping(e){Logger.cache("Upsert cache mapping start");const t=JSON.stringify(e||{});let n=0;for(let c=0;c<t.length;c++)n=n*31+t.charCodeAt(c)|0;const a=(n>>>0).toString(16),r={imock:{type:"cache",version:1,timestamp:Date.now(),count:(e?.mappings||[]).length,hash:a}},o={id:IMOCK_CACHE_ID,name:"iMock Cache",priority:1,persistent:!1,request:{method:"GET",url:IMOCK_CACHE_URL},response:{status:200,jsonBody:e,headers:{"Content-Type":"application/json; charset=utf-8"}},metadata:r};try{Logger.cache("PUT /mappings/{id}");const c=await apiFetch(`/mappings/${IMOCK_CACHE_ID}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return Logger.cache("Upsert done (PUT)"),c}catch{Logger.cache("PUT failed, POST /mappings");const c=await apiFetch("/mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return Logger.cache("Upsert done (POST)"),c}}async function regenerateImockCache(e=null){Logger.cache("Regenerate cache start");const t=performance.now();let n=e;n||(n=await fetchMappingsFromServer({force:!0}));const a=n?.mappings||[];Logger.cache("Using fresh server data for cache regeneration");const r=buildSlimList(a);let o=r;try{const s=await upsertImockCacheMapping(r),p=extractCacheJsonBody(s);p&&(o=p)}catch(s){Logger.warn("CACHE","Upsert cache failed:",s)}const c=Math.round(performance.now()-t);return Logger.cache(`Regenerate cache done (${(o?.mappings||[]).length} items) in ${c}ms`),o}async function refreshImockCache(){Logger.cache("Refresh cache requested");try{const e=await regenerateImockCache();return typeof window.refreshMappingsFromCache=="function"&&window.refreshMappingsFromCache(),Logger.cache("Refresh cache completed"),e}catch(e){throw Logger.error("CACHE","Refresh cache failed:",e),e}}window.refreshImockCache=refreshImockCache;async function loadImockCacheBestOf3(){Logger.cache("loadImockCacheBestOf3 start (fixed-id only)");const e=await getCacheByFixedId();return e&&e.response?.jsonBody?(Logger.cache("Using cache: fixed id"),{source:"cache",data:e.response.jsonBody}):(Logger.cache("No cache found - will load from server"),null)}function cloneMappingForCache(e){if(!e)return null;try{if(typeof structuredClone=="function")return structuredClone(e)}catch(t){Logger.warn("CACHE","structuredClone failed for mapping cache clone:",t)}try{return JSON.parse(JSON.stringify(e))}catch(t){Logger.warn("CACHE","JSON clone failed for mapping cache clone:",t)}return{...e}}function mergeMappingData(e,t){return e?t?{...e,...t,request:{...e.request,...t.request},response:{...e.response,...t.response},metadata:{...e.metadata,...t.metadata}}:e:t}function syncCacheWithMappings(e){try{const t=window.MappingsStore;if(!t||!(t.items instanceof Map)||!Array.isArray(e))return;const n=t.items,a=new Set;e.forEach(c=>{if(!c||isImockCacheMapping(c))return;const s=c.id||c.uuid;if(!s)return;a.add(s);const p=cloneMappingForCache(c)||{...c};n.has(s)?n.set(s,mergeMappingData(n.get(s),p)):n.set(s,p)});const r=t.pending instanceof Map?Array.from(t.pending.values()):[],o=new Set;for(const c of r)!c||c.type==="delete"||c.id&&o.add(c.id);Array.from(n.keys()).forEach(c=>{!a.has(c)&&!o.has(c)&&n.delete(c)}),window.cacheLastUpdate=Date.now()}catch(t){Logger.warn("CACHE","syncCacheWithMappings failed:",t)}}function extractCacheJsonBody(e){try{if(!e||typeof e!="object")return null;if(e.response?.jsonBody)return e.response.jsonBody;if(e.mapping?.response?.jsonBody)return e.mapping.response.jsonBody;if(e.jsonBody?.mappings||Array.isArray(e.mappings))return{mappings:(Array.isArray(e.jsonBody?.mappings)?e.jsonBody.mappings:Array.isArray(e.mappings)?e.mappings:[]).map(n=>({...n}))}}catch(t){Logger.warn("CACHE","extractCacheJsonBody failed:",t)}return null}(function(t){function n(a={}){const{markDemoModeActive:r,notificationManager:o,fetchAndRenderMappings:c,fetchAndRenderRequests:s,isDatasetAvailable:p,getDataset:w}=a;if(typeof r!="function")throw new Error("Demo loader requires markDemoModeActive callback");if(!o||typeof o=="function")throw new Error("Demo loader requires a notification manager object");if(typeof c!="function")throw new Error("Demo loader requires fetchAndRenderMappings function");if(typeof s!="function")throw new Error("Demo loader requires fetchAndRenderRequests function");const E=o?.success?.bind(o)||o?.info?.bind(o)||(N=>Logger.warn("DEMO",N)),v=o?.error?.bind(o)||o?.warning?.bind(o)||(N=>Logger.warn("DEMO",N)),C=o?.warning?.bind(o)||o?.info?.bind(o)||(N=>Logger.warn("DEMO",N));return async function(){if(!(typeof p=="function"?p():!0))return v("Demo dataset is not available in this build."),{status:"unavailable",mappingsLoaded:!1,requestsLoaded:!1,errors:[]};const G=typeof w=="function"?w():null;if(!G)return v("Unable to load the demo dataset."),{status:"missing",mappingsLoaded:!1,requestsLoaded:!1,errors:[]};const b=Array.isArray(G.mappings)?G.mappings:[],y=Array.isArray(G.requests)?G.requests:[];r("manual-trigger");const[k,q]=await Promise.allSettled([c(b,{source:"demo"}),s(y,{source:"demo"})]),X=k.status==="fulfilled"?k.value!==!1:!1,he=q.status==="fulfilled"?q.value!==!1:!1,ce=[];k.status==="rejected"&&ce.push(k.reason),q.status==="rejected"&&ce.push(q.reason);const Me=X&&he?"success":X||he?"partial":"failed";return Me==="success"?E("Demo data loaded locally. Explore the interface freely."):(C("Demo data only loaded partially. Check the console for details."),ce.length&&v("Some demo data failed to load. Inspect console for details.")),{status:Me,mappingsLoaded:X,requestsLoaded:he,errors:ce}}}t.DemoMode={createLoader:n}})(typeof window<"u"?window:globalThis),(function(t){let n=!1;function a(r){if(n)return!0;if(!r)return!1;n=!0;const o=t,c=r,{markDemoModeActive:s,addMappingToIndex:p,rebuildMappingIndex:w,computeMappingTabTotals:E,refreshMappingTabSnapshot:v,computeRequestTabTotals:C,refreshRequestTabSnapshot:N,removeMappingFromIndex:J,fetchMappingsFromServer:G}=c;o.updateUptime=function(){if(!o.startTime)return;const F=Math.floor((Date.now()-o.startTime)/1e3),B=Math.floor(F/3600),P=Math.floor(F%3600/60),D=F%60,oe=document.getElementById("uptime");oe&&(B>0?oe.textContent=`${B}h ${P}m ${D}s`:P>0?oe.textContent=`${P}m ${D}s`:oe.textContent=`${D}s`)},o.stopUptime=function(){o.uptimeInterval&&(o.LifecycleManager.clearInterval(o.uptimeInterval),o.uptimeInterval=null),o.startTime=null;const F=document.getElementById("uptime");F&&(F.textContent="0s")},o.checkHealth=async()=>{try{const F=document.getElementById("wiremock-host"),B=document.getElementById("wiremock-port");if(F&&B&&(F.value.trim()||B.value.trim())){const P=F.value.trim()||"localhost",D=B.value.trim()||"8080";typeof o.normalizeWiremockBaseUrl=="function"?o.wiremockBaseUrl=o.normalizeWiremockBaseUrl(P,D):o.wiremockBaseUrl=`http://${P}:${D}/__admin`,Logger.info("FEATURES","Updated WireMock URL from form:",o.wiremockBaseUrl)}await checkHealthAndStartUptime(),NotificationManager.success("Health check passed!")}catch(F){NotificationManager.error(`Health check failed: ${F.message}`)}},o.refreshMappings=async()=>{try{const F=typeof o.readWiremockSettings=="function"?o.readWiremockSettings():{},B=isCacheEnabled();await fetchAndRenderMappings(null,{useCache:B})&&NotificationManager.success("Mappings refreshed!")}catch(F){NotificationManager.error(`Failed to refresh mappings: ${F.message}`)}},o.forceRefreshCache=async()=>{try{if(!isCacheEnabled()){NotificationManager.warning("Cache is not enabled. Enable it in Settings first.");return}if(typeof o.refreshImockCache!="function"){NotificationManager.error("Cache service not available");return}const F=document.querySelector('[onclick="forceRefreshCache()"]');F&&(F.classList.add("is-loading"),F.disabled=!0);const B=await o.refreshImockCache();let P=!0;B&&typeof B=="object"&&(B.cacheMessage&&y(SELECTORS.IMPORT.RESULT,"info",B.cacheMessage),typeof B.useCache=="boolean"&&(P=B.useCache)),await fetchAndRenderMappings(null,{useCache:P})&&NotificationManager.success("Cache rebuilt and mappings refreshed!")}catch(F){NotificationManager.error(`Failed to rebuild cache: ${F.message}`)}finally{const F=document.querySelector('[onclick="forceRefreshCache()"]');F&&(F.classList.remove("is-loading"),F.disabled=!1)}};const b=o.DemoMode&&typeof o.DemoMode.createLoader=="function"?o.DemoMode.createLoader({markDemoModeActive:s,notificationManager:NotificationManager,fetchAndRenderMappings,fetchAndRenderRequests,isDatasetAvailable:()=>o.DemoData?.isAvailable?.(),getDataset:()=>o.DemoData?.getDataset?.()}):null;o.loadMockData=async()=>{if(!b)return NotificationManager.error("Demo mode is not available in this build."),{status:"unavailable",mappingsLoaded:!1,requestsLoaded:!1,errors:[]};o.demoModeLastError=null;const F=await b();if(F&&F.status!=="success"){const[B]=Array.isArray(F.errors)?F.errors:[];o.demoModeLastError=B||F.status}return o.demoModeLastResult=F,F},o.updateScenarioState=async()=>{const F=document.getElementById("scenario-select"),B=document.getElementById("scenario-state"),P=document.getElementById("scenario-update-btn");if(!F?.value||!B?.value){NotificationManager.warning("Please select scenario and enter state");return}P&&(P.disabled=!0);try{await o.setScenarioState()}finally{P&&(P.disabled=!1)}},o.updateFileDisplay=()=>{const F=document.getElementById(SELECTORS.IMPORT.FILE),B=document.getElementById(SELECTORS.IMPORT.DISPLAY),P=document.getElementById(SELECTORS.IMPORT.ACTIONS);if(!F||!B){Logger.warn("FEATURES","Import file elements not found.");return}if(F.files?.length>0){const D=F.files[0],oe=D.size?` (${Math.round(D.size/1024)} KB)`:"";B.innerHTML=`<strong>${D.name}</strong>${oe}`,P&&(P.style.display="block")}else B.innerHTML='<span class="file-placeholder">No file selected</span>',P&&(P.style.display="none")},o.updateRecorderLink=(F,B)=>{try{const P=document.getElementById("recorder-link");if(!P)return;const D=(F||"").trim();if(!D){P.removeAttribute("href"),P.setAttribute("title","Configure host in Settings to enable recorder link"),P.textContent="Recorder UI (configure host first)";return}let oe=D;/^https?:\/\//i.test(oe)||(oe=`http://${oe}`);const j=new URL(oe);B&&String(B).trim()&&(j.port=String(B).trim()),j.pathname="/__admin/recorder/",P.href=j.toString(),P.textContent=j.toString(),P.removeAttribute("title")}catch(P){Logger.warn("FEATURES","Failed to update recorder link:",P)}};function y(F,B,P){const D=document.getElementById(F);if(!D)return;const oe=B==="success"?"\u2705":B==="error"?"\u274C":"\u2139\uFE0F";D.textContent=`${oe} ${P}`}function k(F,B,P){const D=new Blob([B],{type:P}),oe=URL.createObjectURL(D),j=document.createElement("a");j.href=oe,j.download=F,document.body.appendChild(j),j.click(),document.body.removeChild(j),setTimeout(()=>URL.revokeObjectURL(oe),0)}function q(){if(o.elementCache?.has(SELECTORS.IMPORT.ACTIONS)){const P=o.elementCache.get(SELECTORS.IMPORT.ACTIONS);if(P){const D=P.querySelector("button");if(D)return D}}const F=document.getElementById(SELECTORS.IMPORT.ACTIONS);if(!F)return null;const B=F.querySelector("button");return B&&o.elementCache&&o.elementCache.set(SELECTORS.IMPORT.ACTIONS,F),B}function X(F){const B=q();B&&(B.classList.toggle("is-loading",F),B.disabled=F)}function he(F=null){if(F)return F;const B=document.getElementById(SELECTORS.IMPORT.MODE);return B&&B.value||"MERGE"}async function ce(){const F=document.getElementById(SELECTORS.IMPORT.FILE);if(!F?.files?.length)throw new Error("Please select a file to import.");const B=F.files[0],P=await B.text(),D=B.name.split(".").pop()?.toLowerCase();if(D==="yaml"||D==="yml"){if(o.jsyaml?.load)return o.jsyaml.load(P);throw new Error("YAML parser is not available.")}try{return JSON.parse(P)}catch{throw new Error("Failed to parse JSON import file.")}}function Me(F,B){if(!F||typeof F!="object")throw new Error("Import file is empty or malformed.");const P=JSON.parse(JSON.stringify(F)),D={};if(["meta","globalSettings","requestJournal","importSettings"].forEach(de=>{P&&Object.prototype.hasOwnProperty.call(P,de)&&(D[de]=P[de])}),Array.isArray(P))D.mappings=P;else if(Array.isArray(P.mappings))D.mappings=P.mappings;else if(P.mappings&&typeof P.mappings=="object"){if(Array.isArray(P.mappings.mappings))D.mappings=P.mappings.mappings;else if(Array.isArray(P.mappings.items))D.mappings=P.mappings.items;else{const De=Object.values(P.mappings).filter(Boolean).filter(Ee=>typeof Ee=="object"&&(Ee.request||Ee.response));De.length>0&&(D.mappings=De)}!D.mappings&&(P.mappings.request||P.mappings.response)&&(D.mappings=[P.mappings])}else P.mappings?D.mappings=[P.mappings]:Array.isArray(P.mapping)?D.mappings=P.mapping:P.mapping?D.mappings=[P.mapping]:Array.isArray(P.stubs)?D.mappings=P.stubs:P.stubs&&typeof P.stubs=="object"?D.mappings=Object.values(P.stubs).filter(Boolean):(P.request||P.response)&&(D.mappings=[P]);if(!Array.isArray(D.mappings))throw new Error("No mappings array found in the import file.");if(D.mappings=D.mappings.filter(Boolean),D.mappings.length===0)throw new Error("The import file does not contain any mappings.");Object.keys(P).forEach(de=>{["mappings","mapping","importMode"].includes(de)||Object.prototype.hasOwnProperty.call(D,de)||(D[de]=P[de])});const j=B||P.importMode||"MERGE";return D.importMode=j,D}async function Fe(F=null){try{X(!0),y(SELECTORS.IMPORT.RESULT,"info","Processing import file...");const B=await ce(),P=he(F),D=Me(B,P);D.importMode=P,await apiFetch(ENDPOINTS.MAPPINGS_IMPORT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(D)}),NotificationManager.success(`Imported ${D.mappings.length} mapping(s).`);const oe=document.getElementById(SELECTORS.IMPORT.FILE);oe&&(oe.value="",o.updateFileDisplay());try{typeof o.refreshImockCache=="function"&&await o.refreshImockCache(),await fetchAndRenderMappings(null,{useCache:!1})}catch(j){Logger.warn("FEATURES","Failed to refresh mappings after import:",j)}y(SELECTORS.IMPORT.RESULT,"success",`Imported ${D.mappings.length} mapping(s) using mode ${P}.`)}catch(B){throw Logger.error("FEATURES","Import failed:",B),y(SELECTORS.IMPORT.RESULT,"error",B.message||"Import failed."),NotificationManager.error(`Import failed: ${B.message}`),B}finally{X(!1)}}return o.executeImport=Fe,o.exportMappings=async()=>{const B=document.getElementById(SELECTORS.EXPORT.FORMAT)?.value||"json";y(SELECTORS.EXPORT.RESULT,"info","Preparing mappings export...");try{const D=(await apiFetch(ENDPOINTS.MAPPINGS))?.mappings||[],j=`wiremock-mappings-${new Date().toISOString().replace(/[:.]/g,"-")}`;if(B==="yaml"){if(!o.jsyaml?.dump)throw new Error("YAML serializer is not available.");const de=o.jsyaml.dump({mappings:D},{noRefs:!0});k(`${j}.yaml`,de.endsWith(`
`)?de:`${de}
`,"text/yaml")}else{const de=JSON.stringify({mappings:D},null,2);k(`${j}.json`,`${de}
`,"application/json")}y(SELECTORS.EXPORT.RESULT,"success",`Exported ${D.length} mapping(s) as ${B.toUpperCase()}.`),NotificationManager.success(`Exported ${D.length} mapping(s).`)}catch(P){Logger.error("FEATURES","Export mappings failed:",P),y(SELECTORS.EXPORT.RESULT,"error",P.message||"Failed to export mappings."),NotificationManager.error(`Failed to export mappings: ${P.message}`)}},o.exportRequests=async()=>{const B=document.getElementById(SELECTORS.EXPORT.FORMAT)?.value||"json";y(SELECTORS.EXPORT.RESULT,"info","Preparing request log export...");try{const D=(await apiFetch(ENDPOINTS.REQUESTS))?.requests||[],j=`wiremock-requests-${new Date().toISOString().replace(/[:.]/g,"-")}`;if(B==="yaml"){if(!o.jsyaml?.dump)throw new Error("YAML serializer is not available.");const de=o.jsyaml.dump({requests:D},{noRefs:!0});k(`${j}.yaml`,de.endsWith(`
`)?de:`${de}
`,"text/yaml")}else{const de=JSON.stringify({requests:D},null,2);k(`${j}.json`,`${de}
`,"application/json")}y(SELECTORS.EXPORT.RESULT,"success",`Exported ${D.length} request(s) as ${B.toUpperCase()}.`),NotificationManager.success(`Exported ${D.length} request(s).`)}catch(P){Logger.error("FEATURES","Export requests failed:",P),y(SELECTORS.EXPORT.RESULT,"error",P.message||"Failed to export request log."),NotificationManager.error(`Failed to export request log: ${P.message}`)}},!0}if(!a(t.FeaturesState)){let r=null;const o=c=>{const s=c&&c.detail&&c.detail.state||t.FeaturesState;return a(s)?(typeof t.removeEventListener=="function"&&t.removeEventListener("features:state-ready",o),r!==null&&(t.clearInterval(r),r=null),!0):!1};if(typeof t.addEventListener=="function"&&t.addEventListener("features:state-ready",o),typeof t.setInterval=="function"){let c=0;r=t.setInterval(()=>{c+=1,!o()&&c>=200&&(t.clearInterval(r),r=null,n||Logger.error("FEATURES","features.js could not find FeaturesState after waiting for 10 seconds."))},50)}}})(typeof window<"u"?window:globalThis);let editorState={originalMapping:null,currentMapping:null,isDirty:!1};document.addEventListener("DOMContentLoaded",()=>{setupMappingFormListeners(),setupEditorModeHandlers()});function setupMappingFormListeners(){const e=document.getElementById("edit-mapping-form");e&&e.addEventListener("submit",handleEditMappingSubmit)}function setupEditorModeHandlers(){const e=document.getElementById("open-json-studio-btn");e&&e.addEventListener("click",()=>{const n=editorState.currentMapping?.id;n&&typeof window.editMapping=="function"?(hideModal("edit-mapping-modal"),window.editMapping(n)):NotificationManager.warning("No mapping loaded")}),document.addEventListener("keydown",n=>{const a=document.getElementById("edit-mapping-modal");if(!(!a||a.classList.contains("hidden"))){if((n.ctrlKey||n.metaKey)&&n.key==="s"){n.preventDefault(),updateMapping();return}if((n.ctrlKey||n.metaKey)&&n.key==="Enter"){n.preventDefault(),updateMapping().then(()=>{hideModal("edit-mapping-modal")});return}if(n.key==="Escape"){editorState.isDirty?confirm("You have unsaved changes. Close anyway?")&&hideModal("edit-mapping-modal"):hideModal("edit-mapping-modal");return}}}),document.addEventListener("click",n=>{n.target.matches('[data-action="validate-json"]')&&validateCurrentJSON(),n.target.matches('[data-action="format-json"]')&&formatCurrentJSON(),n.target.matches('[data-action="minify-json"]')&&minifyCurrentJSON()});let t=null;document.addEventListener("input",n=>{if(n.target.id==="json-editor"){const a=!editorState.isDirty;editorState.isDirty=!0,a?updateDirtyIndicator():(t&&clearTimeout(t),t=setTimeout(()=>{updateDirtyIndicator(),t=null},300))}})}function setButtonLoadingState(e,t,n){if(!e)return;const a=e.querySelector(".btn-label");t?(e.classList.add("is-loading"),e.disabled=!0,e.setAttribute("aria-busy","true"),a&&(a.dataset.originalText||(a.dataset.originalText=a.textContent),n&&(a.textContent=n))):(e.classList.remove("is-loading"),e.disabled=!1,e.removeAttribute("aria-busy"),a&&a.dataset.originalText&&(a.textContent=a.dataset.originalText,delete a.dataset.originalText))}window.setMappingEditorBusyState=(e,t)=>{const n=document.getElementById("update-mapping-btn");n&&setButtonLoadingState(n,e,t)};async function handleEditMappingSubmit(e){e.preventDefault(),await updateMapping()}function normalizeScenarioNameInMapping(e){if(!e||typeof e!="object"||!Object.prototype.hasOwnProperty.call(e,"scenarioName"))return;const t=window.Utils?.normalizeScenarioName;if(typeof t!="function")return;const n=t(e.scenarioName);if(!n?.changed||!n?.hadWhitespace)return;n.cleared?(delete e.scenarioName,NotificationManager.warning("Scenario name contained only whitespace and was cleared")):(e.scenarioName=n.normalized,NotificationManager.warning(`Scenario name cannot contain spaces. Replaced with "${n.normalized}"`));const a=document.getElementById("json-editor");if(a)try{a.value=JSON.stringify(e,null,2)}catch{}}window.updateMapping=async()=>{Logger.debug("EDITOR","updateMapping called");try{window.setMappingEditorBusyState(!0,"Updating\u2026"),saveFromJSONMode();const e=editorState.currentMapping,t=e?.id;if(!t){NotificationManager.error("Mapping ID not found");return}if(normalizeScenarioNameInMapping(e),typeof e=="object"&&e){const o=new Date().toISOString();e.metadata||(e.metadata={}),e.metadata.created||(e.metadata.created=o),e.metadata.edited=o,e.metadata.source="ui"}const n=await apiFetch(`/mappings/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=n?.mapping||n;NotificationManager.success("Mapping updated!"),a&&updateOptimisticCache(a,"update"),editorState.isDirty=!1,updateDirtyIndicator(),hideModal("edit-mapping-modal"),(document.getElementById(SELECTORS.MAPPING_FILTERS.METHOD)?.value||document.getElementById(SELECTORS.MAPPING_FILTERS.URL)?.value||document.getElementById(SELECTORS.MAPPING_FILTERS.STATUS)?.value)&&FilterManager.applyMappingFilters()}catch(e){Logger.error("EDITOR","Error in updateMapping:",e),NotificationManager.error(`Update failed: ${e.message}`)}finally{window.setMappingEditorBusyState(!1)}},window.populateEditMappingForm=e=>{Logger.debug("EDITOR","populateEditMappingForm called"),Logger.debug("EDITOR","Incoming mapping ID:",e?.id),Logger.debug("EDITOR","Incoming mapping name:",e?.name),editorState.originalMapping=e,editorState.currentMapping=e,editorState.isDirty=!1,updateDirtyIndicator(),Logger.debug("EDITOR","After state update - currentMapping ID:",editorState.currentMapping?.id),Logger.debug("EDITOR","Loading JSON mode for mapping ID:",editorState.currentMapping?.id),loadJSONMode(),Logger.debug("EDITOR","populateEditMappingForm completed for mapping ID:",e?.id)};function saveFromJSONMode(){const e=document.getElementById("json-editor");if(!e)return;const t=e.value.trim();if(t)try{editorState.currentMapping=JSON.parse(t)}catch(n){throw new Error("Invalid JSON: "+n.message)}}function loadJSONMode(){const e=document.getElementById("json-editor");if(!e){Logger.warn("EDITOR","JSON editor element not found!");return}if(!editorState.currentMapping){Logger.warn("EDITOR","No currentMapping in editorState!");return}const t=JSON.stringify(editorState.currentMapping,null,2);e.value=t,Logger.debug("EDITOR","JSON editor populated with mapping ID:",editorState.currentMapping?.id),Logger.debug("EDITOR","JSON content length:",t.length)}function validateCurrentJSON(){const e=document.getElementById("json-editor"),t=document.getElementById("json-validation-result");if(!e||!t)return;const n=e.value;if(!n.trim()){t.innerHTML='<div class="validation-warning">JSON is empty</div>';return}try{JSON.parse(n),t.innerHTML='<div class="validation-success">\u2713 JSON is valid</div>'}catch(a){t.innerHTML=`<div class="validation-error">\u2717 JSON error: ${a.message}</div>`}}function formatCurrentJSON(){const e=document.getElementById("json-editor");if(e)try{const t=JSON.parse(e.value);e.value=JSON.stringify(t,null,2),showNotification("JSON formatted","success")}catch(t){showNotification("Formatting failed: "+t.message,"error")}}function minifyCurrentJSON(){const e=document.getElementById("json-editor");if(e)try{const t=JSON.parse(e.value);e.value=JSON.stringify(t),showNotification("JSON minified","success")}catch(t){showNotification("Minification failed: "+t.message,"error")}}function updateDirtyIndicator(){const e=document.getElementById("editor-dirty-indicator");e&&(e.style.display=editorState.isDirty?"inline":"none")}function showNotification(e,t="info"){if(typeof NotificationManager<"u"){t==="success"?NotificationManager.success(e):t==="error"?NotificationManager.error(e):NotificationManager.info(e);return}Logger.info("EDITOR",`[${t.toUpperCase()}] ${e}`)}Logger.info("UI","\u2705 All required modules loaded successfully"),window.DEFAULT_SETTINGS={host:"localhost",port:"8080",requestTimeout:"69000",customHeaders:{},customHeadersRaw:"",cacheEnabled:!0,autoRefreshEnabled:!1,refreshInterval:"0",autoConnect:!0,cacheRebuildDelay:"1000",cacheValidationDelay:"1500",optimisticCacheAgeLimit:"30000",cacheCountDiffThreshold:"2",backgroundFetchDelay:"200"};const DEFAULT_SETTINGS=window.DEFAULT_SETTINGS;window.customHeaders={...DEFAULT_SETTINGS.customHeaders||{}};let autoConnectInitiated=!1;function getStoredSettings(){const e=Utils.safeCall(window.readWiremockSettings);if(e)return e;try{const t=localStorage.getItem("wiremock-settings");if(!t)return{};const n=JSON.parse(t),a=Utils.safeCall(window.normalizeWiremockSettings,n);return a||(n&&typeof n=="object"?n:{})}catch(t){return Logger.warn("UI","Failed to parse stored settings, falling back to defaults:",t),{}}}function parseCustomHeadersInput(e){const t=(e||"").trim();if(!t)return{headers:{},raw:""};try{const n=JSON.parse(t);if(!n||typeof n!="object"||Array.isArray(n))throw new Error("Custom headers must be a JSON object.");return{headers:n,raw:t}}catch{const a=t.split(/\n+/),r={};let o=!0;for(const c of a){if(!c.trim())continue;const s=c.indexOf(":");if(s===-1){o=!1;break}const p=c.slice(0,s).trim(),w=c.slice(s+1).trim();if(!p){o=!1;break}r[p]=w}if(o&&Object.keys(r).length>0)return{headers:r,raw:t};throw new Error('Custom headers must be valid JSON or "Key: Value" pairs.')}}function serializeCustomHeaders(e){if(!e)return"";if(e.customHeadersRaw)return e.customHeadersRaw;if(e.customHeaders&&typeof e.customHeaders=="object"&&!Array.isArray(e.customHeaders))try{return JSON.stringify(e.customHeaders,null,2)}catch(t){Logger.warn("UI","Failed to serialize custom headers:",t)}return""}function shouldAutoConnect(e){return!!(e&&e.host&&e.port&&e.autoConnect!==!1)}function showOnboardingOverlay(){const e=document.getElementById("onboarding-overlay");if(!e)return;e.classList.remove("hidden"),requestAnimationFrame(()=>{e.classList.add("visible")}),document.body&&document.body.classList.add("onboarding-active");const t=e.querySelector("#onboarding-host");t&&t.focus()}function hideOnboardingOverlay(){const e=document.getElementById("onboarding-overlay");e&&(e.classList.remove("visible"),setTimeout(()=>{e.classList.add("hidden")},220),document.body&&document.body.classList.remove("onboarding-active"))}function attemptAutoConnect(e,t={}){if(Logger.info("UI","\u{1F50C} [attemptAutoConnect] Called with settings:",e),Logger.info("UI","\u{1F50C} [attemptAutoConnect] Options:",t),Logger.info("UI","\u{1F50C} [attemptAutoConnect] shouldAutoConnect:",shouldAutoConnect(e)),Logger.info("UI","\u{1F50C} [attemptAutoConnect] autoConnectInitiated:",autoConnectInitiated),!shouldAutoConnect(e)){Logger.info("UI","\u26A0\uFE0F [attemptAutoConnect] Skipping - shouldAutoConnect returned false");return}if(autoConnectInitiated&&!t.force){Logger.info("UI","\u26A0\uFE0F [attemptAutoConnect] Skipping - already initiated and not forced");return}autoConnectInitiated=!0,Logger.info("UI","\u2705 [attemptAutoConnect] Proceeding with autoconnect");const n=()=>{try{Logger.info("UI","\u{1F50C} [attemptAutoConnect] Triggering connection...");const a=typeof window.connectToWireMock=="function"?window.connectToWireMock():null;a&&typeof a.catch=="function"&&a.catch(r=>{Logger.error("UI","\u274C Auto-connect failed:",r),autoConnectInitiated=!1})}catch(a){Logger.error("UI","\u274C Auto-connect encountered an error:",a),autoConnectInitiated=!1}};t.immediate?(Logger.info("UI","\u{1F50C} [attemptAutoConnect] Immediate mode - connecting now"),n()):(Logger.info("UI","\u{1F50C} [attemptAutoConnect] Delayed mode - connecting in 150ms"),setTimeout(n,150))}function initializeOnboardingFlow(){const e=document.getElementById("onboarding-overlay"),t=document.getElementById("onboarding-form"),n=document.getElementById("onboarding-host"),a=document.getElementById("onboarding-port"),r=document.getElementById("onboarding-headers"),o=document.getElementById("onboarding-auto-connect"),c=getStoredSettings(),s=!!(c.host&&c.port);Logger.info("UI","\u{1F527} [initializeOnboardingFlow] Settings:",c),Logger.info("UI","\u{1F527} [initializeOnboardingFlow] Has configuration:",s),Logger.info("UI","\u{1F527} [initializeOnboardingFlow] autoConnect setting:",c.autoConnect),n&&(n.value=c.host||DEFAULT_SETTINGS.host||""),a&&(a.value=c.port||DEFAULT_SETTINGS.port||""),r&&(r.value=serializeCustomHeaders(c)),o&&(o.checked=c.autoConnect!==!1),s?(Logger.info("UI","\u2705 [initializeOnboardingFlow] Configuration found - attempting autoconnect"),attemptAutoConnect(c)):(Logger.info("UI","\u26A0\uFE0F [initializeOnboardingFlow] No configuration - showing onboarding overlay"),showOnboardingOverlay()),t&&t.addEventListener("submit",p=>{p.preventDefault();const w=n?.value.trim(),E=a?.value.trim();if(!w){typeof NotificationManager<"u"&&NotificationManager.error("Host is required."),n?.focus();return}let v;try{v=parseCustomHeadersInput(r?.value??"")}catch(N){Logger.error("UI","Failed to parse onboarding headers:",N),typeof NotificationManager<"u"&&NotificationManager.error(N.message),r?.focus();return}const C={...DEFAULT_SETTINGS,...getStoredSettings(),host:w,port:E||DEFAULT_SETTINGS.port,customHeaders:v.headers,customHeadersRaw:v.raw,autoConnect:o?o.checked:DEFAULT_SETTINGS.autoConnect};localStorage.setItem("wiremock-settings",JSON.stringify(C)),window.customHeaders={...C.customHeaders||{}},loadSettings(),loadConnectionSettings(),hideOnboardingOverlay(),shouldAutoConnect(C)?attemptAutoConnect(C,{immediate:!0,force:!0}):typeof NotificationManager<"u"&&NotificationManager.info("Connection saved. You can connect from the dashboard when you are ready.")},{once:!1})}window.initializeOnboardingFlow=initializeOnboardingFlow,window.attemptAutoConnect=attemptAutoConnect,window.hideOnboardingOverlay=hideOnboardingOverlay,window.editMapping=e=>{Logger.info("UI","\u{1F527} Opening editor for mapping:",e);const t=getStoredSettings(),n=encodeURIComponent(JSON.stringify(t)),a=`editor/json-editor.html?mappingId=${e}&mode=edit&settings=${n}`,r=window.open(a,`editor_${e}`,"width=1200,height=800,scrollbars=yes,resizable=yes,status=yes");if(!r){NotificationManager.error("Popup blocked. Please allow popups for this site.");return}NotificationManager.info(`Editor opened for mapping ${e}`);const o=window.LifecycleManager.setNamedInterval("editor-close-watch",()=>{r.closed&&(window.LifecycleManager.clearInterval(o),Logger.info("UI","\u{1F504} Editor closed, updating counters only"),Utils.safeCall(window.updateMappingsCounter),Utils.safeCall(window.updateRequestsCounter))},1e3);window.LifecycleManager.setTimeout(()=>{r.closed||(window.LifecycleManager.clearInterval(o),Logger.info("UI","\u{1F504} Editor interval cleaned up after timeout"))},300*1e3)};function computeSwaggerUiUrl(e,t){const n=(e??"").toString().trim(),a=(t??"").toString().trim();if(!n&&!a)return null;try{const r=typeof window.normalizeWiremockBaseUrl=="function"?window.normalizeWiremockBaseUrl(n,a):`http://${n||"localhost"}:${a||"8080"}/__admin`;return r?`${r.replace(/\/?$/,"")}/swagger-ui/`:null}catch(r){return Logger.warn("UI","Failed to compute Swagger UI URL:",r),null}}window.updateSwaggerUILink=(e,t)=>{const n=document.getElementById("swagger-ui-link"),a=document.getElementById("swagger-ui-link-hint");if(!n)return;const r=e??document.getElementById("default-host")?.value??"",o=t??document.getElementById("default-port")?.value??"",c=computeSwaggerUiUrl(r,o);c?(n.href=c,n.textContent=c,n.classList.remove("is-disabled"),n.removeAttribute("aria-disabled"),a&&(a.textContent="Opens the WireMock Admin Swagger UI in a new tab.")):(n.removeAttribute("href"),n.textContent="Define host and port to enable Swagger UI link",n.classList.add("is-disabled"),n.setAttribute("aria-disabled","true"),a&&(a.textContent="We build this link from your saved connection details."))},window.saveSettings=()=>{try{const e=document.getElementById("cache-enabled"),t=document.getElementById("auto-refresh-enabled"),n=document.getElementById("auto-connect-enabled"),a=document.getElementById("custom-headers");let r;try{r=parseCustomHeadersInput(a?.value??"")}catch(p){Logger.error("UI","Failed to parse custom headers:",p),typeof NotificationManager<"u"&&NotificationManager.error(p.message),a?.focus();return}const o={...DEFAULT_SETTINGS,...getStoredSettings(),host:document.getElementById("default-host")?.value||DEFAULT_SETTINGS.host,port:document.getElementById("default-port")?.value||DEFAULT_SETTINGS.port,requestTimeout:document.getElementById("request-timeout")?.value||DEFAULT_SETTINGS.requestTimeout,cacheEnabled:e?.checked??DEFAULT_SETTINGS.cacheEnabled,autoRefreshEnabled:t?.checked??DEFAULT_SETTINGS.autoRefreshEnabled,refreshInterval:document.getElementById("refresh-interval")?.value||DEFAULT_SETTINGS.refreshInterval,cacheRebuildDelay:document.getElementById("cache-rebuild-delay")?.value||DEFAULT_SETTINGS.cacheRebuildDelay,cacheValidationDelay:document.getElementById("cache-validation-delay")?.value||DEFAULT_SETTINGS.cacheValidationDelay,optimisticCacheAgeLimit:document.getElementById("optimistic-cache-age-limit")?.value||DEFAULT_SETTINGS.optimisticCacheAgeLimit,cacheCountDiffThreshold:document.getElementById("cache-count-diff-threshold")?.value||DEFAULT_SETTINGS.cacheCountDiffThreshold,backgroundFetchDelay:document.getElementById("background-fetch-delay")?.value||DEFAULT_SETTINGS.backgroundFetchDelay,autoConnect:n?.checked??DEFAULT_SETTINGS.autoConnect,customHeaders:r.headers,customHeadersRaw:r.raw},c=document.getElementById("wiremock-host"),s=document.getElementById("wiremock-port");c&&(c.value=o.host),s&&(s.value=o.port),localStorage.setItem("wiremock-settings",JSON.stringify(o)),Logger.info("UI","\u{1F527} [main.js] Settings saved to localStorage:",o),Logger.info("UI","\u{1F527} [main.js] Request timeout field value:",document.getElementById("request-timeout")?.value),typeof window.normalizeWiremockBaseUrl=="function"?window.wiremockBaseUrl=window.normalizeWiremockBaseUrl(o.host,o.port):window.wiremockBaseUrl=`http://${o.host}:${o.port}/__admin`,window.customHeaders={...o.customHeaders||{}},broadcastSettingsUpdate(o),NotificationManager.success("Settings saved successfully!"),Logger.info("UI","\u{1F4BE} Settings saved:",o),typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink(o.host,o.port)}catch(e){Logger.error("UI","Error saving settings:",e),NotificationManager.error("Failed to save settings")}},window.resetSettings=()=>{if(confirm("Reset all settings to defaults?"))try{const e={host:document.getElementById("default-host"),port:document.getElementById("default-port"),timeout:document.getElementById("request-timeout"),cacheEnabled:document.getElementById("cache-enabled"),autoRefresh:document.getElementById("auto-refresh-enabled"),refreshInterval:document.getElementById("refresh-interval"),customHeaders:document.getElementById("custom-headers"),autoConnect:document.getElementById("auto-connect-enabled")};e.host&&(e.host.value=DEFAULT_SETTINGS.host),e.port&&(e.port.value=DEFAULT_SETTINGS.port),e.timeout&&(e.timeout.value=DEFAULT_SETTINGS.requestTimeout),e.cacheEnabled&&(e.cacheEnabled.checked=DEFAULT_SETTINGS.cacheEnabled),e.autoRefresh&&(e.autoRefresh.checked=DEFAULT_SETTINGS.autoRefreshEnabled),e.refreshInterval&&(e.refreshInterval.value=DEFAULT_SETTINGS.refreshInterval),e.customHeaders&&(e.customHeaders.value=DEFAULT_SETTINGS.customHeadersRaw||""),e.autoConnect&&(e.autoConnect.checked=DEFAULT_SETTINGS.autoConnect),localStorage.setItem("wiremock-settings",JSON.stringify(DEFAULT_SETTINGS)),window.wiremockBaseUrl=`http://${DEFAULT_SETTINGS.host}:${DEFAULT_SETTINGS.port}/__admin`,window.customHeaders={...DEFAULT_SETTINGS.customHeaders||{}},broadcastSettingsUpdate(DEFAULT_SETTINGS),typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink(DEFAULT_SETTINGS.host,DEFAULT_SETTINGS.port),NotificationManager.success("Settings reset to defaults!"),Logger.info("UI","\u{1F504} Settings reset to defaults")}catch(e){Logger.error("UI","Error resetting settings:",e),NotificationManager.error("Failed to reset settings")}},window.loadSettings=()=>{try{const e=getStoredSettings();Logger.info("UI","\u{1F527} [main.js] Loading settings from localStorage:",e);const t={host:document.getElementById("default-host"),port:document.getElementById("default-port"),timeout:document.getElementById("request-timeout"),cacheEnabled:document.getElementById("cache-enabled"),autoRefresh:document.getElementById("auto-refresh-enabled"),refreshInterval:document.getElementById("refresh-interval"),cacheRebuildDelay:document.getElementById("cache-rebuild-delay"),cacheValidationDelay:document.getElementById("cache-validation-delay"),optimisticCacheAgeLimit:document.getElementById("optimistic-cache-age-limit"),cacheCountDiffThreshold:document.getElementById("cache-count-diff-threshold"),backgroundFetchDelay:document.getElementById("background-fetch-delay"),customHeaders:document.getElementById("custom-headers"),autoConnect:document.getElementById("auto-connect-enabled")};if(t.host&&(t.host.value=e.host||DEFAULT_SETTINGS.host),t.port&&(t.port.value=e.port||DEFAULT_SETTINGS.port),t.timeout&&(t.timeout.value=e.requestTimeout||DEFAULT_SETTINGS.requestTimeout),t.cacheEnabled&&(t.cacheEnabled.checked=e.cacheEnabled!==void 0?e.cacheEnabled:DEFAULT_SETTINGS.cacheEnabled),t.autoRefresh&&(t.autoRefresh.checked=e.autoRefreshEnabled!==void 0?e.autoRefreshEnabled:DEFAULT_SETTINGS.autoRefreshEnabled),t.refreshInterval&&(t.refreshInterval.value=e.refreshInterval||DEFAULT_SETTINGS.refreshInterval),t.cacheRebuildDelay&&(t.cacheRebuildDelay.value=e.cacheRebuildDelay||DEFAULT_SETTINGS.cacheRebuildDelay),t.cacheValidationDelay&&(t.cacheValidationDelay.value=e.cacheValidationDelay||DEFAULT_SETTINGS.cacheValidationDelay),t.optimisticCacheAgeLimit&&(t.optimisticCacheAgeLimit.value=e.optimisticCacheAgeLimit||DEFAULT_SETTINGS.optimisticCacheAgeLimit),t.cacheCountDiffThreshold&&(t.cacheCountDiffThreshold.value=e.cacheCountDiffThreshold||DEFAULT_SETTINGS.cacheCountDiffThreshold),t.backgroundFetchDelay&&(t.backgroundFetchDelay.value=e.backgroundFetchDelay||DEFAULT_SETTINGS.backgroundFetchDelay),t.customHeaders&&(t.customHeaders.value=serializeCustomHeaders(e)),t.autoConnect&&(t.autoConnect.checked=e.autoConnect!==!1),window.customHeaders=e.customHeaders&&typeof e.customHeaders=="object"&&!Array.isArray(e.customHeaders)?{...e.customHeaders}:{...DEFAULT_SETTINGS.customHeaders||{}},Logger.info("UI","\u{1F4CB} Settings loaded into settings form"),typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink(e.host,e.port),typeof window.updateRecorderLink=="function")try{window.updateRecorderLink(e.host,e.port)}catch(n){Logger.warn("UI","Failed to update recorder link:",n)}}catch(e){Logger.error("UI","Error loading settings:",e)}};function broadcastSettingsUpdate(e){try{localStorage.setItem("wiremock-settings-broadcast",JSON.stringify({timestamp:Date.now(),settings:e})),Logger.info("UI","\u{1F4E1} Broadcasting settings update to editor windows")}catch(t){Logger.warn("UI","Failed to broadcast settings update:",t)}}if(window.wiremockBaseUrl||(window.wiremockBaseUrl=`http://${DEFAULT_SETTINGS.host}:${DEFAULT_SETTINGS.port}/__admin`,Logger.info("UI","\u{1F527} [main.js] Initialized default WireMock URL:",window.wiremockBaseUrl)),window.applyDefaultsToForm=()=>{Logger.info("UI","\u{1F527} [applyDefaultsToForm] Setting form defaults from DEFAULT_SETTINGS");const e=document.getElementById("default-host"),t=document.getElementById("default-port"),n=document.getElementById("request-timeout"),a=document.getElementById("cache-enabled"),r=document.getElementById("auto-refresh-enabled"),o=document.getElementById("refresh-interval"),c=document.getElementById("custom-headers"),s=document.getElementById("auto-connect-enabled");e&&!e.value&&(e.value=DEFAULT_SETTINGS.host),t&&!t.value&&(t.value=DEFAULT_SETTINGS.port),n&&!n.value&&(n.value=DEFAULT_SETTINGS.requestTimeout),a&&(a.checked=DEFAULT_SETTINGS.cacheEnabled),r&&(r.checked=DEFAULT_SETTINGS.autoRefreshEnabled),o&&!o.value&&(o.value=DEFAULT_SETTINGS.refreshInterval),c&&!c.value&&(c.value=DEFAULT_SETTINGS.customHeadersRaw||""),s&&(s.checked=DEFAULT_SETTINGS.autoConnect),Logger.info("UI","\u{1F527} [applyDefaultsToForm] Form defaults applied")},document.addEventListener("DOMContentLoaded",async()=>{if(await new Promise(c=>requestAnimationFrame(c)),window.location.pathname.includes("json-editor.html")||window.location.search.includes("mappingId=")||window.location.search.includes("mode=edit")||window.location.search.includes("mode=create")){Logger.info("UI","\u{1F4DD} JSON Editor page detected - skipping main app initialization");return}typeof window.initializeSidebarPreference=="function"&&window.initializeSidebarPreference(),applyDefaultsToForm(),loadSettings(),loadConnectionSettings(),typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink();const t=document.getElementById("default-host"),n=document.getElementById("default-port"),a=()=>{typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink()};t?.addEventListener("input",a),n?.addEventListener("input",a),t?.addEventListener("change",a),n?.addEventListener("change",a),Logger.info("UI","\u{1F527} [main.js] Page loaded, defaults applied, settings initialized, ready for user interaction"),typeof window.initializeFilterTabs=="function"&&window.initializeFilterTabs(),typeof window.initMappingPagination=="function"&&window.initMappingPagination(),typeof window.FilterManager?.restoreFilters=="function"&&(window.FilterManager.restoreFilters("mappings"),typeof window.updateActiveFiltersDisplay=="function"&&window.updateActiveFiltersDisplay(),window.FilterManager.restoreFilters("requests"),typeof window.updateRequestActiveFiltersDisplay=="function"&&window.updateRequestActiveFiltersDisplay()),typeof window.loadAllSavedFilters=="function"&&window.loadAllSavedFilters();const r=typeof window.getActiveTabFromURL=="function"?window.getActiveTabFromURL():null;r&&["mappings","requests","scenarios","import-export","recording","settings"].includes(r)&&typeof window.showPage=="function"&&(Logger.info("UI",`\u{1F517} Switching to tab from URL: ${r}`),window.showPage(r,document.querySelector(`[onclick*="showPage('${r}')"]`))),initializeOnboardingFlow()}),window.addEventListener("popstate",()=>{if(Logger.info("UI","\u2B05\uFE0F Browser navigation detected, syncing filters from URL"),typeof window.URLStateManager>"u")return;const e=window.TabManager?.getCurrentTab();e==="mappings"?(window.URLStateManager.syncUIFromURL("mappings"),typeof window.FilterManager<"u"&&window.FilterManager.flushMappingFilters()):e==="requests"&&(window.URLStateManager.syncUIFromURL("requests"),typeof window.FilterManager<"u"&&window.FilterManager.flushRequestFilters())}),window.addEventListener("storage",e=>{if(e.key==="wiremock-settings"&&e.newValue)try{const t=JSON.parse(e.newValue);Logger.info("UI","\u{1F527} [main.js] Settings updated from external source:",t);const n=document.getElementById("wiremock-host"),a=document.getElementById("wiremock-port");n&&t.host&&(n.value=t.host),a&&t.port&&(a.value=t.port),t.host&&t.port&&(typeof window.normalizeWiremockBaseUrl=="function"?window.wiremockBaseUrl=window.normalizeWiremockBaseUrl(t.host,t.port):window.wiremockBaseUrl=`http://${t.host}:${t.port}/__admin`,Logger.info("UI","\u{1F527} [main.js] URL updated from settings change:",window.wiremockBaseUrl)),typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink(t.host,t.port),t.customHeaders&&typeof t.customHeaders=="object"&&!Array.isArray(t.customHeaders)?window.customHeaders={...t.customHeaders}:window.customHeaders={}}catch(t){Logger.error("UI","\u{1F527} [main.js] Error processing settings update:",t)}}),window.addEventListener("message",e=>{if(e.origin===window.location.origin){if(e.data&&e.data.type==="imock-cache-refresh"&&(Logger.info("UI","\u{1F4E8} [main.js] Received cache refresh request from:",e.data.source),typeof window.refreshImockCache=="function"&&window.refreshImockCache().catch(t=>{Logger.warn("UI","Failed to refresh cache from message:",t)})),e.data&&e.data.type==="imock-optimistic-mapping-update"&&(Logger.info("UI","\u{1F3AF} [main.js] Received optimistic mapping update from:",e.data.source,e.data.mapping.id),typeof window.applyOptimisticMappingUpdate=="function"&&(window.applyOptimisticMappingUpdate(e.data.mapping),typeof window.fetchAndRenderMappings=="function"))){Logger.info("UI","\u{1F3AF} [main.js] Triggering UI refresh after optimistic update");const t=window.MappingsStore.getAll();window.fetchAndRenderMappings(t)}e.data&&e.data.type==="imock-optimistic-cache-update"&&(Logger.info("UI","\u{1F9E9} [main.js] Received optimistic cache update from:",e.data.source,e.data.operation,e.data.mapping?.id),typeof window.updateOptimisticCache=="function"&&window.updateOptimisticCache(e.data.mapping,e.data.operation))}}),window.addEventListener("storage",e=>{if(e.key==="imock-cache-refresh-trigger"&&e.newValue&&(Logger.info("UI","\u{1F4BE} [main.js] Received localStorage cache refresh trigger"),typeof window.refreshImockCache=="function"&&window.refreshImockCache().catch(t=>{Logger.warn("UI","Failed to refresh cache from localStorage trigger:",t)})),e.key==="imock-optimistic-update"&&e.newValue)try{const t=JSON.parse(e.newValue);if(Logger.info("UI","\u{1F3AF} [main.js] Received localStorage optimistic update from:",t.source,"for mapping:",t.mapping?.id),t.mapping&&typeof window.applyOptimisticMappingUpdate=="function"){if(window.applyOptimisticMappingUpdate(t.mapping),typeof window.fetchAndRenderMappings=="function"){Logger.info("UI","\u{1F3AF} [main.js] Triggering UI refresh after localStorage optimistic update");const n=window.MappingsStore.getAll();window.fetchAndRenderMappings(n)}typeof window.updateMappingsCounter=="function"&&window.updateMappingsCounter()}}catch(t){Logger.warn("UI","Failed to process optimistic update from localStorage:",t)}}),typeof BroadcastChannel<"u")try{const e=new BroadcastChannel("imock-cache-refresh"),t=new BroadcastChannel("imock-optimistic-updates");e.addEventListener("message",n=>{n.data&&n.data.type==="cache-refresh"&&(Logger.info("UI","\u{1F4E1} [main.js] Received BroadcastChannel cache refresh from:",n.data.source),typeof window.refreshImockCache=="function"&&window.refreshImockCache().catch(a=>{Logger.warn("UI","Failed to refresh cache from BroadcastChannel:",a)}))}),t.addEventListener("message",n=>{if(n.data&&n.data.type==="optimistic-mapping-update"&&(Logger.info("UI","\u{1F3AF} [main.js] Received BroadcastChannel optimistic update from:",n.data.source,n.data.mapping.id),typeof window.applyOptimisticMappingUpdate=="function"&&(window.applyOptimisticMappingUpdate(n.data.mapping),typeof window.fetchAndRenderMappings=="function"))){Logger.info("UI","\u{1F3AF} [main.js] Triggering UI refresh after BroadcastChannel optimistic update");const a=window.MappingsStore.getAll();window.fetchAndRenderMappings(a)}}),window.addEventListener("beforeunload",()=>{e.close(),t.close()})}catch(e){Logger.warn("UI","BroadcastChannel setup failed:",e)}function loadConnectionSettings(){try{const e=getStoredSettings();Logger.info("UI","\u{1F527} [loadConnectionSettings] Loading settings:",e);const t=document.getElementById("wiremock-host"),n=document.getElementById("wiremock-port");t&&e.host&&(t.value=e.host,Logger.info("UI","\u{1F527} [loadConnectionSettings] Set host input:",e.host)),n&&e.port&&(n.value=e.port,Logger.info("UI","\u{1F527} [loadConnectionSettings] Set port input:",e.port)),Logger.info("UI","\u{1F527} [loadConnectionSettings] Form fields updated, URL will be set by connectToWireMock()")}catch(e){Logger.error("UI","Error loading connection settings:",e),Logger.info("UI","\u{1F527} [loadConnectionSettings] Error loading settings, form fields may remain empty")}}
