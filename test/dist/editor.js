"use strict";var an=n=>{throw TypeError(n)};var xt=(n,e,t)=>e.has(n)||an("Cannot "+t);var Pe=(n,e,t)=>(xt(n,e,"read from private field"),t?t.call(n):e.get(n)),pt=(n,e,t)=>e.has(n)?an("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),ft=(n,e,t,i)=>(xt(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t),At=(n,e,t)=>(xt(n,e,"access private method"),t);var Ut,Qe,Xe,rt,Et,Ze,sn,cn,Dt;class VirtualizedJSONRenderer{constructor(e){this.editor=e,this.fullContent="",this.isVirtualized=!1}setContent(e){typeof e!="string"&&(e=""),this.fullContent=e;const t=e.split(`
`).length;this.isVirtualized=!1,this.editor.getValue()!==e&&this.editor.setValue(e),t>5e3&&console.log(`\u{1F4C4} Loaded large document (${t} lines) without manual virtualization.`)}updateVisibleRange(){}getFullContent(){return this.isVirtualized?this.fullContent:this.editor.getValue()}dispose(){this.fullContent="",this.isVirtualized=!1}}class IndexedSearch{constructor(){this.keyIndex=new Map,this.valueIndex=new Map,this.lineIndex=[],this.isIndexed=!1,this.lastBuildTime=0}buildIndex(e){const t=performance.now(),i=e.split(`
`);this.keyIndex.clear(),this.valueIndex.clear(),this.lineIndex=[],i.forEach((r,o)=>{this.lineIndex.push(r);const c=r.trim(),s=c.match(/"([^"]+)":/);if(s){const d=s[1].toLowerCase();this.keyIndex.has(d)||this.keyIndex.set(d,[]),this.keyIndex.get(d).push({line:o,column:r.indexOf(s[0]),text:r,key:s[1]})}const l=c.match(/:\s*"([^"]+)"/);if(l){const d=l[1].toLowerCase();this.valueIndex.has(d)||this.valueIndex.set(d,[]),this.valueIndex.get(d).push({line:o,column:r.indexOf(l[1]),text:r,value:l[1]})}}),this.isIndexed=!0,this.lastBuildTime=performance.now()-t,console.log(`\u{1F50D} Search index built in ${this.lastBuildTime.toFixed(2)}ms for ${i.length} lines`)}searchKeys(e,t={}){if(!this.isIndexed)return[];const i=t.matchCase?e:e.toLowerCase(),r=[];for(const[o,c]of this.keyIndex)this.matches(o,i,t)&&r.push(...c.map(s=>({...s,type:"key"})));return r.slice(0,1e3)}searchValues(e,t={}){if(!this.isIndexed)return[];const i=t.matchCase?e:e.toLowerCase(),r=[];for(const[o,c]of this.valueIndex)this.matches(o,i,t)&&r.push(...c.map(s=>({...s,type:"value"})));return r.slice(0,1e3)}searchAll(e,t={}){const i=this.searchKeys(e,t),r=this.searchValues(e,t);return[...i,...r].sort((o,c)=>o.line-c.line).slice(0,1e3)}matches(e,t,i){return i.wholeWord?new RegExp(`\\b${this.escapeRegex(t)}\\b`,i.matchCase?"":"i").test(e):e.includes(t)}escapeRegex(e){return e.replace(/[.*+?^${}()|[\\]\\]/g,"\\$&")}getStats(){return{indexed:this.isIndexed,keys:this.keyIndex.size,values:this.valueIndex.size,lines:this.lineIndex.length,buildTime:this.lastBuildTime}}clear(){this.keyIndex.clear(),this.valueIndex.clear(),this.lineIndex=[],this.isIndexed=!1,this.lastBuildTime=0}}class WorkerPool{constructor(e,t=4){if(this.workers=[],this.queue=[],this.busyWorkers=new Set,this.taskIdCounter=0,this.pendingTasks=new Map,location.protocol==="file:"){console.log("\u{1F6A7} Skipping worker pool creation due to file:// protocol limitations"),console.log("\u{1F465} Worker pool initialized with 0 workers (file:// mode)");return}for(let i=0;i<t;i++)try{const r=new Worker(e);r.id=i,r.onmessage=o=>this.handleMessage(r,o),r.onerror=o=>this.handleError(r,o),this.workers.push(r)}catch(r){console.warn(`Failed to create worker ${i}:`,r)}console.log(`\u{1F465} Worker pool initialized with ${this.workers.length} workers`)}execute(e,t,i=0,r=1e4){return new Promise((o,c)=>{const s=++this.taskIdCounter,l={id:s,operation:e,payload:t,resolve:o,reject:c,priority:i,timestamp:Date.now(),timeout:setTimeout(()=>{this.cancelTask(s,"timeout")},r)};this.pendingTasks.set(s,l);const d=this.getAvailableWorker();d?this.runTask(d,l):(this.queue.push(l),this.queue.sort((f,h)=>h.priority-f.priority))})}getAvailableWorker(){return this.workers.find(e=>!this.busyWorkers.has(e.id))}runTask(e,t){this.busyWorkers.add(e.id),e.currentTask=t,e.postMessage({type:t.operation,payload:t.payload,taskId:t.id})}handleMessage(e,t){const i=e.currentTask;i&&(clearTimeout(i.timeout),this.pendingTasks.delete(i.id),t.data.error?i.reject(new Error(t.data.error)):i.resolve(t.data.result||t.data)),this.releaseWorker(e)}handleError(e,t){const i=e.currentTask;i&&(clearTimeout(i.timeout),this.pendingTasks.delete(i.id),i.reject(t)),this.releaseWorker(e)}releaseWorker(e){if(this.busyWorkers.delete(e.id),e.currentTask=null,this.queue.length>0){const t=this.queue.shift();this.runTask(e,t)}}cancelTask(e,t="cancelled"){const i=this.pendingTasks.get(e);if(i){clearTimeout(i.timeout),this.pendingTasks.delete(e),i.reject(new Error(`Task ${t}`));const r=this.queue.findIndex(o=>o.id===e);r!==-1&&this.queue.splice(r,1)}}getStats(){return{workers:this.workers.length,busy:this.busyWorkers.size,queued:this.queue.length,pending:this.pendingTasks.size}}terminate(){for(const[e]of this.pendingTasks)this.cancelTask(e,"pool_terminated");this.workers.forEach(e=>e.terminate()),this.workers=[],this.queue=[],this.busyWorkers.clear(),this.pendingTasks.clear()}}class PerformanceController{constructor(){this.debounceTimers=new Map,this.throttleTimestamps=new Map,this.measurements=new Map}debounce(e,t,i){clearTimeout(this.debounceTimers.get(e)),this.debounceTimers.set(e,setTimeout(()=>{t(),this.debounceTimers.delete(e)},i))}throttle(e,t,i){const r=Date.now(),o=this.throttleTimestamps.get(e)||0;return r-o>=i?(this.throttleTimestamps.set(e,r),t(),!0):!1}measurePerformance(e,t){const i=performance.now(),r=t(),o=performance.now()-i;return this.measurements.has(e)||this.measurements.set(e,[]),this.measurements.get(e).push(o),o>100?console.warn(`\u{1F40C} Slow operation [${e}]: ${o.toFixed(2)}ms`):o>50&&console.log(`\u26A1 Operation [${e}]: ${o.toFixed(2)}ms`),r}async measureAsync(e,t){const i=performance.now(),r=await t(),o=performance.now()-i;return this.measurements.has(e)||this.measurements.set(e,[]),this.measurements.get(e).push(o),o>100&&console.warn(`\u{1F40C} Async operation [${e}]: ${o.toFixed(2)}ms`),r}getStats(e){const t=this.measurements.get(e);if(!t||t.length===0)return null;const i=[...t].sort((r,o)=>r-o);return{count:t.length,min:i[0],max:i[i.length-1],avg:t.reduce((r,o)=>r+o,0)/t.length,median:i[Math.floor(i.length/2)]}}clearStats(){this.measurements.clear()}}class ResultCache{constructor(e=100,t=3e5){this.cache=new Map,this.maxSize=e,this.ttl=t,this.hits=0,this.misses=0}generateKey(e,t){const i=this.simpleHash(t);return`${e}:${i}:${t.length}`}simpleHash(e){let t=0;for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);t=(t<<5)-t+r,t=t&t}return Math.abs(t).toString(36)}get(e,t){const i=this.generateKey(e,t),r=this.cache.get(i);return r&&Date.now()-r.timestamp<this.ttl?(this.hits++,r.result):(r&&this.cache.delete(i),this.misses++,null)}set(e,t,i){const r=this.generateKey(e,t);if(this.cache.size>=this.maxSize){const o=this.cache.keys().next().value;this.cache.delete(o)}this.cache.set(r,{result:i,timestamp:Date.now()})}clear(){this.cache.clear(),this.hits=0,this.misses=0}getStats(){const e=this.hits+this.misses;return{size:this.cache.size,maxSize:this.maxSize,hits:this.hits,misses:this.misses,hitRate:e>0?(this.hits/e*100).toFixed(1)+"%":"0%"}}}typeof window<"u"&&(window.VirtualizedJSONRenderer=VirtualizedJSONRenderer,window.IndexedSearch=IndexedSearch,window.WorkerPool=WorkerPool,window.PerformanceController=PerformanceController,window.ResultCache=ResultCache),typeof module<"u"&&module.exports&&(module.exports={VirtualizedJSONRenderer,IndexedSearch,WorkerPool,PerformanceController,ResultCache});const Logger=(function(){const n={DEBUG:0,INFO:1,WARN:2,ERROR:3,SILENT:4};let e=n.WARN;const t={API:"\u{1F517}",CACHE:"\u{1F9E9}",DEMO:"\u{1F9EA}",EDITOR:"\u{1F4DD}",EVENTS:"\u{1F4E2}",FEATURES:"\u{1F9E0}",FILTERS:"\u{1F50D}",HEALTH:"\u{1F493}",MANAGERS:"\u{1F9ED}",METADATA:"\u{1F4C5}",OPS:"\u{1F6E0}\uFE0F",OPTIMISTIC:"\u{1F3AF}",PAGINATION:"\u2194\uFE0F",QUERY:"\u2753",RECORDING:"\u23FA\uFE0F",REQUESTS:"\u{1F4E1}",SCENARIOS:"\u{1F3AC}",STATE:"\u{1F310}",STORE:"\u{1F5C2}\uFE0F",SYNC:"\u{1F504}",TEMPLATES:"\u{1F9FE}",UI:"\u{1F5A5}\uFE0F",DEFAULT:"\u{1F4CB}"};function i(){try{const s=localStorage.getItem("imock-log-level");s&&n[s.toUpperCase()]!==void 0&&(e=n[s.toUpperCase()])}catch{}}function r(s,...l){const d=t[s]||t.DEFAULT;return[`[${new Date().toISOString().substring(11,23)}] ${d} [${s}]`,...l]}function o(s){const l=(s||"").toUpperCase();if(n[l]!==void 0){e=n[l];try{localStorage.setItem("imock-log-level",l)}catch{}}}const c={LEVELS:n,setLevel:o,debug:(s,...l)=>{e<=n.DEBUG&&console.log(...r(s,...l))},info:(s,...l)=>{e<=n.INFO&&console.info(...r(s,...l))},warn:(s,...l)=>{e<=n.WARN&&console.warn(...r(s,...l))},error:(s,...l)=>{e<=n.ERROR&&console.error(...r(s,...l))},api:(...s)=>c.debug("API",...s),cache:(...s)=>c.debug("CACHE",...s),ui:(...s)=>c.debug("UI",...s)};return i(),c})();window.Logger=Logger;class MonacoLoader{static async load(){return Pe(this,rt)?(console.log("\u2705 [Monaco Lazy Loader] Already loaded"),Promise.resolve()):Pe(this,Qe)?(console.log("\u23F3 [Monaco Lazy Loader] Already loading, returning existing promise"),Pe(this,Qe)):(console.log("\u{1F680} [Monaco Lazy Loader] Starting lazy load..."),ft(this,Xe,!0),ft(this,Qe,At(this,Ze,sn).call(this).then(()=>{ft(this,rt,!0),ft(this,Xe,!1),console.log("\u2705 [Monaco Lazy Loader] Monaco loaded successfully"),window.dispatchEvent(new CustomEvent("monaco:loaded"))}).catch(e=>{throw ft(this,Xe,!1),ft(this,Qe,null),console.error("\u274C [Monaco Lazy Loader] Failed to load Monaco:",e),e})),Pe(this,Qe))}static prefetch(){Pe(this,rt)||Pe(this,Xe)||(console.log("\u26A1 [Monaco Lazy Loader] Prefetching Monaco..."),this.load().catch(e=>{console.warn("\u26A0\uFE0F [Monaco Lazy Loader] Prefetch failed:",e)}))}static isLoaded(){return Pe(this,rt)}static isLoading(){return Pe(this,Xe)}static getStatus(){return{isLoaded:Pe(this,rt),isLoading:Pe(this,Xe),hasPromise:Pe(this,Qe)!==null}}}Ut=new WeakMap,Qe=new WeakMap,Xe=new WeakMap,rt=new WeakMap,Et=new WeakMap,Ze=new WeakSet,sn=async function(){const e=Pe(this,Et)[0];try{return console.log(`\u{1F4E6} [Monaco Lazy Loader] Loading from ${e.label}...`),await At(this,Ze,Dt).call(this,`${e.baseUrl}/loader.js`,"monaco-loader-script"),typeof window.require<"u"&&typeof window.require.config=="function"?window.require.config({paths:{vs:e.baseUrl}}):(window.require=window.require||{},window.require.paths=Object.assign({},window.require.paths||{},{vs:e.baseUrl})),new Promise((t,i)=>{const r=setTimeout(()=>{i(new Error("Monaco loading timeout (30s)"))},3e4);window.require(["vs/editor/editor.main"],()=>{clearTimeout(r),console.log("\u2705 [Monaco Lazy Loader] Monaco editor.main loaded"),t()},o=>{clearTimeout(r),console.error("\u274C [Monaco Lazy Loader] AMD require failed:",o),i(o)})})}catch(t){console.error(`\u274C [Monaco Lazy Loader] Primary source (${e.label}) failed:`,t);for(let i=1;i<Pe(this,Et).length;i++){const r=Pe(this,Et)[i];try{return console.log(`\u{1F504} [Monaco Lazy Loader] Trying fallback: ${r.label}...`),await At(this,Ze,cn).call(this,r)}catch(o){console.warn(`\u26A0\uFE0F [Monaco Lazy Loader] Fallback ${r.label} failed:`,o)}}throw new Error("All Monaco CDN sources failed")}},cn=async function(e){return await At(this,Ze,Dt).call(this,`${e.baseUrl}/loader.js`,`monaco-loader-fallback-${e.label}`),typeof window.require<"u"&&typeof window.require.config=="function"?window.require.config({paths:{vs:e.baseUrl}}):window.require.paths=Object.assign({},window.require.paths||{},{vs:e.baseUrl}),new Promise((t,i)=>{const r=setTimeout(()=>{i(new Error(`Fallback ${e.label} timeout`))},3e4);window.require(["vs/editor/editor.main"],()=>{clearTimeout(r),t()},o=>{clearTimeout(r),i(o)})})},Dt=function(e,t){return new Promise((i,r)=>{if(document.getElementById(t)){console.log(`\u2705 [Monaco Lazy Loader] Script ${t} already loaded`),i();return}const o=document.createElement("script");o.id=t,o.src=e,o.async=!1,o.onload=()=>{console.log(`\u2705 [Monaco Lazy Loader] Script loaded: ${e}`),i()},o.onerror=c=>{console.error(`\u274C [Monaco Lazy Loader] Script failed: ${e}`,c),document.head.removeChild(o),r(new Error(`Failed to load script: ${e}`))},document.head.appendChild(o)})},pt(MonacoLoader,Ze),pt(MonacoLoader,Ut,null),pt(MonacoLoader,Qe,null),pt(MonacoLoader,Xe,!1),pt(MonacoLoader,rt,!1),pt(MonacoLoader,Et,[{label:"jsDelivr",baseUrl:"https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs"},{label:"cdnjs",baseUrl:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs"},{label:"unpkg",baseUrl:"https://unpkg.com/monaco-editor@0.44.0/min/vs"}]),window.MonacoLoader=MonacoLoader,console.log("\u{1F4E6} Monaco Lazy Loader initialized"),console.log("\u{1F4A1} Usage: await MonacoLoader.load() or MonacoLoader.prefetch()"),(function(e){const t=[{id:"happy-get-resource",title:"GET Resource",description:"Return a resource by id with templated fields.",category:"happy-path",highlight:"GET \xB7 /api/resources/{id}",feature:{path:["response","jsonBody","id"],label:"response.jsonBody.id"},content:{request:{method:"GET",urlPathPattern:"/api/resources/[a-f0-9-]+"},response:{status:200,headers:{"Content-Type":"application/json"},jsonBody:{id:"{{request.pathSegments.[2]}}",name:"Example Resource",createdAt:"{{now}}"},transformers:["response-template"]}}},{id:"happy-post-create",title:"POST Create (201)",description:"Create a new resource with Location header.",category:"happy-path",highlight:"POST \xB7 /api/resources",feature:{path:["response","headers","Location"],label:"response.headers.Location"},popular:!0,content:{request:{method:"POST",urlPath:"/api/resources",headers:{"Content-Type":{equalTo:"application/json"}}},response:{status:201,headers:{"Content-Type":"application/json",Location:"/api/resources/{{randomValue type='UUID'}}"},jsonBody:{id:"{{randomValue type='UUID'}}",message:"Resource created"},transformers:["response-template"]}}},{id:"error-400-validation",title:"400 Bad Request",description:"Validation error example for POST payloads.",category:"errors",highlight:"POST \xB7 /api/resources \xB7 400",content:{request:{method:"POST",urlPath:"/api/resources",bodyPatterns:[{matchesJsonPath:"$[?(!@.name)]"}]},response:{status:400,jsonBody:{error:"Bad Request",details:[{field:"name",error:"required"}]}}}},{id:"error-401-unauthorized",title:"401 Unauthorized",description:"Missing or invalid auth header.",category:"errors",highlight:"ANY \xB7 /api/* \xB7 401",content:{request:{method:"ANY",urlPathPattern:"/api/.*",headers:{Authorization:{absent:!0}}},response:{status:401,headers:{"WWW-Authenticate":'Bearer realm="api"'},jsonBody:{error:"Unauthorized"}}}},{id:"error-404-not-found",title:"404 Not Found",description:"Simple not-found stub for missing resources.",category:"errors",highlight:"GET \xB7 /api/resources/non-existent",content:{request:{method:"GET",urlPath:"/api/resources/non-existent"},response:{status:404,jsonBody:{error:"Not Found"}}}},{id:"error-429-rate-limit",title:"429 Rate Limit",description:"Throttle response with retry guidance.",category:"errors",highlight:"ANY \xB7 429 Too Many Requests",popular:!0,content:{request:{method:"ANY",urlPattern:"/api/.*"},response:{status:429,headers:{"Retry-After":"60","X-RateLimit-Remaining":"0"},jsonBody:{error:"Too Many Requests"}}}},{id:"fault-fixed-delay",title:"Fixed Delay",description:"Deterministic slow response.",category:"faults",highlight:"GET \xB7 /api/slow \xB7 delay",feature:{path:["response","fixedDelayMilliseconds"],label:"response.fixedDelayMilliseconds"},content:{request:{method:"GET",urlPath:"/api/slow"},response:{status:200,fixedDelayMilliseconds:5e3,jsonBody:{message:"Delayed"}}}},{id:"fault-random-delay-uniform",title:"Random Delay (Uniform)",description:"Variable latency within bounds.",category:"faults",highlight:"ANY \xB7 delayDistribution.uniform",content:{request:{method:"GET",urlPath:"/api/variable-latency"},response:{status:200,delayDistribution:{type:"uniform",lower:500,upper:2e3}}}},{id:"fault-random-delay-lognormal",title:"Random Delay (Lognormal)",description:"Realistic latency distribution.",category:"faults",highlight:"ANY \xB7 delayDistribution.lognormal",content:{request:{method:"GET",urlPath:"/api/realistic-latency"},response:{status:200,delayDistribution:{type:"lognormal",median:100,sigma:.4}}}},{id:"fault-chunked-dribble",title:"Chunked Dribble",description:"Slow streaming response.",category:"faults",highlight:"GET \xB7 /api/slow-download",content:{request:{method:"GET",urlPath:"/api/slow-download"},response:{status:200,body:"Slow response...",chunkedDribbleDelay:{numberOfChunks:10,totalDuration:5e3}}}},{id:"fault-connection-reset",title:"Connection Reset",description:"Simulate TCP reset failure.",category:"faults",highlight:"GET \xB7 /api/reset \xB7 fault",popular:!0,content:{request:{method:"GET",urlPath:"/api/reset"},response:{fault:"CONNECTION_RESET_BY_PEER"}}},{id:"fault-empty-response",title:"Empty Response",description:"Return no body to mimic dropped payloads.",category:"faults",highlight:"ANY \xB7 fault: EMPTY_RESPONSE",content:{request:{method:"GET",urlPath:"/api/empty"},response:{status:200,fault:"EMPTY_RESPONSE"}}},{id:"fault-malformed-response",title:"Malformed Response",description:"Corrupted chunk fault.",category:"faults",highlight:"ANY \xB7 fault: MALFORMED_RESPONSE_CHUNK",content:{request:{method:"GET",urlPath:"/api/corrupt"},response:{status:200,fault:"MALFORMED_RESPONSE_CHUNK"}}},{id:"scenario-retry-500-200",title:"Retry: 500 \u2192 200",description:"First call fails, retry succeeds.",category:"scenarios",highlight:"Scenario \xB7 /api/flaky",popular:!0,content:{mappings:[{scenarioName:"Retry_Scenario",requiredScenarioState:"Started",newScenarioState:"Recovered",request:{method:"GET",urlPath:"/api/flaky"},response:{status:500,jsonBody:{error:"Temporary failure"}}},{scenarioName:"Retry_Scenario",requiredScenarioState:"Recovered",request:{method:"GET",urlPath:"/api/flaky"},response:{status:200,jsonBody:{message:"Success"}}}]}},{id:"scenario-todo-workflow",title:"Todo List Workflow",description:"Create \u2192 Read \u2192 Update lifecycle.",category:"scenarios",highlight:"Scenario \xB7 /todo/items",content:{mappings:[{scenarioName:"todo_list",requiredScenarioState:"Started",request:{method:"GET",url:"/todo/items"},response:{status:200,jsonBody:{items:["Buy milk"]}}},{scenarioName:"todo_list",requiredScenarioState:"Started",newScenarioState:"Item added",request:{method:"POST",url:"/todo/items",bodyPatterns:[{contains:"Cancel subscription"}]},response:{status:201}},{scenarioName:"todo_list",requiredScenarioState:"Item added",request:{method:"GET",url:"/todo/items"},response:{status:200,jsonBody:{items:["Buy milk","Cancel subscription"]}}}]}},{id:"scenario-order-lifecycle",title:"Order Lifecycle",description:"Order status across states.",category:"scenarios",highlight:"Scenario \xB7 /orders/123/status",content:{mappings:[{scenarioName:"Order_Status",requiredScenarioState:"Started",newScenarioState:"Processing",request:{method:"GET",urlPath:"/orders/123/status"},response:{status:200,jsonBody:{status:"pending"}}},{scenarioName:"Order_Status",requiredScenarioState:"Processing",newScenarioState:"Shipped",request:{method:"GET",urlPath:"/orders/123/status"},response:{status:200,jsonBody:{status:"processing"}}},{scenarioName:"Order_Status",requiredScenarioState:"Shipped",request:{method:"GET",urlPath:"/orders/123/status"},response:{status:200,jsonBody:{status:"shipped"}}}]}},{id:"dynamic-echo-request",title:"Echo Request",description:"Reflect request values in the response.",category:"dynamic",highlight:"ANY \xB7 /api/echo/*",feature:{path:["response","jsonBody","path"],label:"response.jsonBody.*"},popular:!0,content:{request:{method:"ANY",urlPathPattern:"/api/echo/.*"},response:{status:200,jsonBody:{path:"{{request.path}}",query:"{{request.query.q}}",header:"{{request.headers.X-Custom}}",timestamp:"{{now}}"},transformers:["response-template"]}}},{id:"dynamic-jsonpath-extract",title:"JSONPath Extract",description:"Use JSONPath to pull fields from the request body.",category:"dynamic",highlight:"POST \xB7 /api/process",content:{request:{method:"POST",urlPath:"/api/process"},response:{status:200,body:`{"name": "{{jsonPath request.body '$.name'}}"}`,transformers:["response-template"]}}},{id:"dynamic-random-values",title:"Random Values",description:"Generate UUIDs, codes, and numbers in the response.",category:"dynamic",highlight:"ANY \xB7 response-template random values",content:{request:{method:"GET",urlPath:"/api/generate"},response:{status:200,jsonBody:{uuid:"{{randomValue type='UUID'}}",code:"{{randomValue length=8 type='ALPHANUMERIC'}}",number:"{{randomInt lower=1 upper=100}}",type:"ORDER_ACCEPTED",orderId:"{{jsonPath request.body '$.orderId'}}",occurredAt:`{{now offset='0' pattern=\\"yyyy-MM-dd'T'HH:mm:ssXXX\\"}}`},transformers:["response-template"]}}},{id:"match-url-regex",title:"URL Pattern (Regex)",description:"Regex path matcher for numeric IDs.",category:"matching",highlight:"GET \xB7 /api/users/{id}/orders/{orderId}",content:{request:{method:"GET",urlPathPattern:"/api/users/[0-9]+/orders/[a-f0-9-]+"}}},{id:"match-query-params",title:"Query Parameters",description:"Match search params with combinations.",category:"matching",highlight:"GET \xB7 /api/search?q=\u2026",popular:!0,content:{request:{method:"GET",urlPath:"/api/search",queryParameters:{q:{matches:".+"},page:{equalTo:"1"},limit:{or:[{equalTo:"10"},{equalTo:"20"}]}}},response:{status:200}}},{id:"match-headers",title:"Headers",description:"Match requests by required headers.",category:"matching",highlight:"ANY \xB7 header matchers",content:{request:{method:"ANY",urlPath:"/api/data",headers:{Accept:{contains:"application/json"},Authorization:{matches:"Bearer .+"}}},response:{status:200}}},{id:"match-json-equal",title:"JSON Body (equalToJson)",description:"Semantic JSON comparison with json-unit helpers.",category:"matching",highlight:"POST \xB7 equalToJson",content:{request:{method:"POST",urlPath:"/api/orders",bodyPatterns:[{equalToJson:{customerId:"${json-unit.any-string}",total:"${json-unit.any-number}"},ignoreArrayOrder:!0,ignoreExtraElements:!0}]},response:{status:201}}},{id:"match-jsonpath",title:"JSONPath",description:"Multiple JSONPath checks in one stub.",category:"matching",highlight:"POST \xB7 matchesJsonPath",content:{request:{method:"POST",urlPath:"/api/events",bodyPatterns:[{matchesJsonPath:"$.type"},{matchesJsonPath:"$[?(@.priority > 5)]"},{matchesJsonPath:{expression:"$.email",contains:"@example.com"}}]},response:{status:200}}},{id:"match-basic-auth",title:"Basic Auth",description:"Protect endpoints with HTTP Basic Auth.",category:"matching",highlight:"ANY \xB7 basicAuthCredentials",content:{request:{method:"GET",urlPath:"/api/secure",basicAuthCredentials:{username:"admin",password:"secret"}},response:{status:200}}},{id:"webhook-simple",title:"Simple Webhook",description:"Send a POST callback after accepting a request.",category:"webhooks",highlight:"POST \xB7 /api/trigger \xB7 webhook",popular:!0,content:{request:{method:"POST",urlPath:"/api/trigger"},response:{status:202},serveEventListeners:[{name:"webhook",parameters:{method:"POST",url:"http://callback-service/webhook",headers:{"Content-Type":"application/json"},body:'{"status": "complete"}'}}]}},{id:"webhook-templated",title:"Templated Webhook",description:"Populate webhook payload from the original request.",category:"webhooks",highlight:"POST \xB7 templated callback",content:{request:{method:"POST",urlPath:"/api/orders"},response:{status:202},serveEventListeners:[{name:"webhook",parameters:{url:"{{jsonPath originalRequest.body '$.callbackUrl'}}",body:`{"orderId": "{{jsonPath originalRequest.body '$.orderId'}}"}`}}]}},{id:"webhook-delayed",title:"Delayed Webhook",description:"Schedule a callback after a fixed delay.",category:"webhooks",highlight:"POST \xB7 delay \u2192 webhook",content:{request:{method:"POST",urlPath:"/api/async-job"},response:{status:202},serveEventListeners:[{name:"webhook",parameters:{url:"http://service/callback",delay:{type:"fixed",milliseconds:5e3}}}]}},{id:"proxy-full",title:"Full Proxy",description:"Pass all traffic through to an upstream API.",category:"proxy",highlight:"ANY \xB7 /api/* \u2192 proxy",popular:!0,content:{priority:10,request:{method:"ANY",urlPattern:"/api/.*"},response:{status:200,proxyBaseUrl:"https://api.example.com"}}},{id:"proxy-override",title:"Proxy + Override",description:"Forward with extra headers or overrides.",category:"proxy",highlight:"ANY \xB7 proxy with headers",content:{priority:100,request:{method:"ANY",urlPattern:"/api/.*"},response:{status:200,proxyBaseUrl:"https://api.example.com",additionalProxyRequestHeaders:{"X-Forwarded-By":"WireMock"}}}},{id:"proxy-start-recording",title:"Start Recording",description:"Record traffic for snapshotting stubs.",category:"proxy",highlight:"ADMIN \xB7 recording",content:{request:{method:"POST",urlPath:"/__admin/recordings/start"},response:{status:200},targetBaseUrl:"https://api.example.com",captureHeaders:{Accept:{},Authorization:{caseInsensitive:!0}},requestBodyPattern:{matcher:"equalToJson",ignoreArrayOrder:!0},persist:!0,repeatsAsScenarios:!0}}];function i(c){return JSON.parse(JSON.stringify(c))}function r(c){if(!c||typeof c!="object")throw new Error("Template must be an object");if(!c.id)throw new Error("Template requires an id");return JSON.parse(JSON.stringify(c))}const o={getAll(){return t.map(i)},findById(c){return t.find(s=>s.id===c)||null},register(c){const s=r(c),l=t.findIndex(d=>d.id===s.id);return l>=0?t[l]=s:t.push(s),this.getAll()},replaceAll(c){if(!Array.isArray(c))throw new Error("replaceAll expects an array of templates");t.length=0;for(const s of c)t.push(JSON.parse(JSON.stringify(s)));return this.getAll()}};Object.freeze(o),e.MonacoTemplateLibrary||Object.defineProperty(e,"MonacoTemplateLibrary",{value:o,configurable:!1,enumerable:!0,writable:!1})})(typeof window<"u"?window:globalThis);/*! js-yaml 4.1.0 https://github.com/nodeca/js-yaml @license MIT */(function(n,e){typeof exports=="object"&&typeof module<"u"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):e((n=typeof globalThis<"u"?globalThis:n||self).jsyaml={})})(this,(function(n){"use strict";function e(a){return a==null}var t={isNothing:e,isObject:function(a){return typeof a=="object"&&a!==null},toArray:function(a){return Array.isArray(a)?a:e(a)?[]:[a]},repeat:function(a,u){var w,E="";for(w=0;w<u;w+=1)E+=a;return E},isNegativeZero:function(a){return a===0&&Number.NEGATIVE_INFINITY===1/a},extend:function(a,u){var w,E,b,N;if(u)for(w=0,E=(N=Object.keys(u)).length;w<E;w+=1)a[b=N[w]]=u[b];return a}};function i(a,u){var w="",E=a.reason||"(unknown reason)";return a.mark?(a.mark.name&&(w+='in "'+a.mark.name+'" '),w+="("+(a.mark.line+1)+":"+(a.mark.column+1)+")",!u&&a.mark.snippet&&(w+=`

`+a.mark.snippet),E+" "+w):E}function r(a,u){Error.call(this),this.name="YAMLException",this.reason=a,this.mark=u,this.message=i(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r.prototype.toString=function(a){return this.name+": "+i(this,a)};var o=r;function c(a,u,w,E,b){var N="",O="",L=Math.floor(b/2)-1;return E-u>L&&(u=E-L+(N=" ... ").length),w-E>L&&(w=E+L-(O=" ...").length),{str:N+a.slice(u,w).replace(/\t/g,"\u2192")+O,pos:E-u+N.length}}function s(a,u){return t.repeat(" ",u-a.length)+a}var l=function(a,u){if(u=Object.create(u||null),!a.buffer)return null;u.maxLength||(u.maxLength=79),typeof u.indent!="number"&&(u.indent=1),typeof u.linesBefore!="number"&&(u.linesBefore=3),typeof u.linesAfter!="number"&&(u.linesAfter=2);for(var w,E=/\r?\n|\r|\0/g,b=[0],N=[],O=-1;w=E.exec(a.buffer);)N.push(w.index),b.push(w.index+w[0].length),a.position<=w.index&&O<0&&(O=b.length-2);O<0&&(O=b.length-1);var L,x,Y="",Q=Math.min(a.line+u.linesAfter,N.length).toString().length,ee=u.maxLength-(u.indent+Q+3);for(L=1;L<=u.linesBefore&&!(O-L<0);L++)x=c(a.buffer,b[O-L],N[O-L],a.position-(b[O]-b[O-L]),ee),Y=t.repeat(" ",u.indent)+s((a.line-L+1).toString(),Q)+" | "+x.str+`
`+Y;for(x=c(a.buffer,b[O],N[O],a.position,ee),Y+=t.repeat(" ",u.indent)+s((a.line+1).toString(),Q)+" | "+x.str+`
`,Y+=t.repeat("-",u.indent+Q+3+x.pos)+`^
`,L=1;L<=u.linesAfter&&!(O+L>=N.length);L++)x=c(a.buffer,b[O+L],N[O+L],a.position-(b[O]-b[O+L]),ee),Y+=t.repeat(" ",u.indent)+s((a.line+L+1).toString(),Q)+" | "+x.str+`
`;return Y.replace(/\n$/,"")},d=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],f=["scalar","sequence","mapping"],h=function(a,u){if(u=u||{},Object.keys(u).forEach((function(w){if(d.indexOf(w)===-1)throw new o('Unknown option "'+w+'" is met in definition of "'+a+'" YAML type.')})),this.options=u,this.tag=a,this.kind=u.kind||null,this.resolve=u.resolve||function(){return!0},this.construct=u.construct||function(w){return w},this.instanceOf=u.instanceOf||null,this.predicate=u.predicate||null,this.represent=u.represent||null,this.representName=u.representName||null,this.defaultStyle=u.defaultStyle||null,this.multi=u.multi||!1,this.styleAliases=(function(w){var E={};return w!==null&&Object.keys(w).forEach((function(b){w[b].forEach((function(N){E[String(N)]=b}))})),E})(u.styleAliases||null),f.indexOf(this.kind)===-1)throw new o('Unknown kind "'+this.kind+'" is specified for "'+a+'" YAML type.')};function m(a,u){var w=[];return a[u].forEach((function(E){var b=w.length;w.forEach((function(N,O){N.tag===E.tag&&N.kind===E.kind&&N.multi===E.multi&&(b=O)})),w[b]=E})),w}function M(a){return this.extend(a)}M.prototype.extend=function(a){var u=[],w=[];if(a instanceof h)w.push(a);else if(Array.isArray(a))w=w.concat(a);else{if(!a||!Array.isArray(a.implicit)&&!Array.isArray(a.explicit))throw new o("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");a.implicit&&(u=u.concat(a.implicit)),a.explicit&&(w=w.concat(a.explicit))}u.forEach((function(b){if(!(b instanceof h))throw new o("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(b.loadKind&&b.loadKind!=="scalar")throw new o("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(b.multi)throw new o("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),w.forEach((function(b){if(!(b instanceof h))throw new o("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var E=Object.create(M.prototype);return E.implicit=(this.implicit||[]).concat(u),E.explicit=(this.explicit||[]).concat(w),E.compiledImplicit=m(E,"implicit"),E.compiledExplicit=m(E,"explicit"),E.compiledTypeMap=(function(){var b,N,O={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function L(x){x.multi?(O.multi[x.kind].push(x),O.multi.fallback.push(x)):O[x.kind][x.tag]=O.fallback[x.tag]=x}for(b=0,N=arguments.length;b<N;b+=1)arguments[b].forEach(L);return O})(E.compiledImplicit,E.compiledExplicit),E};var I=M,T=new h("tag:yaml.org,2002:str",{kind:"scalar",construct:function(a){return a!==null?a:""}}),g=new h("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(a){return a!==null?a:[]}}),y=new h("tag:yaml.org,2002:map",{kind:"mapping",construct:function(a){return a!==null?a:{}}}),C=new I({explicit:[T,g,y]}),A=new h("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(a){if(a===null)return!0;var u=a.length;return u===1&&a==="~"||u===4&&(a==="null"||a==="Null"||a==="NULL")},construct:function(){return null},predicate:function(a){return a===null},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"}),B=new h("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(a){if(a===null)return!1;var u=a.length;return u===4&&(a==="true"||a==="True"||a==="TRUE")||u===5&&(a==="false"||a==="False"||a==="FALSE")},construct:function(a){return a==="true"||a==="True"||a==="TRUE"},predicate:function(a){return Object.prototype.toString.call(a)==="[object Boolean]"},represent:{lowercase:function(a){return a?"true":"false"},uppercase:function(a){return a?"TRUE":"FALSE"},camelcase:function(a){return a?"True":"False"}},defaultStyle:"lowercase"});function X(a){return 48<=a&&a<=55}function H(a){return 48<=a&&a<=57}var le=new h("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(a){if(a===null)return!1;var u,w,E=a.length,b=0,N=!1;if(!E)return!1;if((u=a[b])!=="-"&&u!=="+"||(u=a[++b]),u==="0"){if(b+1===E)return!0;if((u=a[++b])==="b"){for(b++;b<E;b++)if((u=a[b])!=="_"){if(u!=="0"&&u!=="1")return!1;N=!0}return N&&u!=="_"}if(u==="x"){for(b++;b<E;b++)if((u=a[b])!=="_"){if(!(48<=(w=a.charCodeAt(b))&&w<=57||65<=w&&w<=70||97<=w&&w<=102))return!1;N=!0}return N&&u!=="_"}if(u==="o"){for(b++;b<E;b++)if((u=a[b])!=="_"){if(!X(a.charCodeAt(b)))return!1;N=!0}return N&&u!=="_"}}if(u==="_")return!1;for(;b<E;b++)if((u=a[b])!=="_"){if(!H(a.charCodeAt(b)))return!1;N=!0}return!(!N||u==="_")},construct:function(a){var u,w=a,E=1;if(w.indexOf("_")!==-1&&(w=w.replace(/_/g,"")),(u=w[0])!=="-"&&u!=="+"||(u==="-"&&(E=-1),u=(w=w.slice(1))[0]),w==="0")return 0;if(u==="0"){if(w[1]==="b")return E*parseInt(w.slice(2),2);if(w[1]==="x")return E*parseInt(w.slice(2),16);if(w[1]==="o")return E*parseInt(w.slice(2),8)}return E*parseInt(w,10)},predicate:function(a){return Object.prototype.toString.call(a)==="[object Number]"&&a%1==0&&!t.isNegativeZero(a)},represent:{binary:function(a){return a>=0?"0b"+a.toString(2):"-0b"+a.toString(2).slice(1)},octal:function(a){return a>=0?"0o"+a.toString(8):"-0o"+a.toString(8).slice(1)},decimal:function(a){return a.toString(10)},hexadecimal:function(a){return a>=0?"0x"+a.toString(16).toUpperCase():"-0x"+a.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),Se=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),U=/^[-+]?[0-9]+e/,j=new h("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(a){return a!==null&&!(!Se.test(a)||a[a.length-1]==="_")},construct:function(a){var u,w;return w=(u=a.replace(/_/g,"").toLowerCase())[0]==="-"?-1:1,"+-".indexOf(u[0])>=0&&(u=u.slice(1)),u===".inf"?w===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:u===".nan"?NaN:w*parseFloat(u,10)},predicate:function(a){return Object.prototype.toString.call(a)==="[object Number]"&&(a%1!=0||t.isNegativeZero(a))},represent:function(a,u){var w;if(isNaN(a))switch(u){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===a)switch(u){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===a)switch(u){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(t.isNegativeZero(a))return"-0.0";return w=a.toString(10),U.test(w)?w.replace("e",".e"):w},defaultStyle:"lowercase"}),F=C.extend({implicit:[A,B,le,j]}),v=F,k=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),q=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$"),W=new h("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(a){return a!==null&&(k.exec(a)!==null||q.exec(a)!==null)},construct:function(a){var u,w,E,b,N,O,L,x,Y=0,Q=null;if((u=k.exec(a))===null&&(u=q.exec(a)),u===null)throw new Error("Date resolve error");if(w=+u[1],E=+u[2]-1,b=+u[3],!u[4])return new Date(Date.UTC(w,E,b));if(N=+u[4],O=+u[5],L=+u[6],u[7]){for(Y=u[7].slice(0,3);Y.length<3;)Y+="0";Y=+Y}return u[9]&&(Q=6e4*(60*+u[10]+ +(u[11]||0)),u[9]==="-"&&(Q=-Q)),x=new Date(Date.UTC(w,E,b,N,O,L,Y)),Q&&x.setTime(x.getTime()-Q),x},instanceOf:Date,represent:function(a){return a.toISOString()}}),ne=new h("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(a){return a==="<<"||a===null}}),be=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`,ot=new h("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(a){if(a===null)return!1;var u,w,E=0,b=a.length,N=be;for(w=0;w<b;w++)if(!((u=N.indexOf(a.charAt(w)))>64)){if(u<0)return!1;E+=6}return E%8==0},construct:function(a){var u,w,E=a.replace(/[\r\n=]/g,""),b=E.length,N=be,O=0,L=[];for(u=0;u<b;u++)u%4==0&&u&&(L.push(O>>16&255),L.push(O>>8&255),L.push(255&O)),O=O<<6|N.indexOf(E.charAt(u));return(w=b%4*6)===0?(L.push(O>>16&255),L.push(O>>8&255),L.push(255&O)):w===18?(L.push(O>>10&255),L.push(O>>2&255)):w===12&&L.push(O>>4&255),new Uint8Array(L)},predicate:function(a){return Object.prototype.toString.call(a)==="[object Uint8Array]"},represent:function(a){var u,w,E="",b=0,N=a.length,O=be;for(u=0;u<N;u++)u%3==0&&u&&(E+=O[b>>18&63],E+=O[b>>12&63],E+=O[b>>6&63],E+=O[63&b]),b=(b<<8)+a[u];return(w=N%3)===0?(E+=O[b>>18&63],E+=O[b>>12&63],E+=O[b>>6&63],E+=O[63&b]):w===2?(E+=O[b>>10&63],E+=O[b>>4&63],E+=O[b<<2&63],E+=O[64]):w===1&&(E+=O[b>>2&63],E+=O[b<<4&63],E+=O[64],E+=O[64]),E}}),Le=Object.prototype.hasOwnProperty,We=Object.prototype.toString,at=new h("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(a){if(a===null)return!0;var u,w,E,b,N,O=[],L=a;for(u=0,w=L.length;u<w;u+=1){if(E=L[u],N=!1,We.call(E)!=="[object Object]")return!1;for(b in E)if(Le.call(E,b)){if(N)return!1;N=!0}if(!N||O.indexOf(b)!==-1)return!1;O.push(b)}return!0},construct:function(a){return a!==null?a:[]}}),Nt=Object.prototype.toString,Ye=new h("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(a){if(a===null)return!0;var u,w,E,b,N,O=a;for(N=new Array(O.length),u=0,w=O.length;u<w;u+=1){if(E=O[u],Nt.call(E)!=="[object Object]"||(b=Object.keys(E)).length!==1)return!1;N[u]=[b[0],E[b[0]]]}return!0},construct:function(a){if(a===null)return[];var u,w,E,b,N,O=a;for(N=new Array(O.length),u=0,w=O.length;u<w;u+=1)E=O[u],b=Object.keys(E),N[u]=[b[0],E[b[0]]];return N}}),Rt=Object.prototype.hasOwnProperty,Be=new h("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(a){if(a===null)return!0;var u,w=a;for(u in w)if(Rt.call(w,u)&&w[u]!==null)return!1;return!0},construct:function(a){return a!==null?a:{}}}),st=v.extend({implicit:[W,ne],explicit:[ot,at,Ye,Be]}),se=Object.prototype.hasOwnProperty,Te=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,He=/[\x85\u2028\u2029]/,Fe=/[,\[\]\{\}]/,Ge=/^(?:!|!!|![a-z\-]+!)$/i,et=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function Ke(a){return Object.prototype.toString.call(a)}function Ce(a){return a===10||a===13}function qe(a){return a===9||a===32}function Me(a){return a===9||a===32||a===10||a===13}function ze(a){return a===44||a===91||a===93||a===123||a===125}function Mt(a){var u;return 48<=a&&a<=57?a-48:97<=(u=32|a)&&u<=102?u-97+10:-1}function mt(a){return a===48?"\0":a===97?"\x07":a===98?"\b":a===116||a===9?"	":a===110?`
`:a===118?"\v":a===102?"\f":a===114?"\r":a===101?"\x1B":a===32?" ":a===34?'"':a===47?"/":a===92?"\\":a===78?"\x85":a===95?"\xA0":a===76?"\u2028":a===80?"\u2029":""}function ht(a){return a<=65535?String.fromCharCode(a):String.fromCharCode(55296+(a-65536>>10),56320+(a-65536&1023))}for(var gt=new Array(256),yt=new Array(256),$e=0;$e<256;$e++)gt[$e]=mt($e)?1:0,yt[$e]=mt($e);function It(a,u){this.input=a,this.filename=u.filename||null,this.schema=u.schema||st,this.onWarning=u.onWarning||null,this.legacy=u.legacy||!1,this.json=u.json||!1,this.listener=u.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=a.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Ot(a,u){var w={name:a.filename,buffer:a.input.slice(0,-1),position:a.position,line:a.line,column:a.position-a.lineStart};return w.snippet=l(w),new o(u,w)}function V(a,u){throw Ot(a,u)}function wt(a,u){a.onWarning&&a.onWarning.call(null,Ot(a,u))}var ct={YAML:function(a,u,w){var E,b,N;a.version!==null&&V(a,"duplication of %YAML directive"),w.length!==1&&V(a,"YAML directive accepts exactly one argument"),(E=/^([0-9]+)\.([0-9]+)$/.exec(w[0]))===null&&V(a,"ill-formed argument of the YAML directive"),b=parseInt(E[1],10),N=parseInt(E[2],10),b!==1&&V(a,"unacceptable YAML version of the document"),a.version=w[0],a.checkLineBreaks=N<2,N!==1&&N!==2&&wt(a,"unsupported YAML version of the document")},TAG:function(a,u,w){var E,b;w.length!==2&&V(a,"TAG directive accepts exactly two arguments"),E=w[0],b=w[1],Ge.test(E)||V(a,"ill-formed tag handle (first argument) of the TAG directive"),se.call(a.tagMap,E)&&V(a,'there is a previously declared suffix for "'+E+'" tag handle'),et.test(b)||V(a,"ill-formed tag prefix (second argument) of the TAG directive");try{b=decodeURIComponent(b)}catch{V(a,"tag prefix is malformed: "+b)}a.tagMap[E]=b}};function Je(a,u,w,E){var b,N,O,L;if(u<w){if(L=a.input.slice(u,w),E)for(b=0,N=L.length;b<N;b+=1)(O=L.charCodeAt(b))===9||32<=O&&O<=1114111||V(a,"expected valid JSON character");else Te.test(L)&&V(a,"the stream contains non-printable characters");a.result+=L}}function Tt(a,u,w,E){var b,N,O,L;for(t.isObject(w)||V(a,"cannot merge mappings; the provided source object is unacceptable"),O=0,L=(b=Object.keys(w)).length;O<L;O+=1)N=b[O],se.call(u,N)||(u[N]=w[N],E[N]=!0)}function tt(a,u,w,E,b,N,O,L,x){var Y,Q;if(Array.isArray(b))for(Y=0,Q=(b=Array.prototype.slice.call(b)).length;Y<Q;Y+=1)Array.isArray(b[Y])&&V(a,"nested arrays are not supported inside keys"),typeof b=="object"&&Ke(b[Y])==="[object Object]"&&(b[Y]="[object Object]");if(typeof b=="object"&&Ke(b)==="[object Object]"&&(b="[object Object]"),b=String(b),u===null&&(u={}),E==="tag:yaml.org,2002:merge")if(Array.isArray(N))for(Y=0,Q=N.length;Y<Q;Y+=1)Tt(a,u,N[Y],w);else Tt(a,u,N,w);else a.json||se.call(w,b)||!se.call(u,b)||(a.line=O||a.line,a.lineStart=L||a.lineStart,a.position=x||a.position,V(a,"duplicated mapping key")),b==="__proto__"?Object.defineProperty(u,b,{configurable:!0,enumerable:!0,writable:!0,value:N}):u[b]=N,delete w[b];return u}function vt(a){var u;(u=a.input.charCodeAt(a.position))===10?a.position++:u===13?(a.position++,a.input.charCodeAt(a.position)===10&&a.position++):V(a,"a line break is expected"),a.line+=1,a.lineStart=a.position,a.firstTabInLine=-1}function Ee(a,u,w){for(var E=0,b=a.input.charCodeAt(a.position);b!==0;){for(;qe(b);)b===9&&a.firstTabInLine===-1&&(a.firstTabInLine=a.position),b=a.input.charCodeAt(++a.position);if(u&&b===35)do b=a.input.charCodeAt(++a.position);while(b!==10&&b!==13&&b!==0);if(!Ce(b))break;for(vt(a),b=a.input.charCodeAt(a.position),E++,a.lineIndent=0;b===32;)a.lineIndent++,b=a.input.charCodeAt(++a.position)}return w!==-1&&E!==0&&a.lineIndent<w&&wt(a,"deficient indentation"),E}function St(a){var u,w=a.position;return!((u=a.input.charCodeAt(w))!==45&&u!==46||u!==a.input.charCodeAt(w+1)||u!==a.input.charCodeAt(w+2)||(w+=3,(u=a.input.charCodeAt(w))!==0&&!Me(u)))}function Ct(a,u){u===1?a.result+=" ":u>1&&(a.result+=t.repeat(`
`,u-1))}function Lt(a,u){var w,E,b=a.tag,N=a.anchor,O=[],L=!1;if(a.firstTabInLine!==-1)return!1;for(a.anchor!==null&&(a.anchorMap[a.anchor]=O),E=a.input.charCodeAt(a.position);E!==0&&(a.firstTabInLine!==-1&&(a.position=a.firstTabInLine,V(a,"tab characters must not be used in indentation")),E===45)&&Me(a.input.charCodeAt(a.position+1));)if(L=!0,a.position++,Ee(a,!0,-1)&&a.lineIndent<=u)O.push(null),E=a.input.charCodeAt(a.position);else if(w=a.line,nt(a,u,3,!1,!0),O.push(a.result),Ee(a,!0,-1),E=a.input.charCodeAt(a.position),(a.line===w||a.lineIndent>u)&&E!==0)V(a,"bad indentation of a sequence entry");else if(a.lineIndent<u)break;return!!L&&(a.tag=b,a.anchor=N,a.kind="sequence",a.result=O,!0)}function ve(a){var u,w,E,b,N=!1,O=!1;if((b=a.input.charCodeAt(a.position))!==33)return!1;if(a.tag!==null&&V(a,"duplication of a tag property"),(b=a.input.charCodeAt(++a.position))===60?(N=!0,b=a.input.charCodeAt(++a.position)):b===33?(O=!0,w="!!",b=a.input.charCodeAt(++a.position)):w="!",u=a.position,N){do b=a.input.charCodeAt(++a.position);while(b!==0&&b!==62);a.position<a.length?(E=a.input.slice(u,a.position),b=a.input.charCodeAt(++a.position)):V(a,"unexpected end of the stream within a verbatim tag")}else{for(;b!==0&&!Me(b);)b===33&&(O?V(a,"tag suffix cannot contain exclamation marks"):(w=a.input.slice(u-1,a.position+1),Ge.test(w)||V(a,"named tag handle cannot contain such characters"),O=!0,u=a.position+1)),b=a.input.charCodeAt(++a.position);E=a.input.slice(u,a.position),Fe.test(E)&&V(a,"tag suffix cannot contain flow indicator characters")}E&&!et.test(E)&&V(a,"tag name cannot contain such characters: "+E);try{E=decodeURIComponent(E)}catch{V(a,"tag name is malformed: "+E)}return N?a.tag=E:se.call(a.tagMap,w)?a.tag=a.tagMap[w]+E:w==="!"?a.tag="!"+E:w==="!!"?a.tag="tag:yaml.org,2002:"+E:V(a,'undeclared tag handle "'+w+'"'),!0}function Pt(a){var u,w;if((w=a.input.charCodeAt(a.position))!==38)return!1;for(a.anchor!==null&&V(a,"duplication of an anchor property"),w=a.input.charCodeAt(++a.position),u=a.position;w!==0&&!Me(w)&&!ze(w);)w=a.input.charCodeAt(++a.position);return a.position===u&&V(a,"name of an anchor node must contain at least one character"),a.anchor=a.input.slice(u,a.position),!0}function nt(a,u,w,E,b){var N,O,L,x,Y,Q,ee,we,G,he=1,me=!1,ge=!1;if(a.listener!==null&&a.listener("open",a),a.tag=null,a.anchor=null,a.kind=null,a.result=null,N=O=L=w===4||w===3,E&&Ee(a,!0,-1)&&(me=!0,a.lineIndent>u?he=1:a.lineIndent===u?he=0:a.lineIndent<u&&(he=-1)),he===1)for(;ve(a)||Pt(a);)Ee(a,!0,-1)?(me=!0,L=N,a.lineIndent>u?he=1:a.lineIndent===u?he=0:a.lineIndent<u&&(he=-1)):L=!1;if(L&&(L=me||b),he!==1&&w!==4||(we=w===1||w===2?u:u+1,G=a.position-a.lineStart,he===1?L&&(Lt(a,G)||(function(p,re,te){var Z,ce,K,ue,de,fe,ye,ae=p.tag,Ie=p.anchor,Ae={},Ne=Object.create(null),Ue=null,je=null,ut=null,ke=!1,bt=!1;if(p.firstTabInLine!==-1)return!1;for(p.anchor!==null&&(p.anchorMap[p.anchor]=Ae),ye=p.input.charCodeAt(p.position);ye!==0;){if(ke||p.firstTabInLine===-1||(p.position=p.firstTabInLine,V(p,"tab characters must not be used in indentation")),Z=p.input.charCodeAt(p.position+1),K=p.line,ye!==63&&ye!==58||!Me(Z)){if(ue=p.line,de=p.lineStart,fe=p.position,!nt(p,te,2,!1,!0))break;if(p.line===K){for(ye=p.input.charCodeAt(p.position);qe(ye);)ye=p.input.charCodeAt(++p.position);if(ye===58)Me(ye=p.input.charCodeAt(++p.position))||V(p,"a whitespace character is expected after the key-value separator within a block mapping"),ke&&(tt(p,Ae,Ne,Ue,je,null,ue,de,fe),Ue=je=ut=null),bt=!0,ke=!1,ce=!1,Ue=p.tag,je=p.result;else{if(!bt)return p.tag=ae,p.anchor=Ie,!0;V(p,"can not read an implicit mapping pair; a colon is missed")}}else{if(!bt)return p.tag=ae,p.anchor=Ie,!0;V(p,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else ye===63?(ke&&(tt(p,Ae,Ne,Ue,je,null,ue,de,fe),Ue=je=ut=null),bt=!0,ke=!0,ce=!0):ke?(ke=!1,ce=!0):V(p,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),p.position+=1,ye=Z;if((p.line===K||p.lineIndent>re)&&(ke&&(ue=p.line,de=p.lineStart,fe=p.position),nt(p,re,4,!0,ce)&&(ke?je=p.result:ut=p.result),ke||(tt(p,Ae,Ne,Ue,je,ut,ue,de,fe),Ue=je=ut=null),Ee(p,!0,-1),ye=p.input.charCodeAt(p.position)),(p.line===K||p.lineIndent>re)&&ye!==0)V(p,"bad indentation of a mapping entry");else if(p.lineIndent<re)break}return ke&&tt(p,Ae,Ne,Ue,je,null,ue,de,fe),bt&&(p.tag=ae,p.anchor=Ie,p.kind="mapping",p.result=Ae),bt})(a,G,we))||(function(p,re){var te,Z,ce,K,ue,de,fe,ye,ae,Ie,Ae,Ne,Ue=!0,je=p.tag,ut=p.anchor,ke=Object.create(null);if((Ne=p.input.charCodeAt(p.position))===91)ue=93,ye=!1,K=[];else{if(Ne!==123)return!1;ue=125,ye=!0,K={}}for(p.anchor!==null&&(p.anchorMap[p.anchor]=K),Ne=p.input.charCodeAt(++p.position);Ne!==0;){if(Ee(p,!0,re),(Ne=p.input.charCodeAt(p.position))===ue)return p.position++,p.tag=je,p.anchor=ut,p.kind=ye?"mapping":"sequence",p.result=K,!0;Ue?Ne===44&&V(p,"expected the node content, but found ','"):V(p,"missed comma between flow collection entries"),Ae=null,de=fe=!1,Ne===63&&Me(p.input.charCodeAt(p.position+1))&&(de=fe=!0,p.position++,Ee(p,!0,re)),te=p.line,Z=p.lineStart,ce=p.position,nt(p,re,1,!1,!0),Ie=p.tag,ae=p.result,Ee(p,!0,re),Ne=p.input.charCodeAt(p.position),!fe&&p.line!==te||Ne!==58||(de=!0,Ne=p.input.charCodeAt(++p.position),Ee(p,!0,re),nt(p,re,1,!1,!0),Ae=p.result),ye?tt(p,K,ke,Ie,ae,Ae,te,Z,ce):de?K.push(tt(p,null,ke,Ie,ae,Ae,te,Z,ce)):K.push(ae),Ee(p,!0,re),(Ne=p.input.charCodeAt(p.position))===44?(Ue=!0,Ne=p.input.charCodeAt(++p.position)):Ue=!1}V(p,"unexpected end of the stream within a flow collection")})(a,we)?ge=!0:(O&&(function(p,re){var te,Z,ce,K,ue,de=1,fe=!1,ye=!1,ae=re,Ie=0,Ae=!1;if((K=p.input.charCodeAt(p.position))===124)Z=!1;else{if(K!==62)return!1;Z=!0}for(p.kind="scalar",p.result="";K!==0;)if((K=p.input.charCodeAt(++p.position))===43||K===45)de===1?de=K===43?3:2:V(p,"repeat of a chomping mode identifier");else{if(!((ce=48<=(ue=K)&&ue<=57?ue-48:-1)>=0))break;ce===0?V(p,"bad explicit indentation width of a block scalar; it cannot be less than one"):ye?V(p,"repeat of an indentation width identifier"):(ae=re+ce-1,ye=!0)}if(qe(K)){do K=p.input.charCodeAt(++p.position);while(qe(K));if(K===35)do K=p.input.charCodeAt(++p.position);while(!Ce(K)&&K!==0)}for(;K!==0;){for(vt(p),p.lineIndent=0,K=p.input.charCodeAt(p.position);(!ye||p.lineIndent<ae)&&K===32;)p.lineIndent++,K=p.input.charCodeAt(++p.position);if(!ye&&p.lineIndent>ae&&(ae=p.lineIndent),Ce(K))Ie++;else{if(p.lineIndent<ae){de===3?p.result+=t.repeat(`
`,fe?1+Ie:Ie):de===1&&fe&&(p.result+=`
`);break}for(Z?qe(K)?(Ae=!0,p.result+=t.repeat(`
`,fe?1+Ie:Ie)):Ae?(Ae=!1,p.result+=t.repeat(`
`,Ie+1)):Ie===0?fe&&(p.result+=" "):p.result+=t.repeat(`
`,Ie):p.result+=t.repeat(`
`,fe?1+Ie:Ie),fe=!0,ye=!0,Ie=0,te=p.position;!Ce(K)&&K!==0;)K=p.input.charCodeAt(++p.position);Je(p,te,p.position,!1)}}return!0})(a,we)||(function(p,re){var te,Z,ce;if((te=p.input.charCodeAt(p.position))!==39)return!1;for(p.kind="scalar",p.result="",p.position++,Z=ce=p.position;(te=p.input.charCodeAt(p.position))!==0;)if(te===39){if(Je(p,Z,p.position,!0),(te=p.input.charCodeAt(++p.position))!==39)return!0;Z=p.position,p.position++,ce=p.position}else Ce(te)?(Je(p,Z,ce,!0),Ct(p,Ee(p,!1,re)),Z=ce=p.position):p.position===p.lineStart&&St(p)?V(p,"unexpected end of the document within a single quoted scalar"):(p.position++,ce=p.position);V(p,"unexpected end of the stream within a single quoted scalar")})(a,we)||(function(p,re){var te,Z,ce,K,ue,de,fe;if((de=p.input.charCodeAt(p.position))!==34)return!1;for(p.kind="scalar",p.result="",p.position++,te=Z=p.position;(de=p.input.charCodeAt(p.position))!==0;){if(de===34)return Je(p,te,p.position,!0),p.position++,!0;if(de===92){if(Je(p,te,p.position,!0),Ce(de=p.input.charCodeAt(++p.position)))Ee(p,!1,re);else if(de<256&&gt[de])p.result+=yt[de],p.position++;else if((ue=(fe=de)===120?2:fe===117?4:fe===85?8:0)>0){for(ce=ue,K=0;ce>0;ce--)(ue=Mt(de=p.input.charCodeAt(++p.position)))>=0?K=(K<<4)+ue:V(p,"expected hexadecimal character");p.result+=ht(K),p.position++}else V(p,"unknown escape sequence");te=Z=p.position}else Ce(de)?(Je(p,te,Z,!0),Ct(p,Ee(p,!1,re)),te=Z=p.position):p.position===p.lineStart&&St(p)?V(p,"unexpected end of the document within a double quoted scalar"):(p.position++,Z=p.position)}V(p,"unexpected end of the stream within a double quoted scalar")})(a,we)?ge=!0:(function(p){var re,te,Z;if((Z=p.input.charCodeAt(p.position))!==42)return!1;for(Z=p.input.charCodeAt(++p.position),re=p.position;Z!==0&&!Me(Z)&&!ze(Z);)Z=p.input.charCodeAt(++p.position);return p.position===re&&V(p,"name of an alias node must contain at least one character"),te=p.input.slice(re,p.position),se.call(p.anchorMap,te)||V(p,'unidentified alias "'+te+'"'),p.result=p.anchorMap[te],Ee(p,!0,-1),!0})(a)?(ge=!0,a.tag===null&&a.anchor===null||V(a,"alias node should not have any properties")):(function(p,re,te){var Z,ce,K,ue,de,fe,ye,ae,Ie=p.kind,Ae=p.result;if(Me(ae=p.input.charCodeAt(p.position))||ze(ae)||ae===35||ae===38||ae===42||ae===33||ae===124||ae===62||ae===39||ae===34||ae===37||ae===64||ae===96||(ae===63||ae===45)&&(Me(Z=p.input.charCodeAt(p.position+1))||te&&ze(Z)))return!1;for(p.kind="scalar",p.result="",ce=K=p.position,ue=!1;ae!==0;){if(ae===58){if(Me(Z=p.input.charCodeAt(p.position+1))||te&&ze(Z))break}else if(ae===35){if(Me(p.input.charCodeAt(p.position-1)))break}else{if(p.position===p.lineStart&&St(p)||te&&ze(ae))break;if(Ce(ae)){if(de=p.line,fe=p.lineStart,ye=p.lineIndent,Ee(p,!1,-1),p.lineIndent>=re){ue=!0,ae=p.input.charCodeAt(p.position);continue}p.position=K,p.line=de,p.lineStart=fe,p.lineIndent=ye;break}}ue&&(Je(p,ce,K,!1),Ct(p,p.line-de),ce=K=p.position,ue=!1),qe(ae)||(K=p.position+1),ae=p.input.charCodeAt(++p.position)}return Je(p,ce,K,!1),!!p.result||(p.kind=Ie,p.result=Ae,!1)})(a,we,w===1)&&(ge=!0,a.tag===null&&(a.tag="?")),a.anchor!==null&&(a.anchorMap[a.anchor]=a.result)):he===0&&(ge=L&&Lt(a,G))),a.tag===null)a.anchor!==null&&(a.anchorMap[a.anchor]=a.result);else if(a.tag==="?"){for(a.result!==null&&a.kind!=="scalar"&&V(a,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+a.kind+'"'),x=0,Y=a.implicitTypes.length;x<Y;x+=1)if((ee=a.implicitTypes[x]).resolve(a.result)){a.result=ee.construct(a.result),a.tag=ee.tag,a.anchor!==null&&(a.anchorMap[a.anchor]=a.result);break}}else if(a.tag!=="!"){if(se.call(a.typeMap[a.kind||"fallback"],a.tag))ee=a.typeMap[a.kind||"fallback"][a.tag];else for(ee=null,x=0,Y=(Q=a.typeMap.multi[a.kind||"fallback"]).length;x<Y;x+=1)if(a.tag.slice(0,Q[x].tag.length)===Q[x].tag){ee=Q[x];break}ee||V(a,"unknown tag !<"+a.tag+">"),a.result!==null&&ee.kind!==a.kind&&V(a,"unacceptable node kind for !<"+a.tag+'> tag; it should be "'+ee.kind+'", not "'+a.kind+'"'),ee.resolve(a.result,a.tag)?(a.result=ee.construct(a.result,a.tag),a.anchor!==null&&(a.anchorMap[a.anchor]=a.result)):V(a,"cannot resolve a node with !<"+a.tag+"> explicit tag")}return a.listener!==null&&a.listener("close",a),a.tag!==null||a.anchor!==null||ge}function kt(a){var u,w,E,b,N=a.position,O=!1;for(a.version=null,a.checkLineBreaks=a.legacy,a.tagMap=Object.create(null),a.anchorMap=Object.create(null);(b=a.input.charCodeAt(a.position))!==0&&(Ee(a,!0,-1),b=a.input.charCodeAt(a.position),!(a.lineIndent>0||b!==37));){for(O=!0,b=a.input.charCodeAt(++a.position),u=a.position;b!==0&&!Me(b);)b=a.input.charCodeAt(++a.position);for(E=[],(w=a.input.slice(u,a.position)).length<1&&V(a,"directive name must not be less than one character in length");b!==0;){for(;qe(b);)b=a.input.charCodeAt(++a.position);if(b===35){do b=a.input.charCodeAt(++a.position);while(b!==0&&!Ce(b));break}if(Ce(b))break;for(u=a.position;b!==0&&!Me(b);)b=a.input.charCodeAt(++a.position);E.push(a.input.slice(u,a.position))}b!==0&&vt(a),se.call(ct,w)?ct[w](a,w,E):wt(a,'unknown document directive "'+w+'"')}Ee(a,!0,-1),a.lineIndent===0&&a.input.charCodeAt(a.position)===45&&a.input.charCodeAt(a.position+1)===45&&a.input.charCodeAt(a.position+2)===45?(a.position+=3,Ee(a,!0,-1)):O&&V(a,"directives end mark is expected"),nt(a,a.lineIndent-1,4,!1,!0),Ee(a,!0,-1),a.checkLineBreaks&&He.test(a.input.slice(N,a.position))&&wt(a,"non-ASCII line breaks are interpreted as content"),a.documents.push(a.result),a.position===a.lineStart&&St(a)?a.input.charCodeAt(a.position)===46&&(a.position+=3,Ee(a,!0,-1)):a.position<a.length-1&&V(a,"end of the stream or a document separator is expected")}function S(a,u){u=u||{},(a=String(a)).length!==0&&(a.charCodeAt(a.length-1)!==10&&a.charCodeAt(a.length-1)!==13&&(a+=`
`),a.charCodeAt(0)===65279&&(a=a.slice(1)));var w=new It(a,u),E=a.indexOf("\0");for(E!==-1&&(w.position=E,V(w,"null byte is not allowed in input")),w.input+="\0";w.input.charCodeAt(w.position)===32;)w.lineIndent+=1,w.position+=1;for(;w.position<w.length-1;)kt(w);return w.documents}var R={loadAll:function(a,u,w){u!==null&&typeof u=="object"&&w===void 0&&(w=u,u=null);var E=S(a,w);if(typeof u!="function")return E;for(var b=0,N=E.length;b<N;b+=1)u(E[b])},load:function(a,u){var w=S(a,u);if(w.length!==0){if(w.length===1)return w[0];throw new o("expected a single document in the stream, but found more")}}},P=Object.prototype.toString,D=Object.prototype.hasOwnProperty,z=65279,$={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},J=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],ie=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function pe(a){var u,w,E;if(u=a.toString(16).toUpperCase(),a<=255)w="x",E=2;else if(a<=65535)w="u",E=4;else{if(!(a<=4294967295))throw new o("code point within a string may not be greater than 0xFFFFFFFF");w="U",E=8}return"\\"+w+t.repeat("0",E-u.length)+u}function _(a){this.schema=a.schema||st,this.indent=Math.max(1,a.indent||2),this.noArrayIndent=a.noArrayIndent||!1,this.skipInvalid=a.skipInvalid||!1,this.flowLevel=t.isNothing(a.flowLevel)?-1:a.flowLevel,this.styleMap=(function(u,w){var E,b,N,O,L,x,Y;if(w===null)return{};for(E={},N=0,O=(b=Object.keys(w)).length;N<O;N+=1)L=b[N],x=String(w[L]),L.slice(0,2)==="!!"&&(L="tag:yaml.org,2002:"+L.slice(2)),(Y=u.compiledTypeMap.fallback[L])&&D.call(Y.styleAliases,x)&&(x=Y.styleAliases[x]),E[L]=x;return E})(this.schema,a.styles||null),this.sortKeys=a.sortKeys||!1,this.lineWidth=a.lineWidth||80,this.noRefs=a.noRefs||!1,this.noCompatMode=a.noCompatMode||!1,this.condenseFlow=a.condenseFlow||!1,this.quotingType=a.quotingType==='"'?2:1,this.forceQuotes=a.forceQuotes||!1,this.replacer=typeof a.replacer=="function"?a.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function oe(a,u){for(var w,E=t.repeat(" ",u),b=0,N=-1,O="",L=a.length;b<L;)(N=a.indexOf(`
`,b))===-1?(w=a.slice(b),b=L):(w=a.slice(b,N+1),b=N+1),w.length&&w!==`
`&&(O+=E),O+=w;return O}function Re(a,u){return`
`+t.repeat(" ",a.indent*u)}function xe(a){return a===32||a===9}function _e(a){return 32<=a&&a<=126||161<=a&&a<=55295&&a!==8232&&a!==8233||57344<=a&&a<=65533&&a!==z||65536<=a&&a<=1114111}function Oe(a){return _e(a)&&a!==z&&a!==13&&a!==10}function lt(a,u,w){var E=Oe(a),b=E&&!xe(a);return(w?E:E&&a!==44&&a!==91&&a!==93&&a!==123&&a!==125)&&a!==35&&!(u===58&&!b)||Oe(u)&&!xe(u)&&a===35||u===58&&b}function De(a,u){var w,E=a.charCodeAt(u);return E>=55296&&E<=56319&&u+1<a.length&&(w=a.charCodeAt(u+1))>=56320&&w<=57343?1024*(E-55296)+w-56320+65536:E}function it(a){return/^\n* /.test(a)}function dt(a,u,w,E,b,N,O,L){var x,Y,Q=0,ee=null,we=!1,G=!1,he=E!==-1,me=-1,ge=_e(Y=De(a,0))&&Y!==z&&!xe(Y)&&Y!==45&&Y!==63&&Y!==58&&Y!==44&&Y!==91&&Y!==93&&Y!==123&&Y!==125&&Y!==35&&Y!==38&&Y!==42&&Y!==33&&Y!==124&&Y!==61&&Y!==62&&Y!==39&&Y!==34&&Y!==37&&Y!==64&&Y!==96&&(function(p){return!xe(p)&&p!==58})(De(a,a.length-1));if(u||O)for(x=0;x<a.length;Q>=65536?x+=2:x++){if(!_e(Q=De(a,x)))return 5;ge=ge&&lt(Q,ee,L),ee=Q}else{for(x=0;x<a.length;Q>=65536?x+=2:x++){if((Q=De(a,x))===10)we=!0,he&&(G=G||x-me-1>E&&a[me+1]!==" ",me=x);else if(!_e(Q))return 5;ge=ge&&lt(Q,ee,L),ee=Q}G=G||he&&x-me-1>E&&a[me+1]!==" "}return we||G?w>9&&it(a)?5:O?N===2?5:2:G?4:3:!ge||O||b(a)?N===2?5:2:1}function Ft(a,u,w,E,b){a.dump=(function(){if(u.length===0)return a.quotingType===2?'""':"''";if(!a.noCompatMode&&(J.indexOf(u)!==-1||ie.test(u)))return a.quotingType===2?'"'+u+'"':"'"+u+"'";var N=a.indent*Math.max(1,w),O=a.lineWidth===-1?-1:Math.max(Math.min(a.lineWidth,40),a.lineWidth-N),L=E||a.flowLevel>-1&&w>=a.flowLevel;switch(dt(u,L,a.indent,O,(function(x){return(function(Y,Q){var ee,we;for(ee=0,we=Y.implicitTypes.length;ee<we;ee+=1)if(Y.implicitTypes[ee].resolve(Q))return!0;return!1})(a,x)}),a.quotingType,a.forceQuotes&&!E,b)){case 1:return u;case 2:return"'"+u.replace(/'/g,"''")+"'";case 3:return"|"+Bt(u,a.indent)+_t(oe(u,N));case 4:return">"+Bt(u,a.indent)+_t(oe((function(x,Y){for(var Q,ee,we=/(\n+)([^\n]*)/g,G=(me=x.indexOf(`
`),me=me!==-1?me:x.length,we.lastIndex=me,jt(x.slice(0,me),Y)),he=x[0]===`
`||x[0]===" ",me;ee=we.exec(x);){var ge=ee[1],p=ee[2];Q=p[0]===" ",G+=ge+(he||Q||p===""?"":`
`)+jt(p,Y),he=Q}return G})(u,O),N));case 5:return'"'+(function(x){for(var Y,Q="",ee=0,we=0;we<x.length;ee>=65536?we+=2:we++)ee=De(x,we),!(Y=$[ee])&&_e(ee)?(Q+=x[we],ee>=65536&&(Q+=x[we+1])):Q+=Y||pe(ee);return Q})(u)+'"';default:throw new o("impossible error: invalid scalar style")}})()}function Bt(a,u){var w=it(a)?String(u):"",E=a[a.length-1]===`
`;return w+(E&&(a[a.length-2]===`
`||a===`
`)?"+":E?"":"-")+`
`}function _t(a){return a[a.length-1]===`
`?a.slice(0,-1):a}function jt(a,u){if(a===""||a[0]===" ")return a;for(var w,E,b=/ [^ ]/g,N=0,O=0,L=0,x="";w=b.exec(a);)(L=w.index)-N>u&&(E=O>N?O:L,x+=`
`+a.slice(N,E),N=E+1),O=L;return x+=`
`,a.length-N>u&&O>N?x+=a.slice(N,O)+`
`+a.slice(O+1):x+=a.slice(N),x.slice(1)}function Ht(a,u,w,E){var b,N,O,L="",x=a.tag;for(b=0,N=w.length;b<N;b+=1)O=w[b],a.replacer&&(O=a.replacer.call(w,String(b),O)),(Ve(a,u+1,O,!0,!0,!1,!0)||O===void 0&&Ve(a,u+1,null,!0,!0,!1,!0))&&(E&&L===""||(L+=Re(a,u)),a.dump&&a.dump.charCodeAt(0)===10?L+="-":L+="- ",L+=a.dump);a.tag=x,a.dump=L||"[]"}function zt(a,u,w){var E,b,N,O,L,x;for(N=0,O=(b=w?a.explicitTypes:a.implicitTypes).length;N<O;N+=1)if(((L=b[N]).instanceOf||L.predicate)&&(!L.instanceOf||typeof u=="object"&&u instanceof L.instanceOf)&&(!L.predicate||L.predicate(u))){if(w?L.multi&&L.representName?a.tag=L.representName(u):a.tag=L.tag:a.tag="?",L.represent){if(x=a.styleMap[L.tag]||L.defaultStyle,P.call(L.represent)==="[object Function]")E=L.represent(u,x);else{if(!D.call(L.represent,x))throw new o("!<"+L.tag+'> tag resolver accepts not "'+x+'" style');E=L.represent[x](u,x)}a.dump=E}return!0}return!1}function Ve(a,u,w,E,b,N,O){a.tag=null,a.dump=w,zt(a,w,!1)||zt(a,w,!0);var L,x=P.call(a.dump),Y=E;E&&(E=a.flowLevel<0||a.flowLevel>u);var Q,ee,we=x==="[object Object]"||x==="[object Array]";if(we&&(ee=(Q=a.duplicates.indexOf(w))!==-1),(a.tag!==null&&a.tag!=="?"||ee||a.indent!==2&&u>0)&&(b=!1),ee&&a.usedDuplicates[Q])a.dump="*ref_"+Q;else{if(we&&ee&&!a.usedDuplicates[Q]&&(a.usedDuplicates[Q]=!0),x==="[object Object]")E&&Object.keys(a.dump).length!==0?((function(G,he,me,ge){var p,re,te,Z,ce,K,ue="",de=G.tag,fe=Object.keys(me);if(G.sortKeys===!0)fe.sort();else if(typeof G.sortKeys=="function")fe.sort(G.sortKeys);else if(G.sortKeys)throw new o("sortKeys must be a boolean or a function");for(p=0,re=fe.length;p<re;p+=1)K="",ge&&ue===""||(K+=Re(G,he)),Z=me[te=fe[p]],G.replacer&&(Z=G.replacer.call(me,te,Z)),Ve(G,he+1,te,!0,!0,!0)&&((ce=G.tag!==null&&G.tag!=="?"||G.dump&&G.dump.length>1024)&&(G.dump&&G.dump.charCodeAt(0)===10?K+="?":K+="? "),K+=G.dump,ce&&(K+=Re(G,he)),Ve(G,he+1,Z,!0,ce)&&(G.dump&&G.dump.charCodeAt(0)===10?K+=":":K+=": ",ue+=K+=G.dump));G.tag=de,G.dump=ue||"{}"})(a,u,a.dump,b),ee&&(a.dump="&ref_"+Q+a.dump)):((function(G,he,me){var ge,p,re,te,Z,ce="",K=G.tag,ue=Object.keys(me);for(ge=0,p=ue.length;ge<p;ge+=1)Z="",ce!==""&&(Z+=", "),G.condenseFlow&&(Z+='"'),te=me[re=ue[ge]],G.replacer&&(te=G.replacer.call(me,re,te)),Ve(G,he,re,!1,!1)&&(G.dump.length>1024&&(Z+="? "),Z+=G.dump+(G.condenseFlow?'"':"")+":"+(G.condenseFlow?"":" "),Ve(G,he,te,!1,!1)&&(ce+=Z+=G.dump));G.tag=K,G.dump="{"+ce+"}"})(a,u,a.dump),ee&&(a.dump="&ref_"+Q+" "+a.dump));else if(x==="[object Array]")E&&a.dump.length!==0?(a.noArrayIndent&&!O&&u>0?Ht(a,u-1,a.dump,b):Ht(a,u,a.dump,b),ee&&(a.dump="&ref_"+Q+a.dump)):((function(G,he,me){var ge,p,re,te="",Z=G.tag;for(ge=0,p=me.length;ge<p;ge+=1)re=me[ge],G.replacer&&(re=G.replacer.call(me,String(ge),re)),(Ve(G,he,re,!1,!1)||re===void 0&&Ve(G,he,null,!1,!1))&&(te!==""&&(te+=","+(G.condenseFlow?"":" ")),te+=G.dump);G.tag=Z,G.dump="["+te+"]"})(a,u,a.dump),ee&&(a.dump="&ref_"+Q+" "+a.dump));else{if(x!=="[object String]"){if(x==="[object Undefined]"||a.skipInvalid)return!1;throw new o("unacceptable kind of an object to dump "+x)}a.tag!=="?"&&Ft(a,a.dump,u,N,Y)}a.tag!==null&&a.tag!=="?"&&(L=encodeURI(a.tag[0]==="!"?a.tag.slice(1):a.tag).replace(/!/g,"%21"),L=a.tag[0]==="!"?"!"+L:L.slice(0,18)==="tag:yaml.org,2002:"?"!!"+L.slice(18):"!<"+L+">",a.dump=L+" "+a.dump)}return!0}function ln(a,u){var w,E,b=[],N=[];for(qt(a,b,N),w=0,E=N.length;w<E;w+=1)u.duplicates.push(b[N[w]]);u.usedDuplicates=new Array(E)}function qt(a,u,w){var E,b,N;if(a!==null&&typeof a=="object")if((b=u.indexOf(a))!==-1)w.indexOf(b)===-1&&w.push(b);else if(u.push(a),Array.isArray(a))for(b=0,N=a.length;b<N;b+=1)qt(a[b],u,w);else for(b=0,N=(E=Object.keys(a)).length;b<N;b+=1)qt(a[E[b]],u,w)}function $t(a,u){return function(){throw new Error("Function yaml."+a+" is removed in js-yaml 4. Use yaml."+u+" instead, which is now safe by default.")}}var Jt=h,Wt=I,Yt=C,Gt=F,Kt=v,Vt=st,Qt=R.load,Xt=R.loadAll,Zt=function(a,u){var w=new _(u=u||{});w.noRefs||ln(a,w);var E=a;return w.replacer&&(E=w.replacer.call({"":E},"",E)),Ve(w,0,E,!0,!0)?w.dump+`
`:""},en=o,tn={binary:ot,float:j,map:y,null:A,pairs:Ye,set:Be,timestamp:W,bool:B,int:le,merge:ne,omap:at,seq:g,str:T},nn=$t("safeLoad","load"),rn=$t("safeLoadAll","loadAll"),on=$t("safeDump","dump"),dn={Type:Jt,Schema:Wt,FAILSAFE_SCHEMA:Yt,JSON_SCHEMA:Gt,CORE_SCHEMA:Kt,DEFAULT_SCHEMA:Vt,load:Qt,loadAll:Xt,dump:Zt,YAMLException:en,types:tn,safeLoad:nn,safeLoadAll:rn,safeDump:on};n.CORE_SCHEMA=Kt,n.DEFAULT_SCHEMA=Vt,n.FAILSAFE_SCHEMA=Yt,n.JSON_SCHEMA=Gt,n.Schema=Wt,n.Type=Jt,n.YAMLException=en,n.default=dn,n.dump=Zt,n.load=Qt,n.loadAll=Xt,n.safeDump=on,n.safeLoad=nn,n.safeLoadAll=rn,n.types=tn,Object.defineProperty(n,"__esModule",{value:!0})})),window.SELECTORS={PAGES:{MAPPINGS:"mappings-page",REQUESTS:"requests-page",SCENARIOS:"scenarios-page","IMPORT-EXPORT":"import-export-page",RECORDING:"recording-page",SETTINGS:"settings-page"},REQUEST_FILTERS:{METHOD:"req-filter-method",STATUS:"req-filter-status",URL:"req-filter-url",DATE_FROM:"req-filter-from",DATE_TO:"req-filter-to",QUICK:"req-filter-quick"},MAPPING_FILTERS:{QUERY:"filter-query"},LISTS:{MAPPINGS:"mappings-list",REQUESTS:"requests-list",SCENARIOS:"scenarios-list"},EMPTY:{MAPPINGS:"mappings-empty",REQUESTS:"requests-empty"},UI:{STATS:"stats",SEARCH_FILTERS:"search-filters",UPTIME:"uptime",DATA_SOURCE_INDICATOR:"data-source-indicator",REQUESTS_SOURCE_INDICATOR:"requests-source-indicator"},LOADING:{MAPPINGS:"mappings-loading",REQUESTS:"requests-loading"},COUNTERS:{MAPPINGS:"mappings-count",REQUESTS:"requests-count"},CONNECTION:{SETUP:"connection-setup",HOST:"wiremock-host",PORT:"wiremock-port",CONNECT_BTN:"connect-btn",STATUS_DOT:"status-dot",STATUS_TEXT:"status-text",UPTIME:"uptime"},MODAL:{FORM:"mapping-form",ID:"mapping-id",TITLE:"modal-title"},FORM_FIELDS:{METHOD:"mapping-method",URL:"mapping-url",STATUS:"mapping-status",HEADERS:"mapping-headers",BODY:"mapping-body",PRIORITY:"mapping-priority",NAME:"mapping-name"},BUTTONS:{ADD_MAPPING:"add-mapping-btn",START_RECORDING:"start-recording-btn"},RECORDING:{URL:"recording-url",CAPTURE_HEADERS:"capture-headers",CAPTURE_BODY:"capture-body",URL_FILTER:"url-filter",INDICATOR:"recording-indicator",TARGET:"recording-target",COUNT:"recording-count",STOP_BTN:"stop-recording-btn"},SETTINGS:{HOST:"settings-host",PORT:"settings-port",TIMEOUT:"settings-timeout",AUTO_REFRESH:"auto-refresh",THEME:"theme-select",CUSTOM_HEADERS:"custom-headers",CACHE_ENABLED:"cache-enabled"},IMPORT:{FILE:"import-file",DISPLAY:"file-display",ACTIONS:"import-actions",RESULT:"import-result",MODE:"import-mode"},EXPORT:{FORMAT:"export-format",RESULT:"export-result"},STATS:{TOTAL_MAPPINGS:"total-mappings",TOTAL_REQUESTS:"total-requests"},HEALTH:{INDICATOR:"health-indicator"}},window.Icons={render(n,e={}){if(!n)return"";const t=["icon",`icon-${n}`];return e.className&&t.push(e.className),`<svg class="${t.join(" ")}" aria-hidden="true" focusable="false"><use href="#icon-${n}"></use></svg>`}},window.ENDPOINTS={HEALTH:"/health",MAPPINGS:"/mappings",MAPPINGS_RESET:"/mappings/reset",MAPPINGS_SAVE:"/mappings/save",MAPPINGS_IMPORT:"/mappings/import",MAPPINGS_FIND_BY_METADATA:"/mappings/find-by-metadata",MAPPINGS_REMOVE_BY_METADATA:"/mappings/remove-by-metadata",MAPPINGS_UNMATCHED:"/mappings/unmatched",REQUESTS:"/requests",REQUESTS_COUNT:"/requests/count",REQUESTS_REMOVE:"/requests/remove",REQUESTS_FIND:"/requests/find",REQUESTS_UNMATCHED:"/requests/unmatched",REQUESTS_UNMATCHED_NEAR_MISSES:"/requests/unmatched/near-misses",RECORDINGS_START:"/recordings/start",RECORDINGS_STOP:"/recordings/stop",RECORDINGS_STATUS:"/recordings/status",RECORDINGS_SNAPSHOT:"/recordings/snapshot",SCENARIOS:"/scenarios",SCENARIOS_RESET:"/scenarios/reset"},(function(){const e=new Map,t=new Map,i=new Set,r=new Map,o=(l,d,f)=>e.set(l,{name:d,delay:f,createdAt:Date.now()}),c=(l,d,f)=>t.set(l,{name:d,delay:f,createdAt:Date.now()}),s={setInterval(l,d,f){const h=window.setInterval(l,d);return o(h,f,d),h},setNamedInterval(l,d,f){return this.setInterval(d,f,l)},clearInterval(l){l!=null&&(window.clearInterval(l),e.delete(l))},setTimeout(l,d,f){const h=window.setTimeout(()=>{t.delete(h),l()},d);return c(h,f,d),h},clearTimeout(l){l!=null&&(window.clearTimeout(l),t.delete(l))},requestAnimationFrame(l){const d=window.requestAnimationFrame(l);return i.add(d),d},cancelAnimationFrame(l){l!=null&&(window.cancelAnimationFrame(l),i.delete(l))},addEventListener(l,d,f,h){!l||!d||!f||(l.addEventListener(d,f,h),r.has(l)||r.set(l,new Set),r.get(l).add({type:d,handler:f,options:h}))},removeEventListener(l,d,f,h){if(!l||!d||!f)return;l.removeEventListener(d,f,h);const m=r.get(l);if(m){for(const M of m)if(M.type===d&&M.handler===f&&JSON.stringify(M.options)===JSON.stringify(h)){m.delete(M);break}m.size===0&&r.delete(l)}},clearAll(){e.forEach((l,d)=>window.clearInterval(d)),e.clear(),t.forEach((l,d)=>window.clearTimeout(d)),t.clear(),i.forEach(l=>window.cancelAnimationFrame(l)),i.clear(),r.forEach((l,d)=>{l.forEach(({type:f,handler:h,options:m})=>{d.removeEventListener(f,h,m)})}),r.clear()},getStats(){return{intervals:e.size,timeouts:t.size,rafs:i.size,eventTargets:r.size,details:{intervals:Array.from(e.entries()),timeouts:Array.from(t.entries())}}}};window.LifecycleManager=s,window.addEventListener("beforeunload",()=>s.clearAll())})(),(function(){if(window.AppEvents&&typeof window.AppEvents.emit=="function")return;const e=new Map,t=(r,o)=>{e.has(r)||e.set(r,new Set),e.get(r).add(o)},i=(r,o)=>{const c=e.get(r);c&&(c.delete(o),c.size===0&&e.delete(r))};window.AppEvents={on(r,o){return!r||typeof o!="function"?()=>{}:(t(r,o),()=>i(r,o))},off(r,o){!r||typeof o!="function"||i(r,o)},emit(r,o={}){const c=e.get(r);if(!c||c.size===0)return!1;const s={type:r,detail:o};return[...c].forEach(l=>{try{l(s)}catch(d){Logger.warn("CORE",`AppEvents handler failed for "${r}":`,d)}}),!0},listenerCount(r){return e.get(r)?.size||0}}})(),window.debounce=function(e,t=150,i={}){let r,o,c,s;const{leading:l=!1,trailing:d=!0}=i,f=()=>{r=void 0,d&&o&&(s=e.apply(c,o),o=c=void 0)};return Object.assign(function(...m){return o=m,c=this,r===void 0?(l&&(s=e.apply(c,o),o=c=void 0),r=window.setTimeout(f,t)):(window.clearTimeout(r),r=window.setTimeout(f,t)),s},{cancel(){r!==void 0&&window.clearTimeout(r),r=void 0,o=c=void 0},flush(){return r!==void 0&&(window.clearTimeout(r),f()),s}})},(function(){const e=new WeakMap;function t(i){if(typeof i!="string"||!i.trim())return null;const r=document.createElement("template");return r.innerHTML=i.trim(),r.content.firstElementChild}window.renderList=function(r,o,c={}){if(!(r instanceof Element)||!Array.isArray(o))return;const{renderItem:s,getKey:l,getSignature:d,onItemChanged:f,onItemRemoved:h}=c;if(typeof s!="function")return;const m=new Map;Array.from(r.children).forEach(T=>{T instanceof HTMLElement&&T.dataset&&T.dataset.id&&m.set(T.dataset.id,T)});const M=document.createDocumentFragment();o.forEach(T=>{const g=typeof l=="function"?l(T):T&&(T.id||T.uuid);if(!g)return;const y=String(g),C=typeof d=="function"?d(T):y,A=m.get(y);if(A&&A.dataset.renderSignature===C){A.dataset.renderSignature=C,M.appendChild(A),m.delete(y);return}const B=A&&A.dataset.renderSignature||null;if(A&&typeof f=="function"&&B!==C)try{f(y,T,C)}catch(le){Logger.warn("UI","renderList onItemChanged failed:",le)}const X=s(T),H=t(X);if(!H){m.delete(y);return}H.dataset.id=y,H.dataset.renderSignature=C,M.appendChild(H),m.delete(y)}),m.forEach((T,g)=>{if(T.remove(),typeof h=="function")try{h(String(g),T)}catch(y){Logger.warn("UI","renderList onItemRemoved failed:",y)}});const I=()=>{r.replaceChildren(M)};if(window.LifecycleManager&&typeof window.LifecycleManager.requestAnimationFrame=="function"){const T=e.get(r);T&&window.LifecycleManager.cancelAnimationFrame(T);const g=window.LifecycleManager.requestAnimationFrame(()=>{I(),e.delete(r)});g!==null&&e.set(r,g)}else if(typeof window.requestAnimationFrame=="function"){const T=window.requestAnimationFrame(I);e.set(r,T)}else I()}})();const fallbackEnsureCustomHeaderObject=n=>!n||typeof n!="object"||Array.isArray(n)?{}:Object.keys(n).reduce((e,t)=>{const i=String(t).trim();return i&&(e[i]=n[t]),e},{}),resolveCustomHeaderNormalizer=()=>typeof window.ensureCustomHeaderObject=="function"?window.ensureCustomHeaderObject:fallbackEnsureCustomHeaderObject;let wiremockBaseUrl="",requestTimeout=window.DEFAULT_SETTINGS?.requestTimeout?parseInt(window.DEFAULT_SETTINGS.requestTimeout):69e3;window.customHeaders=resolveCustomHeaderNormalizer()(window.DEFAULT_SETTINGS?.customHeaders||{}),window.startTime=null,window.uptimeInterval=null;let autoRefreshInterval=null;window.allRequests=[],window.allScenarios=[],window.isRecording=!1,window.recordedCount=0,window.apiFetch=async(n,e={})=>{const t=new AbortController,i=Utils.safeCall(window.readWiremockSettings)||{},r=i.requestTimeout?parseInt(i.requestTimeout):window.DEFAULT_SETTINGS?.requestTimeout?parseInt(window.DEFAULT_SETTINGS.requestTimeout):69e3,o=setTimeout(()=>t.abort(),r),c=`${window.wiremockBaseUrl}${n}`,s=e.method||"GET",d={"Content-Type":"application/json",...resolveCustomHeaderNormalizer()(i.customHeaders||window.customHeaders),...e.headers},h=!(n===window.ENDPOINTS?.HEALTH||n===window.ENDPOINTS?.MAPPINGS);h&&Logger.api(`${s} ${n}`);try{const m=await fetch(c,{...e,signal:t.signal,headers:d});if(clearTimeout(o),!m.ok){const I=await m.text();h&&Logger.error("API",`HTTP ${m.status}: ${I||m.statusText}`,{endpoint:n,method:s});const T=new Error(`HTTP ${m.status}: ${I||m.statusText}`);throw T.status=m.status,T.statusText=m.statusText,T}const M=m.headers.get("content-type")?.includes("application/json")?await m.json():await m.text();h&&Logger.api(`${s} ${n} - OK`);try{if(n===window.ENDPOINTS?.HEALTH||n===window.ENDPOINTS?.MAPPINGS){const I=Date.now();window.lastWiremockSuccess=I,window.AppEvents&&typeof window.AppEvents.emit=="function"&&window.AppEvents.emit("wiremock:success",{endpoint:n,method:s,timestamp:I})}}catch{}return M}catch(m){throw clearTimeout(o),h&&Logger.error("API",`${s} ${n} - ${m.name}: ${m.message}`),m.name==="AbortError"?new Error(`Request timeout after ${r}ms`):m}},window.showPage=(n,e)=>{Logger.info("UI",`Switching to tab: ${n}`),document.querySelectorAll('.main-content > div[id$="-page"]').forEach(i=>i.classList.add("hidden"));const t=document.getElementById(SELECTORS.PAGES[n.toUpperCase()]);if(!t){Logger.warn("UI",`Page not found: ${n}`);return}if(t.classList.remove("hidden"),document.querySelectorAll(".sidebar .nav-item").forEach(i=>i.classList.remove("active")),e&&e.classList.add("active"),window.history&&window.history.replaceState){const i=new URL(window.location.href),r=i.searchParams.get("tab");i.searchParams.set("tab",n);const o=i.toString();Logger.api(`showPage: ${r} \u2192 ${n}`),Logger.api(`showPage URL: ${o}`),window.history.replaceState({},"",o)}else Logger.warn("UI","history.replaceState not available")};const SIDEBAR_COLLAPSED_CLASS="sidebar-collapsed",SIDEBAR_STATE_STORAGE_KEY="imock-sidebar-state",applySidebarState=(n,{persist:e=!0}={})=>{if(!document.body)return;document.body.classList.toggle(SIDEBAR_COLLAPSED_CLASS,n);const t=document.querySelector(".sidebar-toggle");if(t){const i=n?"Expand sidebar":"Collapse sidebar";t.setAttribute("aria-expanded",String(!n)),t.setAttribute("aria-label",i),t.setAttribute("title",i),t.querySelector("use")?.setAttribute("href",n?"#icon-sidebar-expand":"#icon-sidebar-collapse")}if(e)try{localStorage.setItem(SIDEBAR_STATE_STORAGE_KEY,n?"collapsed":"expanded")}catch(i){Logger.warn("UI","Unable to persist sidebar state:",i)}};window.toggleSidebar=()=>{const n=document.body?.classList.contains(SIDEBAR_COLLAPSED_CLASS);applySidebarState(!n)},window.initializeSidebarPreference=()=>{let n=null;try{n=localStorage.getItem(SIDEBAR_STATE_STORAGE_KEY)}catch(e){Logger.warn("UI","Unable to read sidebar state from storage:",e)}applySidebarState(n==="collapsed",{persist:!1})};const resolveModalElement=n=>{if(!n)return Logger.warn("UI","Modal ID is required to resolve modal element"),null;const e=document.getElementById(n);return e||Logger.warn("UI",`Modal element not found for id: ${n}`),e};window.showModal=n=>{const e=resolveModalElement(n);if(!e)return;e.classList.remove("hidden"),e.style.display="flex";const t=e.querySelector("input, select, textarea");t&&LifecycleManager.requestAnimationFrame(()=>t.focus())},window.openAddMappingModal=()=>{if(window.TemplateManager?.openGalleryForTarget){window.TemplateManager.openGalleryForTarget("create-inline");return}const n=document.querySelector('[data-template-trigger][data-template-target="create-inline"]');n?n.click():window.showModal("template-gallery-modal")},window.hideModal=n=>{const e=typeof n=="string"?resolveModalElement(n):n;if(e&&(e.classList.add("hidden"),e.style.display="none",e.querySelector("form")?.reset(),e.id==="edit-mapping-modal"&&(typeof UIComponents?.clearCardState=="function"&&UIComponents.clearCardState("mapping","is-editing"),window.editor&&typeof window.editor.setValue=="function")))try{window.editor.setValue("")}catch(t){Logger.warn("UI","Failed to clear editor:",t)}},window.showTab=(n,e)=>{if(document.querySelectorAll(".tab-content").forEach(t=>t.classList.add("hidden")),document.querySelectorAll(".tab-button").forEach(t=>t.classList.remove("active")),document.getElementById(`${n}-tab`).classList.remove("hidden"),e.classList.add("active"),window.history&&window.history.replaceState){const t=new URL(window.location.href);t.searchParams.set("tab",n),window.history.replaceState({},"",t.toString())}};const applyThemeToDom=n=>{if(!document.body)return;document.body.setAttribute("data-theme",n);const e=[document.getElementById("theme-icon"),document.getElementById("editor-theme-icon")].filter(Boolean);if(e.length){const t=n==="dark"?"#icon-sun":"#icon-moon";e.forEach(i=>{i.setAttribute("href",t),i.setAttribute("xlink:href",t)})}},persistThemePreference=n=>{localStorage.setItem("theme",n);try{localStorage.setItem("wiremock-settings",JSON.stringify({...Utils.safeCall(window.readWiremockSettings)||{},theme:n}))}catch{}};window.toggleTheme=()=>{if(!document.body)return;const n=(document.body.getAttribute("data-theme")||"dark")==="dark"?"light":"dark";applyThemeToDom(n),persistThemePreference(n),window.NotificationManager&&NotificationManager.show(`Switched to ${n} theme`,"success")},window.changeTheme=()=>{const n=document.getElementById("theme-select");if(!n)return;const e=n.value,t=e==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;applyThemeToDom(t),persistThemePreference(e),window.NotificationManager&&NotificationManager.show(`Theme changed to ${e}`,"success")},window.initializeTheme=()=>{const n=localStorage.getItem("theme")||"dark",e=n==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":n;applyThemeToDom(e);const t=document.getElementById("theme-select");t&&(t.value=n)},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",initializeTheme):initializeTheme(),LifecycleManager.addEventListener(document,"click",n=>{n.target.classList.contains("modal")&&hideModal(n.target)}),LifecycleManager.addEventListener(document,"keydown",n=>{if(n.key==="Escape"){const e=document.querySelector(".modal:not(.hidden)");e&&hideModal(e)}}),window.elementCache=new Map,window.invalidateElementCache=n=>n?window.elementCache.delete(n):window.elementCache.clear(),Logger.info("UI","Core.js loaded - Constants, API client, basic UI functions");const migrateLegacyWiremockSettings=n=>{if(!n||typeof n!="object"||Array.isArray(n))return{};const e={...n},t=window.ensureCustomHeaderObject(e.customHeaders);if(typeof e.authHeader=="string"&&e.authHeader.trim()){const i=e.authHeader.trim();if(Object.prototype.hasOwnProperty.call(t,"Authorization")||(t.Authorization=i),delete e.authHeader,!e.customHeadersRaw||typeof e.customHeadersRaw!="string"||!e.customHeadersRaw.trim())try{e.customHeadersRaw=JSON.stringify(t,null,2)}catch(r){Logger.warn("API","Failed to serialize migrated custom headers:",r),e.customHeadersRaw=""}}return e.customHeaders=t,typeof e.customHeadersRaw!="string"&&(e.customHeadersRaw=""),e.autoConnect=e.autoConnect!==!1,e};window.ensureCustomHeaderObject=n=>!n||typeof n!="object"||Array.isArray(n)?{}:Object.keys(n).reduce((e,t)=>{const i=String(t).trim();return i&&(e[i]=n[t]),e},{}),window.normalizeWiremockSettings=n=>migrateLegacyWiremockSettings(n),window.readWiremockSettings=()=>{try{const n=localStorage.getItem("wiremock-settings");if(!n)return{};const e=JSON.parse(n);return migrateLegacyWiremockSettings(e)}catch(n){return Logger.warn("UI","Failed to read stored settings, returning empty object:",n),{}}},window.buildScenarioStateEndpoint=n=>{const e=typeof n=="string"?n:"";return e.trim()?`${ENDPOINTS.SCENARIOS}/${encodeURIComponent(e)}/state`:""},window.normalizeWiremockBaseUrl=(n,e)=>{let t=(n||"").trim()||"localhost",i=(e||"").trim(),r="http",o="";try{const c=new URL(t.includes("://")?t:`http://${t}`);r=c.protocol.replace(":","")||"http",o=c.hostname,i||(i=c.port)}catch{const s=t.match(/^([^:/]+)(?::(\d+))?$/);o=s?s[1]:t,i||(i=s?.[2])}return`${r}://${o||"localhost"}:${i||(r==="https"?"443":"8080")}/__admin`},window.NotificationManager||(window.NotificationManager={TYPES:{INFO:"info",SUCCESS:"success",ERROR:"error",WARNING:"warning"},ICONS:{info:"\u2139\uFE0F",success:"\u2705",warning:"\u26A0\uFE0F",error:"\u26D4"},queue:[],visibleToasts:[],dedupeMap:new Map,toastContainer:null,cooldownTimer:null,lastShownAt:0,maxVisible:3,cooldownMs:650,dedupeWindowMs:4e3,defaultDuration:4e3,motionQuery:null,_boundHandleKeydown:null,init(){this.toastContainer||(this.toastContainer=document.getElementById("toast-container"),this.toastContainer||(this.toastContainer=document.createElement("div"),this.toastContainer.id="toast-container",this.toastContainer.setAttribute("aria-live","polite"),this.toastContainer.setAttribute("aria-atomic","false"),document.body.appendChild(this.toastContainer))),!this.motionQuery&&window.matchMedia&&(this.motionQuery=window.matchMedia("(prefers-reduced-motion: reduce)")),this._boundHandleKeydown||(this._boundHandleKeydown=this.handleKeydown.bind(this),window.LifecycleManager?window.LifecycleManager.addEventListener(document,"keydown",this._boundHandleKeydown):document.addEventListener("keydown",this._boundHandleKeydown))},cleanup(){this._boundHandleKeydown&&(window.LifecycleManager?window.LifecycleManager.removeEventListener(document,"keydown",this._boundHandleKeydown):document.removeEventListener("keydown",this._boundHandleKeydown),this._boundHandleKeydown=null)},normalizePayload(n,e=this.TYPES.INFO,t=void 0){if(n==null)return null;const i={message:String(n).trim(),type:this.TYPES.INFO,duration:this.defaultDuration,action:null};return typeof e=="object"&&e!==null?Object.assign(i,e):(i.type=typeof e=="string"?e:this.TYPES.INFO,typeof t=="number"?i.duration=t:typeof t=="object"&&t!==null&&Object.assign(i,t)),i.message?(Object.values(this.TYPES).includes(i.type)||(i.type=this.TYPES.INFO),i.action&&typeof i.action!="object"&&(i.action=null),i.action&&typeof i.action?.label!="string"&&(i.action=null),i.action&&typeof i.action?.handler!="function"&&(i.action.handler=()=>{}),i.action?i.duration=null:(typeof i.duration!="number"||i.duration<=0)&&(i.duration=this.defaultDuration),i.createdAt=Date.now(),i.count=i.count&&Number.isInteger(i.count)?i.count:1,i.dedupeKey=this.getDedupeKey(i),i):null},show(n,e=this.TYPES.INFO,t=void 0){this.init();const i=this.normalizePayload(n,e,t);if(!i)return;const r=this.dedupeMap.get(i.dedupeKey);if(r&&Date.now()-r.timestamp<=this.dedupeWindowMs){r.count+=1,r.timestamp=Date.now(),r.payload.count=r.count,this.updateToastCount(r),clearTimeout(r.cleanupTimer),r.cleanupTimer=setTimeout(()=>{this.dedupeMap.delete(i.dedupeKey)},this.dedupeWindowMs);return}this.queue.push(i),this.dedupeMap.set(i.dedupeKey,{count:i.count,timestamp:Date.now(),payload:i,toastEl:null,cleanupTimer:setTimeout(()=>{this.dedupeMap.delete(i.dedupeKey)},this.dedupeWindowMs)}),this.processQueue()},success(n,e){this.show(n,{type:this.TYPES.SUCCESS,...typeof e=="object"?e:{duration:e}})},error(n,e){this.show(n,{type:this.TYPES.ERROR,...typeof e=="object"?e:{duration:e}})},warning(n,e){this.show(n,{type:this.TYPES.WARNING,...typeof e=="object"?e:{duration:e}})},info(n,e){this.show(n,{type:this.TYPES.INFO,...typeof e=="object"?e:{duration:e}})},handleKeydown(n){if(n.key!=="Escape"||!this.visibleToasts.length)return;const e=this.visibleToasts[this.visibleToasts.length-1];e&&this.dismissToast(e.toastEl,e.payload,"escape")},processQueue(){if(!this.queue.length||this.visibleToasts.length>=this.maxVisible)return;const e=Date.now()-this.lastShownAt;if(e<this.cooldownMs){this.cooldownTimer||(this.cooldownTimer=setTimeout(()=>{this.cooldownTimer=null,this.processQueue()},this.cooldownMs-e));return}const t=this.getNextToastIndex();if(t===-1)return;const i=this.queue.splice(t,1)[0];this.displayToast(i)},getNextToastIndex(){if(!this.queue.length)return-1;const n={[this.TYPES.ERROR]:3,[this.TYPES.WARNING]:2,[this.TYPES.INFO]:1,[this.TYPES.SUCCESS]:1};let e=0,t=-1/0,i=1/0;for(let r=0;r<this.queue.length;r+=1){const o=this.queue[r],c=n[o.type]||0;(c>t||c===t&&o.createdAt<i)&&(t=c,i=o.createdAt,e=r)}return e},displayToast(n){const e=document.createElement("div");e.className=`toast toast-${n.type}`,e.setAttribute("role",n.type===this.TYPES.ERROR?"alert":"status"),e.setAttribute("aria-live",n.type===this.TYPES.ERROR?"assertive":"polite"),e.setAttribute("aria-atomic","true"),e.dataset.key=n.dedupeKey;const t=document.createElement("span");t.className="toast-icon",t.setAttribute("aria-hidden","true"),t.textContent=this.ICONS[n.type]||this.ICONS.info;const i=document.createElement("div");i.className="toast-content";const r=document.createElement("p");r.className="toast-message",r.textContent=n.message;const o=document.createElement("span");o.className="toast-count",n.count>1&&(o.textContent=`\xD7${n.count}`,o.setAttribute("aria-label",`${n.count} occurrences`));const c=document.createElement("div");c.className="toast-actions";const s=document.createElement("button");if(s.type="button",s.className="toast-close",s.setAttribute("aria-label","Dismiss notification"),s.textContent="\u2715",s.addEventListener("click",()=>this.dismissToast(e,n,"close")),n.action){const m=document.createElement("button");m.type="button",m.className="toast-action",m.textContent=n.action.label,m.addEventListener("click",M=>{M.preventDefault(),M.stopPropagation();try{n.action.handler()}finally{this.dismissToast(e,n,"action")}}),c.appendChild(m)}c.appendChild(s),i.appendChild(r),n.count>1&&i.appendChild(o),e.appendChild(t),e.appendChild(i),e.appendChild(c),this.toastContainer.firstChild?this.toastContainer.insertBefore(e,this.toastContainer.firstChild):this.toastContainer.appendChild(e);const l=this.dedupeMap.get(n.dedupeKey);l&&(l.toastEl=e,l.payload=n);const d={toastEl:e,payload:n,remaining:n.duration,hideTimer:null,startedAt:null};this.visibleToasts.push(d),this.lastShownAt=Date.now(),requestAnimationFrame(()=>{e.classList.add("show")});const f=()=>{d.hideTimer&&(clearTimeout(d.hideTimer),d.hideTimer=null,d.startedAt&&d.remaining&&(d.remaining-=Date.now()-d.startedAt))},h=()=>{d.hideTimer||n.duration===null||((typeof d.remaining!="number"||d.remaining<=0)&&(d.remaining=this.defaultDuration),d.startedAt=Date.now(),d.hideTimer=setTimeout(()=>{this.dismissToast(e,n,"timeout")},d.remaining))};e.addEventListener("mouseenter",f),e.addEventListener("focusin",f),e.addEventListener("mouseleave",h),e.addEventListener("focusout",h),n.duration!==null&&(d.remaining=n.duration,h()),this.motionQuery&&this.motionQuery.matches&&e.classList.add("toast-reduced-motion"),this.processQueue()},dismissToast(n,e,t){if(!n||n.dataset.dismissed==="true")return;n.dataset.dismissed="true",n.classList.remove("show");const i=this.visibleToasts.findIndex(o=>o.toastEl===n);if(i!==-1){const o=this.visibleToasts[i];o.hideTimer&&clearTimeout(o.hideTimer),this.visibleToasts.splice(i,1)}const r=this.dedupeMap.get(e.dedupeKey);r&&r.toastEl===n&&(r.toastEl=null),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),this.processQueue()},this.motionQuery&&this.motionQuery.matches?0:250)},updateToastCount(n){if(n)if(n.toastEl){const e=n.toastEl.querySelector(".toast-count"),t=n.toastEl.querySelector(".toast-content");if(n.count>1){if(e)e.textContent=`\xD7${n.count}`,e.setAttribute("aria-label",`${n.count} occurrences`);else if(t){const r=document.createElement("span");r.className="toast-count",r.textContent=`\xD7${n.count}`,r.setAttribute("aria-label",`${n.count} occurrences`),t.appendChild(r)}}else e&&e.parentNode&&e.parentNode.removeChild(e);const i=this.visibleToasts.find(r=>r.toastEl===n.toastEl);i&&i.payload.duration!==null&&(i.hideTimer&&clearTimeout(i.hideTimer),i.remaining=Math.max(i.payload.duration,this.defaultDuration),i.startedAt=Date.now(),i.hideTimer=setTimeout(()=>{this.dismissToast(i.toastEl,i.payload,"timeout")},i.remaining))}else n.payload&&(n.payload.count=n.count)},getDedupeKey(n){return`${n.type}::${n.message}::${n.action?n.action.label:""}`}}),window.NotificationManager||Logger.warn("MANAGERS","NotificationManager is not loaded before managers.js"),window.TabManager={configs:{mappings:{name:"Mappings",loadFunction:"loadMappings",clearFunction:"clearMappingFilters"},requests:{name:"Requests",loadFunction:"loadRequests",clearFunction:"clearRequestFilters"},scenarios:{name:"Scenarios",loadFunction:"loadScenarios",clearFunction:null}},getCurrentTab(){const n=document.querySelector(".tab-link.active");if(n){const e=n.getAttribute("onclick");if(e){const t=e.match(/showTab\(['"](\w+)['"]\)/);if(t)return t[1]}}return"mappings"},async refresh(n){const e=this.configs[n];if(!e){Logger.warn("MANAGERS",`Tab config not found: ${n}`);return}try{const t=window[e.loadFunction];typeof t=="function"?(await t(),Logger.info("MANAGERS",`${e.name} refreshed`)):Logger.warn("MANAGERS",`Load function not found: ${e.loadFunction}`)}catch(t){Logger.error("MANAGERS",`Error refreshing ${e.name}:`,t),NotificationManager.error(`Failed to refresh ${e.name}: ${t.message}`)}},clearFilters(n){const e=this.configs[n];if(!(!e||!e.clearFunction))try{const t=window[e.clearFunction];typeof t=="function"&&(t(),Logger.info("MANAGERS",`${e.name} filters cleared`))}catch(t){Logger.error("MANAGERS",`Error clearing ${e.name} filters:`,t)}}};function updateURLFilterParams(n,e="mappings"){if(!window.history||!window.history.replaceState)return;const t=new URL(window.location.href),i=`${e}_filter`;n?t.searchParams.set(i,n):t.searchParams.delete(i),window.history.replaceState({},"",t.toString())}function getFilterFromURL(n="mappings"){const e=new URLSearchParams(window.location.search),t=`${n}_filter`;return e.get(t)}function getActiveTabFromURL(){return new URLSearchParams(window.location.search).get("tab")}window.updateURLFilterParams=updateURLFilterParams,window.getFilterFromURL=getFilterFromURL,window.getActiveTabFromURL=getActiveTabFromURL,Logger.info("MANAGERS","Managers.js loaded - NotificationManager, TabManager, URL helpers");const FILTER_STATE_PREFIX="imock-filters-";window.FilterManager={saveFilterState(n,e){try{const t=`${FILTER_STATE_PREFIX}${n}`;localStorage.setItem(t,JSON.stringify(e))}catch(t){Logger.warn("MANAGERS","Failed to save filter state:",t)}},loadFilterState(n){try{const e=`${FILTER_STATE_PREFIX}${n}`,t=localStorage.getItem(e);return t?JSON.parse(t):{}}catch(e){return Logger.warn("MANAGERS","Failed to load filter state:",e),{}}},applyMappingFilters(){typeof this._applyMappingFilters=="function"&&this._applyMappingFilters()},flushMappingFilters(){this._applyMappingFilters&&typeof this._applyMappingFilters.flush=="function"&&this._applyMappingFilters.flush()},applyRequestFilters(){typeof this._applyRequestFilters=="function"&&this._applyRequestFilters()},flushRequestFilters(){this._applyRequestFilters&&typeof this._applyRequestFilters.flush=="function"&&this._applyRequestFilters.flush()},restoreFilters(n){if(n==="mappings"){const e=getFilterFromURL("mappings");if(e){const i=document.getElementById("filter-query");return i&&(i.value=e),{query:e}}const t=this.loadFilterState(n);if(t.query){const i=document.getElementById("filter-query");i&&(i.value=t.query)}return t}else if(n==="requests"){const e=getFilterFromURL("requests");if(e){const c=document.getElementById("req-filter-query");if(c)return c.value=e,{query:e}}const t=this.loadFilterState(n),i=document.getElementById("req-filter-query");i&&t.query&&(i.value=t.query);const r=document.getElementById("req-filter-from"),o=document.getElementById("req-filter-to");return r&&(r.value=t.from||""),o&&(o.value=t.to||""),t}return{}},getFiltersFromURL(n){return{query:getFilterFromURL(n)||""}},hasURLFilters(n){const e=this.getFiltersFromURL(n);return Object.values(e).some(t=>t!=="")}},Logger.info("MANAGERS","Filter state manager loaded");const CUSTOM_PRESETS_KEY="imock-filter-presets-custom";window.FilterPresetsManager={getAllPresets(){try{const n=localStorage.getItem(CUSTOM_PRESETS_KEY);return n?JSON.parse(n):{}}catch(n){return Logger.warn("MANAGERS","Failed to load custom presets:",n),{}}},applyPreset(n,e="mappings"){const i=this.getAllPresets()[n];if(!i){Logger.warn("MANAGERS",`Preset not found: ${n}`);return}if(e==="mappings"){const r=document.getElementById("filter-method"),o=document.getElementById("filter-url"),c=document.getElementById("filter-status");r&&(r.value=i.filters.method||""),o&&(o.value=i.filters.query||""),c&&(c.value=i.filters.status||""),typeof window.applyFilters=="function"&&window.applyFilters(),i.filters.method&&typeof window.syncFilterTabsFromSelect=="function"&&window.syncFilterTabsFromSelect("mapping",i.filters.method),typeof NotificationManager<"u"&&NotificationManager.info(`Applied preset: ${i.name}`)}},saveCustomPreset(n,e){try{const t=this.getCustomPresets();t[n]=e,localStorage.setItem(CUSTOM_PRESETS_KEY,JSON.stringify(t)),typeof NotificationManager<"u"&&NotificationManager.success(`Preset "${e.name}" saved`),typeof window.renderFilterPresets=="function"&&window.renderFilterPresets()}catch(t){Logger.error("MANAGERS","Failed to save preset:",t),typeof NotificationManager<"u"&&NotificationManager.error("Failed to save preset")}},getCustomPresets(){try{const n=localStorage.getItem(CUSTOM_PRESETS_KEY);return n?JSON.parse(n):{}}catch(n){return Logger.warn("MANAGERS","Failed to load custom presets:",n),{}}},deleteCustomPreset(n){try{const e=this.getCustomPresets();delete e[n],localStorage.setItem(CUSTOM_PRESETS_KEY,JSON.stringify(e)),typeof NotificationManager<"u"&&NotificationManager.success("Preset deleted"),typeof window.renderFilterPresets=="function"&&window.renderFilterPresets()}catch(e){Logger.error("MANAGERS","Failed to delete preset:",e),typeof NotificationManager<"u"&&NotificationManager.error("Failed to delete preset")}},getCurrentFiltersAsPreset(n="mappings"){return n==="mappings"?{method:document.getElementById("filter-method")?.value||"",query:document.getElementById("filter-url")?.value||"",status:document.getElementById("filter-status")?.value||""}:{}}},Logger.info("MANAGERS","Filter presets manager loaded"),(function(){const n=Date.now(),e=(c=0)=>new Date(n-c).toISOString(),t=[{id:"demo-mapping-products-list",name:"List products",priority:1,request:{method:"GET",urlPath:"/api/products",headers:{Accept:"application/json"}},response:{status:200,headers:{"Content-Type":"application/json"},jsonBody:{items:[{id:"sku-1000",name:"Demo Sneakers",price:129.99},{id:"sku-1001",name:"Demo Backpack",price:89.5}]}},metadata:{created:e(1e3*60*60*6),edited:e(1e3*60*60*2),source:"demo-seed",tags:["catalog","demo"]}},{id:"demo-mapping-create-order",name:"Create order",priority:2,persistent:!0,request:{method:"POST",urlPath:"/api/orders",bodyPatterns:[{matchesJsonPath:"$.items[*].sku"}]},response:{status:201,fixedDelayMilliseconds:120,headers:{"Content-Type":"application/json",Location:"/api/orders/90001"},jsonBody:{orderId:"90001",status:"processing",estimatedDelivery:e(-1e3*60*15)}},metadata:{created:e(1e3*60*60*12),edited:e(1e3*60*45),scenarioName:"checkout-flow",source:"demo-seed"}},{id:"demo-mapping-update-profile",name:"Update profile",priority:3,request:{method:"PUT",urlPattern:"/api/users/\\d+",headers:{"X-Demo-Auth":"Bearer ***"}},response:{status:204,headers:{"X-Demo-Trace":"profile-update"}},metadata:{created:e(1e3*60*30),edited:e(1e3*60*15),source:"demo-seed",tags:["profile"]}},{id:"demo-mapping-delete-session",name:"Delete session",priority:4,request:{method:"DELETE",urlPathPattern:"/api/sessions/.*"},response:{status:202,headers:{"Retry-After":"30"},jsonBody:{status:"scheduled"}},metadata:{created:e(1e3*60*60*3),source:"demo-seed"}}],i=[{id:"demo-request-001",wasMatched:!0,request:{method:"GET",url:"/api/products",urlPath:"/api/products",loggedDate:e(1e3*60*8),headers:{Accept:["application/json"],Host:["demo.wiremock.local"]},clientIp:"192.168.10.14"},responseDefinition:{status:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({items:[{id:"sku-1000"},{id:"sku-1001"}]})}},{id:"demo-request-002",wasMatched:!1,request:{method:"POST",url:"/api/orders",loggedDate:e(1e3*60*5),body:JSON.stringify({items:[]}),headers:{"Content-Type":["application/json"],Host:["demo.wiremock.local"]},clientIp:"192.168.10.18"},responseDefinition:{status:404,body:"No matching mapping found",headers:{"Content-Type":"text/plain"}}},{id:"demo-request-003",wasMatched:!0,request:{method:"PATCH",url:"/api/orders/90001",loggedDate:e(1e3*60*3),body:JSON.stringify({status:"cancelled"}),headers:{"Content-Type":["application/json"],"X-Demo-Auth":["Bearer demo-token"]},clientIp:"192.168.10.20"},responseDefinition:{status:409,body:JSON.stringify({message:"Order already fulfilled"}),headers:{"Content-Type":"application/json"}}},{id:"demo-request-004",wasMatched:!0,request:{method:"DELETE",url:"/api/sessions/abc123",loggedDate:e(1e3*60*2),headers:{"X-Demo-Auth":["Bearer demo-token"],Host:["demo.wiremock.local"]},clientIp:"192.168.10.22"},responseDefinition:{status:202,body:"Session deletion scheduled",headers:{"Retry-After":"30"}}}],r={generatedAt:e()},o=c=>JSON.parse(JSON.stringify(c));window.DemoData={isAvailable(){return t.length>0||i.length>0},getMappingsPayload(){return{mappings:o(t),meta:{...r},__source:"demo"}},getRequestsPayload(){return{requests:o(i),meta:{...r},__source:"demo"}},getDataset(){return{mappings:o(t),requests:o(i),meta:{...r},__source:"demo"}}}})(),(function(e){const t=e,i=t.FeaturesState||{},r=1e3;t.mappingIndex instanceof Map||(t.mappingIndex=new Map),t.mappingTabTotals??(t.mappingTabTotals={all:0,get:0,post:0,put:0,patch:0,delete:0}),t.requestTabTotals??(t.requestTabTotals={all:0,matched:0,unmatched:0}),t.pendingDeletedIds instanceof Set||(t.pendingDeletedIds=new Set),t.deletionTimeouts instanceof Map||(t.deletionTimeouts=new Map),t.isDemoMode??(t.isDemoMode=!1),t.demoModeAnnounced??(t.demoModeAnnounced=!1),t.demoModeLastError??(t.demoModeLastError=null);let o=null;function c(g="automatic"){t.isDemoMode=!0,t.demoModeReason=g,!t.demoModeAnnounced&&t.NotificationManager?.info&&(t.NotificationManager.info("WireMock API unreachable. Showing demo data so the interface stays interactive."),t.demoModeAnnounced=!0)}function s(g){if(!g||typeof g!="object")return;t.mappingIndex instanceof Map||(t.mappingIndex=new Map);const y=new Set;["id","uuid","stubMappingId","stubId","mappingId"].forEach(C=>{g[C]&&y.add(String(g[C]).trim())}),g.metadata?.id&&y.add(String(g.metadata.id).trim()),y.forEach(C=>{C&&t.mappingIndex.set(C,g)})}function l(g){t.mappingIndex instanceof Map?t.mappingIndex.clear():t.mappingIndex=new Map,Array.isArray(g)&&g.forEach(s)}function d(g=[]){const y={all:0,get:0,post:0,put:0,patch:0,delete:0};return(!Array.isArray(g)||g.length===0)&&(g=t.MappingsStore?.getAll?t.MappingsStore.getAll():[]),!Array.isArray(g)||g.length===0||(y.all=g.length,g.forEach(C=>{const A=(C?.request?.method||"").toLowerCase();Object.prototype.hasOwnProperty.call(y,A)&&(y[A]+=1)})),y}function f(){const g=t.MappingsStore?.getAll?t.MappingsStore.getAll():[];t.mappingTabTotals=d(g)}function h(g=[]){const y={all:0,matched:0,unmatched:0};return!Array.isArray(g)||g.length===0||(y.all=g.length,g.forEach(C=>{C?.wasMatched!==!1?y.matched+=1:y.unmatched+=1})),y}function m(){const g=t.MappingsStore?.getAllRequests?t.MappingsStore.getAllRequests():[];t.requestTabTotals=h(g),typeof t.updateRequestTabCounts=="function"&&t.updateRequestTabCounts()}function M(g){if(!(t.mappingIndex instanceof Map))return;const y=typeof g=="object"?g:t.mappingIndex.get(g);if(y)for(const[C,A]of t.mappingIndex.entries())(A===y||C===g)&&t.mappingIndex.delete(C)}async function I({force:g=!1}={}){if(o){if(!g)return Logger.debug("STATE","fetchMappingsFromServer: reusing in-flight request"),o;try{Logger.debug("STATE","fetchMappingsFromServer: waiting for in-flight request before force refresh");const C=await o;if(Date.now()-(t._lastMappingsFetchTime||0)<r)return Logger.debug("STATE","fetchMappingsFromServer: reusing just-completed result"),C}catch(C){Logger.warn("STATE","fetchMappingsFromServer: previous request failed, starting a new one",C)}}const y=(async()=>{try{const C=await t.apiFetch(t.ENDPOINTS.MAPPINGS);return t._lastMappingsFetchTime=Date.now(),C}catch(C){throw t.demoModeLastError=C,C}finally{o===y&&(o=null)}})();return o=y,y}function T(g,y,C={}){try{if(!g){Logger.warn("STATE","updateOptimisticCache: no mapping provided");return}const A=g.id||g.uuid;if(y==="delete"){if(!A){Logger.warn("STATE","updateOptimisticCache: delete operation requires mapping ID");return}t.MappingsStore?.items instanceof Map&&(t.MappingsStore.items.delete(A),typeof t.MappingsStore?.addPending=="function"&&t.MappingsStore.addPending({id:A,type:"delete",payload:null,optimisticMapping:null}),typeof t.MappingsStore.rebuildIndexes=="function"&&t.MappingsStore.rebuildIndexes()),t.cacheLastUpdate=Date.now(),typeof t.refreshMappingsFromCache=="function"&&t.refreshMappingsFromCache(),Logger.info("STATE","Deleted mapping from optimistic cache:",A);return}if(!A){Logger.warn("STATE","updateOptimisticCache: mapping must have an id or uuid");return}if(t.MappingsStore?.items instanceof Map){const B=t.MappingsStore.items.get(A),X=B&&y==="update"?{...B,...g}:g;t.MappingsStore.items.set(A,X),C.queueMode==="add"&&typeof t.MappingsStore?.addPending=="function"?t.MappingsStore.addPending({id:A,type:y,payload:g,optimisticMapping:X}):C.queueMode==="confirm"&&typeof t.MappingsStore?.confirmPending=="function"&&t.MappingsStore.confirmPending(A),typeof t.MappingsStore.rebuildIndexes=="function"&&t.MappingsStore.rebuildIndexes()}t.cacheLastUpdate=Date.now(),typeof t.refreshMappingsFromCache=="function"&&t.refreshMappingsFromCache(),Logger.info("STATE",`[updateOptimisticCache] ${y} mapping:`,A)}catch(A){Logger.error("STATE","updateOptimisticCache failed:",A)}}if(i.markDemoModeActive=c,i.addMappingToIndex=s,i.rebuildMappingIndex=l,i.computeMappingTabTotals=d,i.refreshMappingTabSnapshot=f,i.computeRequestTabTotals=h,i.refreshRequestTabSnapshot=m,i.removeMappingFromIndex=M,i.fetchMappingsFromServer=I,i.updateOptimisticCache=T,t.markDemoModeActive=c,t.addMappingToIndex=s,t.rebuildMappingIndex=l,t.computeMappingTabTotals=d,t.refreshMappingTabSnapshot=f,t.computeRequestTabTotals=h,t.refreshRequestTabSnapshot=m,t.removeMappingFromIndex=M,t.fetchMappingsFromServer=I,t.updateOptimisticCache=T,t.FeaturesState=i,Logger.info("STATE","state.js loaded - State management functions registered"),typeof t.dispatchEvent=="function"){let g;typeof t.CustomEvent=="function"?g=new CustomEvent("features:state-ready",{detail:{state:i}}):typeof document<"u"&&document.createEvent&&(g=document.createEvent("Event"),g.initEvent("features:state-ready",!1,!1),g.detail={state:i}),g&&t.dispatchEvent(g)}})(typeof window<"u"?window:globalThis);const Utils={escapeHtml:n=>typeof n!="string"?String(n):n.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[e]),normalizeScenarioName:(n,e="_")=>{if(n==null)return{original:n,normalized:n,changed:!1,cleared:!1,hadWhitespace:!1};const t=typeof n=="string"?n:String(n),i=/\s/.test(t),r=t.trim().replace(/\s+/g,e);return{original:t,normalized:r,changed:r!==t,cleared:!!t&&!r,hadWhitespace:i}},formatJson:(n,e="Invalid JSON",t=1e3)=>{try{const i=JSON.stringify(n,null,2);return i.length>t?i.substring(0,t)+`
... (truncated - `+(i.length-t)+" more characters)":i}catch{return e}},parseRequestTime:n=>{if(!n)return new Date().toLocaleString("en-US");try{const e=new Date(typeof n=="number"?n>1e12?n:n*1e3:n);return isNaN(e.getTime())?`Invalid: ${n}`:e.toLocaleString("en-US")}catch{return`Invalid: ${n}`}},getStatusClass:n=>{const e=parseInt(n)||0;return e>=200&&e<300?"success":e>=300&&e<400?"redirect":e>=400&&e<500?"client-error":e>=500?"server-error":"unknown"},formatDateTime:n=>{const e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0"),r=String(n.getHours()).padStart(2,"0"),o=String(n.getMinutes()).padStart(2,"0");return`${e}-${t}-${i}T${r}:${o}`},isFunction:n=>typeof n=="function",safeCall:(n,...e)=>{if(typeof n=="function")return n(...e)},toggleElement:(n,e)=>{n&&(e?n.classList.remove("hidden"):n.classList.add("hidden"))},showElement:n=>{n&&n.classList.remove("hidden")},hideElement:n=>{n&&n.classList.add("hidden")}},escapeHtml=Utils.escapeHtml;window.Utils=Utils,window.escapeHtml=escapeHtml,(function(){if(window.SettingsStore)return;const e=()=>{const o=window.Utils?.safeCall?.(window.readWiremockSettings);if(o)return o;try{const c=localStorage.getItem("wiremock-settings");if(!c)return{};const s=JSON.parse(c),l=window.Utils?.safeCall?.(window.normalizeWiremockSettings,s);return l||(s&&typeof s=="object"?s:{})}catch(c){return Logger.warn("UI","Failed to parse stored settings, falling back to defaults:",c),{}}},t=o=>{const c=(o||"").trim();if(!c)return{headers:{},raw:""};try{const s=JSON.parse(c);if(!s||typeof s!="object"||Array.isArray(s))throw new Error("Custom headers must be a JSON object.");return{headers:s,raw:c}}catch{const l=c.split(/\n+/),d={};let f=!0;for(const h of l){if(!h.trim())continue;const m=h.indexOf(":");if(m===-1){f=!1;break}const M=h.slice(0,m).trim(),I=h.slice(m+1).trim();if(!M){f=!1;break}d[M]=I}if(f&&Object.keys(d).length>0)return{headers:d,raw:c};throw new Error('Custom headers must be valid JSON or "Key: Value" pairs.')}},i=o=>{if(!o)return"";if(o.customHeadersRaw)return o.customHeadersRaw;if(o.customHeaders&&typeof o.customHeaders=="object"&&!Array.isArray(o.customHeaders))try{return JSON.stringify(o.customHeaders,null,2)}catch(c){Logger.warn("UI","Failed to serialize custom headers:",c)}return""},r=o=>!!(o&&o.host&&o.port&&o.autoConnect!==!1);window.SettingsStore={getStoredSettings:e,parseCustomHeadersInput:t,serializeCustomHeaders:i,shouldAutoConnect:r}})(),(function(e){if(e.TemplateRepoModule)return;function t(i={}){const r=i.runtime||e,o=i.storageKey||"imock-custom-templates",c=typeof i.getEmptyTemplate=="function"?i.getEmptyTemplate:()=>null,s={builtIn:null,user:null,userSignature:"",merged:null,mergedSignature:"",enriched:null,enrichedSignature:""},l=(...v)=>{if(r.Logger&&typeof r.Logger.warn=="function"){r.Logger.warn(...v);return}try{console.warn(...v)}catch{}},d=v=>({category:"custom",source:"user",...v,category:v?.category||"custom",source:v?.source||"user"}),f=(v="all")=>{(v==="all"||v==="user")&&(s.user=null),s.merged=null,s.mergedSignature="",s.enriched=null,s.enrichedSignature=""},h=()=>{if(s.builtIn)return[...s.builtIn];try{const v=r.MonacoTemplateLibrary?.getAll?.();return Array.isArray(v)?(s.builtIn=v.map(k=>({...k,source:"built-in"})),[...s.builtIn]):[]}catch(v){return l("TEMPLATES","Unable to read Monaco template library:",v),[]}},m=()=>{const v=localStorage.getItem(o);if(s.user&&s.userSignature===v)return[...s.user];try{const k=v?JSON.parse(v):[];return s.user=Array.isArray(k)?k.map(q=>d(q)):[],s.userSignature=v||"",[...s.user]}catch(k){return l("TEMPLATES","Failed to read user templates from storage:",k),[]}},M=v=>{try{const k=(v||[]).filter(Boolean).map(W=>d(W)),q=JSON.stringify(k);localStorage.setItem(o,q),s.user=[...k],s.userSignature=q,f("user")}catch(k){l("TEMPLATES","Failed to persist user templates:",k)}},I=()=>{const v=[...h(),...m()],k=c();k&&!v.some(W=>W.id===k.id)&&v.unshift(k);const q=v.map(W=>`${W.id}:${W.source||""}:${W.title||""}`).join("|");return s.merged&&s.mergedSignature===q?s.merged:(s.merged=v,s.mergedSignature=q,s.enriched=null,s.enrichedSignature="",v)},T=()=>I(),g=v=>T().find(k=>k.id===v)||null,y=v=>{const k=new Set,q=v.content||{},W=q.request||{},ne=q.response||{},be=W.method||"ANY";return k.add(be),q.category&&k.add(q.category),v.category&&k.add(v.category),v.source==="user"&&k.add("custom"),(W.bodyPatterns||W.multipartPatterns)&&k.add("matching"),W.headers&&k.add("headers"),W.queryParameters&&k.add("query"),W.cookies&&k.add("cookies"),(W.urlPathPattern||W.urlPattern||W.urlPathTemplate)&&k.add("pattern"),Array.isArray(W.bodyPatterns)&&W.bodyPatterns.some(Le=>Le.matchesJsonPath||Le.matchesXPath)&&k.add("jsonpath"),(ne.proxyBaseUrl||q.proxyBaseUrl)&&k.add("proxy"),(ne.serveEventListeners||q.serveEventListeners||ne.postServeActions)&&k.add("webhook"),(ne.transformers||q.transformers)&&k.add("templating"),(ne.fixedDelayMilliseconds||ne.delayDistribution||ne.chunkedDribbleDelay)&&k.add("delay"),ne.fault&&k.add("fault"),q.mappings&&k.add("scenario"),v.popular&&k.add("popular"),Array.from(k)},C=v=>{const k=v.content||{},q=k.response||{};return q.proxyBaseUrl||k.proxyBaseUrl?"proxy":q.fault?"fault":q.status?`${q.status}`:Array.isArray(k.mappings)&&k.mappings.length?"scenario":"200"},A=v=>{const k=v.content||{},q=k.request||{};return q.method?q.method:Array.isArray(k.mappings)&&k.mappings[0]?.request?.method?k.mappings[0].request.method:"ANY"},B=v=>{const k=A(v),q=C(v),W=y(v),ne=!!v.popular||["basic","integration","proxy"].includes(v.category),be=Array.isArray(v.content?.mappings)&&v.content.mappings.length>0;return{...v,method:k,outcome:q,tags:W,popular:ne,isScenario:be}},X=()=>{const v=I();return s.enriched&&s.enrichedSignature===s.mergedSignature||(s.enriched=v.map(B),s.enrichedSignature=s.mergedSignature),s.enriched},H=v=>{if(v==null||v==="")return null;if(typeof v=="object")return{jsonBody:v};try{return{jsonBody:JSON.parse(v)}}catch{return{body:v}}},le=(v,k)=>k?(Array.isArray(k)?k:String(k).split(".").map(W=>W.match(/^\d+$/)?Number(W):W)).reduce((W,ne)=>W&&typeof W=="object"?W[ne]:void 0,v):void 0,Se=v=>{if(v===null)return"null";if(typeof v>"u")return"";if(typeof v=="string")return v.length>64?`${v.slice(0,61)}\u2026`:v;if(typeof v=="number"||typeof v=="boolean")return String(v);try{const k=JSON.stringify(v);return k.length>80?`${k.slice(0,77)}\u2026`:k}catch(k){return l("TEMPLATES","Failed to serialise feature value",k),""}};return{normalizeUserTemplate:d,invalidateTemplateCache:f,getBuiltInTemplates:h,readUserTemplates:m,persistUserTemplates:M,getAllTemplates:T,findTemplateById:g,getTemplatesWithMeta:X,toJsonBody:H,resolveTemplatePath:le,formatFeatureValue:Se,getTemplateFeature:v=>{if(!v||!v.feature)return null;const k=v.feature.path||v.feature,q=v.feature.label||(Array.isArray(k)?k.join("."):String(k)),W=le(v.content,k);return typeof W>"u"?null:{label:q,value:Se(W)}},getTemplateHeadline:v=>{if(!v)return"";if(v.highlight)return v.highlight;const k=[];return v.content?.request?.method&&k.push(v.content.request.method),(v.content?.request?.url||v.content?.request?.urlPath)&&k.push(v.content.request.url||v.content.request.urlPath),k.join(" \xB7 ")},buildTemplatePreview:v=>{try{const k=v.content?v.content:{};if(typeof k=="string")return k;const ne=JSON.stringify(k,null,2).split(`
`).slice(0,24).join(`
`);return ne.length>1280?`${ne.slice(0,1279)}\u2026`:ne}catch{return"[unavailable template preview]"}}}}e.TemplateRepoModule={createTemplateRepo:t}})(typeof window<"u"?window:globalThis),(function(e){if(e.TemplateActionsModule)return;function t(i={}){const r=i.runtime||e,o=i.selectors||{},c=typeof i.getAllTemplates=="function"?i.getAllTemplates:()=>[],s=f=>{const h=document.createElement("option");h.value=f.id;const m=f.title||f.name||f.id;return h.textContent=f.source==="user"?`${m} (yours)`:m,h.dataset.source=f.source||"built-in",h};return{createOption:s,populateSelectors:()=>{const f=c();[o.FORM,o.EDITOR].forEach(h=>{const m=document.getElementById(h);if(!m)return;const M=m.value;m.innerHTML='<option value="">Select a template</option>',f.forEach(I=>m.appendChild(s(I))),M&&f.some(I=>I.id===M)&&(m.value=M)})},copyTextToClipboard:f=>{const h=typeof f=="string"?f:String(f??"");if(typeof navigator<"u"&&navigator.clipboard?.writeText)return navigator.clipboard.writeText(h).then(()=>!0).catch(()=>m(h));return Promise.resolve(m(h));function m(M){try{const I=document.createElement("textarea");return I.value=M,I.setAttribute("readonly",""),I.style.position="absolute",I.style.left="-9999px",document.body.appendChild(I),I.select(),document.execCommand("copy"),document.body.removeChild(I),!0}catch(I){return r.Logger?.warn?.("TEMPLATES","Clipboard fallback failed:",I),!1}}}}}e.TemplateActionsModule={createTemplateActions:t}})(typeof window<"u"?window:globalThis),(function(e){const t="imock-custom-templates",i={FORM:"template-selector",EDITOR:"editor-template-selector"},r={GALLERY:"template-gallery-modal",PREVIEW:"template-preview-modal"},o=[{id:"happy-path",icon:"\u2713",title:"Happy path",subtitle:"Client flows succeed",color:"#10b981",description:"Standard successful API responses"},{id:"errors",icon:"\u26A0",title:"Errors",subtitle:"Client handles failures correctly",color:"#f59e0b",description:"HTTP errors and validation cases"},{id:"faults",icon:"\u26A1",title:"Network issues",subtitle:"Timeouts, disconnects, slow responses",color:"#ef4444",description:"Network fault simulation"},{id:"scenarios",icon:"\u21BB",title:"Scenarios",subtitle:"Stateful steps and retries",color:"#8b5cf6",description:"Changing service behaviour"},{id:"dynamic",icon:"\u2387",title:"Dynamic response",subtitle:"Response templating and conditions",color:"#3b82f6",description:"Response depends on request"},{id:"matching",icon:"\u{1F3AF}",title:"Request Matching",subtitle:"URL, headers, body, JSONPath",color:"#06b6d4",description:"Advanced request matching"},{id:"webhooks",icon:"\u{1F4E4}",title:"Webhooks",subtitle:"Asynchronous callbacks",color:"#ec4899",description:"Outgoing HTTP callbacks"},{id:"proxy",icon:"\u21C4",title:"Proxy & Record",subtitle:"Proxying and recording",color:"#14b8a6",description:"Working against real APIs"},{id:"custom",icon:"\u2605",title:"My templates",subtitle:"Saved by you",color:"#0ea5e9",description:"Personal templates you created"}],c="empty-mapping-skeleton",s={step:"goals",goalId:null,selectedTemplateId:null,searchQuery:"",activeTags:[],showPopularOnly:!1};let l="form";const d={templateId:null,target:null};let f="",h=null;const m={handler:null,label:null,mode:"mapping"};function M(){const S=document.getElementById("method"),R=document.getElementById("url-pattern"),P=document.getElementById("editor-method"),D=document.getElementById("editor-url"),z=S?.value||P?.value,$=R?.value||D?.value;return{method:(z||"GET").toUpperCase(),urlPath:$||"/api/example"}}function I(S=M()){const R={method:(S?.method||"GET").toUpperCase(),urlPath:S?.urlPath||"/api/example"};return{name:"Empty mapping",request:{method:R.method,urlPath:R.urlPath},response:{status:200}}}function T(S){return C(I(S))}function g(){const S=M(),R=T(S);return{id:c,title:"Empty mapping",description:"Create a minimal stub and fill in the request/response yourself.",category:"happy-path",highlight:`${R.request.method} \xB7 ${R.request.urlPath}`,feature:{path:["response","status"],label:"response.status"},content:R}}function y(S,R="info"){const P=e.NotificationManager;if(P&&typeof P[R]=="function"){P[R](S);return}console[R==="error"?"error":"log"](`[TEMPLATES] ${S}`)}function C(S){try{if(typeof structuredClone=="function")return structuredClone(S)}catch(R){Logger.warn("TEMPLATES","Failed to structuredClone, falling back to JSON:",R)}try{return JSON.parse(JSON.stringify(S))}catch(R){if(Logger.warn("TEMPLATES","Failed to JSON clone value, returning shallow copy:",R),S&&typeof S=="object")return Array.isArray(S)?[...S]:{...S}}return S}function A(S,R){d.templateId=S||null,d.target=S?R:null,X()}function B(){return!!d.templateId&&(!d.target||d.target==="editor")}function X(){H(B())}function H(S){const R=document.getElementById("update-mapping-btn");if(!R)return;const P=R.querySelector?.(".btn-label")||R;if(S){if(m.mode==="template-save")return;m.handler||(m.handler=R.onclick||(typeof e.updateMapping=="function"?D=>e.updateMapping(D):null)),!m.label&&P&&(m.label=P.textContent||"Update Mapping"),R.onclick=D=>(D?.preventDefault?.(),Ke({skipNamePrompt:!0,reuseExistingMetadata:!0})),P&&(P.textContent="Save template"),R.setAttribute("data-template-edit-mode","true"),m.mode="template-save";return}m.mode==="template-save"&&(R.onclick=m.handler||R.onclick,P&&m.label&&(P.textContent=m.label),R.removeAttribute("data-template-edit-mode"),m.mode="mapping")}function le(S){["id","uuid","stubMappingId","stubId","mappingId"].forEach(R=>delete S[R]),S.metadata&&delete S.metadata.id}function Se(S){if(!S||typeof S!="object"||!Object.prototype.hasOwnProperty.call(S,"scenarioName"))return null;const R=z=>{if(z==null)return{original:z,normalized:z,changed:!1,cleared:!1,hadWhitespace:!1};const $=typeof z=="string"?z:String(z),J=/\s/.test($),ie=$.trim().replace(/\s+/g,"_");return{original:$,normalized:ie,changed:ie!==$,cleared:!!$&&!ie,hadWhitespace:J}},D=(typeof e?.Utils?.normalizeScenarioName=="function"?e.Utils.normalizeScenarioName:R)(S.scenarioName);return!D?.changed||!D?.hadWhitespace?null:(D.cleared?delete S.scenarioName:S.scenarioName=D.normalized,{original:D.original,normalized:D.normalized,cleared:D.cleared})}function U(S,R={}){if(!S||typeof S!="object")return null;const{source:P="ui",seed:D=M(),scenarioFixes:z}=R,$=new Date().toISOString(),J=C(S);le(J),It(J,D);const ie=Se(J);return ie&&z instanceof Map&&!z.has(ie.original)&&z.set(ie.original,ie),J.metadata={...J.metadata||{},created:J.metadata?.created||$,edited:$,source:J.metadata?.source||P},J}async function j(S,R={}){const{openMode:P="inline",source:D="ui",successMessageFactory:z}=R,$=Array.isArray(S)?S:[S],J=new Map,ie=$.map(_=>U(_,{source:D,scenarioFixes:J})).filter(Boolean);if(J.size){const _=Array.from(J.values()).slice(0,3).map(oe=>oe.cleared?"cleared":`"${oe.original}" \u2192 "${oe.normalized}"`).join(", ");y(`Scenario name cannot contain spaces. Normalized: ${_}`,"warning")}if(!ie.length)return y("No valid mapping payloads to create","warning"),{success:!1,createdIds:[]};const pe=ie.map((_,oe)=>({index:oe,error:V(_)})).filter(_=>!!_.error);if(pe.length){const _=pe[0];return y(`Mapping payload is missing required fields (entry ${_.index+1}): ${_.error}`,"error"),{success:!1,createdIds:[]}}try{const _=[],oe=[];for(let Oe=0;Oe<ie.length;Oe+=1){const lt=ie[Oe];try{const De=await apiFetch("/mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(lt)}),it=De?.mapping||De,dt=it?.id;if(dt&&typeof updateOptimisticCache=="function")try{updateOptimisticCache(it,"create")}catch(Ft){Logger.warn("TEMPLATES","Failed to update optimistic cache after create:",Ft)}dt&&_.push(dt)}catch(De){oe.push({index:Oe,error:De});break}}if(oe.length){const Oe=[];for(const it of _)try{await apiFetch(`/mappings/${it}`,{method:"DELETE"}),typeof updateOptimisticCache=="function"&&updateOptimisticCache({id:it},"delete")}catch(dt){Oe.push(dt)}const lt=oe[0],De=Oe.length?` Rollback issues: ${Oe.length} delete${Oe.length===1?"":"s"} failed.`:"";return y(`Failed to create mapping ${lt.index+1}/${ie.length}: ${lt.error.message}.${De}`,"error"),Logger.error("TEMPLATES","Mapping create failed",{errors:oe,rollbackErrors:Oe}),{success:!1,createdIds:[]}}const Re=_.length||ie.length,xe=typeof z=="function"?z(Re):`Created ${Re} mapping${Re===1?"":"s"}`;y(xe,"success");const _e=_[0];return _e&&(P==="studio"&&typeof e.editMapping=="function"?e.editMapping(_e):typeof e.openEditModal=="function"&&e.openEditModal(_e)),{success:!0,createdIds:_}}catch(_){return y(`Failed to create mapping: ${_.message}`,"error"),Logger.error("TEMPLATES","Failed to create mapping from payloads",_),{success:!1,createdIds:[]}}}function F(){let S=document.getElementById("template-name-modal");if(S)return S;S=document.createElement("div"),S.id="template-name-modal",S.className="modal hidden",S.innerHTML=`
            <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="template-name-title">
                <div class="modal-header">
                    <div class="modal-header-main">
                        <h3 id="template-name-title" class="modal-title">Save as template</h3>
                        <p class="modal-subtitle">Name your template to reuse it later.</p>
                    </div>
                    <button type="button" class="modal-close" aria-label="Close" data-action="close-template-name">\xD7</button>
                </div>
                <div class="modal-body">
                    <label class="form-label" for="template-name-input">Template name</label>
                    <input id="template-name-input" class="form-control" type="text" name="template-name" placeholder="My template" />
                    <p class="form-hint">Titles help you find templates quickly in the gallery.</p>
                </div>
                <div class="modal-footer">
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" data-action="cancel-template-name">Cancel</button>
                        <button type="button" class="btn btn-primary" data-action="confirm-template-name">Save template</button>
                    </div>
                </div>
            </div>
        `,document.body.appendChild(S),S.addEventListener("click",D=>{D.target===S&&v(null)}),S.querySelectorAll('[data-action="close-template-name"], [data-action="cancel-template-name"]').forEach(D=>D.addEventListener("click",()=>v(null))),S.querySelector('[data-action="confirm-template-name"]').addEventListener("click",()=>{const z=S.querySelector("#template-name-input")?.value?.trim();v(z||null)});const P=S.querySelector("#template-name-input");return P?.addEventListener("keydown",D=>{D.key==="Enter"&&(D.preventDefault(),v(P.value.trim()||null))}),S}function v(S){document.getElementById("template-name-modal")?.classList.add("hidden"),typeof h=="function"&&(h(S),h=null)}function k(S=""){const R=F(),P=R.querySelector("#template-name-input");return P&&(P.value=S||"",setTimeout(()=>P.focus(),0)),R.classList.remove("hidden"),h&&v(null),new Promise(D=>{h=D})}const q=!e.TemplateRepoModule||typeof e.TemplateRepoModule.createTemplateRepo!="function"?(Logger.error("TEMPLATES","TemplateRepoModule is not loaded"),null):e.TemplateRepoModule.createTemplateRepo({runtime:e,storageKey:t,getEmptyTemplate:g}),W=!e.TemplateActionsModule||typeof e.TemplateActionsModule.createTemplateActions!="function"?(Logger.error("TEMPLATES","TemplateActionsModule is not loaded"),null):e.TemplateActionsModule.createTemplateActions({runtime:e,selectors:i,getAllTemplates:at});function ne(S){return q?.normalizeUserTemplate?q.normalizeUserTemplate(S):{...S}}function be(S="all"){return q?.invalidateTemplateCache?q.invalidateTemplateCache(S):void 0}function ot(){return q?.getBuiltInTemplates?q.getBuiltInTemplates():[]}function Le(){return q?.readUserTemplates?q.readUserTemplates():[]}function We(S){return q?.persistUserTemplates?q.persistUserTemplates(S):void 0}function at(){return q?.getAllTemplates?q.getAllTemplates():[]}function Nt(S){return q?.findTemplateById?q.findTemplateById(S):null}function Ye(){return q?.getTemplatesWithMeta?q.getTemplatesWithMeta():[]}function Rt(S){return W?.createOption?W.createOption(S):document.createElement("option")}function Be(){W?.populateSelectors&&W.populateSelectors()}function st(S){return q?.toJsonBody?q.toJsonBody(S):null}function se(S){if(!S){y("Select a template first","warning");return}const R=S.content||{},P=R.request||{},D=R.response||{},z=document.getElementById("mapping-name"),$=document.getElementById("method"),J=document.getElementById("url-pattern"),ie=document.getElementById("response-status"),pe=document.getElementById("response-body");z&&(z.value=R.name||S.title||S.id||""),$&&P.method&&($.value=P.method),J&&(J.value=P.url||P.urlPath||""),ie&&typeof D.status<"u"&&(ie.value=D.status);const _=D.jsonBody??D.body;if(pe&&typeof _<"u"){const oe=typeof _=="object"?JSON.stringify(_,null,2):String(_);pe.value=oe}y(`Template "${S.title||S.id}" applied to form`,"success")}async function Te(){if(e.monacoInitializer?.isInitialized)return e.monacoInitializer;if(e.monacoInitializationPromise?.then)try{if(await e.monacoInitializationPromise,e.monacoInitializer?.isInitialized)return e.monacoInitializer}catch(S){Logger.warn("TEMPLATES","Monaco initializer failed to load in time",S)}return e.monacoInitializer}async function He(S){if(!S){y("Select a template first","warning");return}const R=S.content??{},P=await Te();if(P&&(typeof P.applyTemplate=="function"||typeof P.applyTemplateById=="function")){let $=!1;typeof P.applyTemplate=="function"?$=P.applyTemplate(S):$=P.applyTemplateById?.(S.id),y($?`Template "${S.title||S.id}" applied to editor`:"Template could not be applied",$?"success":"error");return}const D=typeof R=="string"?R:JSON.stringify(R,null,2),z=document.getElementById("json-editor");if(z){z.value=D;try{const J=JSON.parse(typeof R=="string"?R:JSON.stringify(R));e.editorState&&(e.editorState.currentMapping=J,e.editorState.isDirty=!0)}catch(J){Logger.warn("TEMPLATES","Failed to parse template content into editorState:",J)}const $=document.getElementById("editor-dirty-indicator");$&&($.style.display="inline")}y(`Template "${S.title||S.id}" applied to editor`,"success")}async function Fe(S,R={}){const{openMode:P="inline"}=R;if(!S){y("Select a template first","warning");return}const D=Ot(S);if(!D){y("Template content is not available","error");return}const z=Array.isArray(D)?D:[D],$=z.map((J,ie)=>({index:ie,error:V(J)})).filter(J=>!!J.error);if($.length){const J=$[0];y(`Template is missing required fields (entry ${J.index+1}): ${J.error}`,"error");return}try{await j(z,{openMode:P,source:"template",successMessageFactory:J=>`Created ${J} mapping${J===1?"":"s"} from template`})}catch(J){y(`Failed to create mapping: ${J.message}`,"error"),Logger.error("TEMPLATES","Failed to create mapping from template",J)}finally{e.hideModal?.(r.GALLERY),e.hideModal?.(r.PREVIEW)}}function Ge(){const S=g();if($e()){Fe(S,{openMode:l==="create-studio"?"studio":"inline"});return}ct(S,l)}async function et(){const S=await k(document.getElementById("mapping-name")?.value||"")||"";if(!S.trim()){y("Template name is required","warning");return}const R=document.getElementById("method")?.value||"GET",P=document.getElementById("url-pattern")?.value||"/api/example",D=parseInt(document.getElementById("response-status")?.value,10)||200,z=document.getElementById("response-body")?.value||"",$=!!d.templateId&&(!d.target||d.target==="form"),J=$?Le().find(pe=>pe.id===d.templateId):null,ie={id:$&&J?J.id:`user-${Date.now()}`,title:S.trim(),description:J?.description||"User template saved from mapping form",category:"custom",source:"user",content:{name:S.trim(),request:{method:R,urlPath:P},response:{status:D,...st(z)||{}}}};if($&&J)Ce(J.id,ie),A(null),y(`Template "${S.trim()}" updated`,"success");else{const pe=Le();pe.push(ie),We(pe),ve({force:!0}),Be(),y(`Template "${S.trim()}" saved`,"success"),A(null)}}async function Ke(S={}){const{skipNamePrompt:R=!1,reuseExistingMetadata:P=!1}=S,D=document.getElementById("json-editor");if(!D){y("Editor not available","warning");return}const z=!!d.templateId&&(!d.target||d.target==="editor"),$=z?Le().find(_=>_.id===d.templateId):null;let J="";if(z&&$&&(R||P)?J=$.title||"":J=await k($?.title||"")||"",!J.trim()){y("Template name is required","warning");return}let ie;try{ie=JSON.parse(D.value)}catch{y("Cannot save template: current JSON is invalid","error");return}const pe={id:z&&$?$.id:`user-${Date.now()}`,title:J.trim(),description:P&&$?.description||$?.description||"User template saved from JSON editor",category:"custom",source:"user",content:ie};if(z&&$)Ce($.id,pe),A(null),y(`Template "${J.trim()}" updated`,"success");else{const _=Le();_.push(pe),We(_),ve({force:!0}),Be(),y(`Template "${J.trim()}" saved`,"success"),A(null)}}function Ce(S,R={}){if(!S)return null;const P=Le(),D=P.findIndex(J=>J.id===S);if(D===-1)return null;const z=P[D],$=ne({...z,...R.title?{title:R.title}:{},...R.description?{description:R.description}:{},...R.content?{content:R.content}:{}});return P[D]=$,We(P),ve({force:!0}),Be(),$}async function qe(S,R={}){const P=Le().find(z=>z.id===S);if(!P)return y("Template not found","warning"),!1;const D=R.target||(document.getElementById("json-editor")?"editor":"form");return A(S,D),D==="editor"?(ct(P,"editor"),y("Template loaded into JSON Studio. Save to keep changes.","info"),document.getElementById("update-mapping-btn")?.focus?.()):(ct(P,"form"),y("Template loaded into mapping form. Update and save to keep changes.","info"),document.getElementById("save-template-btn")?.focus?.()),!0}function Me(S,R={}){const{skipConfirm:P=!1}=R;if(!S)return!1;const D=Le(),z=D.find(J=>J.id===S);if(!z||!P&&typeof e.confirm=="function"&&!e.confirm(`Delete template "${z.title||z.id}"? This cannot be undone.`))return!1;const $=D.filter(J=>J.id!==S);return We($),ve({force:!0}),Be(),y(`Template "${z.title||z.id}" deleted`,"info"),d.templateId===S&&A(null),!0}function ze(S,R){return q?.resolveTemplatePath?q.resolveTemplatePath(S,R):void 0}function Mt(S){return q?.formatFeatureValue?q.formatFeatureValue(S):""}function mt(S){return q?.getTemplateFeature?q.getTemplateFeature(S):null}function ht(S){return q?.getTemplateHeadline?q.getTemplateHeadline(S):""}function gt(S){return q?.buildTemplatePreview?q.buildTemplatePreview(S):"[unavailable template preview]"}function yt(S){return W?.copyTextToClipboard?W.copyTextToClipboard(S):Promise.resolve(!1)}function $e(S=l){return typeof S=="string"&&S.startsWith("create")}function It(S,R){S.request||(S.request={}),S.response||(S.response={}),S.request.method||(S.request.method=R.method||"ANY"),S.request.url||S.request.urlPath||S.request.urlPattern||S.request.urlPathPattern||S.request.urlPathTemplate||(S.request.urlPath=R.urlPath||R.url||"/api/example"),typeof S.response.status!="number"&&!("fault"in S.response)&&(S.response.status=200)}function Ot(S){if(!S)return null;let R=S.content??{};if(typeof R=="string")try{R=JSON.parse(R)}catch(J){Logger.warn("TEMPLATES","Failed to parse string template content:",J),R={}}const P=new Date().toISOString(),D=J=>{["id","uuid","stubMappingId","stubId","mappingId"].forEach(ie=>delete J[ie])},z=M();if(Array.isArray(R?.mappings))return R.mappings.map((ie,pe)=>{const _=JSON.parse(JSON.stringify(ie||{}));return D(_),_.name=_.name||`${S.title||S.id||"Scenario mapping"} #${pe+1}`,It(_,z),Se(_),_.metadata={..._.metadata||{},created:_.metadata?.created||P,edited:P,source:_.metadata?.source||"template"},_});const $=JSON.parse(JSON.stringify(R||{}));return D($),$.name||($.name=S.title||S.id||"New mapping"),It($,z),Se($),$.metadata={...$.metadata||{},created:$.metadata?.created||P,edited:P,source:$.metadata?.source||"template"},$}function V(S){if(!S||typeof S!="object")return"Mapping payload is empty";const R=S.request||{},P=S.response||{};if(!R.method)return"request.method is required";if(!!!(R.url||R.urlPath||R.urlPattern||R.urlPathPattern||R.urlPathTemplate))return"request URL or pattern is required";const z=typeof P.status=="number",$=!!P.fault;return!z&&!$?"response.status is required":null}function wt(){const S=document.getElementById("edit-mapping-modal");return S?(typeof e.showModal=="function"?e.showModal("edit-mapping-modal"):(S.classList.remove?.("hidden"),S.style.display="flex"),!0):!1}function ct(S,R=l){if(S){if(R==="create-inline"){Fe(S,{openMode:"inline"});return}if(R==="create-studio"){Fe(S,{openMode:"studio"});return}R==="editor"?(wt(),He(S)):se(S),e.hideModal?.(r.GALLERY),e.hideModal?.(r.PREVIEW)}}function Je(S){const R=S.map(P=>`${P.id}:${P.source||""}:${P.title||""}:${P.method}:${P.outcome}`).join("|");return[l,s.goalId||"none",s.searchQuery,s.activeTags.join(","),s.showPopularOnly,R].join("|")}function Tt(S,R){return R?R==="happy-path"?S.outcome.startsWith("2"):R==="errors"?["4","5"].includes(S.outcome.charAt(0)):R==="faults"?S.tags.includes("fault")||S.tags.includes("delay"):R==="scenarios"?S.isScenario:R==="dynamic"?S.tags.includes("templating"):R==="matching"?S.tags.includes("matching")||S.tags.includes("pattern")||S.tags.includes("jsonpath"):R==="webhooks"?S.tags.includes("webhook"):R==="proxy"?S.tags.includes("proxy"):R==="custom"?S.source==="user":!0:!0}function tt(S){return Ye().filter(R=>Tt(R,S))}function vt(S,R){S.innerHTML=`
            <div class="template-wizard__grid template-wizard__goals"></div>
            <div class="template-wizard__actions">
                <button type="button" class="btn btn-ghost" data-action="show-all">Show all templates</button>
                <div class="template-wizard__actions-right">
                    <button type="button" class="btn btn-primary" data-action="create-empty">Create empty</button>
                </div>
            </div>
        `;const P=S.querySelector(".template-wizard__grid");o.forEach(D=>{const z=R.filter(J=>Tt(J,D.id)).length,$=document.createElement("button");$.type="button",$.className="template-goal",$.dataset.goalId=D.id,$.innerHTML=`
                <span class="template-goal__icon" aria-hidden="true">${D.icon}</span>
                <span class="template-goal__title">${D.title}</span>
                <span class="template-goal__subtitle">${D.subtitle}</span>
                <span class="template-goal__count">${z} templates</span>
            `,$.style.setProperty("--goal-color",D.color),$.disabled=z===0,$.addEventListener("click",()=>{s.goalId=D.id,s.step="templates",s.activeTags=[],s.searchQuery="",s.showPopularOnly=!1,ve({force:!0})}),P.appendChild($)}),S.querySelectorAll('[data-action="show-all"]').forEach(D=>{D.addEventListener("click",()=>{s.goalId=null,s.step="templates",ve({force:!0})})}),S.querySelectorAll('[data-action="create-empty"]').forEach(D=>{D.addEventListener("click",()=>{Ge()})})}function Ee(S,R){const P=S.outcome==="proxy"?"proxy":S.outcome==="fault"?"fault":S.outcome,D=$e(l),z=document.createElement("div");return z.className="template-card template-card--wizard",z.dataset.templateId=S.id,z.setAttribute("role","button"),z.tabIndex=0,z.innerHTML=`
            <div class="template-card__header">
                <span class="badge badge-soft" data-method="${S.method}">${S.method}</span>
                <span class="badge badge-soft" data-outcome="${S.outcome}">${P}</span>
                ${S.isScenario?`<span class="badge badge-soft badge-scenario">${S.content?.mappings?.length||0} steps</span>`:""}
                ${S.popular?'<span class="template-card__star" aria-hidden="true">\u2B50</span>':""}
            </div>
            <div class="template-card__title">${S.title||S.name||S.id}</div>
            <div class="template-card__desc">${S.description||"WireMock template"}</div>
            <div class="template-card__meta">${ht(S)}</div>
            <div class="template-card__tags">
                ${S.tags.slice(0,4).map($=>`<span class="chip">${$}</span>`).join("")}
            </div>
            <div class="template-card__actions">
                <button class="btn btn-primary btn-sm" type="button" data-card-action="select">${D?"Create":"Select"}</button>
                <button class="btn btn-secondary btn-sm" type="button" data-card-action="details">Details</button>
                ${S.source==="user"?'<button class="btn btn-ghost btn-sm" type="button" data-card-action="edit-template">Edit</button>':""}
                ${S.source==="user"?'<button class="btn btn-ghost btn-sm" type="button" data-card-action="delete-template">Delete</button>':""}
            </div>
        `,z.addEventListener("click",$=>{const J=$.target instanceof HTMLElement?$.target.closest("[data-card-action]"):null;if(J){$.stopPropagation();const ie=J.dataset.cardAction;if(ie==="edit-template"){qe(S.id);return}if(ie==="delete-template"){Me(S.id);return}}R(S)}),z.addEventListener("keydown",$=>{($.key==="Enter"||$.key===" ")&&($.preventDefault(),R(S))}),z}function St(S,R){const P=tt(s.goalId),D=Array.from(new Set(P.flatMap(_=>_.tags))).sort(),z=!s.goalId;let $=P.filter(_=>{if(s.showPopularOnly&&!_.popular||s.activeTags.length&&!s.activeTags.every(Re=>_.tags.includes(Re)))return!1;if(!s.searchQuery)return!0;const oe=s.searchQuery.toLowerCase();return(_.title||_.id).toLowerCase().includes(oe)||(_.description||"").toLowerCase().includes(oe)||_.tags.some(Re=>Re.toLowerCase().includes(oe))});S.innerHTML=`
            <div class="template-toolbar template-toolbar--wizard">
                <div class="template-toolbar__search">
                    <svg class="icon icon-16" aria-hidden="true" focusable="false"><use href="#icon-search"></use></svg>
                    <input type="search" placeholder="Search templates..." value="${s.searchQuery}" aria-label="Search templates" />
                </div>
                <div class="template-toolbar__actions">
                    <button type="button" class="btn btn-ghost btn-sm" data-action="show-all" ${z?"disabled":""}>Show all</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-action="toggle-popular" aria-pressed="${s.showPopularOnly}">\u2B50 Popular</button>
                    <button type="button" class="btn btn-primary btn-sm" data-action="create-empty">Create empty</button>
                </div>
            </div>
            <div class="template-tags" aria-label="Tags">
                ${D.map(_=>`<button type="button" class="chip chip--toggle ${s.activeTags.includes(_)?"is-active":""}" data-tag="${_}">${_}</button>`).join("")}
            </div>
            <div class="template-wizard__grid template-wizard__cards" id="template-wizard-cards"></div>
            <div class="template-info template-info--inline">
                <p class="template-info__lead">Need more examples? Visit the <a href="https://library.wiremock.org/" target="_blank" rel="noopener">official WireMock Template Library</a> and import JSON via Import/Export \u2192 Import Data.</p>
            </div>
        `;const J=S.querySelector("#template-wizard-cards"),ie=document.createElement("div");ie.className="history-empty",ie.innerHTML="<p>No templates found</p><small>Adjust filters or import JSON from the WireMock Template Library.</small>",$.length?$.forEach(_=>{J.appendChild(Ee(_,oe=>{s.selectedTemplateId=oe.id,s.step="preview",ve({force:!0})}))}):J.replaceWith(ie);const pe=S.querySelector('input[type="search"]');pe&&pe.addEventListener("input",_=>{s.searchQuery=_.target.value,ve({force:!0})}),S.querySelectorAll('[data-action="toggle-popular"]').forEach(_=>{_.addEventListener("click",()=>{s.showPopularOnly=!s.showPopularOnly,ve({force:!0})})}),S.querySelectorAll('[data-action="show-all"]').forEach(_=>{_.addEventListener("click",()=>{s.goalId=null,s.step="templates",ve({force:!0})})}),S.querySelectorAll('[data-action="create-empty"]').forEach(_=>{_.addEventListener("click",()=>{Ge()})}),S.querySelectorAll("[data-tag]").forEach(_=>{_.addEventListener("click",()=>{const oe=_.dataset.tag;s.activeTags.includes(oe)?s.activeTags=s.activeTags.filter(Re=>Re!==oe):s.activeTags=[...s.activeTags,oe],ve({force:!0})})})}function Ct(S,R){const P=R.find(oe=>oe.id===s.selectedTemplateId);if(!P){s.step="templates",ve({force:!0});return}const D=$e(l),z=ht(P),$=mt(P),J=gt(P),ie=P.tags||[];S.innerHTML=`
            <div class="template-preview-card">
                <div class="template-preview-card__meta">
                    <div class="template-preview-card__badges">
                        <span class="badge badge-soft" data-method="${P.method}">${P.method}</span>
                        <span class="badge badge-soft" data-outcome="${P.outcome}">${P.outcome==="proxy"?"proxy":P.outcome}</span>
                        ${P.isScenario?`<span class="badge badge-soft badge-scenario">${P.content?.mappings?.length||0} steps</span>`:""}
                    </div>
                    <h4 class="template-preview-card__title">${P.title||P.name||P.id}</h4>
                    <p class="template-preview-card__desc">${P.description||""}</p>
                    <div class="template-preview-card__summary">${z||"\u2014"}</div>
                    ${$?`<div class="template-preview-meta__row"><span class="template-preview-meta__label">${$.label}</span><code class="template-preview-meta__code">${$.value}</code></div>`:""}
                    <div class="template-preview-card__tags">${ie.map(oe=>`<span class="chip">${oe}</span>`).join("")}</div>
                </div>
                <pre class="template-preview-card__code" id="template-preview-code-inline"></pre>
            </div>
            <div class="template-preview-actions template-preview-actions--wizard" id="template-preview-actions">
                <div class="template-preview-actions__primary">
                    ${D?'<button class="btn btn-primary btn-sm" type="button" data-template-action="apply">Create and open editor</button>':'<button class="btn btn-primary btn-sm" type="button" data-template-action="apply">Use template</button>'}
                    ${D?'<button class="btn btn-secondary btn-sm" type="button" data-template-action="create-studio">Create in JSON Studio</button>':""}
                    <button class="btn btn-secondary btn-sm" type="button" data-template-action="copy">Copy JSON</button>
                </div>
                ${P.source==="user"?`<div class="template-preview-actions__secondary">
                        <button class="btn btn-ghost btn-sm" type="button" data-template-action="edit-template">Edit template</button>
                        <button class="btn btn-ghost btn-sm" type="button" data-template-action="delete-template">Delete</button>
                    </div>`:""}
            </div>
        `;const pe=S.querySelector("#template-preview-code-inline");pe&&(pe.textContent=J);const _=S.querySelector("#template-preview-actions");_&&_.addEventListener("click",async oe=>{const Re=oe.target instanceof HTMLElement?oe.target.closest("[data-template-action]"):null;if(!Re)return;const xe=Re.dataset.templateAction;if(xe==="apply"){ct(P,l);return}if(xe==="create-studio"){Fe(P,{openMode:"studio"});return}if(xe==="copy"){const _e=typeof P.content=="string"?P.content:JSON.stringify(P.content,null,2),Oe=await yt(_e);y(Oe?`Template "${P.title}" copied`:"Clipboard copy failed",Oe?"success":"error")}if(xe==="edit-template"){await qe(P.id);return}xe==="delete-template"&&Me(P.id)})}function Lt(){if(s.step==="preview"){s.step="templates";return}s.step="goals",s.goalId=null,s.selectedTemplateId=null}function ve(S={}){const{force:R=!1}=S,P=document.getElementById("template-gallery-shell");if(P)try{const D=Ye(),z=Je(D);if(!R&&z===f)return;f=z;const $=s.step==="goals"?1:s.step==="templates"?2:3,J=o.find(oe=>oe.id===s.goalId),ie=s.step!=="goals";P.innerHTML=`
                <div class="template-wizard">
                    <div class="template-wizard__header">
                        <div>
                            <p class="template-wizard__eyebrow">Step ${$}/3</p>
                            <h3 class="template-wizard__title">${s.step==="goals"?"Create a mapping":J?.title||"Pick a template"}</h3>
                            <p class="template-wizard__subtitle">${s.step==="goals"?"Choose the scenario that fits your testing goal":J?.description||""}</p>
                        </div>
                        <div class="template-wizard__header-actions">
                            <div class="template-wizard__progress" role="progressbar" aria-label="Wizard progress" aria-valuemin="1" aria-valuemax="3" aria-valuenow="${$}">
                                <span class="sr-only">Step ${$} of 3</span>
                                ${[1,2,3].map(oe=>`<span class="template-wizard__dot ${oe<=$?"is-active":""}" aria-current="${oe===$?"step":"false"}" aria-label="Step ${oe}"></span>`).join("")}
                            </div>
                            ${ie?'<button type="button" class="btn btn-ghost btn-sm" id="template-wizard-back">\u2190 Back</button>':""}
                        </div>
                    </div>
                    <div class="template-wizard__body" id="template-wizard-body"></div>
                </div>
            `;const pe=P.querySelector("#template-wizard-body");if(!pe)return;D.length?s.step==="goals"?vt(pe,D):s.step==="templates"?St(pe,D):Ct(pe,D):pe.innerHTML='<div class="history-empty"><p>No templates available</p><small>Add or import templates to populate this view.</small></div>';const _=P.querySelector("#template-wizard-back");_&&_.addEventListener("click",()=>{Lt(),ve({force:!0})})}catch(D){Logger.error("TEMPLATES","Failed to render template wizard",D),P.innerHTML='<div class="history-empty"><p>Templates unavailable</p><small>Reload the page or try again later.</small></div>'}}function Pt(S="form"){l=S,s.step="goals",s.goalId=null,s.selectedTemplateId=null,s.searchQuery="",s.activeTags=[],s.showPopularOnly=!1;try{ve({force:!0})}catch(D){Logger.error("TEMPLATES","Unable to prepare template gallery",D);const z=document.getElementById("template-gallery-shell");z&&(z.innerHTML='<div class="history-empty"><p>Templates unavailable</p><small>Reload the page or try again later.</small></div>')}if(typeof e.showModal=="function"){e.showModal(r.GALLERY);return}const P=document.getElementById(r.GALLERY);P&&(P.classList.remove("hidden"),P.style.display="flex")}function nt(){document.querySelectorAll("[data-template-trigger]").forEach(S=>{S.addEventListener("click",R=>{R.preventDefault(),Pt(S.dataset.templateTarget||"form")})})}function kt(){try{Be(),ve()}catch(S){Logger.error("TEMPLATES","Template manager failed to initialize",S);const R=document.getElementById("template-gallery-shell");R&&(R.innerHTML='<div class="history-empty"><p>Templates unavailable</p><small>Reload the page or try again later.</small></div>')}nt(),document.getElementById("save-template-btn")?.addEventListener("click",S=>{S.preventDefault(),et()}),document.getElementById("editor-save-template")?.addEventListener("click",S=>{S.preventDefault(),Ke()})}e.TemplateManager={getTemplates:at,refresh:Be,openGallery:ve,openGalleryForTarget:Pt,getTemplatesWithMeta:Ye,getEmptyTemplateSeed:M,getEmptyMappingContent:T,applyTemplateToForm:se,applyTemplateToEditor:He,createMappingFromTemplate:Fe,createMappingsFromPayloads:j,prepareMappingForCreation:U,createEmptyMapping:Ge,saveFormAsTemplate:et,saveEditorAsTemplate:Ke,updateUserTemplate:Ce,editUserTemplate:qe,deleteUserTemplate:Me},document.readyState==="loading"?document.addEventListener("DOMContentLoaded",kt):kt()})(typeof window<"u"?window:globalThis),(function(){const e={GET:1,POST:2,PUT:3,PATCH:4,DELETE:5},t=(m,...M)=>{if(!m||typeof m!="object")return"";for(const I of M){const T=I.includes(".")?I.split(".").reduce((g,y)=>g?.[y],m):m[I];if(T!=null)return String(T)}return""},i=m=>{if(m==null)return"";try{const M=typeof m=="string"?m:JSON.stringify(m);return M.length>300?`${M.slice(0,300)}\u2026`:M}catch{return""}},r=m=>t(m,"id","uuid","stubId"),o=m=>t(m,"id","requestId","mappingUuid","request.id","request.loggedDate","loggedDate"),c=m=>{if(!m||typeof m!="object")return"";const M=m.request||{},I=m.response||{},T=m.metadata||{};return[M.method||"",M.url||M.urlPattern||M.urlPath||M.urlPathPattern||"",I.status||"",I.fixedDelayMilliseconds||"",m.name||T.name||"",m.priority??"",m.scenarioName||"",T.edited||T.created||"",T.source||"",i(M.headers),i(M.bodyPatterns||M.body||""),i(M.queryParameters),i(I.headers),i(I.jsonBody!==void 0?I.jsonBody:I.body||""),i(T.additionalMetadata||T.tags||T.description||"")].join("|")},s=m=>{if(!m||typeof m!="object")return"";const M=m.request||{},I=m.responseDefinition||{};return[M.method||"",M.url||M.urlPath||"",M.loggedDate||m.loggedDate||"",m.wasMatched===!1?"unmatched":"matched",I.status??"",(I.body||I.jsonBody||"").length,(M.body||"").length].join("|")},l=m=>[...Array.isArray(m)?m:[]].sort((I,T)=>{const g=I?.priority??1,y=T?.priority??1;if(g!==y)return g-y;const C=e[I?.request?.method]||999,A=e[T?.request?.method]||999;if(C!==A)return C-A;const B=I?.request?.url||I?.request?.urlPattern||I?.request?.urlPath||"",X=T?.request?.url||T?.request?.urlPattern||T?.request?.urlPath||"";return B.localeCompare(X)}),d=m=>typeof window.renderMappingCard=="function"?window.renderMappingCard(m):"",f=m=>typeof window.renderRequestCard=="function"?window.renderRequestCard(m):"",h=(m,M,I={})=>{if(!m||typeof window.renderList!="function")return[];const T=I.preSorted===!0?[...M||[]]:l(M),g=I.onItemChanged,y=I.onItemRemoved;if(window.PaginationManager){window.PaginationManager.updateState(T.length);const C=window.PaginationManager.getCurrentPageItems(T);window.renderList(m,C,{renderItem:d,getKey:r,getSignature:c,onItemChanged:g,onItemRemoved:y});const A=document.getElementById(I.paginationContainerId||"mappings-pagination");return A&&(A.innerHTML=window.PaginationManager.renderControls()),T}return window.renderList(m,T,{renderItem:d,getKey:r,getSignature:c,onItemChanged:g,onItemRemoved:y}),T};window.getRenderKey=t,window.getMappingRenderKey=r,window.getRequestRenderKey=o,window.getMappingRenderSignature=c,window.getRequestRenderSignature=s,window.renderMappingMarkup=d,window.renderRequestMarkup=f,window.sortMappingsForDisplay=l,window.renderMappingsCollection=h})();function executeMappingFilters(){const e=document.getElementById("filter-query")?.value?.trim()||"";window.FilterManager.saveFilterState("mappings",{query:e}),updateURLFilterParams(e,"mappings");const t=window.originalMappings;if(!Array.isArray(t)||t.length===0){const l=document.getElementById(SELECTORS.EMPTY.MAPPINGS),d=document.getElementById(SELECTORS.LISTS.MAPPINGS);l&&(l.classList.remove("hidden"),l.removeAttribute("aria-hidden")),d&&(d.style.display="none"),typeof updateMappingsCounter=="function"&&updateMappingsCounter();return}let i;e?window.QueryParser&&typeof window.QueryParser.filterMappingsByQuery=="function"?i=window.QueryParser.filterMappingsByQuery(t,e):(Logger.warn("MANAGERS","[Mapping Filter] QueryParser or filterMappingsByQuery is not available. Showing all mappings."),i=t):i=t,window._filteredMappings=i;const r=document.getElementById(SELECTORS.LISTS.MAPPINGS),o=document.getElementById(SELECTORS.EMPTY.MAPPINGS),c=document.getElementById(SELECTORS.LOADING.MAPPINGS);if(!r)return;if(window.MappingsStore?.metadata?.isRendering){window.MappingsStore.metadata.pendingFilterRender=!0;return}const s=typeof window.sortMappingsForDisplay=="function"?window.sortMappingsForDisplay(i):[...i];if(typeof window.renderMappingsCollection=="function")window.renderMappingsCollection(r,s,{preSorted:!0});else if(window.PaginationManager){window.PaginationManager.updateState(s.length);const l=window.PaginationManager.getCurrentPageItems(s);renderList(r,l,{renderItem:window.renderMappingMarkup,getKey:window.getMappingRenderKey,getSignature:window.getMappingRenderSignature});const d=document.getElementById("mappings-pagination");d&&(d.innerHTML=window.PaginationManager.renderControls())}else renderList(r,s,{renderItem:window.renderMappingMarkup,getKey:window.getMappingRenderKey,getSignature:window.getMappingRenderSignature});c&&c.classList.add("hidden"),s.length===0?(o&&(o.classList.remove("hidden"),o.removeAttribute("aria-hidden")),r.style.display="none"):(o&&(o.classList.add("hidden"),o.setAttribute("aria-hidden","true")),r.style.display="block"),typeof updateMappingsCounter=="function"&&updateMappingsCounter()}function executeRequestFilters(){const e=document.getElementById("req-filter-query")?.value?.trim()||"",t=document.getElementById("req-filter-from"),i=document.getElementById("req-filter-to"),r=t?.value||"",o=i?.value||"";if(window.FilterManager.saveFilterState("requests",{query:e,from:r,to:o}),updateURLFilterParams(e,"requests"),!Array.isArray(window.originalRequests)||window.originalRequests.length===0){window.allRequests=[];const m=document.getElementById(SELECTORS.EMPTY.REQUESTS),M=document.getElementById(SELECTORS.LISTS.REQUESTS);m&&m.classList.remove("hidden"),M&&(M.style.display="none"),typeof updateRequestsCounter=="function"&&updateRequestsCounter();return}let c=e&&window.QueryParser?window.QueryParser.filterRequestsByQuery(window.originalRequests,e):window.originalRequests;const s=r?new Date(r).getTime():null,l=o?new Date(o).getTime():null;(s!==null||l!==null)&&(c=c.filter(m=>{if(!m)return!1;const M=new Date(m.request?.loggedDate||m.loggedDate).getTime();return!(s!==null&&Number.isFinite(s)&&(!Number.isFinite(M)||M<s)||l!==null&&Number.isFinite(l)&&(!Number.isFinite(M)||M>l))})),window.allRequests=c;const d=document.getElementById(SELECTORS.LISTS.REQUESTS),f=document.getElementById(SELECTORS.EMPTY.REQUESTS),h=document.getElementById(SELECTORS.LOADING.REQUESTS);d&&(renderList(d,window.allRequests,{renderItem:window.renderRequestMarkup,getKey:window.getRequestRenderKey,getSignature:window.getRequestRenderSignature}),h&&h.classList.add("hidden"),window.allRequests.length===0?(f&&f.classList.remove("hidden"),d.style.display="none"):(f&&f.classList.add("hidden"),d.style.display="block"),typeof updateRequestsCounter=="function"&&updateRequestsCounter(),Logger.debug("MANAGERS",`Filtered requests: ${window.allRequests.length} items`))}window.FilterManager._applyMappingFilters=window.debounce(executeMappingFilters,180),window.FilterManager._applyRequestFilters=window.debounce(executeRequestFilters,180),window.applyFilters=()=>{FilterManager.applyMappingFilters(),typeof window._updateActiveFiltersDisplayDebounced=="function"?window._updateActiveFiltersDisplayDebounced():typeof window.updateActiveFiltersDisplay=="function"&&window.updateActiveFiltersDisplay()},window.clearMappingFilters=()=>{const n=document.getElementById("filter-query");n&&(n.value=""),FilterManager.applyMappingFilters(),typeof FilterManager.flushMappingFilters=="function"&&FilterManager.flushMappingFilters(),typeof window.updateActiveFiltersDisplay=="function"&&window.updateActiveFiltersDisplay(),typeof window.updateURLFilterParams=="function"&&window.updateURLFilterParams("","mappings")},window.toggleQueryHelp=(n="mappings")=>{const e=n==="requests"?"req-query-help":"query-help",t=document.getElementById(e);if(!t)return;const i=t.classList.contains("hidden"),r=document.querySelector(`[aria-controls="${e}"]`);i?(t.classList.remove("hidden"),r&&(r.textContent="\xD7",r.setAttribute("aria-expanded","true"))):(t.classList.add("hidden"),r&&(r.textContent="?",r.setAttribute("aria-expanded","false")))},window.applyQuickMethodFilter=n=>{const e=document.getElementById("filter-query");if(!e)return;const t=e.value.trim(),i=/method:[^\s]+/;i.test(t)?e.value=t.replace(i,`method:${n}`):e.value=t?`method:${n} ${t}`:`method:${n}`,applyFilters(),updateActiveFiltersDisplay()},window.updateActiveFiltersDisplay=()=>{const n=document.getElementById("filter-query"),e=document.getElementById("active-filters"),t=document.getElementById("active-filters-list");if(!n||!e||!t)return;const i=n.value.trim();if(!i){e.classList.add("filter-hidden");return}const r=window.QueryParser?window.QueryParser.parseQuery(i):null;if(!r||Object.keys(r).length===0){e.classList.add("filter-hidden");return}const o=[];for(const[c,s]of Object.entries(r)){if(c==="text")continue;let l="";if(typeof s=="object"&&s.exclude){const d=Array.isArray(s.exclude)?s.exclude.join(","):s.exclude;l=`-${c}:${d}`}else typeof s=="object"&&s.from&&s.to?l=`${c}:${s.from}-${s.to}`:Array.isArray(s)?l=`${c}:${s.join(",")}`:l=`${c}:${s}`;o.push(`
            <button type="button"
                    class="filter-chip filter-chip-active"
                    data-action="remove-active-filter"
                    data-filter-key="${Utils.escapeHtml(c)}"
                    title="Click to remove">
                ${Utils.escapeHtml(l)}
                <span class="filter-chip-remove" aria-hidden="true">\xD7</span>
            </button>
        `)}t.innerHTML=o.join(""),o.length>0?e.classList.remove("filter-hidden"):e.classList.add("filter-hidden")},window._updateActiveFiltersDisplayDebounced=window.debounce?window.debounce(window.updateActiveFiltersDisplay,200):window.updateActiveFiltersDisplay,window.removeActiveFilter=n=>{const e=document.getElementById("filter-query");if(!e)return;const t=e.value.trim(),i=[new RegExp(`-?${n}:[^\\s]+`,"g"),new RegExp(`\\s+${n}:[^\\s]+`,"g"),new RegExp(`${n}:[^\\s]+\\s+`,"g")];let r=t;for(const o of i)r=r.replace(o," ");r=r.replace(/\s+/g," ").trim(),e.value=r,applyFilters(),updateActiveFiltersDisplay()},window.applyRequestFilters=()=>FilterManager.applyRequestFilters();function applyDateRange(n,e,t,i){n&&(n.value=Utils.formatDateTime(t)),e&&(e.value=Utils.formatDateTime(i)),FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters()}window.applyQuickFilter=()=>{const n=document.getElementById(SELECTORS.REQUEST_FILTERS.QUICK);if(!n)return;const e=n.value,t=document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_FROM),i=document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_TO);if(!e){t&&(t.value=""),i&&(i.value=""),FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters();return}const r=new Date,o=new Date(r),c=e.match(/^(\d+)([mhd])$/);if(!c)return;const s=parseInt(c[1]);switch(c[2]){case"m":o.setMinutes(o.getMinutes()-s);break;case"h":o.setHours(o.getHours()-s);break;case"d":o.setDate(o.getDate()-s);break;default:return}applyDateRange(t,i,o,r)},window.clearQuickTimeFilter=()=>{const n=document.getElementById("req-filter-quick");n&&(n.value="")},window.applyQuickTimeFilter=()=>{const n=document.getElementById("req-filter-quick"),e=document.getElementById("req-filter-from"),t=document.getElementById("req-filter-to");if(!n||!e||!t)return;const i=n.value;if(!i){e.value="",t.value="",FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters();return}const r=new Date;let o=new Date(r);const c=i.match(/^(\d+)([mhd])$/);if(c){const s=parseInt(c[1],10);switch(c[2]){case"m":o.setMinutes(o.getMinutes()-s);break;case"h":o.setHours(o.getHours()-s);break;case"d":o.setDate(o.getDate()-s);break}}applyDateRange(e,t,o,r)},window.clearRequestFilters=()=>{const n=document.getElementById("req-filter-query");n&&(n.value="");const e=document.getElementById("req-filter-from"),t=document.getElementById("req-filter-to"),i=document.getElementById("req-filter-quick");e&&(e.value=""),t&&(t.value=""),i&&(i.value=""),FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters(),typeof window.updateRequestActiveFiltersDisplay=="function"&&window.updateRequestActiveFiltersDisplay(),typeof window.updateURLFilterParams=="function"&&window.updateURLFilterParams("","requests")},window.applyQuickRequestFilter=n=>{const e=document.getElementById("req-filter-query");if(!e)return;const t=e.value.trim();if(/^[A-Z]+$/.test(n)){const i=/method:[\w,]+/i;i.test(t)?e.value=t.replace(i,`method:${n}`):e.value=t?`method:${n} ${t}`:`method:${n}`}else{const i=n.match(/^(\w+):/);if(i){const r=i[1],o=new RegExp(`${r}:[^\\s]+`,"i");o.test(t)?e.value=t.replace(o,n):e.value=t?`${n} ${t}`:n}else e.value=t?`${n} ${t}`:n}FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters(),typeof window._updateRequestActiveFiltersDisplayDebounced=="function"?window._updateRequestActiveFiltersDisplayDebounced():typeof window.updateRequestActiveFiltersDisplay=="function"&&window.updateRequestActiveFiltersDisplay()},window.updateRequestActiveFiltersDisplay=()=>{const n=document.getElementById("req-active-filters"),e=document.getElementById("req-filter-query");if(!n||!e)return;const t=e.value.trim();if(!t||!window.QueryParser){n.innerHTML="",n.classList.add("filter-hidden");return}const i=window.QueryParser.parseQuery(t);if(!i){n.innerHTML="",n.classList.add("filter-hidden");return}const r=[];for(const[o,c]of Object.entries(i)){if(o==="text")continue;let s="";if(o==="matched"){const l=Array.isArray(c)?c:[c],d=String(l[0]).toLowerCase();d==="true"||d==="yes"||d==="1"?s="Matched":s="Unmatched"}else if(Array.isArray(c))s=`${o}: ${c.join(", ")}`;else if(typeof c=="object"&&c.exclude){const l=Array.isArray(c.exclude)?c.exclude:[c.exclude];s=`NOT ${o}: ${l.join(", ")}`}else s=`${o}: ${c}`;r.push(`<button type="button" class="filter-chip filter-chip-active" data-action="remove-request-active-filter" data-filter-key="${Utils.escapeHtml(o)}" title="Remove filter">${Utils.escapeHtml(s)} \xD7</button>`)}n.innerHTML=r.join(""),r.length>0?n.classList.remove("filter-hidden"):n.classList.add("filter-hidden")},window._updateRequestActiveFiltersDisplayDebounced=window.debounce?window.debounce(window.updateRequestActiveFiltersDisplay,200):window.updateRequestActiveFiltersDisplay,window.removeRequestActiveFilter=n=>{const e=document.getElementById("req-filter-query");if(!e)return;const t=e.value.trim();if(!t)return;const i=new RegExp(`-?${n}:[\\w\\/\\*.,\\-]+(\\s+|$)`,"gi"),r=t.replace(i,"").replace(/\s+/g," ").trim();e.value=r,FilterManager.applyRequestFilters(),typeof FilterManager.flushRequestFilters=="function"&&FilterManager.flushRequestFilters(),typeof window.updateRequestActiveFiltersDisplay=="function"&&window.updateRequestActiveFiltersDisplay()};function getSavedFilters(n){const e=`saved-filters-${n}`;try{const t=localStorage.getItem(e);return t?JSON.parse(t):[]}catch(t){return Logger.warn("FILTERS",`Failed to load saved filters for ${n}:`,t),[]}}function setSavedFilters(n,e){const t=`saved-filters-${n}`;try{localStorage.setItem(t,JSON.stringify(e))}catch(i){Logger.error("FILTERS",`Failed to save filters for ${n}:`,i)}}window.saveCurrentMappingFilter=()=>{const n=document.getElementById("filter-query");if(!n)return;const e=n.value.trim();if(!e){typeof NotificationManager<"u"&&NotificationManager.warning("No filter to save");return}const t=prompt("Enter a name for this filter:",e.substring(0,30));if(!t)return;const i=getSavedFilters("mappings"),r=i.findIndex(o=>o.name===t);if(r>=0){if(!confirm(`Filter "${t}" already exists. Overwrite?`))return;i[r]={name:t,query:e}}else i.push({name:t,query:e});setSavedFilters("mappings",i),updateSavedFiltersDisplay("mappings"),typeof NotificationManager<"u"&&NotificationManager.success(`Filter "${t}" saved`)},window.saveCurrentRequestFilter=()=>{const n=document.getElementById("req-filter-query");if(!n)return;const e=n.value.trim();if(!e){typeof NotificationManager<"u"&&NotificationManager.warning("No filter to save");return}const t=prompt("Enter a name for this filter:",e.substring(0,30));if(!t)return;const i=getSavedFilters("requests"),r=i.findIndex(o=>o.name===t);if(r>=0){if(!confirm(`Filter "${t}" already exists. Overwrite?`))return;i[r]={name:t,query:e}}else i.push({name:t,query:e});setSavedFilters("requests",i),updateSavedFiltersDisplay("requests"),typeof NotificationManager<"u"&&NotificationManager.success(`Filter "${t}" saved`)},window.applySavedFilter=(n,e)=>{const i=getSavedFilters(n).find(r=>r.name===e);if(!i){Logger.warn("FILTERS",`Saved filter "${e}" not found`);return}if(n==="mappings"){const r=document.getElementById("filter-query");r&&(r.value=i.query,applyFilters(),updateActiveFiltersDisplay())}else if(n==="requests"){const r=document.getElementById("req-filter-query");r&&(r.value=i.query,FilterManager.applyRequestFilters(),updateRequestActiveFiltersDisplay())}},window.deleteSavedFilter=(n,e)=>{const i=getSavedFilters(n).filter(r=>r.name!==e);setSavedFilters(n,i),updateSavedFiltersDisplay(n),typeof NotificationManager<"u"&&NotificationManager.info(`Filter "${e}" deleted`)};function updateSavedFiltersDisplay(n){const e=getSavedFilters(n);let t,i;if(n==="mappings")t="saved-filters-list",i="saved-filters-separator";else if(n==="requests")t="req-saved-filters-list",i="req-saved-filters-separator";else return;const r=document.getElementById(t),o=document.getElementById(i);if(!r)return;if(e.length===0){r.classList.add("filter-hidden"),o&&o.classList.add("filter-hidden");return}const c=e.map(s=>`
        <button type="button"
                class="filter-chip filter-chip-saved"
                data-action="apply-saved-filter"
                data-filter-tab="${Utils.escapeHtml(n)}"
                data-filter-name="${Utils.escapeHtml(s.name)}"
                title="${Utils.escapeHtml(s.query)}">
            <span class="filter-chip-text">${Utils.escapeHtml(s.name)}</span>
            <span class="filter-chip-remove"
                  data-action="delete-saved-filter"
                  data-filter-tab="${Utils.escapeHtml(n)}"
                  data-filter-name="${Utils.escapeHtml(s.name)}"
                  title="Delete filter"
                  aria-label="Delete filter">\xD7</span>
        </button>
    `);r.innerHTML=c.join(""),r.classList.remove("filter-hidden"),o&&o.classList.remove("filter-hidden")}if(window.loadAllSavedFilters=()=>{updateSavedFiltersDisplay("mappings"),updateSavedFiltersDisplay("requests")},!window._filterChipDelegationInitialized){let n=function(t){const i=t.target.closest('[data-action="delete-saved-filter"]');if(i){t.stopPropagation();const s=i.dataset.filterTab,l=i.dataset.filterName;s&&l&&window.deleteSavedFilter(s,l);return}const r=t.target.closest('[data-action="apply-saved-filter"]');if(r){const s=r.dataset.filterTab,l=r.dataset.filterName;s&&l&&window.applySavedFilter(s,l);return}const o=t.target.closest('[data-action="remove-active-filter"]');if(o){const s=o.dataset.filterKey;s&&window.removeActiveFilter(s);return}const c=t.target.closest('[data-action="remove-request-active-filter"]');if(c){const s=c.dataset.filterKey;s&&window.removeRequestActiveFilter(s);return}};window._filterChipDelegationInitialized=!0,["active-filters-list","req-active-filters","saved-filters-list","req-saved-filters-list"].forEach(t=>{const i=document.getElementById(t);i&&i.addEventListener("click",n)})}function isCacheEnabled(){try{const n=document.getElementById("cache-enabled"),e=typeof window.readWiremockSettings=="function"?window.readWiremockSettings():{},t=n&&typeof n.checked=="boolean"?n.checked:!0;return e.cacheEnabled!==!1&&t}catch(n){return Logger.warn("CACHE","Failed to resolve cache enabled state. Defaulting to cache disabled. Check settings configuration.",n),!1}}window.isCacheEnabled=isCacheEnabled,window.connectToWireMock=async()=>{const n=document.getElementById("wiremock-host")||document.getElementById(SELECTORS.CONNECTION.HOST),e=document.getElementById("wiremock-port")||document.getElementById(SELECTORS.CONNECTION.PORT);let t,i;if(n&&e)t=n.value.trim()||"localhost",i=e.value.trim()||"8080";else if(window.wiremockBaseUrl)Logger.api("Using existing wiremockBaseUrl for connection"),t="localhost",i="8080";else{const s=typeof window.readWiremockSettings=="function"?window.readWiremockSettings():{};t=s.host||"localhost",i=s.port||"8080",Logger.api("Using settings for connection:",{host:t,port:i})}Logger.api("Connecting with:",{host:t,port:i});const r=document.getElementById(SELECTORS.CONNECTION.STATUS_DOT),o=document.getElementById(SELECTORS.CONNECTION.STATUS_TEXT),c=document.getElementById(SELECTORS.LOADING.MAPPINGS);if(r&&(r.className="status-dot connecting"),o&&(o.textContent="Connecting..."),c&&c.classList.remove("hidden"),!window.wiremockBaseUrl||n){if(typeof window.normalizeWiremockBaseUrl=="function")window.wiremockBaseUrl=window.normalizeWiremockBaseUrl(t,i);else{const s=/^(https?:)\/\//i.test(t),l=s?t.split(":")[0]:"http",d=s?t.replace(/^(https?:)\/\//i,""):t,f=i&&String(i).trim()||(l==="https"?"443":"8080");window.wiremockBaseUrl=`${l}://${d}:${f}/__admin`}Logger.api("Updated wiremockBaseUrl:",window.wiremockBaseUrl)}else Logger.api("Using pre-configured wiremockBaseUrl:",window.wiremockBaseUrl);try{await checkHealthAndStartUptime(),Logger.info("API","Online mode - proceeding with data loading");const s=document.getElementById(SELECTORS.CONNECTION.SETUP),l=document.getElementById(SELECTORS.BUTTONS.ADD_MAPPING);r&&(r.className="status-dot connected"),o&&(window.lastWiremockSuccess||(window.lastWiremockSuccess=Date.now()),typeof window.updateLastSuccessUI=="function"&&window.updateLastSuccessUI()),s&&(s.style.display="none"),l&&(l.disabled=!1);const d=document.getElementById(SELECTORS.UI.STATS),f=document.getElementById("stats-spacer"),h=document.getElementById(SELECTORS.UI.SEARCH_FILTERS);d&&(d.style.display="flex"),f&&(f.style.display="none"),h&&(h.style.display="block"),startHealthCheck(),Logger.info("API","Using new optimized sync engine");const m=isCacheEnabled();Logger.info("CACHE",`Service cache is ${m?"enabled":"disabled"} for this session`),window.SyncEngine.stop(),await window.SyncEngine.coldStart({useCache:m}),window.SyncEngine.start(),await loadScenarios(),typeof window.hideOnboardingOverlay=="function"&&window.hideOnboardingOverlay(),typeof window.FilterManager?.restoreFilters=="function"&&window.FilterManager.restoreFilters("mappings")?.query&&typeof window.FilterManager.applyMappingFilters=="function"&&(window.FilterManager.applyMappingFilters(),typeof window.FilterManager.flushMappingFilters=="function"&&window.FilterManager.flushMappingFilters()),NotificationManager.success("Connected to WireMock successfully!")}catch(s){Logger.error("API","Connection error - entering offline mode:",s),Logger.warn("API","Offline mode - no server requests will be made"),stopUptime(),r&&(r.className="status-dot disconnected"),o&&(o.textContent="Offline"),c&&c.classList.add("hidden"),NotificationManager.warning("WireMock server is offline. Retrying connection in background..."),startHealthCheck()}};let healthCheckTimeout=null,healthCheckFailureCount=0;window.startHealthCheck=()=>{healthCheckTimeout&&(clearTimeout(healthCheckTimeout),healthCheckTimeout=null);let n;window.isOnline?n=3e4:n=Math.min(2e3*Math.pow(2,healthCheckFailureCount),6e4),Logger.info("HEALTH",`Scheduling next check in ${n}ms (${window.isOnline?"online":`offline, attempt ${healthCheckFailureCount+1}`})`),healthCheckTimeout=setTimeout(async()=>{try{const e=performance.now();let t=!1,i=0;try{const o=await apiFetch(ENDPOINTS.HEALTH);i=Math.round(performance.now()-e),t=typeof o=="object"&&(typeof o.status=="string"&&["up","healthy","ok"].includes(o.status.toLowerCase())||o.healthy===!0)}catch(o){if(o?.message?.includes("404")||o?.status===404){Logger.warn("HEALTH","/health not found (404), trying /mappings fallback for older WireMock");try{const s=await window.apiFetch(window.ENDPOINTS.MAPPINGS);i=Math.round(performance.now()-e),t=typeof s=="object"&&s!==null&&!s.__isDemo}catch{t=!1}}else t=!1}const r=window.isOnline;if(window.isOnline=t,t){healthCheckFailureCount=0;const o=document.getElementById(SELECTORS.HEALTH.INDICATOR);o&&(o.innerHTML=`<span>Response Time: </span><span class="healthy">${i}ms</span>`),r?Logger.info("HEALTH",`Server is healthy (${i}ms)`):(Logger.info("HEALTH",`Server is back online (${i}ms)`),NotificationManager.success("WireMock server is back online! Reconnecting..."),await window.connectToWireMock())}else{healthCheckFailureCount++;const o=document.getElementById(SELECTORS.HEALTH.INDICATOR);if(o&&(o.innerHTML='<span>Response Time: </span><span class="unhealthy">Offline</span>'),r){Logger.warn("HEALTH","Server went offline"),stopUptime();const c=document.getElementById(SELECTORS.CONNECTION.STATUS_DOT),s=document.getElementById(SELECTORS.CONNECTION.STATUS_TEXT);c&&(c.className="status-dot disconnected"),s&&(s.textContent="Offline"),NotificationManager.warning("WireMock server went offline. Retrying in background...")}else Logger.warn("HEALTH",`Server still offline (attempt ${healthCheckFailureCount})`)}startHealthCheck()}catch(e){Logger.error("HEALTH","Check error:",e),window.isOnline=!1,healthCheckFailureCount++,startHealthCheck()}},n)},window.stopHealthCheck=()=>{healthCheckTimeout&&(clearTimeout(healthCheckTimeout),healthCheckTimeout=null,healthCheckFailureCount=0,Logger.info("HEALTH","Health check stopped"))},window.checkHealthAndStartUptime=async()=>{try{const n=performance.now();let e=0,t=!1;try{const i=await apiFetch(ENDPOINTS.HEALTH);e=Math.round(performance.now()-n),t=typeof i=="object"&&(typeof i.status=="string"&&["up","healthy","ok"].includes(i.status.toLowerCase())||i.healthy===!0),Logger.info("HEALTH","initial check:",{rawStatus:i?.status,healthyFlag:i?.healthy,isHealthy:t})}catch(i){if(i?.message?.includes("404")||i?.status===404){Logger.warn("HEALTH","/health not found (404), trying /mappings fallback for older WireMock");try{const o=await window.apiFetch(window.ENDPOINTS.MAPPINGS);e=Math.round(performance.now()-n),t=typeof o=="object"&&o!==null&&!o.__isDemo,Logger.info("HEALTH","fallback check (mappings):",{isHealthy:t,responseTime:e})}catch{Logger.warn("HEALTH","fallback failed - offline mode"),t=!1}}else Logger.warn("HEALTH","connection failed - offline mode"),t=!1}if(t){if(window.isOnline=!0,window.startTime=Date.now(),window.uptimeInterval&&window.LifecycleManager.clearInterval(window.uptimeInterval),window.uptimeInterval=window.LifecycleManager.setNamedInterval("uptime-display",updateUptime,1e3),typeof window.applyHealthUI=="function")try{window.applyHealthUI(!0,e)}catch(r){Logger.warn("HEALTH","applyHealthUI failed:",r)}const i=document.getElementById(SELECTORS.HEALTH.INDICATOR);i&&(i.style.display="inline",i.innerHTML=`<span>Response Time: </span><span class="healthy">${e}ms</span>`),Logger.info("HEALTH",`WireMock health check passed (${e}ms), uptime started, online mode`)}else throw window.isOnline=!1,new Error("WireMock is not reachable - offline mode")}catch(n){throw window.isOnline=!1,Logger.error("HEALTH","Health check failed - entering offline mode:",n),n}},(function(){const e=new Map,t=new Map,i=new Set,r=new Map,o={setInterval(c,s){const l=window.setInterval(c,s);return e.set(l,{delay:s,createdAt:Date.now()}),Logger.debug("LIFECYCLE",`Interval created: ${l} (${s}ms)`),l},clearInterval(c){if(c!=null){window.clearInterval(c);const s=e.get(c);e.delete(c),Logger.debug("LIFECYCLE",`Interval cleared: ${c}${s?` (${s.delay}ms, ${Date.now()-s.createdAt}ms ago)`:""}`)}},setTimeout(c,s){const l=window.setTimeout(c,s);return t.set(l,{delay:s,createdAt:Date.now()}),Logger.debug("LIFECYCLE",`Timeout created: ${l} (${s}ms)`),l},clearTimeout(c){if(c!=null){window.clearTimeout(c);const s=t.get(c);t.delete(c),Logger.debug("LIFECYCLE",`Timeout cleared: ${c}${s?` (${s.delay}ms, ${Date.now()-s.createdAt}ms ago)`:""}`)}},requestAnimationFrame(c){const l=(window.requestAnimationFrame||function(d){return setTimeout(d,16)})(c);return i.add(l),Logger.debug("LIFECYCLE",`Animation frame requested: ${l}`),l},cancelAnimationFrame(c){c!=null&&((window.cancelAnimationFrame||clearTimeout)(c),i.delete(c),Logger.debug("LIFECYCLE",`Animation frame cancelled: ${c}`))},addEventListener(c,s,l,d){if(!c||!s||!l){Logger.warn("LIFECYCLE","addEventListener called with missing parameters",{target:c,type:s,handler:!!l});return}c.addEventListener(s,l,d),r.has(c)||r.set(c,new Set),r.get(c).add({type:s,handler:l,options:d});const f=c.id||c.className||c.tagName||"unknown";Logger.debug("LIFECYCLE",`Event listener added: ${s} on ${f}`)},removeEventListener(c,s,l,d){if(!c||!s||!l){Logger.warn("LIFECYCLE","removeEventListener called with missing parameters",{target:c,type:s,handler:!!l});return}c.removeEventListener(s,l,d);const f=r.get(c);if(f){for(const m of f)if(m.type===s&&m.handler===l&&JSON.stringify(m.options)===JSON.stringify(d)){f.delete(m);break}f.size===0&&r.delete(c)}const h=c.id||c.className||c.tagName||"unknown";Logger.debug("LIFECYCLE",`Event listener removed: ${s} on ${h}`)},setNamedInterval(c,s,l){const d=window.setInterval(s,l);return e.set(d,{name:c,delay:l,createdAt:Date.now()}),Logger.debug("LIFECYCLE",`Named interval created: ${c||d} (${l}ms)`),d},getStats(){const c=Array.from(e.entries()).map(([d,f])=>({id:d,name:f.name||`interval-${d}`,delay:f.delay,age:Date.now()-f.createdAt})),s=Array.from(t.entries()).map(([d,f])=>({id:d,name:f.name||`timeout-${d}`,delay:f.delay,age:Date.now()-f.createdAt})),l=Array.from(r.entries()).map(([d,f])=>({target:d.id||d.className||d.tagName||"unknown",eventTypes:Array.from(f).map(m=>m.type),count:f.size}));return{activeIntervals:e.size,activeTimeouts:t.size,activeAnimationFrames:i.size,activeEventListeners:r.size,details:{intervals:c,timeouts:s,animationFrames:Array.from(i),eventListeners:l}}},clearAll(){Logger.debug("LIFECYCLE","Clearing all lifecycle resources");const c=e.size,s=t.size,l=i.size,d=r.size;e.forEach((f,h)=>window.clearInterval(h)),e.clear(),t.forEach((f,h)=>window.clearTimeout(h)),t.clear(),i.forEach(f=>window.cancelAnimationFrame(f)),i.clear(),r.forEach((f,h)=>{f.forEach(({type:m,handler:M,options:I})=>{h.removeEventListener(m,M,I)})}),r.clear(),Logger.debug("LIFECYCLE",`Cleared ${c} intervals, ${s} timeouts, ${l} animation frames, ${d} event listeners`)}};window.LifecycleManager=o,window.addEventListener("beforeunload",()=>{Logger.info("LIFECYCLE","Page unloading, cleaning up resources");try{if(o.clearAll(),window.CacheIntervals&&typeof window.CacheIntervals.stop=="function"&&(Logger.info("LIFECYCLE","Stopping cache intervals"),window.CacheIntervals.stop()),window.SyncEngine&&typeof window.SyncEngine.stop=="function"&&(Logger.info("LIFECYCLE","Stopping sync engine"),window.SyncEngine.stop()),typeof window.cleanupPendingDeletions=="function"&&(Logger.info("LIFECYCLE","Cleaning up pending deletions"),window.cleanupPendingDeletions()),window.deletionTimeouts instanceof Map){Logger.info("LIFECYCLE","Cleaning up deletion timeouts");for(const c of window.deletionTimeouts.values())clearTimeout(c);window.deletionTimeouts.clear()}if(window.pendingDeletedIds instanceof Set&&(Logger.info("LIFECYCLE","Clearing pending deleted IDs"),window.pendingDeletedIds.clear()),typeof window.stopUptime=="function"&&(Logger.info("LIFECYCLE","Stopping uptime tracking"),window.stopUptime()),typeof window.stopHealthCheck=="function"&&(Logger.info("LIFECYCLE","Stopping health check"),window.stopHealthCheck()),window.optimisticShadowMappings&&window.optimisticShadowMappings.clear&&(Logger.info("LIFECYCLE","Clearing optimistic shadow mappings"),window.optimisticShadowMappings.clear()),window.CacheService&&typeof window.CacheService.clear=="function"&&(Logger.info("LIFECYCLE","Clearing CacheService"),window.CacheService.clear()),window.elementCache&&window.elementCache.clear&&(Logger.info("LIFECYCLE","Clearing element cache"),window.elementCache.clear()),window.autoRefreshInterval&&(Logger.info("LIFECYCLE","Clearing auto-refresh interval"),clearInterval(window.autoRefreshInterval),window.autoRefreshInterval=null),typeof window.cacheRefreshChannel<"u"&&window.cacheRefreshChannel){Logger.info("LIFECYCLE","Closing cache refresh BroadcastChannel");try{window.cacheRefreshChannel.close()}catch(c){Logger.warn("LIFECYCLE","Failed to close cache refresh BroadcastChannel:",c)}}if(typeof window.optimisticUpdateChannel<"u"&&window.optimisticUpdateChannel){Logger.info("LIFECYCLE","Closing optimistic update BroadcastChannel");try{window.optimisticUpdateChannel.close()}catch(c){Logger.warn("LIFECYCLE","Failed to close optimistic update BroadcastChannel:",c)}}Logger.info("LIFECYCLE","Cleanup completed successfully")}catch(c){Logger.error("LIFECYCLE","Error during cleanup:",c)}})})(),window.debounce=function(e,t=150,i={}){let r,o,c,s;const{leading:l=!1,trailing:d=!0}=i,f=()=>{r=void 0,d&&o&&(s=e.apply(c,o),o=c=void 0)};return Object.assign(function(...m){return o=m,c=this,r===void 0?(l&&(s=e.apply(c,o),o=c=void 0),r=window.setTimeout(f,t)):(window.clearTimeout(r),r=window.setTimeout(f,t)),s},{cancel(){r!==void 0&&window.clearTimeout(r),r=void 0,o=c=void 0},flush(){return r!==void 0&&(window.clearTimeout(r),f()),s}})},Logger.debug("LIFECYCLE","Lifecycle module loaded"),window.MappingsStore={items:new Map,metadata:{serverVersion:null,lastFullSync:null,lastIncrementalSync:null,isSyncing:!1,syncError:null},pending:new Map,indexes:{byMethod:new Map,byUrl:new Map,byPriority:new Map,byScenario:new Map},stats:{totalMappings:0,pendingOperations:0,lastSyncDuration:0},requests:new Map,getAllRequests(){return Array.from(this.requests.values())},setRequests(n){this.requests.clear(),Array.isArray(n)&&n.forEach(e=>{const t=e.id||e.uuid||e.request&&e.request.url||Date.now().toString();t&&this.requests.set(t,e)})},init(){Logger.info("STORE","Initializing MappingsStore"),this.clear(),Logger.info("STORE","MappingsStore initialized")},get(n){if(!n)return null;const e=this.pending.get(n);return e&&e.type!=="delete"?e.optimisticMapping:this.items.get(n)||null},getAll(){const n=[];return this.items.forEach((e,t)=>{const i=this.pending.get(t);i&&i.type==="delete"||(i&&i.type==="update"?n.push(i.optimisticMapping):n.push(e))}),this.pending.forEach((e,t)=>{e.type==="create"&&!this.items.has(t)&&n.push(e.optimisticMapping)}),n},setFromServer(n,e={}){Logger.info("STORE",`Setting ${n.length} mappings from server`),this.items.clear(),n.forEach(t=>{const i=t.id||t.uuid;i&&this.items.set(i,t)}),this.metadata.serverVersion=e.version||e.etag||null,this.metadata.lastFullSync=Date.now(),this.rebuildIndexes(),this._updateStats(),Logger.info("STORE",`Loaded ${this.items.size} mappings`)},applyChanges({added:n=[],updated:e=[],deleted:t=[]}){Logger.info("STORE",`Applying changes: +${n.length} ~${e.length} -${t.length}`);const i=[];return e.forEach(r=>{const o=r.id||r.uuid,c=this.pending.get(o);if(c&&c.type==="update"){i.push({id:o,type:"update",local:c.optimisticMapping,server:r,localTimestamp:c.timestamp});return}this.items.set(o,r),this._addToIndexes(o,r)}),t.forEach(r=>{this.pending.has(r)&&i.push({id:r,type:"delete",local:this.pending.get(r).optimisticMapping,server:null}),this.items.delete(r),this._removeFromIndexes(r)}),n.forEach(r=>{const o=r.id||r.uuid;this.items.set(o,r),this._addToIndexes(o,r)}),this.metadata.lastIncrementalSync=Date.now(),this._updateStats(),i},addPending(n){const{id:e,type:t,payload:i,optimisticMapping:r}=n;this.pending.set(e,{id:e,type:t,payload:i,optimisticMapping:r,timestamp:Date.now(),retries:0}),Logger.debug("STORE",`Added pending ${t}: ${e}`),this._updateStats()},confirmPending(n,e=null){const t=this.pending.get(n);if(t){if(Logger.info("STORE",`Confirmed pending ${t.type}: ${n}`),t.type==="create"&&e){const i=e.id||e.uuid;this.items.set(i,e),this._addToIndexes(i,e)}else t.type==="update"&&e?(this.items.set(n,e),this._addToIndexes(n,e)):t.type==="delete"&&(this.items.delete(n),this._removeFromIndexes(n));this.pending.delete(n),this._updateStats()}},rollbackPending(n,e=null){const t=this.pending.get(n);t&&(Logger.warn("STORE",`Rolling back pending ${t.type}: ${n}`),t.type==="create"?this.items.delete(n):t.type==="update"&&e?(this.items.set(n,e),this._addToIndexes(n,e)):t.type==="delete"&&e&&(this.items.set(n,e),this._addToIndexes(n,e)),this.pending.delete(n),this._updateStats())},rebuildIndexes(){Object.values(this.indexes).forEach(n=>n.clear()),this.items.forEach((n,e)=>{this._addToIndexes(e,n)}),Logger.debug("STORE",`Rebuilt indexes for ${this.items.size} mappings`)},filter({method:n,url:e,priority:t,scenario:i}){let r=new Set(this.items.keys());if(n){const o=this.indexes.byMethod.get(n.toUpperCase());if(o)r=this._intersect(r,o);else return[]}if(e){const o=this.indexes.byUrl.get(e);o?r=this._intersect(r,o):r=new Set([...r].filter(c=>{const s=this.items.get(c);return this._matchesUrl(s,e)}))}if(t!==void 0){const o=this.indexes.byPriority.get(t);if(o)r=this._intersect(r,o);else return[]}if(i){const o=this.indexes.byScenario.get(i);if(o)r=this._intersect(r,o);else return[]}return Array.from(r).map(o=>this.get(o)).filter(Boolean)},clear(){this.items.clear(),this.pending.clear(),Object.values(this.indexes).forEach(n=>n.clear()),this.metadata={serverVersion:null,lastFullSync:null,lastIncrementalSync:null,isSyncing:!1,syncError:null},this._updateStats(),Logger.info("STORE","Cleared all data")},_addToIndexes(n,e){const t=e.request?.method||"GET";this.indexes.byMethod.has(t)||this.indexes.byMethod.set(t,new Set),this.indexes.byMethod.get(t).add(n);const i=e.request?.urlPattern||e.request?.url||e.request?.urlPath;i&&(this.indexes.byUrl.has(i)||this.indexes.byUrl.set(i,new Set),this.indexes.byUrl.get(i).add(n));const r=e.priority||1;this.indexes.byPriority.has(r)||this.indexes.byPriority.set(r,new Set),this.indexes.byPriority.get(r).add(n),e.scenarioName&&(this.indexes.byScenario.has(e.scenarioName)||this.indexes.byScenario.set(e.scenarioName,new Set),this.indexes.byScenario.get(e.scenarioName).add(n))},_removeFromIndexes(n){Object.values(this.indexes).forEach(e=>{e.forEach((t,i)=>{t.delete(n),t.size===0&&e.delete(i)})})},_intersect(n,e){const t=new Set;return n.forEach(i=>{e.has(i)&&t.add(i)}),t},_matchesUrl(n,e){const t=n.request?.urlPattern||n.request?.url||n.request?.urlPath||"";if(t===e)return!0;try{return new RegExp(e).test(t)}catch{return t.includes(e)}},_updateStats(){this.stats.totalMappings=this.items.size,this.stats.pendingOperations=this.pending.size}},typeof window<"u"&&(window.MappingsStore.init(),Object.defineProperty(window,"originalMappings",{get:function(){return window.MappingsStore?window.MappingsStore.getAll():[]},configurable:!0,enumerable:!0}),Object.defineProperty(window,"allMappings",{get:function(){return window._filteredMappings?window._filteredMappings:window.MappingsStore?window.MappingsStore.getAll():[]},configurable:!0,enumerable:!0}),Object.defineProperty(window,"originalRequests",{get:function(){return window.MappingsStore?window.MappingsStore.getAllRequests():[]},set:function(n){window.MappingsStore&&typeof window.MappingsStore.setRequests=="function"&&window.MappingsStore.setRequests(n);try{delete window._filteredRequests}catch{}},configurable:!0,enumerable:!0}),Object.defineProperty(window,"allRequests",{get:function(){return window._filteredRequests?window._filteredRequests:window.MappingsStore?window.MappingsStore.getAllRequests():[]},set:function(n){window._filteredRequests=Array.isArray(n)?n:[]},configurable:!0,enumerable:!0})),window.SyncEngine={config:{incrementalInterval:3e4,fullSyncInterval:3e5,fullSyncTimeout:6e4,cacheRebuildInterval:6e4,cacheMaxAge:36e5,maxRetries:3,retryDelay:2e3},timers:{incremental:null,fullSync:null,cacheRebuild:null},isStarted:!1,lastCacheHash:null,isIncrementalSyncing:!1,isFullSyncing:!1,useServiceCache:!0,init(){Logger.info("SYNC","Initializing SyncEngine"),this.stop(),Logger.info("SYNC","SyncEngine initialized")},start(){if(this.isStarted){Logger.debug("SYNC","Sync timers already running, skipping start");return}Logger.info("SYNC","Starting sync timers"),this.isStarted=!0,this.timers.incremental=window.LifecycleManager.setInterval(()=>this.incrementalSync(),this.config.incrementalInterval),this.timers.fullSync=window.LifecycleManager.setInterval(()=>this.fullSync({background:!0}),this.config.fullSyncInterval),this.useServiceCache&&(this.timers.cacheRebuild=window.LifecycleManager.setInterval(()=>this.rebuildServiceCache(),this.config.cacheRebuildInterval)),Logger.info("SYNC","Sync timers started")},stop(){Logger.info("SYNC","Stopping sync timers"),Object.keys(this.timers).forEach(n=>{this.timers[n]&&(window.LifecycleManager.clearInterval(this.timers[n]),this.timers[n]=null)}),this.isStarted=!1},async coldStart(n={}){const e=n.useCache===!0;this.useServiceCache=e,Logger.info("SYNC",`Cold start - loading from ${e?"cache or server":"server only"}`),this._showLoadingState();try{if(e){const t=await this.loadFromServiceCache();t&&t.items&&t.items.length>0&&(Logger.info("SYNC",`Loaded ${t.items.length} mappings from cache`),window.MappingsStore.setFromServer(t.items,{version:t.version}),this._renderMappings("cache"),this._applyMappingFilters(),this._updateDataSourceIndicator("cache"),Logger.info("SYNC","Initial UI rendered from cache"))}Logger.info("SYNC","Starting background full sync for latest data"),await this.fullSync({background:!0})}catch(t){Logger.error("SYNC","Cold start failed:",t);try{await this.fullSync({background:!1})}catch(i){throw Logger.error("SYNC","Fallback full sync also failed:",i),i}}},async fullSync({background:n=!1}={}){if(this.isFullSyncing){Logger.debug("SYNC","Full sync already in progress, skipping overlapping run");return}if(window.MappingsStore.metadata.isSyncing||window.MappingsStore.metadata.isOptimisticUpdate){Logger.debug("SYNC","Already syncing or optimistic update in progress, skipping full sync");return}this.isFullSyncing=!0,Logger.info("SYNC",`Starting full sync (background: ${n})`),n&&this._showSyncIndicator(),window.MappingsStore.metadata.isSyncing=!0,window.MappingsStore.metadata.syncStartTime=Date.now();const e=Date.now();try{const t=await this._fetchWithTimeout(typeof window.fetchMappingsFromServer=="function"?window.fetchMappingsFromServer({force:!0}):fetch(`${window.wiremockBaseUrl}/mappings`).then(s=>s.json()),this.config.fullSyncTimeout),i=t.mappings||[],r=t.meta?.version||t.meta?.etag||null;Logger.info("SYNC",`Received ${i.length} mappings from server`);const o=i.filter(s=>(s.id||s.uuid)!=="00000000-0000-0000-0000-00000000cace"&&!this._isServiceCacheMapping(s));window.MappingsStore.setFromServer(o,{version:r}),this._renderMappings("direct",{skipSyncCheck:!0}),this._applyMappingFilters(),this._updateDataSourceIndicator("synced");const c=Date.now()-e;window.MappingsStore.stats.lastSyncDuration=c,Logger.info("SYNC",`Full sync completed in ${c}ms`)}catch(t){if(Logger.error("SYNC","Full sync failed:",t),window.MappingsStore.metadata.syncError=t.message,!n)throw t}finally{this.isFullSyncing=!1,window.MappingsStore.metadata.isSyncing=!1,window.MappingsStore.metadata.syncStartTime=null,this._hideSyncIndicator()}},async incrementalSync(){if(this.isIncrementalSyncing){Logger.debug("SYNC","Incremental sync already in progress, skipping overlapping run");return}this.isIncrementalSyncing=!0;try{if(window.MappingsStore.metadata.isSyncing||window.MappingsStore.metadata.isOptimisticUpdate){Logger.debug("SYNC","Already syncing or optimistic update in progress, skipping incremental sync");return}if(this.isFullSyncing){Logger.debug("SYNC","Full sync in progress, skipping incremental");return}if(!window.MappingsStore.metadata.lastFullSync){Logger.debug("SYNC","No full sync yet, skipping incremental");return}Logger.debug("SYNC","Starting lightweight incremental sync check");const n=Date.now()-(window.MappingsStore.metadata.lastFullSync||0),e=this.config.fullSyncInterval/2;n>e?Logger.debug("SYNC",`Data approaching staleness (${Math.round(n/1e3)}s since last sync), will refresh on next full sync`):Logger.debug("SYNC",`Data is fresh (${Math.round(n/1e3)}s since last sync), skipping server check`)}finally{this.isIncrementalSyncing=!1}},async loadFromServiceCache(){if(!this.useServiceCache)return null;try{Logger.debug("SYNC","Attempting to load from Service Cache");let n;try{n=await window.apiFetch("/mappings/00000000-0000-0000-0000-00000000cace")}catch(o){if(o.status===404)return Logger.debug("SYNC","Service Cache not found"),null;throw o}const e=n.response?.jsonBody||n,t=e.items||e.mappings;if(!t||!Array.isArray(t))return Logger.warn("SYNC","Invalid cache format"),null;const i={...e,items:t},r=Date.now()-(i.timestamp||0);return r>this.config.cacheMaxAge?(Logger.info("SYNC",`Cache is stale (${Math.round(r/1e3)}s old), skipping`),null):(Logger.info("SYNC",`Service Cache loaded (${i.items.length} items, ${Math.round(r/1e3)}s old)`),i)}catch(n){return Logger.warn("SYNC","Failed to load Service Cache:",n),null}},async rebuildServiceCache(){if(!this.useServiceCache)return;if(window.MappingsStore.pending.size>0||window.MappingsStore.metadata.isOptimisticUpdate){Logger.debug("SYNC","Skipping cache rebuild - pending operations or optimistic updates exist");return}const n=this._hashMappings(window.MappingsStore.items);if(n===this.lastCacheHash){Logger.debug("SYNC","Skipping cache rebuild - no changes");return}Logger.info("SYNC","Rebuilding Service Cache");try{const e={timestamp:Date.now(),version:window.MappingsStore.metadata.serverVersion,items:Array.from(window.MappingsStore.items.values()),count:window.MappingsStore.items.size},t={...e,items:e.items.map(r=>{if(!r||typeof r!="object")return r;const o={...r};return delete o._pending,delete o._operation,delete o._deleted,delete o.__optimisticTs,o.request&&(delete o.request._pending,delete o.request._operation,delete o.request._deleted),o.response&&(delete o.response._pending,delete o.response._operation,delete o.response._deleted),o})},i={id:"00000000-0000-0000-0000-00000000cace",priority:1e3,request:{method:"GET",url:"/__imock/cache/v2"},response:{status:200,jsonBody:t}};try{await window.apiFetch(`/mappings/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}catch(r){if(r.status===404)await window.apiFetch("/mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});else throw r}this.lastCacheHash=n,Logger.info("SYNC",`Service Cache saved (${e.count} mappings)`)}catch(e){Logger.warn("SYNC","Failed to rebuild Service Cache:",e)}},_emit(n,e={}){return window.AppEvents&&typeof window.AppEvents.emit=="function"?window.AppEvents.emit(n,e):!1},_showLoadingState(){this._emit("sync:loading",{})},_renderMappings(n,e={}){const t={source:n||"direct",skipSyncCheck:e.skipSyncCheck===!0,mappings:window.MappingsStore?.getAll?.()||[]};this._emit("sync:render-mappings",t)},_applyMappingFilters(){this._emit("sync:apply-mapping-filters",{})},_updateDataSourceIndicator(n){this._emit("sync:data-source",{source:n})},_notifyWarning(n,e={}){this._emit("sync:notify",{level:"warning",message:n,...e})},_detectChanges(n){const e=new Set(n.map(c=>c.id||c.uuid)),t=new Set(window.MappingsStore.items.keys()),i=[],r=[],o=[];return n.forEach(c=>{const s=c.id||c.uuid;if(!t.has(s))i.push(c);else{const l=window.MappingsStore.items.get(s);this._hasChanged(l,c)&&r.push(c)}}),t.forEach(c=>{e.has(c)||o.push(c)}),{added:i,updated:r,deleted:o,hasChanges:i.length>0||r.length>0||o.length>0}},_hasChanged(n,e){try{return JSON.stringify(n)!==JSON.stringify(e)}catch{return!0}},_handleConflicts(n){Logger.warn("SYNC",`Handling ${n.length} conflicts`),n.forEach(e=>{if(e.type==="delete"){Logger.warn("SYNC",`Conflict: mapping ${e.id} was deleted on server`);const t=e.local?.name||e.id;this._notifyWarning(`Mapping "${t}" was deleted by another user`,{type:"delete",mappingId:e.id,conflict:e}),window.MappingsStore.pending.delete(e.id)}else if(e.type==="update"){const t=this._getTimestamp(e.server),i=e.localTimestamp||Date.now();if(t>i){Logger.warn("SYNC",`Conflict: server version is newer for ${e.id}`);const r=e.server?.name||e.id;this._notifyWarning(`Your changes to "${r}" were overwritten by another user`,{type:"update",mappingId:e.id,conflict:e}),window.MappingsStore.rollbackPending(e.id,e.server)}else Logger.warn("SYNC",`Conflict: local version is newer for ${e.id}, keeping local`)}})},_getTimestamp(n){return n?.metadata?.edited||n?.metadata?.updated||n?.metadata?.created||0},_formatChangesSummary(n){const e=[];return n.added.length>0&&e.push(`+${n.added.length} added`),n.updated.length>0&&e.push(`~${n.updated.length} updated`),n.deleted.length>0&&e.push(`-${n.deleted.length} deleted`),e.join(", ")},_hashMappings(n){if(n.size===0)return"0:";const e=Array.from(n.keys());if(e.length>1e3){const t=e.slice(0,50).sort().join("|").substring(0,100),i=e.slice(-50).sort().join("|").substring(0,100),r=`${t}...${i}`;return`${n.size}:${this._simpleHash(r)}`}else{const t=e.sort().join(",");return`${n.size}:${t}`}},_simpleHash(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);e=(e<<5)-e+i,e|=0}return Math.abs(e).toString(36)},_isServiceCacheMapping(n){return(n.id||n.uuid)==="00000000-0000-0000-0000-00000000cace"||n.request?.url?.includes("/__imock/cache")},_fetchWithTimeout(n,e){return Promise.race([n,new Promise((t,i)=>setTimeout(()=>i(new Error("Request timeout")),e))])},_showSyncIndicator(){this._emit("sync:indicator",{active:!0})},_hideSyncIndicator(){this._emit("sync:indicator",{active:!1})}},typeof window<"u"&&window.SyncEngine.init(),(function(){if(window.__syncEngineUiBridgeReady)return;window.__syncEngineUiBridgeReady=!0;const e=(t,i)=>{!window.AppEvents||typeof window.AppEvents.on!="function"||window.AppEvents.on(t,i)};e("sync:loading",()=>{typeof window.showLoadingState=="function"&&window.showLoadingState()}),e("sync:render-mappings",t=>{if(typeof window.fetchAndRenderMappings!="function")return;const i=t?.detail||{},r=Array.isArray(i.mappings)?i.mappings:window.MappingsStore?.getAll?.()||[];window.fetchAndRenderMappings(r,{source:i.source||"direct",skipSyncCheck:i.skipSyncCheck===!0})}),e("sync:apply-mapping-filters",()=>{window.FilterManager&&typeof window.FilterManager.applyMappingFilters=="function"&&window.FilterManager.applyMappingFilters()}),e("sync:data-source",t=>{if(typeof window.updateDataSourceIndicator!="function")return;const i=t?.detail?.source;typeof i=="string"&&i.length>0&&window.updateDataSourceIndicator(i)}),e("sync:indicator",t=>{const i=document.getElementById("sync-indicator");if(!i)return;const r=t?.detail?.active===!0;i.classList.toggle("is-active",r)}),e("sync:notify",t=>{const i=t?.detail||{},r=i.level||"warning",o=i.message;!o||!window.NotificationManager||(typeof window.NotificationManager[r]=="function"?window.NotificationManager[r](o):typeof window.NotificationManager.warning=="function"&&window.NotificationManager.warning(o))}),e("wiremock:success",t=>{const i=t?.detail?.timestamp;if(typeof i=="number"&&(window.lastWiremockSuccess=i),window.Utils&&typeof window.Utils.safeCall=="function")window.Utils.safeCall(window.updateLastSuccessUI);else if(typeof window.updateLastSuccessUI=="function")try{window.updateLastSuccessUI()}catch{}})})();function normalizeScenarioNameValue(n){if(n==null)return{original:n,normalized:n,changed:!1,cleared:!1,hadWhitespace:!1};const e=typeof n=="string"?n:String(n),t=/\s/.test(e),i=e.trim().replace(/\s+/g,"_");return{original:e,normalized:i,changed:i!==e,cleared:!!e&&!i,hadWhitespace:t}}function normalizeScenarioNameField(n,{notify:e}={}){if(!n||typeof n!="object")return{changed:!1};if(!Object.prototype.hasOwnProperty.call(n,"scenarioName"))return{changed:!1};const i=(typeof window.Utils?.normalizeScenarioName=="function"?window.Utils.normalizeScenarioName:normalizeScenarioNameValue)(n.scenarioName);return!i?.changed||!i?.hadWhitespace?{changed:!1}:(i.cleared?(delete n.scenarioName,e?.("Scenario name contained only whitespace and was cleared")):(n.scenarioName=i.normalized,e?.(`Scenario name cannot contain spaces. Replaced with "${i.normalized}"`)),{changed:!0,original:i.original,normalized:i.normalized,cleared:i.cleared})}window.MappingsOperations={async create(n){const e={...n||{}};normalizeScenarioNameField(e,{notify:r=>window.NotificationManager?.warning?.(r)});const t=typeof crypto?.randomUUID=="function"?`temp-${crypto.randomUUID()}`:`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;Logger.info("OPS",`Creating mapping with temp ID: ${t}`);const i={...e,id:t,_pending:!0,_operation:"create"};try{window.MappingsStore.addPending({id:t,type:"create",payload:e,optimisticMapping:i}),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.info=="function"&&window.NotificationManager.info("Creating mapping...");const r=await this._sendCreateRequest(e),o=r.id||r.uuid;if(Logger.info("OPS",`Mapping created on server with ID: ${o}`),window.MappingsStore.confirmPending(t,r),this._refreshUI(),this._broadcastUpdate("created",r),window.NotificationManager&&typeof window.NotificationManager.success=="function"){const c=r.name||r.id.substring(0,8);window.NotificationManager.success(`Mapping "${c}" created successfully`)}return r}catch(r){throw Logger.error("OPS","Failed to create mapping:",r),window.MappingsStore.rollbackPending(t,null),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.error=="function"&&window.NotificationManager.error(`Failed to create mapping: ${r.message}`),r}},async update(n,e){Logger.info("OPS",`Updating mapping: ${n}`);const t=window.MappingsStore.get(n);if(!t)throw new Error(`Mapping ${n} not found`);if(window.MappingsStore.pending.has(n))throw Logger.warn("OPS",`Mapping ${n} already has pending operation`),new Error("Mapping has pending changes");const i={...e||{}},r={...t,...i,_pending:!0,_operation:"update",metadata:{...t.metadata,...i.metadata,edited:Date.now()}};normalizeScenarioNameField(r,{notify:o=>window.NotificationManager?.warning?.(o)});try{window.MappingsStore.addPending({id:n,type:"update",payload:i,optimisticMapping:r,original:t}),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.info=="function"&&window.NotificationManager.info("Saving changes...");const o=await this._sendUpdateRequest(n,r);if(Logger.info("OPS",`Mapping updated on server: ${n}`),window.MappingsStore.confirmPending(n,o),this._refreshUI(),this._broadcastUpdate("updated",o),window.NotificationManager&&typeof window.NotificationManager.success=="function"){const c=o.name||n.substring(0,8);window.NotificationManager.success(`Mapping "${c}" updated successfully`)}return o}catch(o){throw Logger.error("OPS","Failed to update mapping:",o),window.MappingsStore.rollbackPending(n,t),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.error=="function"&&window.NotificationManager.error(`Failed to update mapping: ${o.message}`),o}},async delete(n){Logger.info("OPS",`Deleting mapping: ${n}`);const e=window.MappingsStore.get(n);if(!e){Logger.warn("OPS",`Mapping ${n} not found, skipping delete`);return}const t={...e,_deleted:!0,_pending:!0,_operation:"delete"};try{if(window.MappingsStore.addPending({id:n,type:"delete",payload:null,optimisticMapping:t,original:e}),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.info=="function"){const i=e.name||n.substring(0,8);window.NotificationManager.info(`Deleting "${i}"...`)}if(await this._sendDeleteRequest(n),Logger.info("OPS",`Mapping deleted on server: ${n}`),window.MappingsStore.confirmPending(n,null),this._refreshUI(),this._broadcastUpdate("deleted",e),window.NotificationManager&&typeof window.NotificationManager.success=="function"){const i=e.name||n.substring(0,8);window.NotificationManager.success(`Mapping "${i}" deleted successfully`)}}catch(i){throw Logger.error("OPS","Failed to delete mapping:",i),window.MappingsStore.rollbackPending(n,e),this._refreshUI(),window.NotificationManager&&typeof window.NotificationManager.error=="function"&&window.NotificationManager.error(`Failed to delete mapping: ${i.message}`),i}},async batchDelete(n){Logger.info("OPS",`Batch deleting ${n.length} mappings`);const e={success:[],failed:[]};for(const t of n)try{await this.delete(t),e.success.push(t)}catch(i){Logger.error("OPS",`Failed to delete ${t}:`,i),e.failed.push({id:t,error:i.message})}return Logger.info("OPS",`Batch delete complete: ${e.success.length} succeeded, ${e.failed.length} failed`),window.NotificationManager&&(e.failed.length===0?window.NotificationManager.success(`Deleted ${e.success.length} mappings`):window.NotificationManager.warning(`Deleted ${e.success.length} mappings, ${e.failed.length} failed`)),e},async _sendCreateRequest(n){const e=this._cleanMappingData(n);return await window.apiFetch("/mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})},async _sendUpdateRequest(n,e){const t=this._cleanMappingData(e);return await window.apiFetch(`/mappings/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})||t},async _sendDeleteRequest(n){await window.apiFetch(`/mappings/${n}`,{method:"DELETE"})},_cleanMappingData(n){const e={...n};return delete e._pending,delete e._operation,delete e._deleted,e},_refreshUI(){if(!window.MappingsStore){Logger.warn("OPS","MappingsStore not available for UI refresh");return}if(typeof window.refreshMappingTabSnapshot=="function"&&window.refreshMappingTabSnapshot(),window.FilterManager&&typeof window.FilterManager.applyMappingFilters=="function")window.FilterManager.applyMappingFilters(),typeof window.FilterManager.flushMappingFilters=="function"&&window.FilterManager.flushMappingFilters();else{Logger.warn("OPS","FilterManager not available, rendering without filters");const n=window.MappingsStore.getAll();typeof window.fetchAndRenderMappings=="function"&&window.fetchAndRenderMappings(n,{source:"optimistic"})}},_broadcastUpdate(n,e){if(typeof BroadcastChannel<"u")try{new BroadcastChannel("imock-optimistic-updates").postMessage({type:"mapping-"+n,operation:n,mapping:e,source:"mappings-operations",timestamp:Date.now()}),Logger.debug("OPS",`Broadcasted ${n} update:`,e.id)}catch(t){Logger.warn("OPS","Failed to broadcast update:",t)}try{const t="imock-optimistic-update",i={type:"mapping-"+n,operation:n,mapping:e,source:"mappings-operations",timestamp:Date.now()};localStorage.setItem(t,JSON.stringify(i)),setTimeout(()=>{try{localStorage.removeItem(t)}catch{}},1e3)}catch(t){Logger.warn("OPS","Failed to update localStorage:",t)}}};const UIComponents={createCard:(n,e,t=[])=>{const{id:i,method:r,url:o,status:c,name:s,time:l,extras:d={},expanded:f=!1}=e,h={editMapping:"edit-external",openEditModal:"edit-mapping",deleteMapping:"delete-mapping",duplicateMapping:"duplicate-mapping",viewRequestDetails:"view-request"};return`
            <div class="${n}-card${f?" is-expanded":""}" data-id="${Utils.escapeHtml(i)}">
                <div class="${n}-header" data-action="toggle-details">
                    <div class="${n}-info">
                        <div class="${n}-top-line">
                            <span class="method-badge ${r.toLowerCase()}">
                                <span class="collapse-arrow" id="arrow-${Utils.escapeHtml(i)}">${f?"\u25BC":"\u25B6"}</span> ${r}
                            </span>
                            ${s?`<span class="${n}-name">${Utils.escapeHtml(s)}</span>`:""}
                            ${l?`<span class="${n}-time">${l}</span>`:""}
                        </div>
                        <div class="${n}-url-line">
                            <span class="status-badge ${Utils.getStatusClass(c)}">${c}</span>
                            <span class="${n}-url">${Utils.escapeHtml(o)}</span>
                            ${d.badges||""}
                        </div>
                    </div>
                    <div class="${n}-actions">
                        ${t.map(m=>{const M=h[m.handler]||m.handler;return`
                            <button class="btn btn-sm btn-${m.class}"
                                    data-action="${M}"
                                    data-${n}-id="${Utils.escapeHtml(i)}"
                                    title="${Utils.escapeHtml(m.title)}">
                                ${m.icon?Icons.render(m.icon,{className:"action-icon"}):""}
                                <span class="sr-only">${Utils.escapeHtml(m.title)}</span>
                            </button>
                        `}).join("")}
                    </div>
                </div>
                <div class="${n}-preview" id="preview-${Utils.escapeHtml(i)}" style="display: ${f?"block":"none"};">
                    ${d.preview||""}
                </div>
            </div>`},getCardElement(n,e){const t=document.querySelectorAll(`.${n}-card`),i=String(e??"");for(const r of t)if((r.dataset?.id||"")===i)return r;return null},setCardState(n,e,t,i=!0){const r=this.getCardElement(n,e);r&&r.classList.toggle(t,!!i)},clearCardState(n,e){document.querySelectorAll(`.${n}-card.${e}`).forEach(t=>{t.classList.remove(e)})},createPreviewSection:(n,e)=>`
        <div class="preview-section">
            <h4>${n}</h4>
            ${Object.entries(e).map(([t,i])=>{if(!i)return"";if(typeof i=="object")if(JSON.stringify(i).length>500){const o=Utils.formatJson(i,"Invalid JSON",200),c=`full-${Math.random().toString(36).substr(2,9)}`;return`<div class="preview-value">
                            <strong>${t}:</strong>
                            <pre>${o}</pre>
                            <button class="btn btn-secondary btn-small" data-action="show-full-content" data-target-id="${c}" data-json="${Utils.escapeHtml(JSON.stringify(i))}" style="margin-top: 0.5rem; font-size: 0.8rem;">
                                Show Full Content
                            </button>
                            <div id="${c}" style="display: none;"></div>
                        </div>`}else return`<div class="preview-value"><strong>${t}:</strong><pre>${Utils.formatJson(i)}</pre></div>`;else if(typeof i=="string"){const r=i.trim();if(r.startsWith("{")&&r.endsWith("}"))try{const s=JSON.parse(r);if(JSON.stringify(s).length>500){const d=Utils.formatJson(s,"Invalid JSON",200),f=`full-${Math.random().toString(36).substr(2,9)}`;return`<div class="preview-value">
                                    <strong>${t}:</strong>
                                    <pre>${d}</pre>
                                    <button class="btn btn-secondary btn-small" data-action="show-full-content" data-target-id="${f}" data-json="${Utils.escapeHtml(JSON.stringify(s))}" style="margin-top: 0.5rem; font-size: 0.8rem;">
                                        Show Full Content
                                    </button>
                                    <div id="${f}" style="display: none;"></div>
                                </div>`}return`<div class="preview-value"><strong>${t}:</strong><pre>${Utils.formatJson(s)}</pre></div>`}catch{}const o=Utils.escapeHtml(i),c=o.includes(`
`)?`<pre>${o}</pre>`:o;return`<div class="preview-value"><strong>${t}:</strong> ${c}</div>`}else{const r=Utils.escapeHtml(String(i));return`<div class="preview-value"><strong>${t}:</strong> ${r}</div>`}}).join("")}
        </div>`,toggleDetails:(n,e)=>{const t=String(n??""),i=document.getElementById(`preview-${n}`),r=document.getElementById(`arrow-${n}`),o=i?i.style.display==="none":!1;if(i&&(i.style.display=o?"block":"none"),r&&(r.textContent=o?"\u25BC":"\u25B6"),e==="mapping"){const c=i?i.closest(`.${e}-card`):null;c&&c.classList.toggle("is-expanded",o),window.mappingPreviewState instanceof Set&&(o?window.mappingPreviewState.add(t):window.mappingPreviewState.delete(t))}UIComponents.setCardState(e,n,"is-expanded",o)},toggleFullContent:n=>{const e=document.getElementById(n),t=e.previousElementSibling;if(e.style.display==="none")try{const i=t.getAttribute("data-json"),r=JSON.parse(i);e.innerHTML=`<pre style="max-height: 300px; overflow-y: auto; background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-sm); margin-top: 0.5rem;">${Utils.escapeHtml(JSON.stringify(r,null,2))}</pre>`,e.style.display="block",t.textContent="Hide Full Content"}catch(i){e.innerHTML=`<div class="preview-value warning">Error parsing JSON: ${Utils.escapeHtml(i.message)}</div>`,e.style.display="block",t.textContent="Hide"}else e.style.display="none",t.textContent="Show Full Content"}};window.toggleFullContent=UIComponents.toggleFullContent,window.toggleDetails=UIComponents.toggleDetails,window.renderMappingCard=function(n){if(!n||!n.id)return Logger.warn("CACHE","Invalid mapping data:",n),"";const e=[{class:"secondary",handler:"duplicateMapping",title:"Duplicate",icon:"clipboard"},{class:"secondary",handler:"editMapping",title:"Edit in Editor",icon:"open-external"},{class:"primary",handler:"openEditModal",title:"Edit",icon:"pencil"},{class:"danger",handler:"deleteMapping",title:"Delete",icon:"trash"}],t=String(n.id||n.uuid||""),i=window.mappingPreviewState instanceof Set&&window.mappingPreviewState.has(t),r={id:n.id,method:n.request?.method||"GET",url:n.request?.urlPath||n.request?.urlPathPattern||n.request?.urlPattern||n.request?.url||"N/A",status:n.response?.status||200,name:n.name||n.metadata?.name||`Mapping ${n.id.substring(0,8)}`,expanded:i,extras:{preview:i?UIComponents.createPreviewSection(`${Icons.render("request-in",{className:"icon-inline"})} Request`,{Method:n.request?.method||"GET",URL:n.request?.url||n.request?.urlPattern||n.request?.urlPath||n.request?.urlPathPattern,Headers:n.request?.headers,Body:n.request?.bodyPatterns||n.request?.body,"Query Parameters":n.request?.queryParameters})+UIComponents.createPreviewSection(`${Icons.render("response-out",{className:"icon-inline"})} Response`,{Status:n.response?.status,Headers:n.response?.headers,Body:n.response?.jsonBody||n.response?.body,Delay:n.response?.fixedDelayMilliseconds?`${n.response.fixedDelayMilliseconds}ms`:null})+UIComponents.createPreviewSection(`${Icons.render("info",{className:"icon-inline"})} Overview`,{ID:n.id||n.uuid,Name:n.name||n.metadata?.name,Priority:n.priority,Persistent:n.persistent,Scenario:n.scenarioName,"Required State":n.requiredScenarioState,"New State":n.newScenarioState,Created:window.showMetaTimestamps!==!1&&n.metadata?.created?new Date(n.metadata.created).toLocaleString():null,Edited:window.showMetaTimestamps!==!1&&n.metadata?.edited?new Date(n.metadata.edited).toLocaleString():null,Source:n.metadata?.source?`Edited from ${n.metadata.source}`:null}):"",badges:[n.id||n.uuid?`<span class="badge badge-secondary" title="Mapping ID">${Utils.escapeHtml((n.id||n.uuid).length>12?(n.id||n.uuid).slice(0,8)+"\u2026"+(n.id||n.uuid).slice(-4):n.id||n.uuid)}</span>`:"",typeof n.priority=="number"?`<span class="badge badge-secondary" title="Priority">P${n.priority}</span>`:"",n.scenarioName?`<span class="badge badge-secondary" title="Scenario">${Utils.escapeHtml(n.scenarioName)}</span>`:"",window.showMetaTimestamps!==!1&&n.metadata?.created?`<span class="badge badge-secondary" title="Created">C: ${new Date(n.metadata.created).toLocaleString()}</span>`:"",window.showMetaTimestamps!==!1&&n.metadata?.edited?`<span class="badge badge-secondary" title="Edited">E: ${new Date(n.metadata.edited).toLocaleString()}</span>`:"",n.metadata?.source?`<span class="badge badge-info" title="Last edited from">${n.metadata.source.toUpperCase()}</span>`:""].filter(Boolean).join(" ")}};return UIComponents.createCard("mapping",r,e)},window.toggleMappingDetails=n=>UIComponents.toggleDetails(n,"mapping"),window.toggleRequestDetails=n=>UIComponents.toggleDetails(n,"request"),window.UIComponents=UIComponents;function isOptimisticShadowMap(n){return n&&typeof n=="object"&&typeof n.forEach=="function"&&typeof n.size=="number"&&Object.prototype.toString.call(n)==="[object Map]"}window.mappingPreviewState instanceof Set||(window.mappingPreviewState=new Set),window.mappingPreviewToastState instanceof Map||(window.mappingPreviewToastState=new Map),isOptimisticShadowMap(window.optimisticShadowMappings)||(window.optimisticShadowMappings=new Map);function getOptimisticShadowTtl(){const n=Number(window.DEFAULT_SETTINGS?.optimisticCacheAgeLimit);return Number.isFinite(n)&&n>0?Math.max(n,45e3):6e4}function cloneMappingForOptimisticShadow(n){if(!n||typeof n!="object")return null;try{return typeof structuredClone=="function"?structuredClone(n):JSON.parse(JSON.stringify(n))}catch{return{...n}}}function rememberOptimisticShadowMapping(n,e){if(isOptimisticShadowMap(window.optimisticShadowMappings)||(window.optimisticShadowMappings=new Map),!n||typeof n!="object")return;const t=n.id||n.uuid;if(!t)return;const i=typeof e=="string"?e.toLowerCase():"update";if(i==="delete"){window.optimisticShadowMappings.delete(String(t));return}const r=cloneMappingForOptimisticShadow(n);r&&(typeof r.__optimisticTs!="number"&&Object.defineProperty(r,"__optimisticTs",{value:Date.now(),writable:!1,enumerable:!1,configurable:!0}),window.optimisticShadowMappings.set(String(t),{ts:Date.now(),op:i==="create"?"create":"update",mapping:r}))}function getOptimisticShadowTimestamp(n){if(!n||typeof n!="object")return Number.NaN;const e=n.metadata||{},t=[e.edited,e.updated,e.updatedAt,e.created,e.timestamp];for(const i of t){if(!i)continue;if(i instanceof Date){const c=i.getTime();if(Number.isFinite(c))return c}const r=Date.parse(i);if(Number.isFinite(r))return r;const o=Number(i);if(Number.isFinite(o))return o}return typeof n.__optimisticTs=="number"?n.__optimisticTs:Number.NaN}function applyOptimisticShadowMappings(n){if(!Array.isArray(n)||!isOptimisticShadowMap(window.optimisticShadowMappings)||window.optimisticShadowMappings.size===0)return n;const e=Date.now(),t=getOptimisticShadowTtl(),i=[...n];for(const[r,o]of Array.from(window.optimisticShadowMappings.entries())){const c=String(r||"");if(!o||typeof o!="object"){window.optimisticShadowMappings.delete(c);continue}if(o.mapping==null){const l=i.findIndex(d=>String(d?.id||d?.uuid||"")===c);l!==-1&&i.splice(l,1),window.optimisticShadowMappings.delete(c);continue}if(!Number.isFinite(o.ts)||e-o.ts>t){window.optimisticShadowMappings.delete(c);continue}const s=i.findIndex(l=>String(l?.id||l?.uuid||"")===c);if(s!==-1){let l=!1,d=!0;if(typeof window.getMappingRenderSignature=="function")try{const f=window.getMappingRenderSignature(i[s]),h=window.getMappingRenderSignature(o.mapping);if(f===h){window.optimisticShadowMappings.delete(c);continue}}catch{}if((o.op||"update")==="create")d=!1;else{const f=getOptimisticShadowTimestamp(i[s]),h=getOptimisticShadowTimestamp(o.mapping);Number.isFinite(h)&&(!Number.isFinite(f)||h>f)?l=!0:d=!1}l?(o.ts=e,i[s]=o.mapping):d?o.ts=e:window.optimisticShadowMappings.delete(c)}else i.unshift(o.mapping),Number.isFinite(o.ts)||(o.ts=e)}return i}function pruneOptimisticShadowMappings(n){if(!isOptimisticShadowMap(window.optimisticShadowMappings)||window.optimisticShadowMappings.size===0||!Array.isArray(n)||n.length===0)return;const e=new Map;n.forEach(t=>{if(t&&typeof t=="object"){const i=String(t.id||t.uuid||"");i&&e.set(i,t)}});for(const[t,i]of Array.from(window.optimisticShadowMappings.entries())){if(!e.has(t))continue;if(!i||typeof i!="object"){window.optimisticShadowMappings.delete(t);continue}if((i.op||"update")==="create")continue;if(!i.mapping||typeof i.mapping!="object"){window.optimisticShadowMappings.delete(t);continue}const r=e.get(t);if(!r){window.optimisticShadowMappings.delete(t);continue}try{if(typeof window.getMappingRenderSignature=="function"&&i.mapping){const s=window.getMappingRenderSignature(r),l=window.getMappingRenderSignature(i.mapping);if(s===l){window.optimisticShadowMappings.delete(t);continue}}}catch{}const o=getOptimisticShadowTimestamp(r),c=getOptimisticShadowTimestamp(i.mapping);Number.isFinite(o)&&(!Number.isFinite(c)||o>=c)&&window.optimisticShadowMappings.delete(t)}}window.fetchAndRenderMappings=async(n=null,e={})=>{const t=document.getElementById(SELECTORS.LISTS.MAPPINGS),i=document.getElementById(SELECTORS.EMPTY.MAPPINGS),r=document.getElementById(SELECTORS.LOADING.MAPPINGS);if(!t||!i||!r)return Logger.error("UI","Required DOM elements not found for mappings rendering"),!1;const o=e?.skipSyncCheck===!0;if(!o&&window.MappingsStore?.metadata?.isRendering)return window.MappingsStore.metadata.pendingRenderRequest={mappingsToRender:Array.isArray(n)?[...n]:null,options:{...e||{},skipSyncCheck:!0,_queuedRender:!0}},Logger.debug("UI","Render in progress, queued next render to avoid lost updates"),!0;if(!o&&window.MappingsStore?.metadata?.isSyncing)return Logger.debug("UI","Sync in progress, skipping render to avoid race condition"),!0;window.MappingsStore?.metadata&&(window.MappingsStore.metadata.isRendering=!0);let c=null;try{if(n===null){r.classList.remove("hidden"),t.style.display="none",i.classList.add("hidden"),i.setAttribute("aria-hidden","true");let m,M="direct";if(e&&e.useCache){const y=await loadImockCacheBestOf3();if(y&&y.data&&Array.isArray(y.data.mappings)){Logger.cache("Cache hit - using cached data for quick start"),M="cache";const C=typeof y.data.timestamp=="number"?y.data.timestamp:(y.data.mappings||[]).reduce((B,X)=>{const H=X?.metadata?.imock?.timestamp;return typeof H=="number"&&H>B?H:B},0);Date.now()-C>3e4&&(async()=>{try{const B=typeof window<"u"&&typeof window.optimisticUpdateDelayMs=="number"?window.optimisticUpdateDelayMs:500;await new Promise(H=>setTimeout(H,B));const X=await fetchMappingsFromServer({force:!0});if(X&&X.mappings){const H=X.mappings.filter(U=>!isImockCacheMapping(U)),le=(y.data.mappings||[]).filter(U=>!isImockCacheMapping(U));if(le.length!==H.length){if(window.MappingsStore&&window.MappingsStore.setFromServer(H),refreshMappingTabSnapshot(),syncCacheWithMappings(H),rebuildMappingIndex(H),typeof NotificationManager<"u"){const U=H.length-le.length;U>0?NotificationManager.info(`${U} new mapping${U===1?"":"s"} from server`,3e3):U<0&&NotificationManager.info(`${Math.abs(U)} mapping${Math.abs(U)===1?"":"s"} removed on server`,3e3),Logger.cache("Cache updated with server data:",{cachedCount:le.length,serverCount:H.length})}}else Logger.debug("CACHE","No changes detected, skipping cache update")}}catch(B){Logger.warn("CACHE","Background cache validation failed:",B)}})(),m=y.data}else{Logger.cache("Cache miss - loading from server"),typeof NotificationManager<"u"&&NotificationManager.info("Loading mappings from server...",2e3),m=await fetchMappingsFromServer({force:!0}),M="direct";try{Logger.cache("Async regenerate after cache miss"),regenerateImockCache()}catch{}}}else m=await fetchMappingsFromServer({force:!0}),M="direct";if(m&&m.__source){M=m.__source,M==="demo"&&markDemoModeActive("mappings-fallback");try{delete m.__source}catch{}}let I=m.mappings||[];const T=window.MappingsStore?.pending?Array.from(window.MappingsStore.pending.values()):[];T.length>0&&(Logger.debug("OPTIMISTIC","Applying optimistic updates to incoming data:",T.length,"updates"),I=I.map(y=>{const C=y.id||y.uuid,A=window.MappingsStore?.pending?window.MappingsStore.pending.get(C):null;return A?A.type==="delete"?(Logger.debug("OPTIMISTIC","Removing deleted mapping from results:",y.id),null):(Logger.debug("OPTIMISTIC","Using optimistic version for:",y.id),A.optimisticMapping):y}).filter(y=>y!==null),T.forEach(y=>{y.type!=="delete"&&!I.some(C=>(C.id||C.uuid)===y.id)&&(Logger.debug("OPTIMISTIC","Adding new optimistic mapping:",y.id),I.unshift(y.optimisticMapping))})),I=applyOptimisticShadowMappings(I);try{if(window.pendingDeletedIds&&window.pendingDeletedIds.size>0){const y=I.length;I=I.filter(C=>!window.pendingDeletedIds.has(C.id||C.uuid)),y!==I.length&&Logger.cache("filtered pending-deleted from render:",y-I.length)}}catch{}const g=Array.isArray(I)?I.filter(y=>!isImockCacheMapping(y)):[];window.MappingsStore&&window.MappingsStore.setFromServer(g),refreshMappingTabSnapshot(),syncCacheWithMappings(g),rebuildMappingIndex(g),pruneOptimisticShadowMappings(g),c=M}else{const m=typeof e?.source=="string"?e.source:null,M=Array.isArray(n)?[...n]:[];window.MappingsStore&&window.MappingsStore.setFromServer(M),refreshMappingTabSnapshot(),rebuildMappingIndex(M),pruneOptimisticShadowMappings(M),c=m,c==="demo"&&markDemoModeActive("manual-mappings")}r.classList.add("hidden");const s=document.getElementById(SELECTORS.MAPPING_FILTERS.QUERY)?.value?.trim()||"";let l=window.MappingsStore?window.MappingsStore.getAll():Array.isArray(n)?n:[];if(s&&window.QueryParser&&typeof window.QueryParser.filterMappingsByQuery=="function"&&(Logger.debug("UI","Applying filters before render:",s),l=window.QueryParser.filterMappingsByQuery(l,s)),window._filteredMappings=l,l.length===0)return i.classList.remove("hidden"),i.setAttribute("aria-hidden","false"),t.style.display="none",updateMappingsCounter(),c&&updateDataSourceIndicator(c),!0;i.classList.add("hidden"),i.setAttribute("aria-hidden","true"),t.style.display="block",window.invalidateElementCache(SELECTORS.LISTS.MAPPINGS);const d=l,f=typeof window.sortMappingsForDisplay=="function"?window.sortMappingsForDisplay(d):[...d],h=c||"previous";Logger.info("UI",`Mappings render from: ${h} \u2014 ${f.length} items`);try{if(t.style.willChange="contents",window.PaginationManager&&Logger.debug("UI",`Rendering page ${window.PaginationManager.currentPage}/${window.PaginationManager.totalPages}`),typeof window.renderMappingsCollection=="function")window.renderMappingsCollection(t,f,{preSorted:!0,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});else if(window.PaginationManager){window.PaginationManager.updateState(f.length);const M=window.PaginationManager.getCurrentPageItems(f);renderList(t,M,{renderItem:window.renderMappingMarkup,getKey:window.getMappingRenderKey,getSignature:window.getMappingRenderSignature,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});const I=document.getElementById("mappings-pagination");I&&(I.innerHTML=window.PaginationManager.renderControls())}else renderList(t,f,{renderItem:window.renderMappingMarkup,getKey:window.getMappingRenderKey,getSignature:window.getMappingRenderSignature,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});const m=()=>{updateMappingsCounter(),c&&updateDataSourceIndicator(c),t.style.willChange="auto";try{document.getElementById(SELECTORS.MAPPING_FILTERS.QUERY)?.value?.trim()&&typeof window.updateActiveFiltersDisplay=="function"&&window.updateActiveFiltersDisplay()}catch{}};typeof requestAnimationFrame=="function"?requestAnimationFrame(m):m()}catch(m){if(Logger.error("UI","DOM batch update failed:",m),typeof window.renderMappingsCollection=="function")window.renderMappingsCollection(t,f,{preSorted:!0,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});else if(window.PaginationManager){window.PaginationManager.updateState(f.length);const M=window.PaginationManager.getCurrentPageItems(f);renderList(t,M,{renderItem:window.renderMappingMarkup,getKey:window.getMappingRenderKey,getSignature:window.getMappingRenderSignature,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});const I=document.getElementById("mappings-pagination");I&&(I.innerHTML=window.PaginationManager.renderControls())}else renderList(t,f,{renderItem:window.renderMappingMarkup,getKey:window.getMappingRenderKey,getSignature:window.getMappingRenderSignature,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});updateMappingsCounter(),c&&updateDataSourceIndicator(c)}return!0}catch(s){Logger.error("UI","Error in fetchAndRenderMappings:",s);let l="Failed to load mappings";return s.status===401||s.message&&s.message.includes("401")?l="Authorization error: Please check your credentials":s.status===403||s.message&&s.message.includes("403")?l="Access forbidden: Check your permissions":s.status===404||s.message&&s.message.includes("404")?l="Server endpoint not found":s.message&&s.message.includes("timeout")?l="Request timeout: Server not responding":s.message&&(l=`Failed to load mappings: ${s.message}`),NotificationManager.error(l),r.classList.add("hidden"),i.classList.remove("hidden"),t.style.display="none",!1}finally{if(window.MappingsStore?.metadata){window.MappingsStore.metadata.isRendering=!1;const s=window.MappingsStore.metadata.pendingRenderRequest;if(s&&!e?._queuedRender){window.MappingsStore.metadata.pendingRenderRequest=null;const l=()=>{window.fetchAndRenderMappings(s.mappingsToRender,s.options)};typeof requestAnimationFrame=="function"?requestAnimationFrame(l):setTimeout(l,0)}else window.MappingsStore.metadata.pendingFilterRender&&(window.MappingsStore.metadata.pendingFilterRender=!1,window.FilterManager&&typeof window.FilterManager.applyMappingFilters=="function"&&window.FilterManager.applyMappingFilters())}}},window.refreshMappingsFromCache=async(n="cache")=>{try{if(!window.MappingsStore)return Logger.warn("CACHE","MappingsStore not available"),!1;const t=window.MappingsStore.getAll().filter(r=>!isImockCacheMapping(r));window.MappingsStore.setFromServer(t),typeof refreshMappingTabSnapshot=="function"&&refreshMappingTabSnapshot(),typeof rebuildMappingIndex=="function"&&rebuildMappingIndex(t),typeof pruneOptimisticShadowMappings=="function"&&pruneOptimisticShadowMappings(t),typeof updateDataSourceIndicator=="function"&&updateDataSourceIndicator(n||"cache");const i=window.MappingsStore?window.MappingsStore.getAll():[];return await fetchAndRenderMappings(i,{source:n||"cache"})}catch(e){return Logger.warn("CACHE","refreshMappingsFromCache failed:",e),!1}},window.initMappingPagination=function(){if(!window.PaginationManager){Logger.warn("UI","PaginationManager not available");return}window.PaginationManager.init("#mappings-pagination",20),window.PaginationManager.attachListeners(n=>{Logger.debug("UI",`Page changed to: ${n}`);const e=document.getElementById(SELECTORS.LISTS.MAPPINGS),t=window.MappingsStore?window.MappingsStore.getAll():[];if(!e||!Array.isArray(t)){Logger.warn("UI","Cannot render page: container or data not available");return}const i=typeof window.sortMappingsForDisplay=="function"?window.sortMappingsForDisplay(t):[...t],r=window.PaginationManager.getCurrentPageItems(i);window.invalidateElementCache(SELECTORS.LISTS.MAPPINGS),renderList(e,r,{renderItem:window.renderMappingMarkup,getKey:window.getMappingRenderKey,getSignature:window.getMappingRenderSignature,onItemChanged:handleMappingItemChanged,onItemRemoved:handleMappingItemRemoved});const o=document.getElementById("mappings-pagination");o&&(o.innerHTML=window.PaginationManager.renderControls());const c=document.getElementById("mappings-page");c&&c.scrollIntoView({behavior:"smooth",block:"start"})}),Logger.info("UI","Mapping pagination initialized")},window.getMappingById=async n=>{try{if(!n)throw new Error("Mapping ID is required");Logger.debug("CACHE",`Fetching mapping with ID: ${n}`),Logger.debug("CACHE","Current wiremockBaseUrl:",window.wiremockBaseUrl);const e=window.MappingsStore?window.MappingsStore.getAll():[];Logger.debug("CACHE","MappingsStore available:",!!window.MappingsStore),Logger.debug("CACHE","Cache size:",e?.length||0);let t=window.MappingsStore?window.MappingsStore.get(n):null;if(t||(t=e.find(o=>o.id===n||o.uuid===n)||null),t)return Logger.cache(`Found mapping in cache: ${n}`,t),t;Logger.cache("Mapping not found in cache, will fetch from API"),Logger.api(`Making API call to: /mappings/${n}`);const i=await apiFetch(`/mappings/${n}`);Logger.api("Raw API response:",i);const r=i&&typeof i=="object"&&i.mapping?i.mapping:i;if(Logger.debug("CACHE","Processed mapping:",r),!r||typeof r!="object")throw Logger.error("CACHE",`API returned invalid data for mapping ${n}`),new Error(`Mapping with ID ${n} not found or invalid response`);return Logger.info("CACHE",`Successfully fetched mapping: ${n}`,r),addMappingToIndex(r),r}catch(e){throw Logger.error("CACHE",`Error fetching mapping ${n}:`,e),Logger.error("CACHE","Error details:",{message:e.message,status:e.status,statusText:e.statusText,url:`${window.wiremockBaseUrl}/mappings/${n}`}),e}},window.duplicateMapping=async n=>{const e=(n??"").toString().trim();if(!e){NotificationManager.error("Invalid mapping identifier");return}if(!window.TemplateManager?.createMappingsFromPayloads){NotificationManager.error("Mapping duplication is not available");return}try{const t=await window.getMappingById(e);if(!t)throw new Error("Mapping not found");await window.TemplateManager.createMappingsFromPayloads([t],{openMode:"inline",source:"duplicate",successMessageFactory:i=>`Duplicated ${i} mapping${i===1?"":"s"}`})}catch(t){Logger.error("OPTIMISTIC","Failed to duplicate mapping:",t),NotificationManager.error(`Failed to duplicate mapping: ${t.message}`)}},window.applyOptimisticMappingUpdate=n=>{try{if(!n){Logger.warn("OPTIMISTIC","No mapping data provided");return}const e=n.mapping||n,t=e?.id||e?.uuid;if(!e||!t){Logger.warn("OPTIMISTIC","Invalid mapping data - missing id:",e);return}if(isImockCacheMapping(e)){Logger.debug("OPTIMISTIC","Skipping cache mapping update");return}const i=window.MappingsStore&&window.MappingsStore.items instanceof Map,r=i&&window.MappingsStore.items.has(t)?"update":"create";if(rememberOptimisticShadowMapping(e,r),typeof updateOptimisticCache=="function")updateOptimisticCache(e,r,{queueMode:"add"});else{if(i){try{window.MappingsStore.addPending({id:t,type:r,payload:e,optimisticMapping:e})}catch(c){Logger.warn("OPTIMISTIC","Failed to enqueue optimistic update:",c)}const o=cloneMappingForCache(e);if(!o)Logger.warn("OPTIMISTIC","Failed to clone mapping for store:",t);else{if(!o.id&&t&&(o.id=t),!o.uuid&&(e.uuid||t)&&(o.uuid=e.uuid||t),window.MappingsStore.items.has(t)){const c=mergeMappingData(window.MappingsStore.items.get(t),o);window.MappingsStore.items.set(t,c)}else window.MappingsStore.items.set(t,o);typeof window.MappingsStore.rebuildIndexes=="function"&&window.MappingsStore.rebuildIndexes()}}window.cacheLastUpdate=Date.now(),window.MappingsStore.metadata.isOptimisticUpdate||(window.MappingsStore.metadata.isOptimisticUpdate=!0,setTimeout(()=>{window.MappingsStore.metadata.isOptimisticUpdate=!1},1e3)),refreshMappingsFromCache()}Logger.debug("OPTIMISTIC","Applied update for mapping:",t)}catch(e){Logger.warn("OPTIMISTIC","Update failed:",e)}},window.backgroundRefreshMappings=async(n=!1)=>{try{if(!window.MappingsStore){Logger.warn("CACHE","MappingsStore not available for background refresh");return}let e,t="direct";if(n){const o=await loadImockCacheBestOf3();o&&o.data&&Array.isArray(o.data.mappings)?(e=o.data,t="cache"):(e=await fetchMappingsFromServer({force:!0}),t="direct")}else e=await fetchMappingsFromServer({force:!0}),t="direct";let i=e.mappings||[];i=applyOptimisticShadowMappings(i);try{if(window.pendingDeletedIds instanceof Set&&window.pendingDeletedIds.size>0){const o=i.length;i=i.filter(c=>{if(!c||typeof c!="object")return!0;const s=c.id||c.uuid;return!window.pendingDeletedIds.has(s)}),o!==i.length&&Logger.cache("background refresh filtered pending-deleted mappings:",o-i.length)}}catch(o){Logger.warn("CACHE","Failed to filter pending deletions during background refresh:",o)}const r=Array.isArray(i)?i.filter(o=>!isImockCacheMapping(o)):[];window.MappingsStore&&window.MappingsStore.setFromServer(r),refreshMappingTabSnapshot(),syncCacheWithMappings(r),rebuildMappingIndex(r),pruneOptimisticShadowMappings(r),updateDataSourceIndicator(t),setTimeout(()=>{const o=window.MappingsStore?window.MappingsStore.getAll():[];fetchAndRenderMappings(o)},0)}catch(e){Logger.warn("CACHE","Background refresh failed:",e)}},window.updateMappingsCounter=function(){const n=document.getElementById(SELECTORS.COUNTERS.MAPPINGS);if(n){const e=window.MappingsStore?window.MappingsStore.getAll():[];n.textContent=Array.isArray(e)?e.length:0}};function updateDataSourceIndicator(n){const e=document.getElementById("data-source-indicator");if(!e)return;let t="Source: direct",i="badge badge-secondary";switch(n){case"cache":t="Source: cache",i="badge badge-success";break;case"cache_rebuilding":t="Source: cache (rebuilding\u2026)",i="badge badge-success";break;case"synced":t="Source: synced",i="badge badge-success";break;case"demo":t="Source: demo data",i="badge badge-info";break;case"custom":t="Source: custom",i="badge badge-secondary";break;case"remote":t="Source: remote",i="badge badge-warning";break;case"remote_error":t="Source: remote (error/CORS)",i="badge badge-danger";break;default:t="Source: direct",i="badge badge-secondary"}e.textContent=t,e.className=i}function updateRequestsSourceIndicator(n){const e=document.getElementById("requests-source-indicator");if(!e)return;let t="Requests: direct",i="badge badge-secondary";switch(n){case"custom":t="Requests: custom",i="badge badge-secondary";break;case"demo":t="Requests: demo data",i="badge badge-info";break;case"remote":t="Requests: remote",i="badge badge-warning";break;case"remote_error":t="Requests: remote (error/CORS)",i="badge badge-danger";break;default:t="Requests: direct",i="badge badge-secondary"}e.textContent=t,e.className=i}function handleMappingItemChanged(n,e){const t=String(n||"");if(!(window.mappingPreviewState instanceof Set)||!window.mappingPreviewState.has(t))return;if(window.mappingPreviewToastState instanceof Map){const r=Date.now(),o=window.mappingPreviewToastState.get(t)||0;if(r-o<4e3)return;window.mappingPreviewToastState.set(t,r)}const i=e?.name||e?.metadata?.name||t;window.NotificationManager&&typeof window.NotificationManager.info=="function"&&window.NotificationManager.info(`Mapping "${i}" refreshed with latest data.`)}function handleMappingItemRemoved(n){const e=String(n||"");window.mappingPreviewState instanceof Set&&window.mappingPreviewState.delete(e),window.mappingPreviewToastState instanceof Map&&window.mappingPreviewToastState.delete(e),isOptimisticShadowMap(window.optimisticShadowMappings)&&window.optimisticShadowMappings.delete(e)}window.updateDataSourceIndicator=updateDataSourceIndicator,window.updateRequestsSourceIndicator=updateRequestsSourceIndicator,window.fetchAndRenderRequests=async(n=null,e={})=>{const t=document.getElementById(SELECTORS.LISTS.REQUESTS),i=document.getElementById(SELECTORS.EMPTY.REQUESTS),r=document.getElementById(SELECTORS.LOADING.REQUESTS);if(!t||!i||!r)return Logger.error("REQUESTS","Required DOM elements not found for requests rendering"),!1;try{let o="direct";if(n===null){r.classList.remove("hidden"),t.style.display="none",i.classList.add("hidden");let c;try{c=await apiFetch(ENDPOINTS.REQUESTS)}catch(l){const d=l?.message||"",f=/^HTTP\s+404\b/.test(d),h=l?.name==="SyntaxError"||/Unexpected end of JSON input/i.test(d);if(f||h)Logger.warn("REQUESTS","Requests endpoint returned no payload; treating as empty list.",l),c={requests:[],__source:"empty"};else throw window.demoModeLastError=l,l}if(c&&c.__source){o=c.__source,o==="demo"&&markDemoModeActive("requests-fallback");try{delete c.__source}catch{}}(!c||typeof c!="object")&&(c={requests:[]});const s=Array.isArray(c.requests)?c.requests:[];window.originalRequests=s,refreshRequestTabSnapshot(),window.allRequests=[...s]}else{const c=e?.source;window.allRequests=Array.isArray(n)?[...n]:[],window.originalRequests=[...window.allRequests],refreshRequestTabSnapshot(),o=c||"custom",o==="demo"&&markDemoModeActive("manual-requests")}return r.classList.add("hidden"),window.allRequests.length===0?(i.classList.remove("hidden"),t.style.display="none",updateRequestsCounter(),!0):(i.classList.add("hidden"),t.style.display="block",window.invalidateElementCache(SELECTORS.LISTS.REQUESTS),renderList(t,window.allRequests,{renderItem:window.renderRequestMarkup,getKey:window.getRequestRenderKey,getSignature:window.getRequestRenderSignature}),updateRequestsCounter(),typeof updateRequestsSourceIndicator=="function"&&updateRequestsSourceIndicator(o),Logger.info("REQUESTS",`Requests render from: ${o} \u2014 ${window.allRequests.length} items`),!0)}catch(o){return Logger.error("REQUESTS","Error in fetchAndRenderRequests:",o),NotificationManager.error(`Failed to load requests: ${o.message}`),r.classList.add("hidden"),i.classList.remove("hidden"),t.style.display="none",!1}},window.renderRequestCard=function(n){if(!n)return Logger.warn("REQUESTS","Invalid request data:",n),"";const e=n.wasMatched!==!1,t=n.request?.clientIp||"Unknown",i={id:n.id||"",method:n.request?.method||"GET",url:n.request?.url||n.request?.urlPath||"N/A",status:n.responseDefinition?.status||(e?200:404),time:`${Utils.parseRequestTime(n.request.loggedDate)} <span class="request-ip">IP: ${Utils.escapeHtml(t)}</span>`,extras:{badges:`
                ${e?`<span class="badge badge-success">${Icons.render("check-circle",{className:"badge-icon"})}<span>Matched</span></span>`:`<span class="badge badge-danger">${Icons.render("x-circle",{className:"badge-icon"})}<span>Unmatched</span></span>`}
            `,preview:UIComponents.createPreviewSection(`${Icons.render("request-in",{className:"icon-inline"})} Request`,{Method:n.request?.method,URL:n.request?.url||n.request?.urlPath,"Client IP":t,Headers:n.request?.headers,Body:n.request?.body})+UIComponents.createPreviewSection(`${Icons.render("response-out",{className:"icon-inline"})} Response`,{Status:n.responseDefinition?.status,Matched:e?"Yes":"No",Headers:n.responseDefinition?.headers,Body:n.responseDefinition?.jsonBody||n.responseDefinition?.body})}};return UIComponents.createCard("request",i,[])};function updateRequestsCounter(){const n=document.getElementById(SELECTORS.COUNTERS.REQUESTS);n&&(n.textContent=Array.isArray(window.allRequests)?window.allRequests.length:0),updateRequestTabCounts()}window.updateRequestsCounter=updateRequestsCounter;function updateRequestTabCounts(){const n=window.requestTabTotals||computeRequestTabTotals(window.originalRequests),e={all:document.getElementById("requests-tab-all"),matched:document.getElementById("requests-tab-matched"),unmatched:document.getElementById("requests-tab-unmatched")};Object.entries(e).forEach(([t,i])=>{i&&(i.textContent=n?.[t]??0)})}function setActiveFilterTab(n){if(!n)return;const e=n.dataset.filterGroup;e&&document.querySelectorAll(`.filter-tab[data-filter-group="${e}"]`).forEach(t=>{t.classList.toggle("active",t===n)})}window.syncFilterTabsFromSelect=function(e,t){const i=(t||"").toString().toLowerCase(),r=document.querySelectorAll(`.filter-tab[data-filter-group="${e}"]`);let o=!1;r.forEach(c=>{const s=(c.dataset.filterValue||"").toLowerCase();s===i||!s&&!i?(c.classList.add("active"),o=!0):c.classList.remove("active")}),!o&&r.length>0&&r[0].classList.add("active")},window.handleRequestTabClick=(n,e)=>{setActiveFilterTab(n);const t=document.getElementById("req-filter-status");t&&(t.value=e||"",typeof applyRequestFilters=="function"&&applyRequestFilters())},window.initializeFilterTabs=()=>{const n=document.getElementById("filter-method");n&&(n.addEventListener("change",()=>{syncFilterTabsFromSelect("mapping",n.value)}),syncFilterTabsFromSelect("mapping",n.value));const e=document.getElementById("req-filter-status");e&&(e.addEventListener("change",()=>{syncFilterTabsFromSelect("requests",e.value)}),syncFilterTabsFromSelect("requests",e.value)),updateRequestTabCounts()},window.openEditModal=async n=>{const t=(r=>typeof r=="string"?r.trim():r==null?"":String(r).trim())(n);if(!t){NotificationManager.show("Invalid mapping identifier",NotificationManager.TYPES.ERROR);return}if(typeof UIComponents?.clearCardState=="function"&&UIComponents.clearCardState("mapping","is-editing"),t&&typeof UIComponents?.setCardState=="function"&&UIComponents.setCardState("mapping",t,"is-editing",!0),typeof window.showModal=="function")window.showModal("edit-mapping-modal");else{Logger.warn("REQUESTS","showModal function not found");return}typeof window.setMappingEditorBusyState=="function"&&window.setMappingEditorBusyState(!0,"Loading\u2026");const i=document.getElementById(SELECTORS.MODAL.TITLE);i&&(i.textContent="Edit Mapping"),Logger.debug("REQUESTS","openEditModal called for mapping identifier:",n);try{const r=await apiFetch(`/mappings/${encodeURIComponent(t)}`),o=r?.mapping||r;if(!o||!o.id)throw new Error("Invalid mapping response from server");if(Logger.debug("REQUESTS","Loaded mapping from server:",o),typeof window.populateEditMappingForm=="function")window.populateEditMappingForm(o);else{Logger.error("REQUESTS","populateEditMappingForm function not found!");return}addMappingToIndex(o),Logger.debug("REQUESTS","openEditModal completed successfully")}catch(r){Logger.error("REQUESTS","Failed to load mapping:",r),NotificationManager.show("Failed to load mapping: "+r.message,NotificationManager.TYPES.ERROR),typeof window.hideModal=="function"&&window.hideModal("edit-mapping-modal")}finally{typeof window.setMappingEditorBusyState=="function"&&window.setMappingEditorBusyState(!1)}},window.deleteMapping=async n=>{if(confirm("Delete this mapping?"))try{await apiFetch(`/mappings/${n}`,{method:"DELETE"}),NotificationManager.success("Mapping deleted!"),removeMappingFromIndex(n),updateOptimisticCache({id:n},"delete")}catch(e){e.message.includes("404")?(Logger.info("REQUESTS","Mapping already deleted from server (404), updating cache locally"),removeMappingFromIndex(n),updateOptimisticCache({id:n},"delete"),NotificationManager.success("Mapping was already deleted")):NotificationManager.error(`Delete failed: ${e.message}`)}},window.clearRequests=async()=>{if(confirm("Clear all requests?"))try{await apiFetch("/requests",{method:"DELETE"}),NotificationManager.success("Requests cleared!"),await fetchAndRenderRequests()}catch(n){NotificationManager.error(`Clear failed: ${n.message}`)}},(function(){if(window.ScenarioModel)return;const e=s=>{if(typeof s!="string")return"";const l=s.trim();if(!l)return"";if(!/%[0-9a-fA-F]{2}/.test(l))return l;try{return decodeURIComponent(l)}catch(d){return Logger.warn("SCENARIOS","safeDecode failed, returning original value",{value:s,error:d}),l}},t=s=>{if(typeof s!="string")return"";let l=s.trim();if(!l)return"";if(/^https?:\/\//i.test(l))try{l=new URL(l).pathname}catch(f){Logger.warn("SCENARIOS","normalizeScenarioLink failed to parse absolute URL",{link:s,error:f})}const d="/__admin";return l.startsWith(d)&&(l=l.slice(d.length)||"/"),l=l.replace(/^\/+/,""),l?`/${l}`:""},i=(s,l)=>{if(!s||typeof s!="object")return null;const d=typeof s.id=="string"?s.id:"",f=typeof s.name=="string"?s.name:"",h=e(d),m=e(f),M=h||m||d||f||"",I=m||h||f||d||`Scenario ${l+1}`,T=e(s.state)||s.state||"Started",g=Array.isArray(s.possibleStates)?s.possibleStates.map(B=>e(B)||B).filter(Boolean):[],y=Array.isArray(s.mappings)?s.mappings.map(B=>!B||typeof B!="object"?B:{...B,requiredScenarioState:e(B.requiredScenarioState)||B.requiredScenarioState||"",newScenarioState:e(B.newScenarioState)||B.newScenarioState||""}):[],C=t(s.stateEndpoint||s?._links?.["update-state"]?.href||s?._links?.updateState?.href||s?._links?.state?.href),A=t(s.resetEndpoint||s?._links?.["reset-state"]?.href||s?._links?.resetState?.href||s?._links?.reset?.href);return{...s,id:M||h||d,name:I,displayName:I,identifier:M,originalId:d,originalName:f||m,decodedId:h,decodedName:m,state:T,possibleStates:g,mappings:y,stateEndpoint:C,resetEndpoint:A}},r=s=>Array.isArray(s)?s.map((l,d)=>i(l,d)).filter(Boolean):[],o=s=>typeof s!="string"?"":s.trim().toLowerCase(),c=(s,l)=>l?!s||typeof s!="object"?!1:[s.displayName,s.name,s.identifier,s.id,s.state,s.description].filter(h=>typeof h=="string"&&h.trim()).map(h=>h.toLowerCase()).some(h=>h.includes(l))?!0:(Array.isArray(s.mappings)?s.mappings:[]).some(h=>!h||typeof h!="object"?!1:[h.name,h.id,h.uuid,h.stubId,h.stubMappingId,h.requiredScenarioState,h.newScenarioState,h.request?.method,h.request?.url,h.request?.urlPattern,h.request?.urlPath,h.request?.urlPathPattern].filter(M=>typeof M=="string"&&M.trim()).map(M=>M.toLowerCase()).some(M=>M.includes(l))):!0;window.ScenarioModel={safeDecode:e,normalizeScenarioLink:t,normalizeScenario:i,normalizeScenarioList:r,normalizeSearchTerm:o,scenarioMatchesSearch:c}})(),Array.isArray(window.allScenarios)||(window.allScenarios=[]);let allScenarios=window.allScenarios,scenarioListHandlerAttached=!1;(!window.scenarioExpansionState||typeof window.scenarioExpansionState!="object")&&(window.scenarioExpansionState={});let scenarioExpansionState=window.scenarioExpansionState;(!window.scenarioUiState||typeof window.scenarioUiState!="object")&&(window.scenarioUiState={});const scenarioUiState=window.scenarioUiState;typeof scenarioUiState.searchTerm!="string"&&(scenarioUiState.searchTerm=""),scenarioUiState.selected instanceof Set||(scenarioUiState.selected=new Set),typeof scenarioUiState.bulkMenuOpen!="boolean"&&(scenarioUiState.bulkMenuOpen=!1),Array.isArray(scenarioUiState.lastVisibleSelectable)||(scenarioUiState.lastVisibleSelectable=[]);let scenarioToolbarHandlersAttached=!1;function renderIcon(n,e={}){return typeof window.Icons?.render=="function"?window.Icons.render(n,e):""}function downloadFile(n,e,t){const i=new Blob([e],{type:t}),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(r),0)}function safeDecode(n){return window.ScenarioModel&&typeof window.ScenarioModel.safeDecode=="function"?window.ScenarioModel.safeDecode(n):typeof n=="string"?n.trim():""}function normalizeScenarioLink(n){return window.ScenarioModel&&typeof window.ScenarioModel.normalizeScenarioLink=="function"?window.ScenarioModel.normalizeScenarioLink(n):""}function normalizeScenario(n,e){return window.ScenarioModel&&typeof window.ScenarioModel.normalizeScenario=="function"?window.ScenarioModel.normalizeScenario(n,e):n||null}function normalizeScenarioList(n){return window.ScenarioModel&&typeof window.ScenarioModel.normalizeScenarioList=="function"?window.ScenarioModel.normalizeScenarioList(n):Array.isArray(n)?n.filter(Boolean):[]}function getScenarioByIdentifier(n){if(typeof n!="string")return null;const e=n.trim();return e&&(Array.isArray(allScenarios)?allScenarios:[]).find(i=>[i?.identifier,i?.id,i?.name,i?.decodedId,i?.decodedName,i?.originalId,i?.originalName].some(o=>typeof o!="string"?!1:o.trim()===e))||null}function resolveScenarioTarget(n){const e=typeof n=="string"?n.trim():"",t=e?getScenarioByIdentifier(e):null,i=t?.identifier||t?.decodedId||t?.decodedName||e,r=safeDecode(i)||i,o=t?.displayName||t?.decodedName||t?.name||t?.decodedId||t?.id||safeDecode(e)||e,c=typeof t?.stateEndpoint=="string"?t.stateEndpoint:"",s=typeof t?.resetEndpoint=="string"?t.resetEndpoint:"",l=typeof window.buildScenarioStateEndpoint=="function"?window.buildScenarioStateEndpoint:m=>`${ENDPOINTS.SCENARIOS}/${encodeURIComponent(m)}/state`,d=c||(r?l(r):"");return{rawCandidate:e,targetScenario:t,endpointIdentifier:r,displayName:o,stateEndpoint:d,resetEndpoint:s||d,resetMethod:s?"POST":"PUT"}}function setScenariosLoading(n){const e=document.getElementById("scenarios-loading");if(e&&e.classList.toggle("hidden",!n),n){const t=document.getElementById(SELECTORS.LISTS.SCENARIOS);t&&(t.style.display="none")}}window.loadScenarios=async()=>{const n=document.getElementById("scenarios-empty");n&&n.classList.add("hidden"),setScenariosLoading(!0);try{const e=await apiFetch(ENDPOINTS.SCENARIOS),t=Array.isArray(e?.scenarios)?e.scenarios:[];allScenarios=normalizeScenarioList(t),window.allScenarios=allScenarios}catch(e){allScenarios=[],window.allScenarios=allScenarios,Logger.error("SCENARIOS","Load scenarios error:",e),NotificationManager.error(`Failed to load scenarios: ${e.message}`)}finally{setScenariosLoading(!1),renderScenarios()}},window.refreshScenarios=async()=>{await TabManager.refresh("scenarios")},window.resetAllScenarios=async()=>{if(confirm("Reset all scenarios to the initial state?")){setScenariosLoading(!0);try{await apiFetch(ENDPOINTS.SCENARIOS_RESET,{method:"POST"}),NotificationManager.success("All scenarios have been reset!"),await loadScenarios()}catch(n){NotificationManager.error(`Scenario reset failed: ${n.message}`),setScenariosLoading(!1)}}};function updateScenarioStateSuggestions(n){const e=document.getElementById("scenario-state-options"),t=document.getElementById("scenario-state");if(!e)return;const i=Array.isArray(allScenarios)?allScenarios:[],r=getScenarioByIdentifier(n),o=new Set,c=d=>{if(typeof d!="string")return;const f=d.trim();f&&o.add(f)};c("Started");const s=d=>{d&&(c(d.state),(d.possibleStates||[]).forEach(c),(d.mappings||[]).forEach(f=>{c(f?.requiredScenarioState),c(f?.newScenarioState)}))};r&&s(r),o.size===0&&i.forEach(s);const l=Array.from(o).sort((d,f)=>d.localeCompare(f));e.innerHTML=l.map(d=>`
        <option value="${escapeHtml(d)}"></option>
    `).join(""),t&&(l.length>0?t.setAttribute("placeholder",`Enter state (e.g. ${l[0]})`):t.setAttribute("placeholder","Enter state name"))}window.setScenarioState=async(n,e,t={})=>{const i=document.getElementById("scenario-select"),r=document.getElementById("scenario-state"),o=typeof n=="string"?n:"",c=typeof e=="string"?e.trim():"",s=t&&typeof t=="object"?t:{},l=s.refresh!==!1,d=s.silent===!0,f=s.manageLoading!==!1,h=s.syncForm!==!1;let m=o;!m&&i&&(m=i.value||"");const M=resolveScenarioTarget(m),I=M.endpointIdentifier,T=M.displayName,g=c||r?.value?.trim()||"";if(!I||!I.trim()||!g)return d||NotificationManager.warning("Please select scenario and enter state"),!1;const y=M.stateEndpoint;if(!y)return d||NotificationManager.error("Unable to determine the scenario state endpoint."),!1;if(M.targetScenario&&Array.isArray(M.targetScenario.possibleStates)&&M.targetScenario.possibleStates.length===0)return d||NotificationManager.warning(`Scenario "${T}" does not expose any states to switch to.`),!1;if(h)if(i){const A=M.targetScenario?.identifier||M.targetScenario?.decodedId||M.targetScenario?.decodedName||I;i.value=A,updateScenarioStateSuggestions(A)}else updateScenarioStateSuggestions(I);f&&setScenariosLoading(!0);const C=!!M.targetScenario;try{return await apiFetch(y,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:g})}),d||NotificationManager.success(`Scenario "${T}" switched to state "${g}"`),h&&!c&&r&&(r.value=""),h&&updateScenarioStateSuggestions(I),l?await loadScenarios():f&&setScenariosLoading(!1),!0}catch(A){Logger.error("SCENARIOS","Change scenario state error:",A);const B=/HTTP\s+404/.test(A?.message||""),X=/does not support state/i.test(A?.message||"");return d||(B&&!C?NotificationManager.error(`Scenario "${T}" was not found on the server.`):X?NotificationManager.error(`Scenario "${T}" does not allow state changes.`):NotificationManager.error(`Scenario state change failed: ${A.message}`)),f&&setScenariosLoading(!1),!1}};async function resetScenarioState(n,e={}){const t=e&&typeof e=="object"?e:{},i=t.refresh!==!1,r=t.silent===!0,o=t.manageLoading!==!1;if(typeof n!="string"||!n.trim())return r||NotificationManager.warning("Unable to determine which scenario to reset."),!1;const c=resolveScenarioTarget(n),s=c.resetEndpoint,l=c.resetMethod,d=c.displayName;if(!s)return r||NotificationManager.error("Unable to determine the scenario reset endpoint."),!1;o&&setScenariosLoading(!0);try{return await apiFetch(s,{method:l}),r||NotificationManager.success(`Scenario "${d}" has been reset to its initial state.`),i?await loadScenarios():o&&setScenariosLoading(!1),!0}catch(f){if(l==="PUT"&&c.stateEndpoint)try{return await apiFetch(c.stateEndpoint,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"Started"})}),r||NotificationManager.success(`Scenario "${d}" has been reset to its initial state.`),i?await loadScenarios():o&&setScenariosLoading(!1),!0}catch(h){return Logger.error("SCENARIOS","Reset scenario state error:",h),r||NotificationManager.error(`Scenario reset failed: ${h.message}`),o&&setScenariosLoading(!1),!1}return Logger.error("SCENARIOS","Reset scenario state error:",f),r||NotificationManager.error(`Scenario reset failed: ${f.message}`),o&&setScenariosLoading(!1),!1}}function normalizeSearchTerm(n){return window.ScenarioModel&&typeof window.ScenarioModel.normalizeSearchTerm=="function"?window.ScenarioModel.normalizeSearchTerm(n):""}function scenarioMatchesSearch(n,e){return window.ScenarioModel&&typeof window.ScenarioModel.scenarioMatchesSearch=="function"?window.ScenarioModel.scenarioMatchesSearch(n,e):!0}async function bulkResetSelectedScenarios(){const n=scenarioUiState.selected instanceof Set?Array.from(scenarioUiState.selected):[];if(n.length===0||!confirm(`Reset ${n.length} selected scenarios to their initial state?`))return;setScenarioBulkMenuOpen(!1),setScenariosLoading(!0);const e=[];for(const t of n)try{const i=resolveScenarioTarget(t);if(!i.resetEndpoint){e.push({id:t,name:i.displayName||t,error:"No reset endpoint resolved"});continue}try{await apiFetch(i.resetEndpoint,{method:i.resetMethod})}catch(r){if(i.resetMethod==="PUT"&&i.stateEndpoint)await apiFetch(i.stateEndpoint,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:"Started"})});else throw r}}catch(i){e.push({id:t,name:t,error:i?.message||String(i)})}if(e.length>0){scenarioUiState.selected=new Set(e.map(i=>i.id).filter(Boolean));const t=e.slice(0,3).map(i=>i.name||i.id).join(", ");NotificationManager.warning(`Bulk reset: ${e.length} failed${t?` (e.g. ${t})`:""}.`)}else scenarioUiState.selected.clear(),NotificationManager.success("Bulk reset complete.");await loadScenarios()}async function bulkSetScenarioState(){const n=scenarioUiState.selected instanceof Set?Array.from(scenarioUiState.selected):[];if(n.length===0)return;const e=n.length===1&&getScenarioByIdentifier(n[0])?.state||"Started",t=prompt(`Set state for ${n.length} selected scenarios:`,e);if(!t||!t.trim())return;setScenarioBulkMenuOpen(!1),setScenariosLoading(!0);const i=[],r=t.trim();for(const o of n)try{const c=resolveScenarioTarget(o);if(!c.stateEndpoint){i.push({id:o,name:c.displayName||o,error:"No state endpoint resolved"});continue}await apiFetch(c.stateEndpoint,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:r})})}catch(c){i.push({id:o,name:o,error:c?.message||String(c)})}if(i.length>0){scenarioUiState.selected=new Set(i.map(c=>c.id).filter(Boolean));const o=i.slice(0,3).map(c=>c.name||c.id).join(", ");NotificationManager.warning(`Bulk state update: ${i.length} failed${o?` (e.g. ${o})`:""}.`)}else scenarioUiState.selected.clear(),NotificationManager.success(`Bulk state updated: "${r}"`);await loadScenarios()}async function fetchFullMappingById(n){const e=(n??"").toString().trim();if(!e)return null;if(typeof window.getMappingById=="function")try{const o=await window.getMappingById(e);if(o&&typeof o=="object")return o}catch(o){Logger.warn("SCENARIOS","getMappingById failed, falling back to direct fetch",{mappingId:e,error:o})}const t=`/mappings/${encodeURIComponent(e)}`,i=await apiFetch(t),r=i&&typeof i=="object"&&i.mapping?i.mapping:i;return r&&typeof r=="object"?r:null}async function bulkExportSelectedMappings(){const n=scenarioUiState.selected instanceof Set?Array.from(scenarioUiState.selected):[];if(n.length===0)return;setScenarioBulkMenuOpen(!1);const e=[],t=new Set;if(n.forEach(s=>{const l=getScenarioByIdentifier(s);(Array.isArray(l?.mappings)?l.mappings:[]).forEach(f=>{const h=(f?.id||f?.uuid||f?.stubMappingId||f?.stubId||f?.mappingId||"").toString().trim();!h||t.has(h)||(t.add(h),e.push(h))})}),e.length===0){NotificationManager.warning("No mappings found for selected scenarios.");return}setScenariosLoading(!0);const i=[],r=[];for(const s of e)try{const l=await fetchFullMappingById(s);if(!l){r.push({id:s,error:"Empty mapping payload"});continue}i.push(l)}catch(l){r.push({id:s,error:l?.message||String(l)})}const c=`wiremock-mappings-${new Date().toISOString().replace(/[:.]/g,"-")}.json`;if(downloadFile(c,`${JSON.stringify({mappings:i},null,2)}
`,"application/json"),r.length>0){const s=r.slice(0,3).map(l=>l.id).join(", ");NotificationManager.warning(`Exported ${i.length}/${e.length} mapping(s). Failed: ${r.length}${s?` (e.g. ${s})`:""}.`)}else NotificationManager.success(`Exported ${i.length} mapping(s).`);setScenariosLoading(!1)}function setScenarioBulkMenuOpen(n){scenarioUiState.bulkMenuOpen=!!n;const e=document.getElementById("scenario-bulk-menu");e&&(e.classList.toggle("is-open",scenarioUiState.bulkMenuOpen),e.setAttribute("aria-hidden",scenarioUiState.bulkMenuOpen?"false":"true"))}function updateScenarioHeaderUI(n,e){const t=document.getElementById("scenario-stats");if(t){const d=Array.isArray(n)?n.reduce((h,m)=>h+(Array.isArray(m?.mappings)?m.mappings.length:0),0):0,f=Array.isArray(n)?n.length:0;t.textContent=`${f}/${e} scenarios \u2022 ${d} mappings`}const i=document.getElementById("scenario-select-all-row"),r=document.getElementById("scenario-select-all-btn"),o=Array.isArray(n)?n.map(d=>{const f=typeof d?.identifier=="string"?d.identifier:typeof d?.decodedId=="string"?d.decodedId:typeof d?.id=="string"?d.id:"";return(typeof f=="string"?f.trim():"")||""}).filter(Boolean):[];scenarioUiState.lastVisibleSelectable=o;const c=scenarioUiState.selected instanceof Set?scenarioUiState.selected.size:0,s=document.getElementById("scenario-bulk-wrap"),l=document.getElementById("scenario-bulk-count");if(l&&(l.textContent=String(c)),s&&s.classList.toggle("is-hidden",c===0),i&&(i.style.display=o.length>0?"":"none"),r){const d=o.length>0&&o.every(f=>scenarioUiState.selected.has(f));r.classList.toggle("is-selected",d),r.setAttribute("aria-checked",d?"true":"false")}c===0&&scenarioUiState.bulkMenuOpen&&setScenarioBulkMenuOpen(!1)}function clearScenarioSelection(){scenarioUiState.selected instanceof Set&&scenarioUiState.selected.clear(),setScenarioBulkMenuOpen(!1),renderScenarios()}function toggleSelectAllVisibleScenarios(){const n=Array.isArray(scenarioUiState.lastVisibleSelectable)?scenarioUiState.lastVisibleSelectable:[];scenarioUiState.selected instanceof Set||(scenarioUiState.selected=new Set),n.length>0&&n.every(t=>scenarioUiState.selected.has(t))?n.forEach(t=>scenarioUiState.selected.delete(t)):n.forEach(t=>scenarioUiState.selected.add(t)),renderScenarios()}window.renderScenarios=()=>{const n=document.getElementById(SELECTORS.LISTS.SCENARIOS),e=document.getElementById("scenarios-empty"),t=document.getElementById("scenarios-count"),i=document.getElementById("scenario-select"),r=document.getElementById("scenario-state-options"),o=document.getElementById("scenario-search"),c=document.getElementById("scenario-bulk-btn"),s=document.getElementById("scenario-bulk-reset"),l=document.getElementById("scenario-bulk-set-state"),d=document.getElementById("scenario-bulk-export"),f=document.getElementById("scenario-bulk-clear"),h=document.getElementById("scenario-select-all-btn");if(!n)return;t&&(t.textContent=Array.isArray(allScenarios)?allScenarios.length:0);const m=Array.isArray(allScenarios)?allScenarios:[];if(m.length===0){n.innerHTML="",n.style.display="none",e&&e.classList.remove("hidden"),i&&(i.innerHTML='<option value="">Select Scenario</option>'),r&&(r.innerHTML=""),updateScenarioStateSuggestions(""),updateScenarioHeaderUI([],0);return}if(e&&e.classList.add("hidden"),scenarioUiState.selected instanceof Set&&scenarioUiState.selected.size>0){const g=new Set(m.map(y=>{const C=typeof y?.identifier=="string"?y.identifier:typeof y?.decodedId=="string"?y.decodedId:typeof y?.id=="string"?y.id:"";return typeof C=="string"?C.trim():""}).filter(Boolean));for(const y of Array.from(scenarioUiState.selected))g.has(y)||scenarioUiState.selected.delete(y)}o&&(o.value||"")!==scenarioUiState.searchTerm&&(o.value=scenarioUiState.searchTerm),scenarioToolbarHandlersAttached||(o&&o.addEventListener("input",g=>{scenarioUiState.searchTerm=typeof g.target?.value=="string"?g.target.value:"",renderScenarios()}),c&&c.addEventListener("click",g=>{g.stopPropagation(),setScenarioBulkMenuOpen(!scenarioUiState.bulkMenuOpen)}),s&&s.addEventListener("click",()=>{bulkResetSelectedScenarios()}),l&&l.addEventListener("click",()=>{bulkSetScenarioState()}),d&&d.addEventListener("click",()=>{bulkExportSelectedMappings()}),f&&f.addEventListener("click",clearScenarioSelection),h&&h.addEventListener("click",toggleSelectAllVisibleScenarios),document.addEventListener("click",g=>{const y=document.getElementById("scenario-bulk-wrap");y&&scenarioUiState.bulkMenuOpen&&(typeof y.contains=="function"&&y.contains(g.target)||setScenarioBulkMenuOpen(!1))}),document.addEventListener("keydown",g=>{scenarioUiState.bulkMenuOpen&&g.key==="Escape"&&setScenarioBulkMenuOpen(!1)}),scenarioToolbarHandlersAttached=!0);const M=i?.value||"";if(i){const g=['<option value="">Select Scenario</option>'].concat(m.map(y=>{const C=typeof y?.identifier=="string"?y.identifier:typeof y?.decodedId=="string"?y.decodedId:typeof y?.id=="string"?y.id:"",A=typeof y?.displayName=="string"?y.displayName:typeof y?.name=="string"?y.name:typeof y?.decodedName=="string"?y.decodedName:"Unnamed scenario";return`
                <option value="${escapeHtml(C)}">${escapeHtml(A)}</option>
            `}));if(i.innerHTML=g.join(""),M){const y=getScenarioByIdentifier(M);y&&(i.value=y.identifier||y.decodedId||y.decodedName||y.id||y.name||"")}}r&&updateScenarioStateSuggestions(i?.value||M||""),i&&!i.dataset.scenarioHandlerAttached&&(i.addEventListener("change",g=>{updateScenarioStateSuggestions(g.target.value)}),i.dataset.scenarioHandlerAttached="1"),n.style.display="";const I=normalizeSearchTerm(scenarioUiState.searchTerm),T=m.filter(g=>scenarioMatchesSearch(g,I));if(T.length===0){if(n.innerHTML="",n.style.display="none",e){e.classList.remove("hidden");const g=typeof e.querySelector=="function"?e.querySelector("h3"):null,y=typeof e.querySelector=="function"?e.querySelector("p"):null;g&&(g.textContent="No scenarios match your filter"),y&&(y.textContent="Try clearing the filter or searching by mapping URL/state.")}updateScenarioHeaderUI([],m.length);return}if(e){const g=typeof e.querySelector=="function"?e.querySelector("h3"):null,y=typeof e.querySelector=="function"?e.querySelector("p"):null;g&&(g.textContent="No scenarios found"),y&&(y.textContent="Create mappings with scenarios to manage state here."),e.classList.add("hidden")}updateScenarioHeaderUI(T,m.length),n.innerHTML=T.map((g,y)=>{const C=typeof g?.identifier=="string"?g.identifier:typeof g?.decodedId=="string"?g.decodedId:typeof g?.id=="string"?g.id:"",A=escapeHtml(C),B=typeof g?.displayName=="string"?g.displayName:typeof g?.name=="string"?g.name:typeof g?.decodedName=="string"?g.decodedName:"Unnamed scenario",X=escapeHtml(B),H=escapeHtml(g.state||"Started"),le=Array.isArray(g.possibleStates)?g.possibleStates.filter(Boolean):[],Se=C||g?.decodedId||g?.decodedName||g?.id||g?.name||`scenario-${y}`,U=typeof Se=="string"&&Se.trim()?Se.trim():`scenario-${y}`,j=scenarioExpansionState[U]===!0,F=escapeHtml(U),v=typeof C=="string"&&C.trim().length>0,k=v?C.trim():"",q=k&&scenarioUiState.selected instanceof Set?scenarioUiState.selected.has(k):!1,W=v?`
            <button
                type="button"
                class="scenario-select-btn${q?" is-selected":""}"
                data-scenario-action="select"
                data-scenario="${A}"
                role="checkbox"
                aria-checked="${q?"true":"false"}"
                aria-label="Select scenario ${X}"
                title="Select"
            >
                <span class="scenario-select-box" aria-hidden="true"></span>
            </button>
        `:`
            <span style="width:18px;height:18px;display:inline-block;"></span>
        `,ne=new Set,be=[],ot=se=>{if(typeof se!="string")return;const Te=se.trim();!Te||ne.has(Te)||(ne.add(Te),be.push(Te))};ot(g.state||""),le.forEach(ot);const Le=be.map(se=>{const Te=escapeHtml(se),He=se===g.state,Fe="scenario-state-pill";return He?`<span class="${Fe} is-active" data-current="true">${Te}</span>`:v?`
                <button
                    type="button"
                    class="${Fe}"
                    data-scenario-action="transition"
                    data-scenario="${A}"
                    data-state="${Te}"
                >
                    ${Te}
                </button>
            `:`<span class="${Fe}">${Te}</span>`}).join(""),We=v?`
            <button
                type="button"
                class="scenario-reset-btn"
                data-scenario-action="reset"
                data-scenario="${A}"
            >
                ${renderIcon("refresh",{className:"icon-inline"})} Reset
            </button>
        `:"",at=Le||We?`
            <div class="scenario-summary-controls">
                <div class="scenario-state-pill-list">${Le}</div>
                ${We}
            </div>
        `:"",Nt=g.description?`
            <div class="scenario-info">
                <div class="scenario-description">${escapeHtml(g.description)}</div>
            </div>
        `:"",Ye=Array.isArray(g.mappings)?g.mappings:[],Rt=Ye.length?`
            <ul class="scenario-mapping-list">
                ${Ye.map(se=>{const Te=se?.id||se?.uuid||se?.stubMappingId||se?.stubId||se?.mappingId||"",He=Te?escapeHtml(Te):"",Fe=escapeHtml(se?.name||Te||"Unnamed mapping"),Ge=se?.request?.method||se?.method||se?.requestMethod||"",et=se?.request?.urlPattern||se?.request?.urlPath||se?.request?.url||se?.url||se?.requestUrl||"",Ke=Ge?`<span class="scenario-mapping-method">${escapeHtml(Ge)}</span>`:"",Ce=et?`<span class="scenario-mapping-url">${escapeHtml(et)}</span>`:"",qe=Ke||Ce?`
                        <div class="scenario-mapping-meta">
                            ${[Ke,Ce].filter(Boolean).join(" \xB7 ")}
                        </div>
                    `:"",Me=se?.requiredScenarioState||se?.requiredState||"",ze=se?.newScenarioState||se?.newState||"",Mt=[Me?`<span class="badge badge-warning" title="Required scenario state">Requires: ${escapeHtml(Me)}</span>`:"",ze?`<span class="badge badge-info" title="Next scenario state">\u2192 ${escapeHtml(ze)}</span>`:""].filter(Boolean).join(" "),mt=Mt?`
                        <div class="scenario-mapping-states">${Mt}</div>
                    `:"",ht=renderIcon("pencil",{className:"action-icon"}),gt=renderIcon("clipboard",{className:"action-icon"}),yt=renderIcon("trash",{className:"action-icon"}),$e=Te?`
                        <div class="scenario-mapping-actions">
                            <button
                                class="btn btn-sm btn-secondary"
                                data-scenario-action="edit-mapping"
                                data-mapping-id="${He}"
                                title="Edit mapping"
                            >
                                ${ht||""}<span>Edit</span>
                            </button>
                            <button
                                class="btn btn-sm btn-secondary"
                                data-scenario-action="duplicate-mapping"
                                data-mapping-id="${He}"
                                title="Duplicate mapping"
                            >
                                ${gt||""}<span>Duplicate</span>
                            </button>
                            <button
                                class="btn btn-sm btn-danger"
                                data-scenario-action="delete-mapping"
                                data-mapping-id="${He}"
                                title="Delete mapping"
                            >
                                ${yt||""}<span>Delete</span>
                            </button>
                        </div>
                    `:"";return`
                        <li class="scenario-mapping-item">
                            <div class="scenario-mapping-name">${Fe}</div>
                            ${qe}
                            ${mt}
                            ${$e}
                        </li>
                    `}).join("")}
            </ul>
        `:`
            <div class="scenario-mapping-empty">No stub mappings are bound to this scenario yet.</div>
        `,Be=`<span class="collapse-arrow" aria-hidden="true">${j?"\u25BC":"\u25B6"}</span>`,st=`${j?"Collapse":"Expand"} scenario ${B}`;return`
            <div class="scenario-item ${j?"expanded":"collapsed"}${q?" is-selected":""}" data-scenario="${A}" data-scenario-key="${F}">
                <div class="scenario-summary">
                    ${W}
                    <button
                        type="button"
                        class="scenario-toggle-btn"
                        data-scenario-action="toggle"
                        data-scenario-key="${F}"
                        aria-expanded="${j?"true":"false"}"
                        aria-label="${escapeHtml(st)}"
                    >
                        ${Be}
                    </button>
                    <div class="scenario-summary-main">
                        <div class="scenario-summary-header">
                            <div class="scenario-name">${X}</div>
                            <div class="scenario-state">State: ${H}</div>
                        </div>
                        ${at}
                    </div>
                </div>
                <div class="scenario-body">
                    ${Nt}
                    <div class="scenario-mappings">
                        <div class="scenario-section-title">Stub mappings</div>
                        ${Rt}
                    </div>
                </div>
            </div>
        `}).join(""),scenarioListHandlerAttached||(n.addEventListener("click",async g=>{const y=g.target.closest("[data-scenario-action]");if(!y||typeof n.contains=="function"&&!n.contains(y))return;const C=y.dataset.scenarioAction;if(C==="toggle"){g.preventDefault();const A=y.dataset.scenarioKey||y.dataset.scenario||"";if(!A.trim())return;const B=scenarioExpansionState[A]===!0;scenarioExpansionState[A]=!B,renderScenarios()}else if(C==="select"){g.preventDefault();const A=y.dataset.scenario||"",B=typeof A=="string"?A.trim():"";if(!B)return;scenarioUiState.selected instanceof Set||(scenarioUiState.selected=new Set),scenarioUiState.selected.has(B)?scenarioUiState.selected.delete(B):scenarioUiState.selected.add(B),renderScenarios()}else if(C==="transition"){const A=y.dataset.scenario||"",B=y.dataset.state||"";if(!A.trim()||!B.trim())return;y.disabled=!0;try{await setScenarioState(A,B)}finally{y.disabled=!1}}else if(C==="reset"){const A=y.dataset.scenario||"";if(!A.trim())return;y.disabled=!0;try{await resetScenarioState(A)}finally{y.disabled=!1}}else if(C==="edit-mapping"){const A=y.dataset.mappingId;A&&typeof window.openEditModal=="function"&&window.openEditModal(A)}else if(C==="duplicate-mapping"){const A=y.dataset.mappingId;if(A&&typeof window.duplicateMapping=="function"){y.disabled=!0;try{await window.duplicateMapping(A),await loadScenarios()}finally{y.disabled=!1}}}else if(C==="delete-mapping"){const A=y.dataset.mappingId;if(A&&typeof window.deleteMapping=="function"){y.disabled=!0;try{await window.deleteMapping(A),await loadScenarios()}finally{y.disabled=!1}}}}),scenarioListHandlerAttached=!0)},window.startRecording=async(n={})=>{try{const t={...{targetBaseUrl:"https://example.com",filters:{urlPathPatterns:[".*"],method:"ANY",headers:{}},captureHeaders:{},requestBodyPattern:{},persist:!0,repeatsAsScenarios:!1,transformers:["response-template"],transformerParameters:{}},...n};await apiFetch(ENDPOINTS.RECORDINGS_START,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),NotificationManager.success("Recording started!"),window.isRecording=!0;const i=document.getElementById(SELECTORS.RECORDING.INDICATOR);i&&(i.style.display="block")}catch(e){Logger.error("RECORDING","Start recording error:",e),NotificationManager.error(`Failed to start recording: ${e.message}`)}},window.stopRecording=async()=>{try{const n=await apiFetch(ENDPOINTS.RECORDINGS_STOP,{method:"POST"});window.isRecording=!1,window.recordedCount=0;const e=document.getElementById(SELECTORS.RECORDING.INDICATOR);e&&(e.style.display="none");const t=n.mappings?n.mappings.length:0;NotificationManager.success(`Recording stopped! Captured ${t} mappings`);const i=window.MappingsStore.getAll();return await fetchAndRenderMappings(i),n.mappings||[]}catch(n){return Logger.error("RECORDING","Stop recording error:",n),NotificationManager.error(`Failed to stop recording: ${n.message}`),[]}},window.getRecordingStatus=async()=>{try{return(await apiFetch(ENDPOINTS.RECORDINGS_STATUS)).status||"Unknown"}catch(n){return Logger.error("RECORDING","Recording status error:",n),"Unknown"}},window.takeRecordingSnapshot=async(n={})=>{try{const e=await apiFetch(ENDPOINTS.RECORDINGS_SNAPSHOT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),t=e.mappings?e.mappings.length:0;return NotificationManager.success(`Snapshot created! Captured ${t} mappings`),e.mappings||[]}catch(e){return Logger.error("RECORDING","Recording snapshot error:",e),NotificationManager.error(`Snapshot failed: ${e.message}`),[]}},window.clearRecordings=async()=>{if(confirm("Clear all recorded requests?"))try{await apiFetch(ENDPOINTS.REQUESTS,{method:"DELETE"}),window.recordedCount=0;const n=document.getElementById("recordings-list");n&&(n.innerHTML=""),typeof fetchAndRenderRequests=="function"&&await fetchAndRenderRequests(),NotificationManager.success("Recording log cleared.")}catch(n){Logger.error("RECORDING","Clear recordings error:",n),NotificationManager.error(`Failed to clear recordings: ${n.message}`)}},window.refreshRequests=async()=>{await fetchAndRenderRequests(),(document.getElementById(SELECTORS.REQUEST_FILTERS.METHOD)?.value||document.getElementById(SELECTORS.REQUEST_FILTERS.URL)?.value||document.getElementById(SELECTORS.REQUEST_FILTERS.STATUS)?.value||document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_FROM)?.value||document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_TO)?.value)&&FilterManager.applyRequestFilters()},window.applyQuickTimeFilter=()=>{const n=new Date,e=new Date(n.getTime()-1440*60*1e3),t=document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_FROM),i=document.getElementById(SELECTORS.REQUEST_FILTERS.DATE_TO);t&&(t.value=Utils.formatDateTime(e)),i&&(i.value=Utils.formatDateTime(n)),FilterManager.applyRequestFilters()},window.cleanupPendingDeletions=()=>{for(const[n,e]of window.deletionTimeouts)clearTimeout(e);window.deletionTimeouts.clear(),window.pendingDeletedIds.clear()},window.addEventListener("beforeunload",window.cleanupPendingDeletions),window.toggleElementById=n=>document.getElementById(n)?.classList.toggle("hidden"),window.togglePreview=n=>window.toggleElementById(`preview-${n}`),window.toggleRequestPreview=n=>window.toggleElementById(`request-preview-${n}`),window.getRequestCount=async(n={})=>{try{return(await apiFetch(ENDPOINTS.REQUESTS_COUNT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).count||0}catch(e){return Logger.error("REQUESTS","Request count error:",e),NotificationManager.error(`Request count failed: ${e.message}`),0}},window.findRequests=async n=>{try{return(await apiFetch(ENDPOINTS.REQUESTS_FIND,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).requests||[]}catch(e){return Logger.error("REQUESTS","Find requests error:",e),NotificationManager.error(`Request search failed: ${e.message}`),[]}},window.getUnmatchedRequests=async()=>{try{return(await apiFetch(ENDPOINTS.REQUESTS_UNMATCHED)).requests||[]}catch(n){return Logger.error("REQUESTS","Unmatched requests error:",n),[]}},window.findMappingsByMetadata=async n=>{try{return(await apiFetch(ENDPOINTS.MAPPINGS_FIND_BY_METADATA,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).mappings||[]}catch(e){return Logger.error("METADATA","Find mappings by metadata error:",e),[]}},Logger.info("UI","Features.js loaded - Business functions for mappings, requests, scenarios + WireMock 3.9.1+ API fixes"),window.updateLastSuccessUI=()=>{try{const n=document.getElementById(SELECTORS.CONNECTION.STATUS_TEXT);if(!n)return;const e=window.lastWiremockSuccess||Date.now(),t=new Date(e).toLocaleTimeString();n.textContent=`Last OK: ${t}`,Logger.info("HEALTH","last success UI updated:",{ts:e,time:t})}catch{}},window.applyHealthUI=(n,e)=>{try{window.healthState=window.healthState||{isHealthy:null,lastCheckAt:null,lastOkAt:null,lastLatencyMs:null},window.healthState.lastCheckAt=Date.now(),n===!0?(window.healthState.isHealthy=!0,window.healthState.lastOkAt=Date.now(),window.healthState.lastLatencyMs=typeof e=="number"?e:null):n===!1&&(window.healthState.isHealthy=!1,window.healthState.lastLatencyMs=null);const t=document.getElementById(SELECTORS.HEALTH.INDICATOR);if(t)if(t.style.display="inline",n===!0){const i=typeof e=="number"?`${e}ms`:"OK";t.innerHTML=`<span>Response Time: </span><span class="healthy">${i}</span>`}else n===!1?t.innerHTML='<span>Response Time: </span><span class="unhealthy">Unhealthy</span>':t.innerHTML='<span>Response Time: </span><span class="error">Error</span>';n===!0&&(window.lastWiremockSuccess=Date.now(),typeof window.updateLastSuccessUI=="function"&&window.updateLastSuccessUI())}catch(t){Logger.warn("HEALTH","applyHealthUI failed:",t)}};try{const n=localStorage.getItem("imock-show-meta-timestamps");n!==null&&(window.showMetaTimestamps=n==="1")}catch{}window.toggleMetaTimestamps=()=>{try{window.showMetaTimestamps=window.showMetaTimestamps===!1,localStorage.setItem("imock-show-meta-timestamps",window.showMetaTimestamps?"1":"0");const n=window.MappingsStore.getAll();Array.isArray(n)&&fetchAndRenderMappings(n)}catch(n){Logger.warn("METADATA","toggleMetaTimestamps failed:",n)}};const IMOCK_CACHE_ID="00000000-0000-0000-0000-00000000cace",IMOCK_CACHE_URL="/__imock/cache";function isImockCacheMapping(n){try{const e=(n?.id||n?.uuid)===IMOCK_CACHE_ID,t=n?.metadata?.imock?.type==="cache",i=(n?.name||"").toLowerCase()==="imock cache",r=(n?.request?.url||n?.request?.urlPath)===IMOCK_CACHE_URL;return!!(e||t||i||r)}catch{return!1}}function slimMapping(n){return{id:n.id||n.uuid,name:n.name||n.metadata?.name,priority:n.priority,persistent:n.persistent,scenarioName:n.scenarioName,requiredScenarioState:n.requiredScenarioState,newScenarioState:n.newScenarioState,request:{method:n.request?.method,url:n.request?.urlPath||n.request?.urlPathPattern||n.request?.urlPattern||n.request?.url||"N/A"},response:{status:n.response?.status},metadata:{created:n.metadata?.created,edited:n.metadata?.edited,source:n.metadata?.source}}}function buildSlimList(n){return{mappings:(n||[]).filter(t=>!isImockCacheMapping(t)).map(slimMapping)}}async function getCacheByFixedId(){try{Logger.cache("Trying fixed ID lookup...");const n=await apiFetch(`/mappings/${IMOCK_CACHE_ID}`);if(n&&isImockCacheMapping(n))return n;Logger.cache("Fixed ID miss")}catch(n){n.status===401||n.message&&n.message.includes("401")?Logger.warn("CACHE","Authorization error loading cache by fixed ID - check credentials"):n.status===404||n.message&&n.message.includes("404")?Logger.debug("CACHE","Cache mapping not found by fixed ID (404)"):Logger.debug("CACHE","Error loading cache by fixed ID:",n.message)}return null}async function upsertImockCacheMapping(n){Logger.cache("Upsert cache mapping start");const e=JSON.stringify(n||{});let t=0;for(let c=0;c<e.length;c++)t=t*31+e.charCodeAt(c)|0;const i=(t>>>0).toString(16),r={imock:{type:"cache",version:1,timestamp:Date.now(),count:(n?.mappings||[]).length,hash:i}},o={id:IMOCK_CACHE_ID,name:"iMock Cache",priority:1,persistent:!1,request:{method:"GET",url:IMOCK_CACHE_URL},response:{status:200,jsonBody:n,headers:{"Content-Type":"application/json; charset=utf-8"}},metadata:r};try{Logger.cache("PUT /mappings/{id}");const c=await apiFetch(`/mappings/${IMOCK_CACHE_ID}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return Logger.cache("Upsert done (PUT)"),c}catch{Logger.cache("PUT failed, POST /mappings");const c=await apiFetch("/mappings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});return Logger.cache("Upsert done (POST)"),c}}async function regenerateImockCache(n=null){Logger.cache("Regenerate cache start");const e=performance.now();let t=n;t||(t=await fetchMappingsFromServer({force:!0}));const i=t?.mappings||[];Logger.cache("Using fresh server data for cache regeneration");const r=buildSlimList(i);let o=r;try{const s=await upsertImockCacheMapping(r),l=extractCacheJsonBody(s);l&&(o=l)}catch(s){Logger.warn("CACHE","Upsert cache failed:",s)}const c=Math.round(performance.now()-e);return Logger.cache(`Regenerate cache done (${(o?.mappings||[]).length} items) in ${c}ms`),o}async function refreshImockCache(){Logger.cache("Refresh cache requested");try{const n=await regenerateImockCache();return typeof window.refreshMappingsFromCache=="function"&&window.refreshMappingsFromCache(),Logger.cache("Refresh cache completed"),n}catch(n){throw Logger.error("CACHE","Refresh cache failed:",n),n}}window.refreshImockCache=refreshImockCache;async function loadImockCacheBestOf3(){Logger.cache("loadImockCacheBestOf3 start (fixed-id only)");const n=await getCacheByFixedId();return n&&n.response?.jsonBody?(Logger.cache("Using cache: fixed id"),{source:"cache",data:n.response.jsonBody}):(Logger.cache("No cache found - will load from server"),null)}function cloneMappingForCache(n){if(!n)return null;try{if(typeof structuredClone=="function")return structuredClone(n)}catch(e){Logger.warn("CACHE","structuredClone failed for mapping cache clone:",e)}try{return JSON.parse(JSON.stringify(n))}catch(e){Logger.warn("CACHE","JSON clone failed for mapping cache clone:",e)}return{...n}}function mergeMappingData(n,e){return n?e?{...n,...e,request:{...n.request,...e.request},response:{...n.response,...e.response},metadata:{...n.metadata,...e.metadata}}:n:e}function syncCacheWithMappings(n){try{const e=window.MappingsStore;if(!e||!(e.items instanceof Map)||!Array.isArray(n))return;const t=e.items,i=new Set;n.forEach(c=>{if(!c||isImockCacheMapping(c))return;const s=c.id||c.uuid;if(!s)return;i.add(s);const l=cloneMappingForCache(c)||{...c};t.has(s)?t.set(s,mergeMappingData(t.get(s),l)):t.set(s,l)});const r=e.pending instanceof Map?Array.from(e.pending.values()):[],o=new Set;for(const c of r)!c||c.type==="delete"||c.id&&o.add(c.id);Array.from(t.keys()).forEach(c=>{!i.has(c)&&!o.has(c)&&t.delete(c)}),window.cacheLastUpdate=Date.now()}catch(e){Logger.warn("CACHE","syncCacheWithMappings failed:",e)}}function extractCacheJsonBody(n){try{if(!n||typeof n!="object")return null;if(n.response?.jsonBody)return n.response.jsonBody;if(n.mapping?.response?.jsonBody)return n.mapping.response.jsonBody;if(n.jsonBody?.mappings||Array.isArray(n.mappings))return{mappings:(Array.isArray(n.jsonBody?.mappings)?n.jsonBody.mappings:Array.isArray(n.mappings)?n.mappings:[]).map(t=>({...t}))}}catch(e){Logger.warn("CACHE","extractCacheJsonBody failed:",e)}return null}(function(e){function t(i={}){const{markDemoModeActive:r,notificationManager:o,fetchAndRenderMappings:c,fetchAndRenderRequests:s,isDatasetAvailable:l,getDataset:d}=i;if(typeof r!="function")throw new Error("Demo loader requires markDemoModeActive callback");if(!o||typeof o=="function")throw new Error("Demo loader requires a notification manager object");if(typeof c!="function")throw new Error("Demo loader requires fetchAndRenderMappings function");if(typeof s!="function")throw new Error("Demo loader requires fetchAndRenderRequests function");const f=o?.success?.bind(o)||o?.info?.bind(o)||(M=>Logger.warn("DEMO",M)),h=o?.error?.bind(o)||o?.warning?.bind(o)||(M=>Logger.warn("DEMO",M)),m=o?.warning?.bind(o)||o?.info?.bind(o)||(M=>Logger.warn("DEMO",M));return async function(){if(!(typeof l=="function"?l():!0))return h("Demo dataset is not available in this build."),{status:"unavailable",mappingsLoaded:!1,requestsLoaded:!1,errors:[]};const T=typeof d=="function"?d():null;if(!T)return h("Unable to load the demo dataset."),{status:"missing",mappingsLoaded:!1,requestsLoaded:!1,errors:[]};const g=Array.isArray(T.mappings)?T.mappings:[],y=Array.isArray(T.requests)?T.requests:[];r("manual-trigger");const[C,A]=await Promise.allSettled([c(g,{source:"demo"}),s(y,{source:"demo"})]),B=C.status==="fulfilled"?C.value!==!1:!1,X=A.status==="fulfilled"?A.value!==!1:!1,H=[];C.status==="rejected"&&H.push(C.reason),A.status==="rejected"&&H.push(A.reason);const le=B&&X?"success":B||X?"partial":"failed";return le==="success"?f("Demo data loaded locally. Explore the interface freely."):(m("Demo data only loaded partially. Check the console for details."),H.length&&h("Some demo data failed to load. Inspect console for details.")),{status:le,mappingsLoaded:B,requestsLoaded:X,errors:H}}}e.DemoMode={createLoader:t}})(typeof window<"u"?window:globalThis),(function(e){let t=!1;function i(r){if(t)return!0;if(!r)return!1;t=!0;const o=e,c=r,{markDemoModeActive:s,addMappingToIndex:l,rebuildMappingIndex:d,computeMappingTabTotals:f,refreshMappingTabSnapshot:h,computeRequestTabTotals:m,refreshRequestTabSnapshot:M,removeMappingFromIndex:I,fetchMappingsFromServer:T}=c;o.updateUptime=function(){if(!o.startTime)return;const U=Math.floor((Date.now()-o.startTime)/1e3),j=Math.floor(U/3600),F=Math.floor(U%3600/60),v=U%60,k=document.getElementById("uptime");k&&(j>0?k.textContent=`${j}h ${F}m ${v}s`:F>0?k.textContent=`${F}m ${v}s`:k.textContent=`${v}s`)},o.stopUptime=function(){o.uptimeInterval&&(o.LifecycleManager.clearInterval(o.uptimeInterval),o.uptimeInterval=null),o.startTime=null;const U=document.getElementById("uptime");U&&(U.textContent="0s")},o.checkHealth=async()=>{try{const U=document.getElementById("wiremock-host"),j=document.getElementById("wiremock-port");if(U&&j&&(U.value.trim()||j.value.trim())){const F=U.value.trim()||"localhost",v=j.value.trim()||"8080";typeof o.normalizeWiremockBaseUrl=="function"?o.wiremockBaseUrl=o.normalizeWiremockBaseUrl(F,v):o.wiremockBaseUrl=`http://${F}:${v}/__admin`,Logger.info("FEATURES","Updated WireMock URL from form:",o.wiremockBaseUrl)}await checkHealthAndStartUptime(),NotificationManager.success("Health check passed!")}catch(U){NotificationManager.error(`Health check failed: ${U.message}`)}},o.refreshMappings=async()=>{try{const U=typeof o.readWiremockSettings=="function"?o.readWiremockSettings():{},j=isCacheEnabled();await fetchAndRenderMappings(null,{useCache:j})&&NotificationManager.success("Mappings refreshed!")}catch(U){NotificationManager.error(`Failed to refresh mappings: ${U.message}`)}},o.forceRefreshCache=async()=>{try{if(!isCacheEnabled()){NotificationManager.warning("Cache is not enabled. Enable it in Settings first.");return}if(typeof o.refreshImockCache!="function"){NotificationManager.error("Cache service not available");return}const U=document.querySelector('[onclick="forceRefreshCache()"]');U&&(U.classList.add("is-loading"),U.disabled=!0);const j=await o.refreshImockCache();let F=!0;j&&typeof j=="object"&&(j.cacheMessage&&y(SELECTORS.IMPORT.RESULT,"info",j.cacheMessage),typeof j.useCache=="boolean"&&(F=j.useCache)),await fetchAndRenderMappings(null,{useCache:F})&&NotificationManager.success("Cache rebuilt and mappings refreshed!")}catch(U){NotificationManager.error(`Failed to rebuild cache: ${U.message}`)}finally{const U=document.querySelector('[onclick="forceRefreshCache()"]');U&&(U.classList.remove("is-loading"),U.disabled=!1)}};const g=o.DemoMode&&typeof o.DemoMode.createLoader=="function"?o.DemoMode.createLoader({markDemoModeActive:s,notificationManager:NotificationManager,fetchAndRenderMappings,fetchAndRenderRequests,isDatasetAvailable:()=>o.DemoData?.isAvailable?.(),getDataset:()=>o.DemoData?.getDataset?.()}):null;o.loadMockData=async()=>{if(!g)return NotificationManager.error("Demo mode is not available in this build."),{status:"unavailable",mappingsLoaded:!1,requestsLoaded:!1,errors:[]};o.demoModeLastError=null;const U=await g();if(U&&U.status!=="success"){const[j]=Array.isArray(U.errors)?U.errors:[];o.demoModeLastError=j||U.status}return o.demoModeLastResult=U,U},o.updateScenarioState=async()=>{const U=document.getElementById("scenario-select"),j=document.getElementById("scenario-state"),F=document.getElementById("scenario-update-btn");if(!U?.value||!j?.value){NotificationManager.warning("Please select scenario and enter state");return}F&&(F.disabled=!0);try{await o.setScenarioState()}finally{F&&(F.disabled=!1)}},o.updateFileDisplay=()=>{const U=document.getElementById(SELECTORS.IMPORT.FILE),j=document.getElementById(SELECTORS.IMPORT.DISPLAY),F=document.getElementById(SELECTORS.IMPORT.ACTIONS);if(!U||!j){Logger.warn("FEATURES","Import file elements not found.");return}if(U.files?.length>0){const v=U.files[0],k=v.size?` (${Math.round(v.size/1024)} KB)`:"";j.innerHTML=`<strong>${v.name}</strong>${k}`,F&&(F.style.display="block")}else j.innerHTML='<span class="file-placeholder">No file selected</span>',F&&(F.style.display="none")},o.updateRecorderLink=(U,j)=>{try{const F=document.getElementById("recorder-link");if(!F)return;const v=(U||"").trim();if(!v){F.removeAttribute("href"),F.setAttribute("title","Configure host in Settings to enable recorder link"),F.textContent="Recorder UI (configure host first)";return}let k=v;/^https?:\/\//i.test(k)||(k=`http://${k}`);const q=new URL(k);j&&String(j).trim()&&(q.port=String(j).trim()),q.pathname="/__admin/recorder/",F.href=q.toString(),F.textContent=q.toString(),F.removeAttribute("title")}catch(F){Logger.warn("FEATURES","Failed to update recorder link:",F)}};function y(U,j,F){const v=document.getElementById(U);if(!v)return;const k=j==="success"?"\u2705":j==="error"?"\u274C":"\u2139\uFE0F";v.textContent=`${k} ${F}`}function C(U,j,F){const v=new Blob([j],{type:F}),k=URL.createObjectURL(v),q=document.createElement("a");q.href=k,q.download=U,document.body.appendChild(q),q.click(),document.body.removeChild(q),setTimeout(()=>URL.revokeObjectURL(k),0)}function A(){if(o.elementCache?.has(SELECTORS.IMPORT.ACTIONS)){const F=o.elementCache.get(SELECTORS.IMPORT.ACTIONS);if(F){const v=F.querySelector("button");if(v)return v}}const U=document.getElementById(SELECTORS.IMPORT.ACTIONS);if(!U)return null;const j=U.querySelector("button");return j&&o.elementCache&&o.elementCache.set(SELECTORS.IMPORT.ACTIONS,U),j}function B(U){const j=A();j&&(j.classList.toggle("is-loading",U),j.disabled=U)}function X(U=null){if(U)return U;const j=document.getElementById(SELECTORS.IMPORT.MODE);return j&&j.value||"MERGE"}async function H(){const U=document.getElementById(SELECTORS.IMPORT.FILE);if(!U?.files?.length)throw new Error("Please select a file to import.");const j=U.files[0],F=await j.text(),v=j.name.split(".").pop()?.toLowerCase();if(v==="yaml"||v==="yml"){if(o.jsyaml?.load)return o.jsyaml.load(F);throw new Error("YAML parser is not available.")}try{return JSON.parse(F)}catch{throw new Error("Failed to parse JSON import file.")}}function le(U,j){if(!U||typeof U!="object")throw new Error("Import file is empty or malformed.");const F=JSON.parse(JSON.stringify(U)),v={};if(["meta","globalSettings","requestJournal","importSettings"].forEach(W=>{F&&Object.prototype.hasOwnProperty.call(F,W)&&(v[W]=F[W])}),Array.isArray(F))v.mappings=F;else if(Array.isArray(F.mappings))v.mappings=F.mappings;else if(F.mappings&&typeof F.mappings=="object"){if(Array.isArray(F.mappings.mappings))v.mappings=F.mappings.mappings;else if(Array.isArray(F.mappings.items))v.mappings=F.mappings.items;else{const ne=Object.values(F.mappings).filter(Boolean).filter(be=>typeof be=="object"&&(be.request||be.response));ne.length>0&&(v.mappings=ne)}!v.mappings&&(F.mappings.request||F.mappings.response)&&(v.mappings=[F.mappings])}else F.mappings?v.mappings=[F.mappings]:Array.isArray(F.mapping)?v.mappings=F.mapping:F.mapping?v.mappings=[F.mapping]:Array.isArray(F.stubs)?v.mappings=F.stubs:F.stubs&&typeof F.stubs=="object"?v.mappings=Object.values(F.stubs).filter(Boolean):(F.request||F.response)&&(v.mappings=[F]);if(!Array.isArray(v.mappings))throw new Error("No mappings array found in the import file.");if(v.mappings=v.mappings.filter(Boolean),v.mappings.length===0)throw new Error("The import file does not contain any mappings.");Object.keys(F).forEach(W=>{["mappings","mapping","importMode"].includes(W)||Object.prototype.hasOwnProperty.call(v,W)||(v[W]=F[W])});const q=j||F.importMode||"MERGE";return v.importMode=q,v}async function Se(U=null){try{B(!0),y(SELECTORS.IMPORT.RESULT,"info","Processing import file...");const j=await H(),F=X(U),v=le(j,F);v.importMode=F,await apiFetch(ENDPOINTS.MAPPINGS_IMPORT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)}),NotificationManager.success(`Imported ${v.mappings.length} mapping(s).`);const k=document.getElementById(SELECTORS.IMPORT.FILE);k&&(k.value="",o.updateFileDisplay());try{typeof o.refreshImockCache=="function"&&await o.refreshImockCache(),await fetchAndRenderMappings(null,{useCache:!1})}catch(q){Logger.warn("FEATURES","Failed to refresh mappings after import:",q)}y(SELECTORS.IMPORT.RESULT,"success",`Imported ${v.mappings.length} mapping(s) using mode ${F}.`)}catch(j){throw Logger.error("FEATURES","Import failed:",j),y(SELECTORS.IMPORT.RESULT,"error",j.message||"Import failed."),NotificationManager.error(`Import failed: ${j.message}`),j}finally{B(!1)}}return o.executeImport=Se,o.exportMappings=async()=>{const j=document.getElementById(SELECTORS.EXPORT.FORMAT)?.value||"json";y(SELECTORS.EXPORT.RESULT,"info","Preparing mappings export...");try{const v=(await apiFetch(ENDPOINTS.MAPPINGS))?.mappings||[],q=`wiremock-mappings-${new Date().toISOString().replace(/[:.]/g,"-")}`;if(j==="yaml"){if(!o.jsyaml?.dump)throw new Error("YAML serializer is not available.");const W=o.jsyaml.dump({mappings:v},{noRefs:!0});C(`${q}.yaml`,W.endsWith(`
`)?W:`${W}
`,"text/yaml")}else{const W=JSON.stringify({mappings:v},null,2);C(`${q}.json`,`${W}
`,"application/json")}y(SELECTORS.EXPORT.RESULT,"success",`Exported ${v.length} mapping(s) as ${j.toUpperCase()}.`),NotificationManager.success(`Exported ${v.length} mapping(s).`)}catch(F){Logger.error("FEATURES","Export mappings failed:",F),y(SELECTORS.EXPORT.RESULT,"error",F.message||"Failed to export mappings."),NotificationManager.error(`Failed to export mappings: ${F.message}`)}},o.exportRequests=async()=>{const j=document.getElementById(SELECTORS.EXPORT.FORMAT)?.value||"json";y(SELECTORS.EXPORT.RESULT,"info","Preparing request log export...");try{const v=(await apiFetch(ENDPOINTS.REQUESTS))?.requests||[],q=`wiremock-requests-${new Date().toISOString().replace(/[:.]/g,"-")}`;if(j==="yaml"){if(!o.jsyaml?.dump)throw new Error("YAML serializer is not available.");const W=o.jsyaml.dump({requests:v},{noRefs:!0});C(`${q}.yaml`,W.endsWith(`
`)?W:`${W}
`,"text/yaml")}else{const W=JSON.stringify({requests:v},null,2);C(`${q}.json`,`${W}
`,"application/json")}y(SELECTORS.EXPORT.RESULT,"success",`Exported ${v.length} request(s) as ${j.toUpperCase()}.`),NotificationManager.success(`Exported ${v.length} request(s).`)}catch(F){Logger.error("FEATURES","Export requests failed:",F),y(SELECTORS.EXPORT.RESULT,"error",F.message||"Failed to export request log."),NotificationManager.error(`Failed to export request log: ${F.message}`)}},!0}if(!i(e.FeaturesState)){let r=null;const o=c=>{const s=c&&c.detail&&c.detail.state||e.FeaturesState;return i(s)?(typeof e.removeEventListener=="function"&&e.removeEventListener("features:state-ready",o),r!==null&&(e.clearInterval(r),r=null),!0):!1};if(typeof e.addEventListener=="function"&&e.addEventListener("features:state-ready",o),typeof e.setInterval=="function"){let c=0;r=e.setInterval(()=>{c+=1,!o()&&c>=200&&(e.clearInterval(r),r=null,t||Logger.error("FEATURES","features.js could not find FeaturesState after waiting for 10 seconds."))},50)}}})(typeof window<"u"?window:globalThis),Logger.info("UI","\u2705 All required modules loaded successfully"),window.DEFAULT_SETTINGS={host:"localhost",port:"8080",requestTimeout:"69000",customHeaders:{},customHeadersRaw:"",cacheEnabled:!0,autoRefreshEnabled:!1,refreshInterval:"0",autoConnect:!0,cacheRebuildDelay:"1000",cacheValidationDelay:"1500",optimisticCacheAgeLimit:"30000",cacheCountDiffThreshold:"2",backgroundFetchDelay:"200"};const DEFAULT_SETTINGS=window.DEFAULT_SETTINGS;window.customHeaders={...DEFAULT_SETTINGS.customHeaders||{}};let autoConnectInitiated=!1;function getStoredSettings(){return window.SettingsStore&&typeof window.SettingsStore.getStoredSettings=="function"?window.SettingsStore.getStoredSettings():{}}function parseCustomHeadersInput(n){return window.SettingsStore&&typeof window.SettingsStore.parseCustomHeadersInput=="function"?window.SettingsStore.parseCustomHeadersInput(n):{headers:{},raw:""}}function serializeCustomHeaders(n){return window.SettingsStore&&typeof window.SettingsStore.serializeCustomHeaders=="function"?window.SettingsStore.serializeCustomHeaders(n):""}function shouldAutoConnect(n){return window.SettingsStore&&typeof window.SettingsStore.shouldAutoConnect=="function"?window.SettingsStore.shouldAutoConnect(n):!1}function showOnboardingOverlay(){const n=document.getElementById("onboarding-overlay");if(!n)return;n.classList.remove("hidden"),requestAnimationFrame(()=>{n.classList.add("visible")}),document.body&&document.body.classList.add("onboarding-active");const e=n.querySelector("#onboarding-host");e&&e.focus()}function hideOnboardingOverlay(){const n=document.getElementById("onboarding-overlay");n&&(n.classList.remove("visible"),setTimeout(()=>{n.classList.add("hidden")},220),document.body&&document.body.classList.remove("onboarding-active"))}function attemptAutoConnect(n,e={}){if(Logger.info("UI","\u{1F50C} [attemptAutoConnect] Called with settings:",n),Logger.info("UI","\u{1F50C} [attemptAutoConnect] Options:",e),Logger.info("UI","\u{1F50C} [attemptAutoConnect] shouldAutoConnect:",shouldAutoConnect(n)),Logger.info("UI","\u{1F50C} [attemptAutoConnect] autoConnectInitiated:",autoConnectInitiated),!shouldAutoConnect(n)){Logger.info("UI","\u26A0\uFE0F [attemptAutoConnect] Skipping - shouldAutoConnect returned false");return}if(autoConnectInitiated&&!e.force){Logger.info("UI","\u26A0\uFE0F [attemptAutoConnect] Skipping - already initiated and not forced");return}autoConnectInitiated=!0,Logger.info("UI","\u2705 [attemptAutoConnect] Proceeding with autoconnect");const t=()=>{try{Logger.info("UI","\u{1F50C} [attemptAutoConnect] Triggering connection...");const i=typeof window.connectToWireMock=="function"?window.connectToWireMock():null;i&&typeof i.catch=="function"&&i.catch(r=>{Logger.error("UI","\u274C Auto-connect failed:",r),autoConnectInitiated=!1})}catch(i){Logger.error("UI","\u274C Auto-connect encountered an error:",i),autoConnectInitiated=!1}};e.immediate?(Logger.info("UI","\u{1F50C} [attemptAutoConnect] Immediate mode - connecting now"),t()):(Logger.info("UI","\u{1F50C} [attemptAutoConnect] Delayed mode - connecting in 150ms"),setTimeout(t,150))}function initializeOnboardingFlow(){const n=document.getElementById("onboarding-overlay"),e=document.getElementById("onboarding-form"),t=document.getElementById("onboarding-host"),i=document.getElementById("onboarding-port"),r=document.getElementById("onboarding-headers"),o=document.getElementById("onboarding-auto-connect"),c=getStoredSettings(),s=!!(c.host&&c.port);Logger.info("UI","\u{1F527} [initializeOnboardingFlow] Settings:",c),Logger.info("UI","\u{1F527} [initializeOnboardingFlow] Has configuration:",s),Logger.info("UI","\u{1F527} [initializeOnboardingFlow] autoConnect setting:",c.autoConnect),t&&(t.value=c.host||DEFAULT_SETTINGS.host||""),i&&(i.value=c.port||DEFAULT_SETTINGS.port||""),r&&(r.value=serializeCustomHeaders(c)),o&&(o.checked=c.autoConnect!==!1),s?(Logger.info("UI","\u2705 [initializeOnboardingFlow] Configuration found - attempting autoconnect"),attemptAutoConnect(c)):(Logger.info("UI","\u26A0\uFE0F [initializeOnboardingFlow] No configuration - showing onboarding overlay"),showOnboardingOverlay()),e&&e.addEventListener("submit",l=>{l.preventDefault();const d=t?.value.trim(),f=i?.value.trim();if(!d){typeof NotificationManager<"u"&&NotificationManager.error("Host is required."),t?.focus();return}let h;try{h=parseCustomHeadersInput(r?.value??"")}catch(M){Logger.error("UI","Failed to parse onboarding headers:",M),typeof NotificationManager<"u"&&NotificationManager.error(M.message),r?.focus();return}const m={...DEFAULT_SETTINGS,...getStoredSettings(),host:d,port:f||DEFAULT_SETTINGS.port,customHeaders:h.headers,customHeadersRaw:h.raw,autoConnect:o?o.checked:DEFAULT_SETTINGS.autoConnect};localStorage.setItem("wiremock-settings",JSON.stringify(m)),window.customHeaders={...m.customHeaders||{}},loadSettings(),loadConnectionSettings(),hideOnboardingOverlay(),shouldAutoConnect(m)?attemptAutoConnect(m,{immediate:!0,force:!0}):typeof NotificationManager<"u"&&NotificationManager.info("Connection saved. You can connect from the dashboard when you are ready.")},{once:!1})}window.initializeOnboardingFlow=initializeOnboardingFlow,window.attemptAutoConnect=attemptAutoConnect,window.hideOnboardingOverlay=hideOnboardingOverlay,window.editMapping=n=>{Logger.info("UI","\u{1F527} Opening editor for mapping:",n);const e=getStoredSettings(),t=encodeURIComponent(JSON.stringify(e)),i=`editor/json-editor.html?mappingId=${n}&mode=edit&settings=${t}`,r=window.open(i,`editor_${n}`,"width=1200,height=800,scrollbars=yes,resizable=yes,status=yes");if(!r){NotificationManager.error("Popup blocked. Please allow popups for this site.");return}NotificationManager.info(`Editor opened for mapping ${n}`);const o=window.LifecycleManager.setNamedInterval("editor-close-watch",()=>{r.closed&&(window.LifecycleManager.clearInterval(o),Logger.info("UI","\u{1F504} Editor closed, updating counters only"),Utils.safeCall(window.updateMappingsCounter),Utils.safeCall(window.updateRequestsCounter))},1e3);window.LifecycleManager.setTimeout(()=>{r.closed||(window.LifecycleManager.clearInterval(o),Logger.info("UI","\u{1F504} Editor interval cleaned up after timeout"))},300*1e3)};function computeSwaggerUiUrl(n,e){const t=(n??"").toString().trim(),i=(e??"").toString().trim();if(!t&&!i)return null;try{const r=typeof window.normalizeWiremockBaseUrl=="function"?window.normalizeWiremockBaseUrl(t,i):`http://${t||"localhost"}:${i||"8080"}/__admin`;return r?`${r.replace(/\/?$/,"")}/swagger-ui/`:null}catch(r){return Logger.warn("UI","Failed to compute Swagger UI URL:",r),null}}window.updateSwaggerUILink=(n,e)=>{const t=document.getElementById("swagger-ui-link"),i=document.getElementById("swagger-ui-link-hint");if(!t)return;const r=n??document.getElementById("default-host")?.value??"",o=e??document.getElementById("default-port")?.value??"",c=computeSwaggerUiUrl(r,o);c?(t.href=c,t.textContent=c,t.classList.remove("is-disabled"),t.removeAttribute("aria-disabled"),i&&(i.textContent="Opens the WireMock Admin Swagger UI in a new tab.")):(t.removeAttribute("href"),t.textContent="Define host and port to enable Swagger UI link",t.classList.add("is-disabled"),t.setAttribute("aria-disabled","true"),i&&(i.textContent="We build this link from your saved connection details."))},window.saveSettings=()=>{try{const n=document.getElementById("cache-enabled"),e=document.getElementById("auto-refresh-enabled"),t=document.getElementById("auto-connect-enabled"),i=document.getElementById("custom-headers");let r;try{r=parseCustomHeadersInput(i?.value??"")}catch(l){Logger.error("UI","Failed to parse custom headers:",l),typeof NotificationManager<"u"&&NotificationManager.error(l.message),i?.focus();return}const o={...DEFAULT_SETTINGS,...getStoredSettings(),host:document.getElementById("default-host")?.value||DEFAULT_SETTINGS.host,port:document.getElementById("default-port")?.value||DEFAULT_SETTINGS.port,requestTimeout:document.getElementById("request-timeout")?.value||DEFAULT_SETTINGS.requestTimeout,cacheEnabled:n?.checked??DEFAULT_SETTINGS.cacheEnabled,autoRefreshEnabled:e?.checked??DEFAULT_SETTINGS.autoRefreshEnabled,refreshInterval:document.getElementById("refresh-interval")?.value||DEFAULT_SETTINGS.refreshInterval,cacheRebuildDelay:document.getElementById("cache-rebuild-delay")?.value||DEFAULT_SETTINGS.cacheRebuildDelay,cacheValidationDelay:document.getElementById("cache-validation-delay")?.value||DEFAULT_SETTINGS.cacheValidationDelay,optimisticCacheAgeLimit:document.getElementById("optimistic-cache-age-limit")?.value||DEFAULT_SETTINGS.optimisticCacheAgeLimit,cacheCountDiffThreshold:document.getElementById("cache-count-diff-threshold")?.value||DEFAULT_SETTINGS.cacheCountDiffThreshold,backgroundFetchDelay:document.getElementById("background-fetch-delay")?.value||DEFAULT_SETTINGS.backgroundFetchDelay,autoConnect:t?.checked??DEFAULT_SETTINGS.autoConnect,customHeaders:r.headers,customHeadersRaw:r.raw},c=document.getElementById("wiremock-host"),s=document.getElementById("wiremock-port");c&&(c.value=o.host),s&&(s.value=o.port),localStorage.setItem("wiremock-settings",JSON.stringify(o)),Logger.info("UI","\u{1F527} [main.js] Settings saved to localStorage:",o),Logger.info("UI","\u{1F527} [main.js] Request timeout field value:",document.getElementById("request-timeout")?.value),typeof window.normalizeWiremockBaseUrl=="function"?window.wiremockBaseUrl=window.normalizeWiremockBaseUrl(o.host,o.port):window.wiremockBaseUrl=`http://${o.host}:${o.port}/__admin`,window.customHeaders={...o.customHeaders||{}},broadcastSettingsUpdate(o),NotificationManager.success("Settings saved successfully!"),Logger.info("UI","\u{1F4BE} Settings saved:",o),typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink(o.host,o.port)}catch(n){Logger.error("UI","Error saving settings:",n),NotificationManager.error("Failed to save settings")}},window.resetSettings=()=>{if(confirm("Reset all settings to defaults?"))try{const n={host:document.getElementById("default-host"),port:document.getElementById("default-port"),timeout:document.getElementById("request-timeout"),cacheEnabled:document.getElementById("cache-enabled"),autoRefresh:document.getElementById("auto-refresh-enabled"),refreshInterval:document.getElementById("refresh-interval"),customHeaders:document.getElementById("custom-headers"),autoConnect:document.getElementById("auto-connect-enabled")};n.host&&(n.host.value=DEFAULT_SETTINGS.host),n.port&&(n.port.value=DEFAULT_SETTINGS.port),n.timeout&&(n.timeout.value=DEFAULT_SETTINGS.requestTimeout),n.cacheEnabled&&(n.cacheEnabled.checked=DEFAULT_SETTINGS.cacheEnabled),n.autoRefresh&&(n.autoRefresh.checked=DEFAULT_SETTINGS.autoRefreshEnabled),n.refreshInterval&&(n.refreshInterval.value=DEFAULT_SETTINGS.refreshInterval),n.customHeaders&&(n.customHeaders.value=DEFAULT_SETTINGS.customHeadersRaw||""),n.autoConnect&&(n.autoConnect.checked=DEFAULT_SETTINGS.autoConnect),localStorage.setItem("wiremock-settings",JSON.stringify(DEFAULT_SETTINGS)),window.wiremockBaseUrl=`http://${DEFAULT_SETTINGS.host}:${DEFAULT_SETTINGS.port}/__admin`,window.customHeaders={...DEFAULT_SETTINGS.customHeaders||{}},broadcastSettingsUpdate(DEFAULT_SETTINGS),typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink(DEFAULT_SETTINGS.host,DEFAULT_SETTINGS.port),NotificationManager.success("Settings reset to defaults!"),Logger.info("UI","\u{1F504} Settings reset to defaults")}catch(n){Logger.error("UI","Error resetting settings:",n),NotificationManager.error("Failed to reset settings")}},window.loadSettings=()=>{try{const n=getStoredSettings();Logger.info("UI","\u{1F527} [main.js] Loading settings from localStorage:",n);const e={host:document.getElementById("default-host"),port:document.getElementById("default-port"),timeout:document.getElementById("request-timeout"),cacheEnabled:document.getElementById("cache-enabled"),autoRefresh:document.getElementById("auto-refresh-enabled"),refreshInterval:document.getElementById("refresh-interval"),cacheRebuildDelay:document.getElementById("cache-rebuild-delay"),cacheValidationDelay:document.getElementById("cache-validation-delay"),optimisticCacheAgeLimit:document.getElementById("optimistic-cache-age-limit"),cacheCountDiffThreshold:document.getElementById("cache-count-diff-threshold"),backgroundFetchDelay:document.getElementById("background-fetch-delay"),customHeaders:document.getElementById("custom-headers"),autoConnect:document.getElementById("auto-connect-enabled")};if(e.host&&(e.host.value=n.host||DEFAULT_SETTINGS.host),e.port&&(e.port.value=n.port||DEFAULT_SETTINGS.port),e.timeout&&(e.timeout.value=n.requestTimeout||DEFAULT_SETTINGS.requestTimeout),e.cacheEnabled&&(e.cacheEnabled.checked=n.cacheEnabled!==void 0?n.cacheEnabled:DEFAULT_SETTINGS.cacheEnabled),e.autoRefresh&&(e.autoRefresh.checked=n.autoRefreshEnabled!==void 0?n.autoRefreshEnabled:DEFAULT_SETTINGS.autoRefreshEnabled),e.refreshInterval&&(e.refreshInterval.value=n.refreshInterval||DEFAULT_SETTINGS.refreshInterval),e.cacheRebuildDelay&&(e.cacheRebuildDelay.value=n.cacheRebuildDelay||DEFAULT_SETTINGS.cacheRebuildDelay),e.cacheValidationDelay&&(e.cacheValidationDelay.value=n.cacheValidationDelay||DEFAULT_SETTINGS.cacheValidationDelay),e.optimisticCacheAgeLimit&&(e.optimisticCacheAgeLimit.value=n.optimisticCacheAgeLimit||DEFAULT_SETTINGS.optimisticCacheAgeLimit),e.cacheCountDiffThreshold&&(e.cacheCountDiffThreshold.value=n.cacheCountDiffThreshold||DEFAULT_SETTINGS.cacheCountDiffThreshold),e.backgroundFetchDelay&&(e.backgroundFetchDelay.value=n.backgroundFetchDelay||DEFAULT_SETTINGS.backgroundFetchDelay),e.customHeaders&&(e.customHeaders.value=serializeCustomHeaders(n)),e.autoConnect&&(e.autoConnect.checked=n.autoConnect!==!1),window.customHeaders=n.customHeaders&&typeof n.customHeaders=="object"&&!Array.isArray(n.customHeaders)?{...n.customHeaders}:{...DEFAULT_SETTINGS.customHeaders||{}},Logger.info("UI","\u{1F4CB} Settings loaded into settings form"),typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink(n.host,n.port),typeof window.updateRecorderLink=="function")try{window.updateRecorderLink(n.host,n.port)}catch(t){Logger.warn("UI","Failed to update recorder link:",t)}}catch(n){Logger.error("UI","Error loading settings:",n)}};function broadcastSettingsUpdate(n){try{localStorage.setItem("wiremock-settings-broadcast",JSON.stringify({timestamp:Date.now(),settings:n})),Logger.info("UI","\u{1F4E1} Broadcasting settings update to editor windows")}catch(e){Logger.warn("UI","Failed to broadcast settings update:",e)}}if(window.wiremockBaseUrl||(window.wiremockBaseUrl=`http://${DEFAULT_SETTINGS.host}:${DEFAULT_SETTINGS.port}/__admin`,Logger.info("UI","\u{1F527} [main.js] Initialized default WireMock URL:",window.wiremockBaseUrl)),window.applyDefaultsToForm=()=>{Logger.info("UI","\u{1F527} [applyDefaultsToForm] Setting form defaults from DEFAULT_SETTINGS");const n=document.getElementById("default-host"),e=document.getElementById("default-port"),t=document.getElementById("request-timeout"),i=document.getElementById("cache-enabled"),r=document.getElementById("auto-refresh-enabled"),o=document.getElementById("refresh-interval"),c=document.getElementById("custom-headers"),s=document.getElementById("auto-connect-enabled");n&&!n.value&&(n.value=DEFAULT_SETTINGS.host),e&&!e.value&&(e.value=DEFAULT_SETTINGS.port),t&&!t.value&&(t.value=DEFAULT_SETTINGS.requestTimeout),i&&(i.checked=DEFAULT_SETTINGS.cacheEnabled),r&&(r.checked=DEFAULT_SETTINGS.autoRefreshEnabled),o&&!o.value&&(o.value=DEFAULT_SETTINGS.refreshInterval),c&&!c.value&&(c.value=DEFAULT_SETTINGS.customHeadersRaw||""),s&&(s.checked=DEFAULT_SETTINGS.autoConnect),Logger.info("UI","\u{1F527} [applyDefaultsToForm] Form defaults applied")},document.addEventListener("DOMContentLoaded",async()=>{if(await new Promise(c=>requestAnimationFrame(c)),window.location.pathname.includes("json-editor.html")||window.location.search.includes("mappingId=")||window.location.search.includes("mode=edit")||window.location.search.includes("mode=create")){Logger.info("UI","\u{1F4DD} JSON Editor page detected - skipping main app initialization");return}typeof window.initializeSidebarPreference=="function"&&window.initializeSidebarPreference(),applyDefaultsToForm(),loadSettings(),loadConnectionSettings(),typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink();const e=document.getElementById("default-host"),t=document.getElementById("default-port"),i=()=>{typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink()};e?.addEventListener("input",i),t?.addEventListener("input",i),e?.addEventListener("change",i),t?.addEventListener("change",i),Logger.info("UI","\u{1F527} [main.js] Page loaded, defaults applied, settings initialized, ready for user interaction"),typeof window.initializeFilterTabs=="function"&&window.initializeFilterTabs(),typeof window.initMappingPagination=="function"&&window.initMappingPagination(),typeof window.FilterManager?.restoreFilters=="function"&&(window.FilterManager.restoreFilters("mappings"),typeof window.updateActiveFiltersDisplay=="function"&&window.updateActiveFiltersDisplay(),window.FilterManager.restoreFilters("requests"),typeof window.updateRequestActiveFiltersDisplay=="function"&&window.updateRequestActiveFiltersDisplay()),typeof window.loadAllSavedFilters=="function"&&window.loadAllSavedFilters();const r=typeof window.getActiveTabFromURL=="function"?window.getActiveTabFromURL():null;r&&["mappings","requests","scenarios","import-export","recording","settings"].includes(r)&&typeof window.showPage=="function"&&(Logger.info("UI",`\u{1F517} Switching to tab from URL: ${r}`),window.showPage(r,document.querySelector(`[onclick*="showPage('${r}')"]`))),initializeOnboardingFlow()}),window.addEventListener("popstate",()=>{if(Logger.info("UI","\u2B05\uFE0F Browser navigation detected, syncing filters from URL"),typeof window.URLStateManager>"u")return;const n=window.TabManager?.getCurrentTab();n==="mappings"?(window.URLStateManager.syncUIFromURL("mappings"),typeof window.FilterManager<"u"&&window.FilterManager.flushMappingFilters()):n==="requests"&&(window.URLStateManager.syncUIFromURL("requests"),typeof window.FilterManager<"u"&&window.FilterManager.flushRequestFilters())}),window.addEventListener("storage",n=>{if(n.key==="wiremock-settings"&&n.newValue)try{const e=JSON.parse(n.newValue);Logger.info("UI","\u{1F527} [main.js] Settings updated from external source:",e);const t=document.getElementById("wiremock-host"),i=document.getElementById("wiremock-port");t&&e.host&&(t.value=e.host),i&&e.port&&(i.value=e.port),e.host&&e.port&&(typeof window.normalizeWiremockBaseUrl=="function"?window.wiremockBaseUrl=window.normalizeWiremockBaseUrl(e.host,e.port):window.wiremockBaseUrl=`http://${e.host}:${e.port}/__admin`,Logger.info("UI","\u{1F527} [main.js] URL updated from settings change:",window.wiremockBaseUrl)),typeof window.updateSwaggerUILink=="function"&&window.updateSwaggerUILink(e.host,e.port),e.customHeaders&&typeof e.customHeaders=="object"&&!Array.isArray(e.customHeaders)?window.customHeaders={...e.customHeaders}:window.customHeaders={}}catch(e){Logger.error("UI","\u{1F527} [main.js] Error processing settings update:",e)}}),window.addEventListener("message",n=>{if(n.origin===window.location.origin){if(n.data&&n.data.type==="imock-cache-refresh"&&(Logger.info("UI","\u{1F4E8} [main.js] Received cache refresh request from:",n.data.source),typeof window.refreshImockCache=="function"&&window.refreshImockCache().catch(e=>{Logger.warn("UI","Failed to refresh cache from message:",e)})),n.data&&n.data.type==="imock-optimistic-mapping-update"&&(Logger.info("UI","\u{1F3AF} [main.js] Received optimistic mapping update from:",n.data.source,n.data.mapping.id),typeof window.applyOptimisticMappingUpdate=="function"&&(window.applyOptimisticMappingUpdate(n.data.mapping),typeof window.fetchAndRenderMappings=="function"))){Logger.info("UI","\u{1F3AF} [main.js] Triggering UI refresh after optimistic update");const e=window.MappingsStore.getAll();window.fetchAndRenderMappings(e)}n.data&&n.data.type==="imock-optimistic-cache-update"&&(Logger.info("UI","\u{1F9E9} [main.js] Received optimistic cache update from:",n.data.source,n.data.operation,n.data.mapping?.id),typeof window.updateOptimisticCache=="function"&&window.updateOptimisticCache(n.data.mapping,n.data.operation))}}),window.addEventListener("storage",n=>{if(n.key==="imock-cache-refresh-trigger"&&n.newValue&&(Logger.info("UI","\u{1F4BE} [main.js] Received localStorage cache refresh trigger"),typeof window.refreshImockCache=="function"&&window.refreshImockCache().catch(e=>{Logger.warn("UI","Failed to refresh cache from localStorage trigger:",e)})),n.key==="imock-optimistic-update"&&n.newValue)try{const e=JSON.parse(n.newValue);if(Logger.info("UI","\u{1F3AF} [main.js] Received localStorage optimistic update from:",e.source,"for mapping:",e.mapping?.id),e.mapping&&typeof window.applyOptimisticMappingUpdate=="function"){if(window.applyOptimisticMappingUpdate(e.mapping),typeof window.fetchAndRenderMappings=="function"){Logger.info("UI","\u{1F3AF} [main.js] Triggering UI refresh after localStorage optimistic update");const t=window.MappingsStore.getAll();window.fetchAndRenderMappings(t)}typeof window.updateMappingsCounter=="function"&&window.updateMappingsCounter()}}catch(e){Logger.warn("UI","Failed to process optimistic update from localStorage:",e)}}),typeof BroadcastChannel<"u")try{const n=new BroadcastChannel("imock-cache-refresh"),e=new BroadcastChannel("imock-optimistic-updates");n.addEventListener("message",t=>{t.data&&t.data.type==="cache-refresh"&&(Logger.info("UI","\u{1F4E1} [main.js] Received BroadcastChannel cache refresh from:",t.data.source),typeof window.refreshImockCache=="function"&&window.refreshImockCache().catch(i=>{Logger.warn("UI","Failed to refresh cache from BroadcastChannel:",i)}))}),e.addEventListener("message",t=>{if(t.data&&t.data.type==="optimistic-mapping-update"&&(Logger.info("UI","\u{1F3AF} [main.js] Received BroadcastChannel optimistic update from:",t.data.source,t.data.mapping.id),typeof window.applyOptimisticMappingUpdate=="function"&&(window.applyOptimisticMappingUpdate(t.data.mapping),typeof window.fetchAndRenderMappings=="function"))){Logger.info("UI","\u{1F3AF} [main.js] Triggering UI refresh after BroadcastChannel optimistic update");const i=window.MappingsStore.getAll();window.fetchAndRenderMappings(i)}}),window.addEventListener("beforeunload",()=>{n.close(),e.close()})}catch(n){Logger.warn("UI","BroadcastChannel setup failed:",n)}function loadConnectionSettings(){try{const n=getStoredSettings();Logger.info("UI","\u{1F527} [loadConnectionSettings] Loading settings:",n);const e=document.getElementById("wiremock-host"),t=document.getElementById("wiremock-port");e&&n.host&&(e.value=n.host,Logger.info("UI","\u{1F527} [loadConnectionSettings] Set host input:",n.host)),t&&n.port&&(t.value=n.port,Logger.info("UI","\u{1F527} [loadConnectionSettings] Set port input:",n.port)),Logger.info("UI","\u{1F527} [loadConnectionSettings] Form fields updated, URL will be set by connectToWireMock()")}catch(n){Logger.error("UI","Error loading connection settings:",n),Logger.info("UI","\u{1F527} [loadConnectionSettings] Error loading settings, form fields may remain empty")}}function convertJSONToYAML(n,e=0){const t="  ".repeat(e);if(Array.isArray(n))return n.length===0?`${t}[]`:n.map(i=>{if(isPlainObject(i)||Array.isArray(i)){const r=convertJSONToYAML(i,e+1).split(`
`),o=r.shift()||"";let c=`${t}- ${o.trimStart()}`;return r.length>0&&(c+=`
${r.join(`
`)}`),c}return`${t}- ${formatYAMLScalar(i)}`}).join(`
`);if(isPlainObject(n)){const i=Object.keys(n);return i.length===0?`${t}{}`:i.map(r=>{const o=formatYAMLKey(r),c=n[r];if(isPlainObject(c)||Array.isArray(c)){const s=convertJSONToYAML(c,e+1);return`${t}${o}:
${s}`}return`${t}${o}: ${formatYAMLScalar(c)}`}).join(`
`)}return`${t}${formatYAMLScalar(n)}`}function formatYAMLScalar(n){if(n==null)return"null";if(typeof n=="number"||typeof n=="boolean")return String(n);if(n instanceof Date)return JSON.stringify(n.toISOString());if(typeof n=="string"){if(n==="")return'""';const e=/^[A-Za-z0-9_\-]+$/,t=/^(?:true|false|null|yes|no|on|off|~)$/i;return e.test(n)&&!t.test(n)||!/[\n\r]/.test(n)&&!/^\s|\s$/.test(n)&&!/[#:>{}\[\],&*?]|!/.test(n)?n:JSON.stringify(n)}return JSON.stringify(n)}function formatYAMLKey(n){return typeof n=="string"&&/^[A-Za-z0-9_\-]+$/.test(n)?n:JSON.stringify(n)}function isPlainObject(n){return Object.prototype.toString.call(n)==="[object Object]"}function convertPathArrayToJSONPath(n){if(!Array.isArray(n)||n.length===0)return"$";let e="$";for(let t=1;t<n.length;t++){const i=n[t];if(typeof i=="number")e+=`[${i}]`;else if(typeof i=="string")if(isSimpleJsonPathSegment(i))e+=`.${i}`;else{const r=i.replace(/'/g,"\\'");e+=`['${r}']`}else i!=null&&(e+=`[${String(i)}]`)}return e}function convertPathArrayToPointer(n){if(!Array.isArray(n)||n.length===0)return"$";let e="$";for(let t=1;t<n.length;t++){const i=n[t];e=appendPointerSegment(e,i)}return e}function appendPointerSegment(n,e){return typeof e=="number"?`${n}/${e}`:`${n}/${escapeJsonPointerSegment(e)}`}function escapeJsonPointerSegment(n){return String(n).replace(/~/g,"~0").replace(/\//g,"~1")}function isSimpleJsonPathSegment(n){return/^[A-Za-z_][A-Za-z0-9_]*$/.test(n)}function buildJSONPointerLocator(n){if(typeof n!="string"||n.length===0)return null;try{const e=new Map,t=n.length,i=[0];for(let T=0;T<t;T++)n[T]===`
`&&i.push(T+1);let r=0;const o=T=>{T<0&&(T=0),T>t&&(T=t);let g=0,y=i.length-1;for(;g<=y;){const B=Math.floor((g+y)/2),X=i[B],H=B+1<i.length?i[B+1]:t+1;if(T<X)y=B-1;else if(T>=H)g=B+1;else return{lineNumber:B+1,column:T-X+1}}const C=i.length-1,A=i[C]||0;return{lineNumber:C+1,column:T-A+1}},c=()=>{for(;r<t;){const T=n[r];if(T===" "||T==="	"||T===`
`||T==="\r")r++;else break}},s=(T,g,y)=>{T&&g<=y&&e.set(T,{start:g,end:y})},l=T=>{if(c(),r>=t)throw new Error("Unexpected end of JSON input");const g=n[r];if(g==="{"){d(T);return}if(g==="["){f(T);return}if(g==='"'){const{start:y,end:C}=h();s(T,y,C);return}if(g==="-"||I(g)){const{start:y,end:C}=m();s(T,y,C);return}if(n.startsWith("true",r)){const{start:y,end:C}=M("true");s(T,y,C);return}if(n.startsWith("false",r)){const{start:y,end:C}=M("false");s(T,y,C);return}if(n.startsWith("null",r)){const{start:y,end:C}=M("null");s(T,y,C);return}throw new Error(`Unexpected token ${g} at position ${r}`)},d=T=>{const g=r;if(r++,c(),r<t&&n[r]==="}"){r++,s(T,g,r);return}for(;r<t;){if(n[r]!=='"')throw new Error("Expected string for object key");const{value:y}=h();if(c(),n[r]!==":")throw new Error("Expected colon after object key");r++;const C=appendPointerSegment(T,y);l(C),c();const A=n[r];if(A===","){r++,c();continue}if(A==="}"){r++,s(T,g,r);return}throw new Error("Expected comma or closing brace in object")}throw new Error("Unterminated object literal")},f=T=>{const g=r;if(r++,c(),r<t&&n[r]==="]"){r++,s(T,g,r);return}let y=0;for(;r<t;){const C=appendPointerSegment(T,y);l(C),y++,c();const A=n[r];if(A===","){r++,c();continue}if(A==="]"){r++,s(T,g,r);return}throw new Error("Expected comma or closing bracket in array")}throw new Error("Unterminated array literal")},h=()=>{const T=r;r++;let g="";for(;r<t;){const y=n[r];if(y==='"')return r++,{value:g,start:T,end:r};if(y==="\\"){if(r++,r>=t)throw new Error("Unterminated string literal");const C=n[r];switch(C){case'"':case"\\":case"/":g+=C;break;case"b":g+="\b";break;case"f":g+="\f";break;case"n":g+=`
`;break;case"r":g+="\r";break;case"t":g+="	";break;case"u":const A=n.slice(r+1,r+5);if(!/^[0-9a-fA-F]{4}$/.test(A))throw new Error("Invalid Unicode escape sequence");g+=String.fromCharCode(parseInt(A,16)),r+=4;break;default:g+=C;break}}else g+=y;r++}throw new Error("Unterminated string literal")},m=()=>{const T=r;if(n[r]==="-"&&r++,n[r]==="0")r++;else{if(!I(n[r]))throw new Error("Invalid number literal");for(;r<t&&I(n[r]);)r++}if(n[r]==="."){if(r++,!I(n[r]))throw new Error("Invalid number literal");for(;r<t&&I(n[r]);)r++}if(n[r]==="e"||n[r]==="E"){if(r++,(n[r]==="+"||n[r]==="-")&&r++,!I(n[r]))throw new Error("Invalid number literal");for(;r<t&&I(n[r]);)r++}return{start:T,end:r}},M=T=>{const g=r;if(n.slice(r,r+T.length)!==T)throw new Error(`Expected literal ${T}`);return r+=T.length,{start:g,end:r}},I=T=>T>="0"&&T<="9";return l("$"),c(),{getRange(T){if(!e.has(T))return null;const g=e.get(T),y=o(g.start),C=o(g.end);return{startLineNumber:y.lineNumber,startColumn:y.column,endLineNumber:C.lineNumber,endColumn:C.column}}}}catch(e){return console.warn("Failed to build JSON pointer locator:",e),null}}const TEMPLATE_CATEGORY_LABELS={basic:"Basic",advanced:"Advanced",testing:"Testing",integration:"Integration",proxy:"Proxy"};function getTemplateLibrarySnapshot(){return window.MonacoTemplateLibrary&&typeof window.MonacoTemplateLibrary.getAll=="function"?window.MonacoTemplateLibrary.getAll():[]}function formatRelativeTime(n){if(!n)return"\u2014";const e=Date.now(),t=n-e,i=Math.abs(t),r=[{limit:60*1e3,divisor:1e3,unit:"second"},{limit:3600*1e3,divisor:60*1e3,unit:"minute"},{limit:1440*60*1e3,divisor:3600*1e3,unit:"hour"},{limit:10080*60*1e3,divisor:1440*60*1e3,unit:"day"},{limit:720*60*60*1e3,divisor:10080*60*1e3,unit:"week"},{limit:1/0,divisor:720*60*60*1e3,unit:"month"}],o=typeof Intl<"u"&&Intl.RelativeTimeFormat?new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}):null;for(const{limit:c,divisor:s,unit:l}of r)if(i<c){const d=Math.round(t/s);if(o)return o.format(d,l);const f=d<0?"ago":"from now";return`${Math.abs(d)} ${l}${Math.abs(d)!==1?"s":""} ${f}`}return new Date(n).toLocaleString()}function formatBytes(n){if(!Number.isFinite(n)||n<=0)return"0 B";const e=[{limit:1024,suffix:"B",divisor:1},{limit:1024*1024,suffix:"KB",divisor:1024},{limit:1024*1024*1024,suffix:"MB",divisor:1024*1024}];for(const{limit:i,suffix:r,divisor:o}of e)if(n<i){const c=n/o;return r==="B"?`${Math.round(c)} ${r}`:`${c>=100?Math.round(c):c.toFixed(1)} ${r}`}return`${(n/(1024*1024*1024)).toFixed(2)} GB`}const HISTORY_DB_NAME="imock-history-ak",HISTORY_DB_VERSION=1,HISTORY_FRAMES_STORE="frames",HISTORY_SHA_STORE="shaIndex",HISTORY_LOCK_KEY="imock-history-lock",HISTORY_LOCK_TTL=3e3,DEBOUNCE_MS=1e4,MIN_DELTA_LEN=200,DEFAULT_HISTORY_BUDGET=50*1024*1024,IOS_HISTORY_BUDGET=30*1024*1024,LARGE_DIGEST_THRESHOLD=1e6,HEADER_PARENT_KEYS=new Set(["headers"]),IGNORED_KEYS=new Set(["id","uuid","updatedAt","insertionIndex"]);function isInsideJsonBody(n){return!n||!Array.isArray(n.path)?!1:n.path.includes("jsonBody")}function detectHistoryBudget(){if(typeof navigator>"u")return DEFAULT_HISTORY_BUDGET;const n=navigator.userAgent||"";return/iphone|ipad|ipod/i.test(n)?IOS_HISTORY_BUDGET:DEFAULT_HISTORY_BUDGET}function promisifyRequest(n){return new Promise((e,t)=>{n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error)})}function waitForTransaction(n){return new Promise((e,t)=>{n.oncomplete=()=>e(),n.onabort=()=>t(n.error||new Error("Transaction aborted")),n.onerror=()=>t(n.error||new Error("Transaction error"))})}function openHistoryDatabase(){if(typeof indexedDB>"u")throw new Error("IndexedDB is not available");return new Promise((n,e)=>{const t=indexedDB.open(HISTORY_DB_NAME,HISTORY_DB_VERSION);t.onupgradeneeded=()=>{const i=t.result;if(!i.objectStoreNames.contains(HISTORY_FRAMES_STORE)){const r=i.createObjectStore(HISTORY_FRAMES_STORE,{keyPath:"seq",autoIncrement:!0});r.createIndex("id","id",{unique:!0}),r.createIndex("ts","ts")}i.objectStoreNames.contains(HISTORY_SHA_STORE)||i.createObjectStore(HISTORY_SHA_STORE,{keyPath:"sha256"})},t.onsuccess=()=>{const i=t.result;i.onversionchange=()=>{i.close()},n(i)},t.onerror=()=>e(t.error)})}function mappingSortKey(n){if(!n||typeof n!="object")return"";if(n.name)return String(n.name).toLowerCase();const e=n.request||{},t=e.method?String(e.method):"",i=e.url||e.urlPath||e.urlPattern||e.urlPathPattern||"";return[t,i].filter(Boolean).join(" ").toLowerCase()}function normalizeLineEndings(n){return typeof n=="string"?n.replace(/\r\n/g,`
`):n}function canonicalizeValue(n,e={path:[]}){if(Array.isArray(n)){const t=e.path[e.path.length-1],i=n.map(r=>canonicalizeValue(r,{path:[...e.path,null]}));return t==="mappings"?i.map(r=>({key:mappingSortKey(r),item:r})).sort((r,o)=>r.key.localeCompare(o.key)).map(({item:r})=>r):i}if(n&&typeof n=="object"){const t=[],i=isInsideJsonBody(e);for(const[c,s]of Object.entries(n)){if(IGNORED_KEYS.has(c)&&!i)continue;const l=e.path[e.path.length-1],f=l&&HEADER_PARENT_KEYS.has(l)&&!i?c.toLowerCase():c,h={path:[...e.path,f]},m=canonicalizeValue(s,h);t.push([f,m])}const r={},o=i?t:t.sort((c,s)=>c[0].localeCompare(s[0]));for(const[c,s]of o)r[c]=s;return r}return typeof n=="string"?normalizeLineEndings(n):n}function stableStringifyWireMock(n){if(typeof n=="string"){if(!n.trim())return"";try{const t=JSON.parse(normalizeLineEndings(n)),i=canonicalizeValue(t,{path:[]});return JSON.stringify(i,null,2)}catch{return normalizeLineEndings(n)}}if(n&&typeof n=="object"){const e=canonicalizeValue(n,{path:[]});return JSON.stringify(e,null,2)}return typeof n>"u"?"":String(n)}function crc32(n){let e=-1;for(let t=0;t<n.length;t+=1){e^=n[t];for(let i=0;i<8;i+=1){const r=-(e&1);e=e>>>1^3988292384&r}}return(e^-1)>>>0}let digestWorker=null;async function digestInWorker(n){if(typeof Worker>"u")return null;if(!digestWorker){const t=`self.onmessage = async (event) => {
    try {
        const buffer = event.data;
        const digest = await crypto.subtle.digest('SHA-256', buffer);
        self.postMessage(digest, [digest]);
    } catch (error) {
        self.postMessage({ error: error.message });
    }
};`,i=new Blob([t],{type:"application/javascript"});digestWorker=new Worker(URL.createObjectURL(i))}const e=n.buffer.slice(0);return new Promise((t,i)=>{const r=c=>{digestWorker.removeEventListener("message",r),digestWorker.removeEventListener("error",o);const{data:s}=c;s&&s.error?i(new Error(s.error)):t(s)},o=c=>{digestWorker.removeEventListener("message",r),digestWorker.removeEventListener("error",o),i(c)};digestWorker.addEventListener("message",r),digestWorker.addEventListener("error",o),digestWorker.postMessage(e,[e])})}async function sha256Hex(n){if(typeof crypto<"u"&&crypto.subtle)try{if(n.byteLength>LARGE_DIGEST_THRESHOLD){const r=await digestInWorker(n);if(r instanceof ArrayBuffer)return{algorithm:"sha256",hash:Array.from(new Uint8Array(r)).map(c=>c.toString(16).padStart(2,"0")).join("")}}const t=await crypto.subtle.digest("SHA-256",n);return{algorithm:"sha256",hash:Array.from(new Uint8Array(t)).map(r=>r.toString(16).padStart(2,"0")).join("")}}catch(t){console.warn("[HISTORY] Failed to compute SHA-256, falling back to CRC32",t)}return{algorithm:"crc32",hash:crc32(n).toString(16).padStart(8,"0")}}function delay(n){return new Promise(e=>setTimeout(e,n))}class EditorHistory{constructor(e=50){this.limit=Math.max(5,e),this.dbPromise=openHistoryDatabase(),this.cache=new Map,this.cacheLimit=5,this.currentId=null,this.lastEntry=null,this.budgetBytes=detectHistoryBudget(),this.stats={count:0,byteSize:0,latestTimestamp:null,latestLabel:null},this.ready=this.initialiseState()}async initialiseState(){try{const e=await this.dbPromise,t=await this.readAllFrames(e);if(t.length){const c=t[t.length-1];this.currentId=c.id,this.lastEntry={seq:c.seq,length:c.json.length,timestamp:c.ts,manual:!!c.manual}}let i=0,r=null,o=null;for(const c of t)i+=c.byteSize||0,(!r||c.ts>=r)&&(r=c.ts,o=c.label);this.stats={count:t.length,byteSize:i,latestTimestamp:r,latestLabel:o},this.scheduleCleanup()}catch(e){console.warn("[HISTORY] Failed to initialise history",e)}}async reset(e="",t={}){await this.ready;const i=typeof e=="string"?e:"";await this.withLock(async()=>{const o=(await this.dbPromise).transaction([HISTORY_FRAMES_STORE,HISTORY_SHA_STORE],"readwrite");o.objectStore(HISTORY_FRAMES_STORE).clear(),o.objectStore(HISTORY_SHA_STORE).clear(),await waitForTransaction(o),this.cache.clear(),this.currentId=null,this.lastEntry=null,this.stats={count:0,byteSize:0,latestTimestamp:null,latestLabel:null}}),(i.length>0||t.forceInitial)&&await this.record(i,{...t,reason:t.reason||"Initial snapshot",label:t.label||"Initial document",force:!0})}async readAllFrames(e){return new Promise((t,i)=>{const o=e.transaction(HISTORY_FRAMES_STORE,"readonly").objectStore(HISTORY_FRAMES_STORE),c=[],s=o.openCursor();s.onsuccess=l=>{const d=l.target.result;d?(c.push(d.value),d.continue()):t(c)},s.onerror=()=>i(s.error)})}updateCache(e,t){if(e)for(this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,t);this.cache.size>this.cacheLimit;){const i=this.cache.keys().next().value;this.cache.delete(i)}}async withLock(e){if(typeof localStorage>"u")return e();const t=Date.now()+HISTORY_LOCK_TTL;let i=!1;for(let r=0;r<10;r+=1){const o=localStorage.getItem(HISTORY_LOCK_KEY);if(!o||Number(o)<Date.now())try{localStorage.setItem(HISTORY_LOCK_KEY,String(t)),i=!0;break}catch(c){console.warn("[HISTORY] Failed to acquire lock",c)}await delay(100)}if(!i)return e();try{return await e()}finally{localStorage.getItem(HISTORY_LOCK_KEY)===String(t)&&localStorage.removeItem(HISTORY_LOCK_KEY)}}cleanMeta(e){if(!e||typeof e!="object")return{};const t={...e};return delete t.force,delete t.contentOverride,delete t.editor,delete t.labelGenerated,t}deriveLabel(e,t={}){const i=t&&t.action?t.action:"Snapshot",r=typeof e=="string"?e.trim():"";if(!r)return i;try{const c=JSON.parse(r);if(c&&typeof c=="object"){if(c.name)return c.name;const s=c.request||{},l=s.method||"",d=s.url||s.urlPath||s.urlPattern||s.urlPathPattern||"",f=[];if(l&&f.push(l),d&&f.push(d),f.length)return f.join(" \xB7 ")}}catch{}const o=r.split(`
`)[0];return o.length>60?`${o.slice(0,57)}\u2026`:o||i}buildPreview(e){if(typeof e!="string"||e.trim().length===0)return"(empty document)";try{const t=JSON.parse(e),i=JSON.stringify(t,null,2);return this.truncatePreview(i)}catch{const i=e.split(`
`).slice(0,12).join(`
`);return this.truncatePreview(i)}}truncatePreview(e){return e.length<=480?e:`${e.slice(0,479)}\u2026`}async record(e,t={}){await this.ready;const i=typeof e=="string"?e:"",r=Date.now(),o=!!t.manual,c=this.cleanMeta(t),s=stableStringifyWireMock(i),l=typeof TextEncoder<"u"?new TextEncoder:null,d=l?l.encode(s):new Uint8Array(Array.from(s,M=>M.charCodeAt(0)&255)),{hash:f,algorithm:h}=await sha256Hex(d),m=this.lastEntry;if(!o&&m&&!t.force){const M=Math.abs(s.length-m.length),I=r-m.timestamp;if(M<MIN_DELTA_LEN&&I<DEBOUNCE_MS)return{recorded:!1,reason:"debounced",entry:null}}return this.withLock(async()=>{const M=await this.dbPromise,I=M.transaction([HISTORY_FRAMES_STORE,HISTORY_SHA_STORE],"readwrite"),T=I.objectStore(HISTORY_FRAMES_STORE),g=I.objectStore(HISTORY_SHA_STORE),y=await promisifyRequest(g.get(f));if(y!=null){const X=typeof y=="object"&&y.lastSeq?y.lastSeq:y,H=X!=null?await promisifyRequest(T.get(X)):null;if(H&&H.json===s)return H.occurrences=(H.occurrences||1)+1,H.lastAt=r,o&&!H.manual&&(H.manual=!0),H.meta={...H.meta||{},...c,manual:o||H.meta?.manual||H.manual,occurrences:H.occurrences,lastRecordedAt:new Date(r).toISOString(),hashAlgorithm:h},await promisifyRequest(T.put(H)),await waitForTransaction(I),this.stats.latestTimestamp=r,this.stats.latestLabel=H.label,this.currentId=H.id,this.lastEntry={seq:H.seq,length:s.length,timestamp:r,manual:H.manual},this.updateCache(H.seq,s),{recorded:!1,reason:"duplicate",entry:this.normalizeEntry(H)}}const C=c.label||this.deriveLabel(s,c),A={id:typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`hist-${r}-${Math.random().toString(36).slice(2,8)}`,ts:r,kind:"full",sha256:f,shaAlgorithm:h,byteSize:d.byteLength,label:C,occurrences:1,json:s,manual:o,meta:{...c,label:C,reason:c.reason||c.action||"Edit",occurrences:1,firstRecordedAt:new Date(r).toISOString(),lastRecordedAt:new Date(r).toISOString(),hashAlgorithm:h}},B=await promisifyRequest(T.add(A));return A.seq=B,await promisifyRequest(g.put({sha256:f,lastSeq:B})),await waitForTransaction(I),this.updateCache(B,s),this.currentId=A.id,this.lastEntry={seq:B,length:s.length,timestamp:r,manual:o},this.stats.count+=1,this.stats.byteSize+=A.byteSize,this.stats.latestTimestamp=r,this.stats.latestLabel=C,await this.enforceBudget({withinLock:!0,db:M}),{recorded:!0,entry:this.normalizeEntry(A)}})}normalizeEntry(e){const t=typeof e.json=="string"?e.json:"";return{id:e.id,seq:e.seq,timestamp:e.ts,content:t,label:e.label,preview:this.buildPreview(t),byteSize:e.byteSize,sizeLabel:formatBytes(e.byteSize||0),meta:{...e.meta||{},occurrences:e.occurrences||1,recordedAt:new Date(e.ts).toISOString()}}}async getEntries(e={}){await this.ready;const t=e.newestFirst===!0,i=await this.dbPromise,o=(await this.readAllFrames(i)).map(c=>this.normalizeEntry(c));return o.sort((c,s)=>t?s.timestamp-c.timestamp:c.timestamp-s.timestamp),e.limit?o.slice(0,e.limit):o}async getStats(){return await this.ready,{...this.stats}}getCurrentId(){return this.currentId}async getEntryById(e){await this.ready;const t=await this.dbPromise;return new Promise((i,r)=>{const l=t.transaction(HISTORY_FRAMES_STORE,"readonly").objectStore(HISTORY_FRAMES_STORE).index("id").get(e);l.onsuccess=()=>{i(l.result?this.normalizeEntry(l.result):null)},l.onerror=()=>r(l.error)})}markCurrent(e){this.currentId=e}async clear(e={}){await this.ready;const t=e.keepLatest!==!1,i=e.latestContent||"",r=e.label||"Current document";let o=null;t&&(o=(await this.getEntries({newestFirst:!0,limit:1}))[0]||null),await this.withLock(async()=>{const s=(await this.dbPromise).transaction([HISTORY_FRAMES_STORE,HISTORY_SHA_STORE],"readwrite");s.objectStore(HISTORY_FRAMES_STORE).clear(),s.objectStore(HISTORY_SHA_STORE).clear(),await waitForTransaction(s)}),this.cache.clear(),this.currentId=null,this.lastEntry=null,this.stats={count:0,byteSize:0,latestTimestamp:null,latestLabel:null},o?await this.record(o.content,{...o.meta,label:o.label,reason:"Preserved latest snapshot",manual:!!o.meta?.manual,force:!0}):t&&i&&await this.record(i,{label:r,reason:"Current document",force:!0})}async enforceBudget(e={}){if(await this.ready,this.stats.byteSize<=this.budgetBytes)return;const t=async i=>{const r=await this.readAllFrames(i);if(!r.length)return;const o=r[r.length-1].seq,c=new Set(r.filter(I=>I.manual).map(I=>I.seq)),s=new Set([o]),l=new Map,d=Date.now();for(const I of r){if(c.has(I.seq)){s.add(I.seq);continue}const T=d-I.ts;let g;T<=3600*1e3?g=60*1e3:T<=1440*60*1e3?g=600*1e3:T<=10080*60*1e3?g=3600*1e3:g=1440*60*1e3;const y=`${g}:${Math.floor(I.ts/g)}`,C=l.get(y);(!C||C.ts<I.ts)&&l.set(y,{seq:I.seq,ts:I.ts})}for(const I of l.values())s.add(I.seq);const f=r.filter(I=>!s.has(I.seq)&&!c.has(I.seq)).sort((I,T)=>I.ts-T.ts);if(!f.length)return;const h=i.transaction([HISTORY_FRAMES_STORE,HISTORY_SHA_STORE],"readwrite"),m=h.objectStore(HISTORY_FRAMES_STORE),M=h.objectStore(HISTORY_SHA_STORE);for(const I of f){await promisifyRequest(m.delete(I.seq)),this.stats.byteSize-=I.byteSize||0,this.stats.count-=1;const T=await promisifyRequest(M.get(I.sha256));if(T&&(T.lastSeq===I.seq||T===I.seq)){const g=r.filter(y=>y.sha256===I.sha256&&y.seq!==I.seq).sort((y,C)=>C.seq-y.seq)[0];g?await promisifyRequest(M.put({sha256:I.sha256,lastSeq:g.seq})):await promisifyRequest(M.delete(I.sha256))}if(this.stats.byteSize<=this.budgetBytes)break}if(await waitForTransaction(h),this.stats.byteSize<=0||this.stats.count<=0)this.stats={count:0,byteSize:0,latestTimestamp:null,latestLabel:null},this.currentId=null,this.lastEntry=null;else{const I=await this.readAllFrames(i);if(I.length){this.stats.count=I.length,this.stats.byteSize=I.reduce((g,y)=>g+(y.byteSize||0),0);const T=I[I.length-1];this.currentId=T.id,this.lastEntry={seq:T.seq,length:T.json.length,timestamp:T.ts,manual:!!T.manual},this.stats.latestTimestamp=T.ts,this.stats.latestLabel=T.label}else this.stats={count:0,byteSize:0,latestTimestamp:null,latestLabel:null},this.currentId=null,this.lastEntry=null}};if(e.withinLock&&e.db){await t(e.db);return}await this.withLock(async()=>{const i=await this.dbPromise;await t(i)})}async cleanup(e={}){const t=e.maxAgeMs||2592e6,i=e.maxEntries||50;await this.ready,await this.withLock(async()=>{const r=await this.dbPromise,o=r.transaction(HISTORY_FRAMES_STORE,"readwrite"),s=o.objectStore(HISTORY_FRAMES_STORE).index("ts"),l=Date.now()-t,d=IDBKeyRange.upperBound(l);let f=0;const h=s.openCursor(d);await new Promise((C,A)=>{h.onsuccess=B=>{const X=B.target.result;X?(X.delete(),f++,X.continue()):C()},h.onerror=()=>A(h.error)}),await waitForTransaction(o);const m=r.transaction(HISTORY_FRAMES_STORE,"readwrite"),M=m.objectStore(HISTORY_FRAMES_STORE),I=M.count(),T=await promisifyRequest(I);let g=0;if(T>i){const C=T-i,A=M.openCursor();await new Promise((B,X)=>{let H=0;A.onsuccess=le=>{const Se=le.target.result;Se&&H<C?(Se.delete(),H++,g++,Se.continue()):B()},A.onerror=()=>X(A.error)})}if(await waitForTransaction(m),f+g>0){console.log(`\u2705 [HISTORY] Cleanup completed: deleted ${f} old entries (>${Math.round(t/864e5)}d) + ${g} excess entries`);const C=await this.readAllFrames(r);if(this.stats.count=C.length,this.stats.byteSize=C.reduce((A,B)=>A+(B.byteSize||0),0),C.length>0){const A=C[C.length-1];this.stats.latestTimestamp=A.ts,this.stats.latestLabel=A.label}else this.stats.latestTimestamp=null,this.stats.latestLabel=null,this.currentId=null,this.lastEntry=null;console.log(`\u{1F4CA} [HISTORY] Stats after cleanup: ${this.stats.count} entries, ${(this.stats.byteSize/1024/1024).toFixed(2)} MB`)}})}scheduleCleanup(e=1440*60*1e3,t={}){const i=async()=>{try{await this.cleanup(t)}catch(o){console.error("[HISTORY] Cleanup failed:",o)}};setTimeout(i,1e4);const r=setInterval(i,e);return console.log(`\u2705 [HISTORY] Cleanup scheduled: every ${Math.round(e/36e5)}h, max age ${Math.round((t.maxAgeMs||720*60*60*1e3)/864e5)}d, max ${t.maxEntries||50} entries`),r}}function resolveTemplatePath(n,e){return!n||!e?void 0:(Array.isArray(e)?e:String(e).replace(/\[(\d+)\]/g,".$1").split(".")).reduce((i,r)=>{if(i!=null){if(Array.isArray(i)){const o=Number(r);return Number.isInteger(o)?i[o]:void 0}return i[r]}},n)}function formatFeatureValue(n){if(n==null)return"";if(typeof n=="string")return n.length>80?`${n.slice(0,77)}\u2026`:n;if(typeof n=="number"||typeof n=="boolean")return String(n);try{const e=JSON.stringify(n);return e.length>80?`${e.slice(0,77)}\u2026`:e}catch(e){return console.warn("Failed to serialise feature value",e),""}}function getTemplateFeature(n){if(!n||!n.feature)return null;const e=n.feature.path||n.feature,t=n.feature.label||(Array.isArray(e)?e.join("."):String(e)),i=resolveTemplatePath(n.content,e);return typeof i>"u"?null:{label:t,value:formatFeatureValue(i)}}function getTemplateHeadline(n){if(!n)return"";if(n.highlight)return n.highlight;const e=[];return n.content?.request?.method&&e.push(n.content.request.method),(n.content?.request?.url||n.content?.request?.urlPath)&&e.push(n.content.request.url||n.content.request.urlPath),e.join(" \xB7 ")}function buildTemplatePreview(n){try{const e=n&&n.content?n.content:{};if(typeof e=="string")return e;const r=JSON.stringify(e,null,2).split(`
`).slice(0,8).join(`
`);return r.length>320?`${r.slice(0,319)}\u2026`:r}catch{return"[unavailable template preview]"}}function copyTextToClipboard(n){if(typeof n!="string"&&(n=String(n??"")),typeof navigator<"u"&&navigator.clipboard&&typeof navigator.clipboard.writeText=="function")return navigator.clipboard.writeText(n).then(()=>!0).catch(()=>e(n));return Promise.resolve(e(n));function e(t){try{const i=document.createElement("textarea");return i.value=t,i.setAttribute("readonly",""),i.style.position="absolute",i.style.left="-9999px",document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i),!0}catch(i){return console.warn("Clipboard fallback failed:",i),!1}}}const HISTORY_SUMMARY_MAX_CHANGES=8,HISTORY_SUMMARY_MODAL_CHANGES=20,HISTORY_SUMMARY_MAX_DEPTH=4,HISTORY_SUMMARY_BRANCH_LIMIT=20;function safeParseSnapshot(n){if(typeof n!="string")return null;try{return JSON.parse(n)}catch{return null}}function formatHistoryLeafValue(n){if(n===void 0)return"\u2014";if(n===null)return"null";if(typeof n=="string")return`"${n.length>80?`${n.slice(0,77)}\u2026`:n}"`;if(typeof n=="number"||typeof n=="boolean")return String(n);if(Array.isArray(n))return n.length===0?"[]":n.every(t=>t==null||["string","number","boolean"].includes(typeof t))&&n.length<=5?`[${n.map(t=>formatHistoryLeafValue(t)).join(", ")}]`:`[${n.length} items]`;if(typeof n=="object"){const e=Object.keys(n||{});return e.length?`{${e.slice(0,5).join(", ")}${e.length>5?", \u2026":""}}`:"{}"}return String(n)}function flattenSnapshotForSummary(n,e,t="",i=0){if(i>=HISTORY_SUMMARY_MAX_DEPTH||n==null||typeof n!="object"){e.set(t||"(root)",formatHistoryLeafValue(n));return}if(Array.isArray(n)){if(n.length===0){e.set(t||"(root)","[]");return}const c=Math.min(n.length,HISTORY_SUMMARY_BRANCH_LIMIT);for(let s=0;s<c;s+=1){const l=t?`${t}[${s}]`:`[${s}]`;flattenSnapshotForSummary(n[s],e,l,i+1)}return}const r=Object.keys(n);if(!r.length){e.set(t||"(root)","{}");return}const o=r.sort((c,s)=>c.localeCompare(s)).slice(0,HISTORY_SUMMARY_BRANCH_LIMIT);for(const c of o){const s=t?`${t}.${c}`:c;flattenSnapshotForSummary(n[c],e,s,i+1)}}function summarizeHistoryChanges(n,e,t={}){const i=typeof t.limit=="number"?t.limit:HISTORY_SUMMARY_MAX_CHANGES,r=safeParseSnapshot(n),o=safeParseSnapshot(e);if(!r){const m=typeof n=="string"?n.length:0;if(o)return`Snapshot replaced with non-JSON content (${m} chars)`;const M=typeof e=="string"?e.length:0;return e==null?`Snapshot captured (non-JSON, ${m} chars)`:typeof e=="string"&&e===n?"No textual changes detected":`Content changed (${M} \u2192 ${m} chars)`}const c=new Map;flattenSnapshotForSummary(r,c);const s=new Map;o&&flattenSnapshotForSummary(o,s);const l=new Set([...c.keys(),...s.keys()]),d=Array.from(l).sort((m,M)=>m.localeCompare(M)),f=[];let h=0;for(const m of d){const M=s.has(m)?s.get(m):void 0,I=c.has(m)?c.get(m):void 0;if(M===I)continue;const T=m||"(root)";let g;typeof M>"u"?g=`${T}: ++ ${I}`:typeof I>"u"?g=`${T}: -- ${M}`:g=`${T}: ${M} \u2192 ${I}`,f.length<i?f.push(g):h+=1}return f.length?(h>0&&f.push(`\u2026and ${h} more change${h===1?"":"s"}`),f.join(`
`)):e==null?"Snapshot captured":"No field-level changes detected"}function formatHistoryFullContent(n){if(typeof n!="string")return"";const e=safeParseSnapshot(n);if(e!=null)try{return JSON.stringify(e,null,2)}catch{}return n}function renderHistoryPreviewMeta(n,e){n&&(n.innerHTML="",e.forEach(([t,i])=>{const r=document.createElement("div");r.className="history-preview-meta__row";const o=document.createElement("span");o.className="history-preview-meta__label",o.textContent=t;const c=document.createElement("span");c.className="history-preview-meta__value",c.textContent=i,r.appendChild(o),r.appendChild(c),n.appendChild(r)}))}function openHistoryPreview(n,e){const t=document.getElementById("historyPreviewModal");if(!t||!n)return;const i=window.monacoInitializer,r=t.querySelector("#modal-title-history-preview");r&&(r.textContent=n.label||"Snapshot preview");const o=t.querySelector("#historyPreviewMeta"),c=n.meta?.occurrences||1;renderHistoryPreviewMeta(o,[["Saved",`${formatRelativeTime(n.timestamp)} \xB7 ${new Date(n.timestamp).toLocaleString()}`],["Reason",n.meta?.reason||"edit"],["Size",n.sizeLabel||formatBytes(n.byteSize||(n.content?n.content.length:0))],["Occurrences",`${c}\xD7`]]);const s=t.querySelector("#historyPreviewSummary");s&&(s.textContent=summarizeHistoryChanges(n.content,e?e.content:null,{limit:HISTORY_SUMMARY_MODAL_CHANGES}));const l=t.querySelector("#historyPreviewContent");l&&(l.textContent=formatHistoryFullContent(n.content));const d=t.querySelector("#historyPreviewActions");if(d){d.dataset.currentContent=n.content||"",d.dataset.entryId=n.id||"";const f=d.querySelector('[data-history-preview-action="restore"]');if(f){const h=i&&typeof i.getCurrentHistoryEntryId=="function"?i.getCurrentHistoryEntryId():null,m=h&&n.id===h;f.disabled=!!m,f.textContent=m?"Current version":"Restore"}d.dataset.bound||(d.dataset.bound="true",d.addEventListener("click",async h=>{const m=h.target instanceof HTMLElement?h.target.closest("[data-history-preview-action]"):null;if(m){if(h.preventDefault(),m.dataset.historyPreviewAction==="copy"){const M=d.dataset.currentContent||"",I=await copyTextToClipboard(M);i&&typeof i.showNotification=="function"&&i.showNotification(I?"Snapshot copied to clipboard":"Failed to copy snapshot",I?"success":"error");return}if(m.dataset.historyPreviewAction==="restore"){if(!i||typeof i.restoreHistoryEntry!="function")return;const M=d.dataset.entryId;if(!M||m.disabled)return;const I=m.textContent;m.disabled=!0;try{await i.restoreHistoryEntry(M,{forceRestore:!1,requireConfirm:!0})}catch(y){console.error("[HISTORY] Failed to restore entry from preview",y),m.disabled=!1,m.textContent=I;return}const T=typeof i.getCurrentHistoryEntryId=="function"?i.getCurrentHistoryEntryId():null;T&&M===T?m.textContent="Current version":(m.disabled=!1,m.textContent=I)}}}))}window.openModal("historyPreviewModal")}async function renderHistoryModal(n={}){const e=document.getElementById("historyModal");if(!e)return;const t=window.monacoInitializer;if(t)try{const i=e.querySelector(".modal-body"),r=i?i.querySelector("#historyList"):null;if(!i||!r)return;let o=i.querySelector("#historyStats");o||(o=document.createElement("div"),o.id="historyStats",o.className="history-stats",i.insertBefore(o,i.firstChild));const c=await t.getHistoryStats(),s=formatBytes(c.byteSize),l=c.latestTimestamp?`${formatRelativeTime(c.latestTimestamp)} (${new Date(c.latestTimestamp).toLocaleString()})`:"\u2014",d=c.latestLabel||"\u2014",f=window.Utils.escapeHtml(s),h=window.Utils.escapeHtml(l),m=window.Utils.escapeHtml(d),M=typeof c.count=="number"?c.count:window.Utils.escapeHtml(String(c.count||"\u2014"));if(o.innerHTML=`
            <div class="history-meta">
                <span class="history-meta__label">Snapshots</span>
                <span>${M}</span>
            </div>
            <div class="history-meta">
                <span class="history-meta__label">Approx size</span>
                <span>${f}</span>
            </div>
            <div class="history-meta">
                <span class="history-meta__label">Last save</span>
                <span>${h}</span>
            </div>
            <div class="history-meta">
                <span class="history-meta__label">Latest label</span>
                <span>${m}</span>
            </div>
            <div class="history-actions-row">
                <button class="btn btn-secondary btn-sm" data-history-action="snapshot">Manual snapshot</button>
                <button class="btn btn-secondary btn-sm" data-history-action="export">Copy history JSON</button>
                <button class="btn btn-danger btn-sm" data-history-action="clear">Clear history</button>
            </div>
        `,o.dataset.bound||(o.dataset.bound="true",o.addEventListener("click",async g=>{const y=g.target instanceof HTMLElement?g.target.closest("[data-history-action]"):null;if(!y)return;g.preventDefault();const C=y.dataset.historyAction;if(C==="snapshot"){await t.recordHistorySnapshot("Manual snapshot",{label:"Manual snapshot",manual:!0,force:!0}),await t.refreshHistoryUI({force:!0});return}if(C==="export"){const A=await t.getHistoryEntries({newestFirst:!1}),B={exportedAt:new Date().toISOString(),count:c.count,entries:A.map(H=>({id:H.id,timestamp:H.timestamp,label:H.label,reason:H.meta?.reason,occurrences:H.meta?.occurrences||1,firstRecordedAt:H.meta?.firstRecordedAt,lastRecordedAt:H.meta?.lastRecordedAt,size:H.byteSize,content:H.content}))},X=await copyTextToClipboard(JSON.stringify(B,null,2));t.showNotification(X?"History copied to clipboard":"Failed to copy history",X?"success":"error");return}C==="clear"&&(typeof window.confirm!="function"||window.confirm("Clear history snapshots? The current document will remain as the first entry."))&&await t.clearHistory({keepLatest:!0,label:"Current document"})})),n.statsOnly){t.markHistoryRendered();return}const I=await t.getHistoryEntries({newestFirst:!0}),T=t.getCurrentHistoryEntryId();if(r.innerHTML="",!I.length){const g=document.createElement("div");g.className="history-empty",g.innerHTML="<p>No history yet</p><small>Changes are tracked automatically \u2013 edit the document or create a manual snapshot.</small>",r.appendChild(g),t.markHistoryRendered();return}I.forEach((g,y)=>{const C=document.createElement("article");C.className="history-item",C.dataset.entryId=g.id,g.id===T&&C.classList.add("current");const A=I[y+1]||null,B=document.createElement("div");B.className="history-header";const X=document.createElement("div");X.className="history-title",X.textContent=g.label||"Snapshot";const H=document.createElement("div");H.className="history-time",H.textContent=`${formatRelativeTime(g.timestamp)} \xB7 ${new Date(g.timestamp).toLocaleString()}`,B.appendChild(X),B.appendChild(H);const le=document.createElement("pre");le.className="history-preview is-clickable",le.textContent=summarizeHistoryChanges(g.content,A?A.content:null),le.title="View full snapshot",le.setAttribute("role","button"),le.tabIndex=0,le.addEventListener("click",ne=>{ne.stopPropagation(),openHistoryPreview(g,A)}),le.addEventListener("keydown",ne=>{(ne.key==="Enter"||ne.key===" ")&&(ne.preventDefault(),ne.stopPropagation(),openHistoryPreview(g,A))});const Se=document.createElement("div");Se.className="history-meta";const U=g.meta?.reason||"edit",j=document.createElement("span");j.textContent=`Reason: ${U}`,Se.appendChild(j);const F=g.meta?.occurrences||1;if(F>1){const ne=document.createElement("span");ne.className="history-meta__occurrences";const be=g.meta?.lastRecordedAt?new Date(g.meta.lastRecordedAt).toLocaleString():new Date(g.timestamp).toLocaleString();ne.textContent=`Saved ${F}\xD7`,ne.title=`Captured ${F} times (last at ${be})`,Se.appendChild(ne)}const v=document.createElement("span");v.textContent=g.sizeLabel,Se.appendChild(v);const k=document.createElement("div");k.className="history-action-buttons";const q=document.createElement("button");q.type="button",q.className=g.id===T?"btn btn-secondary btn-sm":"btn btn-primary btn-sm",q.textContent=g.id===T?"Current version":"Restore",q.disabled=g.id===T,q.addEventListener("click",ne=>{ne.stopPropagation(),t.restoreHistoryEntry(g.id,{forceRestore:!1,requireConfirm:!0}).catch(be=>console.error("[HISTORY] Failed to restore entry",be))});const W=document.createElement("button");W.type="button",W.className="btn btn-secondary btn-sm",W.textContent="Copy JSON",W.addEventListener("click",async ne=>{ne.stopPropagation();const be=await copyTextToClipboard(g.content);t.showNotification(be?"Snapshot copied to clipboard":"Failed to copy snapshot",be?"success":"error")}),k.appendChild(q),k.appendChild(W),C.appendChild(B),C.appendChild(le),C.appendChild(Se),C.appendChild(k),r.appendChild(C)}),t.markHistoryRendered()}catch(i){console.error("[HISTORY] Failed to render history modal",i)}}class MonacoInitializer{constructor(){this.isInitialized=!1,this.editors=new Map,this.performanceController=typeof PerformanceController<"u"?new PerformanceController:null,this.searchIndex=typeof IndexedSearch<"u"?new IndexedSearch:{updateIndex:()=>{},searchAll:()=>[],buildIndex:()=>{}},this.resultCache=typeof ResultCache<"u"?new ResultCache:{get:()=>null,set:()=>{}},this.workerPool=null,this.diffEditor=null,this.virtualRenderer=null,this.healthMonitoring={enabled:!1,interval:null,stats:{}},this.lastJSONPathResults=[],this.lastJSONPathPointerLocator=null,this.lastJSONPathMeta={totalCount:0,truncated:!1},this.currentJSONPathIndex=-1,this.lastJSONPathQuery="",this.jsonPathSearchRequestId=0,this.findWidgetIntegration=null,this.history=new EditorHistory(60),this.historyDebounce=null,this.suspendHistoryRecording=!1,this.historyNeedsRender=!0,this.monacoSources=this.resolveMonacoSources(),this.activeMonacoSource=null,this.pendingReadOnlyRestore=null,this.editorReadOnlyLocked=!1,this.pendingMappingLoadId=null}resolveMonacoSources(){const e=[{label:"jsDelivr",baseUrl:"https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs"},{label:"cdnjs",baseUrl:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs"},{label:"unpkg",baseUrl:"https://unpkg.com/monaco-editor@0.44.0/min/vs"}],t=typeof window<"u"&&Array.isArray(window.MONACO_CDN_SOURCES)&&window.MONACO_CDN_SOURCES.length?window.MONACO_CDN_SOURCES:e,i=s=>s?typeof s=="string"?{label:s,baseUrl:s}:s.baseUrl?{label:s.label||s.baseUrl,baseUrl:s.baseUrl}:s.url?{label:s.label||s.url,baseUrl:s.url}:null:null,r=t.map(i).filter(s=>s&&s.baseUrl),o=[],c=new Set;for(const s of r){const l=s.baseUrl.replace(/\/+$/,"");c.has(l)||(c.add(l),o.push({label:s.label||l,baseUrl:l}))}return o.length?o:e.map(s=>({label:s.label,baseUrl:s.baseUrl.replace(/\/+$/,"")}))}async initialize(){if(!this.isInitialized)try{await this.loadMonaco(),this.setupWireMockSchema(),this.setupOptimizations(),await this.createEditors(),this.setupEventHandlers(),this.isInitialized=!0,console.log("\u2705 Monaco Editor initialized with WireMock integration")}catch(e){throw console.error("\u274C Monaco Editor initialization failed:",e),e}}async loadMonaco(){if(typeof MonacoLoader<"u"&&MonacoLoader.load){console.log("\u{1F680} [Lazy Loading] Loading Monaco via MonacoLoader..."),await MonacoLoader.load(),console.log("\u2705 [Lazy Loading] Monaco loaded successfully");return}console.warn("\u26A0\uFE0F [Lazy Loading] MonacoLoader not available, using fallback"),await this.waitForMonacoLoader();const e=[];for(const r of this.monacoSources){this.configureMonacoLoader(r);try{await this.requireMonacoModule(),this.activeMonacoSource=r.baseUrl,console.log(`\u{1F3AF} Monaco loaded from ${r.label||r.baseUrl}`);return}catch(o){const c=this.normalizeMonacoLoadError(o,r);e.push({source:r,error:c}),console.warn(c.message),this.invalidateFailedMonacoLoad(r)}}const t=e.map(({error:r})=>r.message).join("; "),i=new Error(`Monaco Editor could not be loaded from any configured source. Attempts: ${t||"none"}`);throw i.attempts=e,i}async waitForMonacoLoader(e=1e4){const t=Date.now();for(;!this.isMonacoLoaderAvailable();){if(Date.now()-t>e)throw new Error("Monaco AMD loader did not become available");await MonacoInitializer.sleep(50)}}isMonacoLoaderAvailable(){const e=typeof require=="function"?require:typeof window<"u"?window.require:void 0;return typeof e=="function"&&typeof e.config=="function"}configureMonacoLoader(e){const t=e.baseUrl.replace(/\/+$/,""),i=typeof require=="function"?require:typeof window<"u"?window.require:void 0;i&&typeof i.config=="function"?i.config({paths:{vs:t}}):typeof window<"u"&&(window.require=window.require||{},window.require.paths=Object.assign({},window.require.paths||{},{vs:t})),typeof window<"u"&&(window.MONACO_BASE_URL=t)}requireMonacoModule(){const e=typeof require=="function"?require:typeof window<"u"?window.require:void 0;return new Promise((t,i)=>{try{if(typeof e!="function"){i(new Error("Monaco AMD loader is not available"));return}e(["vs/editor/editor.main"],t,r=>i(r))}catch(r){i(r)}})}normalizeMonacoLoadError(e,t){const i=t.label||t.baseUrl;if(!e)return new Error(`[${i}] Unknown error while loading Monaco Editor`);if(e instanceof Event){const o=e.target,c=o&&o.src?o.src:null,s=c?`[${i}] Network error while loading ${c}`:`[${i}] Network error while loading Monaco Editor`,l=new Error(s);return l.cause=e,l.script=c,l}if(typeof e=="string")return new Error(`[${i}] ${e}`);if(e&&e.message){const o=new Error(`[${i}] ${e.message}`);return o.cause=e,o}const r=new Error(`[${i}] ${String(e)}`);return r.cause=e,r}invalidateFailedMonacoLoad(e){const t=e.baseUrl.replace(/\/+$/,""),i=typeof require=="function"?require:typeof window<"u"?window.require:void 0;if(i&&typeof i.undef=="function")try{i.undef("vs/editor/editor.main")}catch(o){console&&typeof console.debug=="function"&&console.debug("Monaco loader undef failed",o)}const r=i&&i.s&&i.s.contexts&&i.s.contexts._;if(r){if(r.urlFetched)for(const o of Object.keys(r.urlFetched))o&&o.startsWith(t)&&delete r.urlFetched[o];if(r.defined)for(const o of Object.keys(r.defined))o&&o.startsWith("vs/")&&delete r.defined[o]}typeof document<"u"&&document.querySelectorAll("script[src]").forEach(c=>{const s=c.getAttribute("src");s&&s.startsWith(`${t}/`)&&/\/vs\//.test(s)&&!/loader\.js$/i.test(s)&&c.remove()})}static sleep(e){return new Promise(t=>setTimeout(t,e))}setupWireMockSchema(){const e={type:"object",properties:{id:{type:"string",description:"Unique identifier for the mapping"},name:{type:"string",description:"Human-readable name for the mapping"},request:{type:"object",description:"Request matching criteria",properties:{method:{enum:["GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS","ANY"],description:"HTTP method to match"},url:{type:"string",description:"Exact URL to match"},urlPath:{type:"string",description:"URL path to match"},urlPathPattern:{type:"string",description:"URL path pattern (regex)"},urlPattern:{type:"string",description:"Full URL pattern (regex)"},queryParameters:{type:"object",description:"Query parameter matching"},headers:{type:"object",description:"HTTP headers matching"},bodyPatterns:{type:"array",description:"Request body matching patterns",items:{type:"object"}}}},response:{type:"object",description:"Response configuration",properties:{status:{type:"number",minimum:100,maximum:599,description:"HTTP status code"},body:{type:"string",description:"Response body as string"},jsonBody:{type:["object","array"],description:"Response body as JSON"},headers:{type:"object",description:"Response headers"},fixedDelayMilliseconds:{type:"number",description:"Fixed delay in milliseconds"}}},priority:{type:"number",description:"Mapping priority"},scenarioName:{type:"string",description:"Scenario this mapping belongs to"},metadata:{type:"object",description:"Custom metadata"}},required:["request","response"]};monaco.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:[{uri:"http://wiremock.org/schemas/mapping.json",fileMatch:["*"],schema:e}]})}setupOptimizations(){try{typeof WorkerPool<"u"?(this.workerPool=new WorkerPool("json-worker.js",2),this.startHealthMonitoring(),console.log("\u26A1 Real WorkerPool initialized with health monitoring")):(this.workerPool={execute:async(e,t,i)=>{switch(e){case"format":const r=JSON.parse(t.text);return JSON.stringify(r,null,2);case"minify":const o=JSON.parse(t.text);return JSON.stringify(o);case"validate":try{return JSON.parse(t.text),{valid:!0}}catch(d){return{valid:!1,error:d.message}}case"sort_keys":const c=t&&typeof t.indent=="number"&&t.indent>=0?t.indent:2,s=JSON.parse(t.text),l=this.sortKeysDeep(s);return JSON.stringify(l,null,c);default:return t}},terminate:()=>{},getStats:()=>({workers:0,busy:0,queued:0,pending:0})},console.log("\u26A1 Fallback WorkerPool initialized")),typeof VirtualizedJSONRenderer<"u"&&(this.virtualRenderer=null,console.log("\u{1F4C4} VirtualizedJSONRenderer available"))}catch(e){console.warn("Performance optimizations initialization failed:",e)}}async createEditors(){const e=document.body.dataset.theme==="dark"?"vs-dark":"vs",r=new URLSearchParams(window.location.search).get("mappingId")?"":this.getDefaultStub(),o=document.getElementById("jsonEditor");o&&(window.editor=this.createEditor(o,{language:"json",theme:e,value:r,automaticLayout:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on",formatOnPaste:!0,formatOnType:!0,folding:!0,foldingMaximumRegions:1e5}),this.editors.set("main",window.editor),await this.initializeHistory(r))}prepareEditorForMappingLoad(e){const t=this.getActiveEditor();if(!t)return;let i=!1;try{if(typeof monaco<"u"&&monaco.editor&&monaco.editor.EditorOption)i=!!t.getOption(monaco.editor.EditorOption.readOnly);else if(typeof t.getRawOptions=="function"){const r=t.getRawOptions();i=!!(r&&r.readOnly)}}catch(r){console.debug("[EDITOR] Unable to detect current readOnly state",r)}if(this.pendingReadOnlyRestore=i,i)this.editorReadOnlyLocked=!1;else try{t.updateOptions({readOnly:!0}),this.editorReadOnlyLocked=!0}catch(r){console.debug("[EDITOR] Failed to toggle readOnly before load",r),this.editorReadOnlyLocked=!1}this.suspendHistoryRecording=!0;try{t&&typeof t.setSelection=="function"&&t.setSelection(new monaco.Range(1,1,t.getModel().getLineCount(),1)),t&&typeof t.trigger=="function"&&t.trigger("source","editor.action.selectAll"),t&&typeof t.executeCommand=="function"&&t.executeCommand("editor.action.deleteAll"),t.setValue("")}finally{this.suspendHistoryRecording=!1}this.historyDebounce&&(clearTimeout(this.historyDebounce),this.historyDebounce=null),e&&(this.pendingMappingLoadId=e)}finalizeEditorMappingLoad(){const e=this.getActiveEditor();if(e){if(this.editorReadOnlyLocked)try{e.updateOptions({readOnly:!1})}catch(t){console.debug("[EDITOR] Failed to restore readOnly after load",t)}else if(typeof this.pendingReadOnlyRestore=="boolean")try{e.updateOptions({readOnly:this.pendingReadOnlyRestore})}catch(t){console.debug("[EDITOR] Failed to reset readOnly flag",t)}}this.editorReadOnlyLocked=!1,this.pendingReadOnlyRestore=null,this.pendingMappingLoadId=null}createEditor(e,t){const i=monaco.editor.create(e,t);if(this.setupFindWidgetIntegration(i),typeof VirtualizedJSONRenderer<"u"){const r=new VirtualizedJSONRenderer(i);i.virtualRenderer=r,t.value&&r.setContent(t.value)}return i.onDidChangeModelContent(()=>{this.changeTimeout&&clearTimeout(this.changeTimeout),this.changeTimeout=setTimeout(()=>{this.onContentChange(i)},500)}),i}async initializeHistory(e=""){const t=typeof e=="string"?e:"";this.history||(this.history=new EditorHistory(60)),await this.history.reset(t,{label:"Initial document",reason:"Initial snapshot"}),this.historyNeedsRender=!0,await this.refreshHistoryUI({statsOnly:!0})}markHistoryRendered(){this.historyNeedsRender=!1}getHistoryEntries(e={}){return this.history?this.history.getEntries(e):Promise.resolve([])}getHistoryStats(){return this.history?this.history.getStats():Promise.resolve({count:0,byteSize:0,latestTimestamp:null})}getCurrentHistoryEntryId(){return this.history?this.history.getCurrentId():null}async recordHistorySnapshot(e="Edit",t={}){if(!this.history)return null;const i=t.editor||this.getActiveEditor();if(!i)return null;let r;if(typeof t.contentOverride=="string"?r=t.contentOverride:i.virtualRenderer&&typeof i.virtualRenderer.getFullContent=="function"?r=i.virtualRenderer.getFullContent():typeof i.getValue=="function"?r=i.getValue():r="",!(t.allowInvalid??!!t.manual))try{JSON.parse(r)}catch(l){return t.silent||console.debug("[HISTORY] Skipped snapshot \u2013 invalid JSON",l),{recorded:!1,skipped:!0,reason:"invalid-json"}}const c={reason:e,label:t.label,manual:!!t.manual,action:e,force:!!t.force},s=await this.history.record(r,c);return s&&s.recorded&&(this.historyNeedsRender=!0,await this.refreshHistoryUI({statsOnly:t.statsOnly===!0})),s}async refreshHistoryUI(e={}){if(typeof window.renderHistoryModal!="function")return;const t=document.getElementById("historyModal"),i=t&&(t.classList.contains("show")||t.getAttribute("aria-hidden")==="false");if(e.force||i){await window.renderHistoryModal({statsOnly:!!e.statsOnly}),this.historyNeedsRender=!1;return}e.statsOnly&&document.getElementById("historyStats")&&(await window.renderHistoryModal({statsOnly:!0}),this.historyNeedsRender=!1)}shouldRenderHistory(){return this.historyNeedsRender}async restoreHistoryEntry(e,t={}){if(!this.history)return this.showNotification("History is unavailable","warning"),!1;const i=await this.history.getEntryById(e);if(!i)return this.showNotification("History entry not found","warning"),!1;const r=this.getActiveEditor();if(!r)return this.showNotification("No active editor to restore into","warning"),!1;if((r.getValue?r.getValue():"")===i.content&&!t.forceRestore)return this.history.markCurrent(i.id),await this.refreshHistoryUI({force:!0}),this.showNotification("Already on this version","info"),!0;if(!t.forceRestore&&t.requireConfirm!==!1){const c=i.label||"snapshot",s=`Restore snapshot "${c.length>80?`${c.slice(0,77)}\u2026`:c}"? Current editor content will be replaced.`;if(!(typeof window.confirm=="function"?window.confirm(s):!0))return!1}if(this.suspendHistoryRecording=!0,r.setValue(i.content),this.suspendHistoryRecording=!1,this.history.markCurrent(i.id),this.historyNeedsRender=!0,await this.refreshHistoryUI({force:!0}),this.showNotification(`Restored snapshot: ${i.label}`,"success"),typeof document<"u"){const c=Array.from(document.querySelectorAll('.modal.show, .modal[aria-hidden="false"]'));if(c.length)for(const s of c)!(typeof HTMLElement>"u"||s instanceof HTMLElement)||!s||!s.id||(typeof window.closeModal=="function"?window.closeModal(s.id):(s.classList.remove("show"),s.classList.add("hidden"),s.style.display="none",s.setAttribute("aria-hidden","true")))}return!0}async clearHistory(e={}){if(!this.history)return;const t=this.getActiveEditor(),i=t&&typeof t.getValue=="function"?t.getValue():"";await this.history.clear({keepLatest:e.keepLatest!==!1,latestContent:i,label:e.label||"Current document"}),this.historyNeedsRender=!0,await this.refreshHistoryUI({force:!0})}getTemplateLibrary(){return getTemplateLibrarySnapshot()}applyTemplateById(e,t={}){const i=this.getTemplateLibrary().find(r=>r.id===e);return i?this.applyTemplate(i,t):(this.showNotification("Template not found","error"),!1)}applyTemplate(e,t={}){const i=this.getActiveEditor();if(!i)return this.showNotification("No active editor to apply template","warning"),!1;const r=e&&e.content?e.content:{};let o=typeof r=="string"?r:JSON.stringify(r,null,2);typeof t.transform=="function"&&(o=t.transform(o,e)||o);const c=i.getValue?i.getValue():"",s=t.replace!==!1;let l=o;return!s&&c&&(l=`${c.trimEnd()}

${o}`),s&&c&&!t.silent&&t.confirm!==!1&&!(typeof window.confirm=="function"?window.confirm(`Replace current document with "${e.title}" template?`):!0)?!1:(this.suspendHistoryRecording=!0,i.setValue(l),this.suspendHistoryRecording=!1,this.recordHistorySnapshot("Template applied",{label:e.title,manual:!0,force:!0,statsOnly:!1}).catch(d=>{console.debug("[HISTORY] Failed to record template snapshot",d)}),this.showNotification(`Template "${e.title}" applied`,"success"),!0)}setupEventHandlers(){this.setupKeyboardShortcuts(),this.setupThemeHandler()}setupKeyboardShortcuts(){if(!window.editor)return;[{key:monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyN,action:()=>this.newDocument()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyO,action:()=>this.loadFile()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyS,action:()=>this.saveFile()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.KeyF,action:()=>this.formatJSON()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyM,action:()=>this.minifyJSON()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyCode.KeyT,action:()=>this.validateJSON()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.BracketLeft,action:()=>this.collapseAllFolds({focus:!0})},{key:monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.BracketRight,action:()=>this.expandAllFolds({focus:!0})},{key:monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KeyS,action:()=>this.sortJSONKeys()},{key:monaco.KeyMod.Alt|monaco.KeyCode.KeyN,action:()=>this.navigateJSONPathMatches(1)},{key:monaco.KeyMod.Alt|monaco.KeyCode.KeyP,action:()=>this.navigateJSONPathMatches(-1)},{key:monaco.KeyMod.Alt|monaco.KeyCode.KeyJ,action:()=>this.toggleFindWidgetJSONPathMode()}].forEach(({key:t,action:i})=>{window.editor.addCommand(t,i)})}setupThemeHandler(){new MutationObserver(t=>{t.forEach(i=>{if(i.type==="attributes"&&i.attributeName==="data-theme"){const r=document.body.dataset.theme==="dark"?"vs-dark":"vs";monaco.editor.setTheme(r),this.diffEditor&&this.diffEditor.updateOptions({theme:r})}})}).observe(document.body,{attributes:!0,attributeFilter:["data-theme"]})}onContentChange(e){const t=e.virtualRenderer?e.virtualRenderer.getFullContent():e.getValue();this.searchIndex&&typeof this.searchIndex.buildIndex=="function"?this.searchIndex.buildIndex(t):this.searchIndex&&typeof this.searchIndex.updateIndex=="function"&&this.searchIndex.updateIndex(t),e.virtualRenderer&&t.split(`
`).length>5e3&&e.virtualRenderer.setContent(t),!this.suspendHistoryRecording&&(this.historyNeedsRender=!0,this.historyDebounce&&clearTimeout(this.historyDebounce),this.historyDebounce=setTimeout(()=>{this.recordHistorySnapshot("Auto snapshot",{statsOnly:!0,allowInvalid:!1}).catch(i=>{console.debug("[HISTORY] Failed to record auto snapshot",i)})},1500))}getDefaultStub(){const e=()=>JSON.stringify({name:"Example WireMock Mapping",request:{method:"GET",urlPath:"/api/example"},response:{status:200,jsonBody:{message:"Hello from WireMock!",timestamp:"2024-01-01T00:00:00Z"},headers:{"Content-Type":"application/json"}}},null,2);try{if(window.TemplateManager?.getEmptyMappingContent){const t=window.TemplateManager.getEmptyMappingContent();return JSON.stringify(t,null,2)}}catch(t){console.warn("Unable to get empty mapping content from TemplateManager, falling back to default stub",t)}return e()}async formatJSON(){const e=this.getActiveEditor(),t=e.getValue();e&&typeof e.setValue=="function"&&e.setValue("");try{if(this.workerPool){const i=await this.workerPool.execute("format",{text:t},1);e.setValue(i)}else{const i=JSON.parse(t),r=JSON.stringify(i,null,2);e.setValue(r)}this.showNotification("JSON formatted","success")}catch(i){this.showNotification("Format error: "+i.message,"error")}}async minifyJSON(){const e=this.getActiveEditor(),t=e.getValue();try{if(this.workerPool){const i=await this.workerPool.execute("minify",{text:t},1);e.setValue(i)}else{const i=JSON.parse(t),r=JSON.stringify(i);e.setValue(r)}this.showNotification("JSON minified","success")}catch(i){this.showNotification("Minify error: "+i.message,"error")}}async validateJSON(){const t=this.getActiveEditor().getValue();try{if(this.workerPool){const i=await this.workerPool.execute("validate",{text:t},1);i.valid?this.showNotification("JSON is valid","success"):this.showNotification(`JSON invalid: ${i.error}`,"error")}else JSON.parse(t),this.showNotification("JSON is valid","success")}catch(i){this.showNotification("JSON invalid: "+i.message,"error")}}getActiveEditor(){return window.editor||this.editors.get("main")}resolveTargetEditors(e={}){if(e&&e.editor)return e.editor?[e.editor]:[];if(e&&Array.isArray(e.editors)&&e.editors.length)return e.editors.filter(Boolean);const t=new Set,i=document.getElementById("editorContainer");if(!i||i.style.display!=="none"){const o=this.editors.get("main");o&&t.add(o)}const r=document.getElementById("compareContainer");if(r&&r.style.display!=="none")if(this.diffEditor){const o=typeof this.diffEditor.getOriginalEditor=="function"?this.diffEditor.getOriginalEditor():null,c=typeof this.diffEditor.getModifiedEditor=="function"?this.diffEditor.getModifiedEditor():null;o&&t.add(o),c&&t.add(c)}else{const o=this.editors.get("compareEditorLeft"),c=this.editors.get("compareEditorRight");o&&t.add(o),c&&t.add(c)}if(!t.size){const o=this.getActiveEditor();o&&t.add(o)}return Array.from(t).filter(Boolean)}runEditorCommand(e,t,i=null){if(!e)return!1;try{if(typeof e.getAction=="function"){const r=e.getAction(t);if(r&&typeof r.run=="function"&&(!r.isSupported||r.isSupported())){const o=r.run();return o&&typeof o.then=="function"&&o.catch(c=>console.warn(`Command ${t} failed:`,c)),!0}}if(typeof e.trigger=="function")return e.trigger("json-tools",t,i),!0}catch(r){console.warn(`Command ${t} failed:`,r)}return!1}executeCommandOnEditors(e,t={}){const i=this.resolveTargetEditors(t);let r=0;return i.forEach(o=>{this.runEditorCommand(o,e,t.payload)&&r++}),t.focus&&i[0]&&typeof i[0].focus=="function"&&i[0].focus(),{executed:r,editors:i}}collapseAllFolds(e={}){const{executed:t}=this.executeCommandOnEditors("editor.foldAll",e);if(t>0){const i=t>1?"Collapsed JSON structures in all visible editors":"Collapsed JSON structures";this.showNotification(i,"success")}else this.showNotification("Unable to collapse JSON structures","warning")}expandAllFolds(e={}){const{executed:t}=this.executeCommandOnEditors("editor.unfoldAll",e);if(t>0){const i=t>1?"Expanded JSON structures in all visible editors":"Expanded JSON structures";this.showNotification(i,"success")}else this.showNotification("Unable to expand JSON structures","warning")}async sortJSONKeys(e={}){const t=this.getActiveEditor();if(!t){this.showNotification("No active editor","warning");return}const i=t.getValue(),r=t.getModel&&t.getModel(),o=e&&typeof e.indent=="number"&&e.indent>=0?e.indent:r&&typeof r.getOptions=="function"?r.getOptions().tabSize:2,c=Number.isFinite(o)?o:2;try{let s;if(this.workerPool&&typeof this.workerPool.execute=="function")s=await this.workerPool.execute("sort_keys",{text:i,indent:c},1);else{const l=JSON.parse(i),d=this.sortKeysDeep(l);s=JSON.stringify(d,null,c)}typeof s!="string"&&(s=JSON.stringify(s)),s!==i&&t.setValue(s),this.showNotification("JSON keys sorted alphabetically","success")}catch(s){console.error("Sort keys error:",s),this.showNotification("Sort keys error: "+s.message,"error")}}sortKeysDeep(e){if(Array.isArray(e))return e.map(t=>this.sortKeysDeep(t));if(e&&typeof e=="object"){const t=Object.keys(e).sort((r,o)=>r.localeCompare(o)),i={};return t.forEach(r=>{i[r]=this.sortKeysDeep(e[r])}),i}return e}showNotification(e,t){typeof showNotification<"u"?showNotification(e,t):console.log(`[${t.toUpperCase()}] ${e}`)}loadMappingIntoEditor(e,t={}){const i=this.getActiveEditor();if(i&&e){const r=typeof t=="boolean"?{notify:t}:t&&typeof t=="object"?t:{},o=JSON.stringify(e,null,2);i.setValue(o),this.finalizeEditorMappingLoad();const c=e&&(e.mapping||e),s=c&&(c.id||c.uuid);if(typeof window<"u"&&typeof window.rememberEditorMappingId=="function"&&window.rememberEditorMappingId(s),r.notify){const l=c&&(c.name||s),f=(typeof r.message=="string"?r.message.trim():"")||(l?`Mapping "${l}" loaded`:"Mapping loaded");this.showNotification(f,"success")}}}getMappingFromEditor(){const e=this.getActiveEditor();if(!e)return null;try{const t=e.getValue(),i=JSON.parse(t);if(typeof window<"u"&&typeof window.rememberEditorMappingId=="function"){const r=i&&(i.id||i.uuid);window.rememberEditorMappingId(r)}return i}catch{return this.showNotification("Invalid JSON in editor","error"),null}}search(e){const t=this.getActiveEditor();if(!t){this.showNotification("No active editor","warning");return}try{t.trigger("search","actions.find",{searchString:e,replaceString:"",isRegex:!1,matchCase:!1,matchWholeWord:!1,preserveCase:!1}),this.showNotification(`Searching for "${e}"`,"success")}catch(i){console.error("Search error:",i),this.showNotification("Search error: "+i.message,"error")}}loadCompareContent(e,t){try{if(this.diffEditor||this.initializeDiffEditor(),this.diffEditor){const i=JSON.parse(t),r=JSON.stringify(i,null,2),o=this.diffEditor.getModel();let c,s;o?(c=o.original,s=o.modified):(c=monaco.editor.createModel("","json"),s=monaco.editor.createModel("","json")),e==="left"||e==="original"?c.setValue(r):s.setValue(r),this.diffEditor.setModel({original:c,modified:s}),this.showNotification(`Content loaded to ${e} panel with diff highlighting`,"success")}else this.loadCompareContentFallback(e,t)}catch(i){console.error("Error loading compare content:",i),this.showNotification(`Error loading ${e} content: `+i.message,"error")}}initializeDiffEditor(){const e=document.getElementById("compareContainer");if(!e){console.warn("Compare container not found, cannot initialize diff editor");return}try{const t=document.body.dataset.theme==="dark"?"vs-dark":"vs";this.diffEditor=monaco.editor.createDiffEditor(e,{theme:t,readOnly:!1,automaticLayout:!0,renderSideBySide:!0,ignoreTrimWhitespace:!1,renderWhitespace:"boundary",diffWordWrap:"on",originalEditable:!0,scrollBeyondLastLine:!1,minimap:{enabled:!1},enableSplitViewResizing:!0,renderOverviewRuler:!0,diffCodeLens:!0,folding:!0,foldingMaximumRegions:1e5,scrollbar:{verticalScrollbarSize:8,horizontalScrollbarSize:8,useShadows:!1}});const i=monaco.editor.createModel("","json"),r=monaco.editor.createModel("","json");this.diffEditor.setModel({original:i,modified:r}),this.setupDiffEditorEnhancements(),this.editors.set("diffEditor",this.diffEditor),console.log("\u2705 Enhanced Monaco DiffEditor initialized with lock-step scrolling")}catch(t){console.error("Failed to initialize diff editor:",t)}}setupDiffEditorEnhancements(){if(!this.diffEditor)return;const e=this.diffEditor.getOriginalEditor(),t=this.diffEditor.getModifiedEditor();[{key:monaco.KeyMod.Alt|monaco.KeyCode.KeyN,action:()=>this.diffEditor.goToNextDiff()},{key:monaco.KeyMod.Alt|monaco.KeyCode.KeyP,action:()=>this.diffEditor.goToPrevDiff()},{key:monaco.KeyMod.CtrlCmd|monaco.KeyMod.Alt|monaco.KeyCode.KeyR,action:()=>this.resetDiffView()}].forEach(({key:r,action:o})=>{e.addCommand(r,o),t.addCommand(r,o)}),e.addAction({id:"diff-copy-to-modified",label:"Copy to Right Side",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.RightArrow],run:()=>{const r=e.getValue();t.setValue(r),this.showNotification("Content copied to right side","success")}}),t.addAction({id:"diff-copy-to-original",label:"Copy to Left Side",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyMod.Shift|monaco.KeyCode.LeftArrow],run:()=>{const r=t.getValue();e.setValue(r),this.showNotification("Content copied to left side","success")}}),e.onDidChangeModelContent(()=>{this.onDiffContentChange("original")}),t.onDidChangeModelContent(()=>{this.onDiffContentChange("modified")})}onDiffContentChange(e){this.diffAnalysisTimeout&&clearTimeout(this.diffAnalysisTimeout),this.diffAnalysisTimeout=setTimeout(()=>{this.analyzeDiffChanges(e)},1e3)}analyzeDiffChanges(e){if(!this.diffEditor)return;const t=this.diffEditor.getModel();if(!t)return;const i=t.original.getValue(),r=t.modified.getValue();if(i&&r){const o=this.diffEditor.getDiffComputationResult();if(o&&o.changes){const c=o.changes.length;this.showNotification(`${c} difference${c!==1?"s":""} detected`,"info")}}}resetDiffView(){if(!this.diffEditor)return;const e=this.diffEditor.getModel();e&&(e.original.setValue(""),e.modified.setValue(""),this.showNotification("Diff view reset","success"))}loadCompareContentFallback(e,t){const i=e==="left"?"compareEditorLeft":"compareEditorRight";let r=this.editors.get(i);if(!r){const o=document.getElementById(i);if(o){const c=document.body.dataset.theme==="dark"?"vs-dark":"vs";r=this.createEditor(o,{language:"json",theme:c,readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on"}),this.editors.set(i,r)}}if(r){const o=JSON.parse(t),c=JSON.stringify(o,null,2);r.setValue(c),this.showNotification(`Content loaded to ${e} panel`,"success")}else throw new Error(`Cannot find container for ${e} compare editor`)}clearCompareContent(e){try{if(this.diffEditor){const t=this.diffEditor.getModel();t&&(e==="left"||e==="original"?t.original.setValue(""):e==="right"||e==="modified"?t.modified.setValue(""):e==="both"&&(t.original.setValue(""),t.modified.setValue(""))),this.showNotification(`${e.charAt(0).toUpperCase()+e.slice(1)} diff panel cleared`,"success")}else{const t=e==="left"?"compareEditorLeft":"compareEditorRight",i=this.editors.get(t);i?(i.setValue(""),this.showNotification(`${e.charAt(0).toUpperCase()+e.slice(1)} panel cleared`,"success")):this.showNotification(`${e} compare editor not found`,"warning")}}catch(t){console.error(`Error clearing ${e} panel:`,t),this.showNotification(`Error clearing ${e} panel: `+t.message,"error")}}evaluateJSONPath(e,t,i,r){const o=[],c=this.createPointerLocator(i),s="$",l=typeof t=="string"?t.trim():"";if(!l||l==="$"){const h=this.findValuePosition(e,i,r,"$",c,s);return o.push({value:e,path:"$",pointer:s,position:h}),o}const d=l.replace(/^\$\.?/,""),f=d?d.split(".").filter(Boolean):[];return this.traverseJSONPath(e,f,i,r,"$",o,c,s),o}traverseJSONPath(e,t,i,r,o,c,s,l){if(t.length===0){const h=this.findValuePosition(e,i,r,o,s,l);c.push({value:e,path:o,pointer:l,position:h});return}const[d,...f]=t;if(d.includes("[")&&d.includes("]")){const[h,m]=d.split("["),M=m.replace("]","");let I=e,T=l;if(h){if(!e||typeof e!="object"||!Object.prototype.hasOwnProperty.call(e,h))return;I=e[h],T=appendPointerSegment(T,h)}if(Array.isArray(I))if(M==="*")I.forEach((g,y)=>{const C=o+(h?`.${h}`:"")+`[${y}]`,A=appendPointerSegment(T,y);this.traverseJSONPath(g,f,i,r,C,c,s,A)});else{const g=parseInt(M,10);if(!Number.isNaN(g)&&g>=0&&g<I.length){const y=o+(h?`.${h}`:"")+`[${g}]`,C=appendPointerSegment(T,g);this.traverseJSONPath(I[g],f,i,r,y,c,s,C)}}}else if(d==="*")e&&typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).forEach(h=>{const m=o+`.${h}`,M=appendPointerSegment(l,h);this.traverseJSONPath(e[h],f,i,r,m,c,s,M)});else if(e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,d)){const h=o+`.${d}`,m=appendPointerSegment(l,d);this.traverseJSONPath(e[d],f,i,r,h,c,s,m)}}findValuePosition(e,t,i,r,o=null,c=null){try{let s=o||null,l=c;if(typeof l=="string"&&l.startsWith("$.")){const h=this.convertJSONPathToPointer(l);h&&(l=h)}if(!l&&typeof r=="string"&&r.length>0&&(l=this.convertJSONPathToPointer(r)),l&&(s||(s=this.createPointerLocator(t)),s)){const h=s.getRange(l);if(h)return h}const d=i&&typeof i.getModel=="function"?i.getModel():null;if(!d)return null;let f;if(typeof e=="string"?f=`"${e}"`:f=JSON.stringify(e),f){const h=d.findMatches(f,!1,!1,!0,null,!1);if(h.length>0){const{range:m}=h[0];return{startLineNumber:m.startLineNumber,startColumn:m.startColumn,endLineNumber:m.endLineNumber,endColumn:m.endColumn}}}if(e&&typeof e=="object"){const h=JSON.stringify(e,null,2);if(h&&h!==f){const m=d.findMatches(h,!1,!1,!0,null,!1);if(m.length>0){const{range:M}=m[0];return{startLineNumber:M.startLineNumber,startColumn:M.startColumn,endLineNumber:M.endLineNumber,endColumn:M.endColumn}}}}}catch(s){console.warn("Could not find position for value:",s)}return null}formatValuePreview(e){if(e===null)return"null";if(e===void 0)return"undefined";let t=JSON.stringify(e);return t.length>100&&(t=t.slice(0,97)+"..."),t}newDocument(){try{const e=this.getActiveEditor();e&&(e.setValue(this.getDefaultStub()),this.showNotification("New document created","success"))}catch(e){this.showNotification("Error creating new document: "+e.message,"error")}}loadFile(){try{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=t=>{const i=t.target.files[0];if(i){const r=new FileReader;r.onload=o=>{try{const c=o.target.result,s=this.getActiveEditor();s&&(s.setValue(c),this.showNotification("File loaded successfully","success"))}catch(c){this.showNotification("Error loading file: "+c.message,"error")}},r.readAsText(i)}},e.click()}catch(e){this.showNotification("Error opening file dialog: "+e.message,"error")}}saveFile(){try{const e=this.getActiveEditor();if(e){const t=e.getValue(),i=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download="wiremock-mapping.json",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r),this.showNotification("File saved successfully","success")}}catch(e){this.showNotification("Error saving file: "+e.message,"error")}}exportAsYAML(){const e=this.getActiveEditor();if(!e){this.showNotification("No active editor","warning");return}let t;try{t=JSON.parse(e.getValue())}catch(i){this.showNotification("Cannot export YAML: "+i.message,"error");return}try{const i=convertJSONToYAML(t),r=i.endsWith(`
`)?i:`${i}
`,o=new Blob([r],{type:"text/yaml"}),c=URL.createObjectURL(o),s=document.createElement("a");s.href=c,s.download="wiremock-mapping.yaml",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c),this.showNotification("YAML exported","success")}catch(i){this.showNotification("YAML export failed: "+i.message,"error")}}async searchJSONPath(e,t={}){if(!this.getActiveEditor())return t.notify!==!1&&this.showNotification("No active editor","warning"),[];const o=(typeof e=="string"?e:"").trim(),c=o.length>0,s=t.allowEmpty===!0;if(!c&&!s)return t.notify!==!1&&this.showNotification("Please enter a search term","warning"),[];const l=typeof t.jsonPathMode=="boolean"?t.jsonPathMode:null,d=c&&this.isJSONPathQuery(o),f=l!==null?l:d;return await this.openFindWidget({query:c?o:void 0,jsonPathMode:f,focus:t.focus!==!1,select:typeof t.select=="boolean"?t.select:!1,notify:t.notify===!0})?c?f?Array.isArray(this.lastJSONPathResults)?this.lastJSONPathResults:[]:[]:[]:(t.notify!==!1&&this.showNotification("Find widget is not available","error"),[])}async searchWithJSONPath(e,t,i={}){const{notify:r=!0,revealFirst:o=!0,fromWidget:c=!1}=i||{},s=++this.jsonPathSearchRequestId,l=t.getValue();if(!l||!l.trim())return this.resetJSONPathResults({keepQuery:!0}),this.lastJSONPathQuery=e,c&&this.updateFindWidgetMatchesCount(0,!1,-1,{noContent:!0}),r&&this.showNotification("No content to search","warning"),[];let d=null;if(this.canUseWorkerForJSONPath())try{d=await this.workerPool.execute("jsonpath",{text:l,path:e},5,1e4)}catch(f){console.warn("JSONPath worker execution failed, falling back to local parser:",f)}if(d&&typeof d=="object"&&Array.isArray(d.values)){const{matches:f,pointerLocator:h}=this.convertWorkerResultToMatches(d,e,l,t),m=typeof d.count=="number"?d.count:f.length,M=!!d.truncated;return s!==this.jsonPathSearchRequestId?f:(this.lastJSONPathPointerLocator=h,this.handleJSONPathMatches(e,f,t,m,M,{notify:r,revealFirst:o,fromWidget:c}))}try{const f=JSON.parse(l),h=this.evaluateJSONPath(f,e,l,t)||[];return s!==this.jsonPathSearchRequestId?h:(this.lastJSONPathPointerLocator=null,this.handleJSONPathMatches(e,h,t,h.length,!1,{notify:r,revealFirst:o,fromWidget:c}))}catch(f){return this.resetJSONPathResults({keepQuery:!0}),this.lastJSONPathPointerLocator=null,this.lastJSONPathQuery=e,c&&this.updateFindWidgetMatchesCount(0,!1,-1,{error:f.message}),r&&this.showNotification("Invalid JSON or JSONPath: "+f.message,"error"),[]}}isJSONPathQuery(e){return e?e.trim().startsWith("$"):!1}canUseWorkerForJSONPath(){return!this.workerPool||typeof this.workerPool.execute!="function"?!1:Array.isArray(this.workerPool.workers)?this.workerPool.workers.length>0:!1}convertWorkerResultToMatches(e,t,i,r){const o=Array.isArray(e.values)?e.values:[],c=this.extractJSONPathStrings(e,t,o.length),s=this.extractPointerPaths(e,o.length),d=s.some(h=>typeof h=="string"&&h.length>0)?this.createPointerLocator(i):null;return{matches:o.map((h,m)=>{const M=c[m]||t,I=s[m]||null;let T=null;if(I&&d){const g=d.getRange(I);g&&(T=g)}return T||(T=this.findValuePosition(h,i,r,M,d,I)),{value:h,path:M,pointer:I,position:T}}),pointerLocator:d,pointerPaths:s}}extractJSONPathStrings(e,t,i=0){return e?Array.isArray(e.jsonPaths)&&e.jsonPaths.length>0?e.jsonPaths:Array.isArray(e.paths)&&e.paths.length>0?e.paths.map(r=>Array.isArray(r)?convertPathArrayToJSONPath(r):String(r)):i>0?new Array(i).fill(t):[]:[]}extractPointerPaths(e,t=0){return e?Array.isArray(e.pointerPaths)&&e.pointerPaths.length>0?e.pointerPaths:Array.isArray(e.paths)&&e.paths.length>0?e.paths.map(i=>Array.isArray(i)?convertPathArrayToPointer(i):null):t>0?new Array(t).fill(null):[]:[]}createPointerLocator(e){return buildJSONPointerLocator(e)}convertJSONPathToPointer(e){if(typeof e!="string")return null;const t=e.trim();if(!t)return null;if(t==="$")return"$";if(!t.startsWith("$"))return null;let i="$",r=1;for(;r<t.length;){const o=t[r];if(o==="."){if(r++,r>=t.length)break;if(t[r]===".")return null;if(t[r]==="[")continue;let c=r;for(;r<t.length&&t[r]!=="."&&t[r]!=="[";)r++;const s=t.slice(c,r);s&&(i=appendPointerSegment(i,s));continue}if(o==="["){if(r++,r>=t.length)break;if(t[r]==="'"||t[r]==='"'){const c=t[r];r++;let s="";for(;r<t.length;){const l=t[r];if(l==="\\"&&r+1<t.length){s+=t[r+1],r+=2;continue}if(l===c)break;s+=l,r++}if(r<t.length&&t[r]===c&&r++,r<t.length&&t[r]==="]"&&r++,!s)return null;i=appendPointerSegment(i,s)}else{let c=r;for(;r<t.length&&t[r]!=="]";)r++;const s=t.slice(c,r);if(r<t.length&&t[r]==="]"&&r++,!s||s==="*")return null;const l=Number(s);Number.isNaN(l)?i=appendPointerSegment(i,s):i=appendPointerSegment(i,l)}continue}r++}return i}handleJSONPathMatches(e,t,i,r,o,c={}){const{notify:s=!0,revealFirst:l=!0,fromWidget:d=!1}=c||{};if(!Array.isArray(t)||t.length===0)return this.resetJSONPathResults({keepQuery:!0}),this.lastJSONPathQuery=e,this.lastJSONPathMeta={totalCount:0,truncated:!1},d&&this.updateFindWidgetMatchesCount(0,o,-1,{query:e}),s&&this.showNotification(`JSONPath "${e}" not found`,"info"),[];if(this.lastJSONPathResults=t,this.lastJSONPathMeta={totalCount:r,truncated:o},this.lastJSONPathQuery=e,l?this.focusJSONPathMatch(0,i,{fromWidget:d,reveal:!0}):(this.currentJSONPathIndex<0||this.currentJSONPathIndex>=t.length)&&(this.currentJSONPathIndex=0),d&&this.updateFindWidgetMatchesCount(r,o,this.currentJSONPathIndex),s){const f=Math.max(0,this.currentJSONPathIndex),h=t[f]||t[0];let m=`JSONPath "${e}" found ${r} match${r===1?"":"es"}`;o&&t.length<r&&(m+=` (showing first ${t.length})`),h&&Object.prototype.hasOwnProperty.call(h,"value")&&(m+=`: ${this.formatValuePreview(h.value)}`),this.showNotification(m,"success"),r>1&&this.showNotification(`Use Alt+N/Alt+P to navigate between ${r} matches`,"info")}return t}resetJSONPathResults(e={}){const{keepQuery:t=!1}=e||{};this.lastJSONPathResults=[],this.lastJSONPathMeta={totalCount:0,truncated:!1},this.lastJSONPathPointerLocator=null,this.currentJSONPathIndex=-1,t||(this.lastJSONPathQuery="")}focusJSONPathMatch(e,t=this.getActiveEditor(),i={}){const{reveal:r=!0,fromWidget:o=!1}=i||{};if(!t)return!1;const c=Array.isArray(this.lastJSONPathResults)?this.lastJSONPathResults:[];if(c.length===0)return this.currentJSONPathIndex=-1,o&&this.updateFindWidgetMatchesCount(0,!1,-1),!1;const s=Number(e);if(Number.isNaN(s)||s<0||s>=c.length)return!1;const l=c[s];if(!l)return!1;const d=t.getValue();let f=l.position,h=this.lastJSONPathPointerLocator;if(h||(h=this.createPointerLocator(d),this.lastJSONPathPointerLocator=h),(!f||typeof f.startLineNumber!="number")&&h){const M=l.pointer||this.convertJSONPathToPointer(l.path);if(M){const I=h.getRange(M);I&&(f=I,l.position=I)}}if(!f||typeof f.startLineNumber!="number"){const M=l.pointer||null,I=this.findValuePosition(l.value,d,t,l.path,h,M);I&&(f=I,l.position=I)}if(!f||typeof f.startLineNumber!="number")return!1;const m=new monaco.Range(f.startLineNumber,f.startColumn,f.endLineNumber,f.endColumn);if(t.setSelection(m),r&&(monaco?.editor?.ScrollType?t.revealRangeInCenter(m,monaco.editor.ScrollType.Smooth):t.revealRangeInCenter(m)),this.currentJSONPathIndex=s,o||this.findWidgetIntegration&&this.findWidgetIntegration.enabled){const M=this.lastJSONPathMeta||{},I=typeof M.totalCount=="number"&&M.totalCount>0?M.totalCount:c.length;this.updateFindWidgetMatchesCount(I,!!M.truncated,s)}return!0}navigateJSONPathMatches(e=1,t=this.getActiveEditor(),i={}){const r=Array.isArray(this.lastJSONPathResults)?this.lastJSONPathResults:[];if(!t||r.length===0)return i.notify!==!1&&this.showNotification("No JSONPath matches to navigate","warning"),!1;let o=Number(e);(Number.isNaN(o)||o===0)&&(o=1);const c=r.length;let s=typeof this.currentJSONPathIndex=="number"?this.currentJSONPathIndex:-1;s<0||s>=c?s=o>0?0:c-1:s=(s+o+c)%c;const l=this.focusJSONPathMatch(s,t,{fromWidget:i.fromWidget,reveal:i.reveal!==!1});return!l&&i.notify!==!1&&this.showNotification("Unable to navigate to JSONPath match","warning"),l}updateFindWidgetMatchesCount(e,t,i=this.currentJSONPathIndex,r={}){const o=this.findWidgetIntegration;if(!o||!o.matchesElement)return;const c=o.matchesElement;if(r.reset){typeof o.originalMatchesText=="string"&&(c.textContent=o.originalMatchesText),c.removeAttribute("data-jsonpath"),c.removeAttribute("data-jsonpath-state"),c.removeAttribute("data-jsonpath-partial"),c.removeAttribute("title");return}if(!o.enabled&&!r.force)return;const s=(m,M="status",I={})=>{c.dataset.jsonpath="true",c.dataset.jsonpathState=M,I.partial?c.dataset.jsonpathPartial="true":c.removeAttribute("data-jsonpath-partial"),c.innerHTML="";const T=document.createElement("span");if(T.className="jsonpath-chip",T.textContent="JSONPath",c.appendChild(T),m){const g=document.createElement("span");g.className="jsonpath-status",g.textContent=m,c.appendChild(g)}I.title?c.title=I.title:m?c.title=`JSONPath \xB7 ${m}`:c.removeAttribute("title")};if(r.searching){s("searching\u2026");return}if(r.emptyQuery){s("enter path");return}if(r.noContent){s("no content");return}if(r.error){s("error","error");return}if(!e||e<=0){s("no results");return}const l=typeof i=="number"&&i>=0?i+1:1,d=`${l}/${e}`,f=t&&Array.isArray(this.lastJSONPathResults)&&this.lastJSONPathResults.length<e,h=f?`JSONPath results \xB7 ${l}/${e} (partial)`:`JSONPath results \xB7 ${l}/${e}`;s(d,"count",{partial:f,title:h})}performFindWidgetJSONPathSearch(e,t={}){const i=this.findWidgetIntegration;if(!i||!i.enabled)return;const r=typeof e=="string"?e.trim():"",o=!!t.immediate,c=typeof t.delay=="number"?t.delay:150;if(i.searchDebounce&&(clearTimeout(i.searchDebounce),i.searchDebounce=null),!r){this.resetJSONPathResults({keepQuery:!1}),this.lastJSONPathQuery="",this.updateFindWidgetMatchesCount(0,!1,-1,{emptyQuery:!0});return}const s=()=>{i.searchDebounce=null;const l=i.editor||this.getActiveEditor();l&&this.searchWithJSONPath(r,l,{notify:!1,revealFirst:t.revealFirst!==!1,fromWidget:!0})};if(this.updateFindWidgetMatchesCount(null,!1,-1,{searching:!0,force:!0}),o){s();return}i.searchDebounce=setTimeout(s,c)}setupFindWidgetIntegration(e){if(typeof document>"u")return;this.findWidgetIntegration?(this.findWidgetIntegration.editor=e,"resizeHandler"in this.findWidgetIntegration||(this.findWidgetIntegration.resizeHandler=null),"resizeObserver"in this.findWidgetIntegration||(this.findWidgetIntegration.resizeObserver=null),"layoutRaf"in this.findWidgetIntegration||(this.findWidgetIntegration.layoutRaf=null),"layoutScheduler"in this.findWidgetIntegration||(this.findWidgetIntegration.layoutScheduler="raf"),"lastLayoutWidth"in this.findWidgetIntegration||(this.findWidgetIntegration.lastLayoutWidth=null),"lastReservedPadding"in this.findWidgetIntegration||(this.findWidgetIntegration.lastReservedPadding=null)):this.findWidgetIntegration={editor:e,widget:null,toggleElement:null,matchesElement:null,inputElement:null,nextButton:null,prevButton:null,closeButton:null,enabled:!1,observer:null,searchDebounce:null,originalMatchesText:"",resizeHandler:null,resizeObserver:null,layoutRaf:null,layoutScheduler:"raf",lastLayoutWidth:null,lastReservedPadding:null};const t=this.findWidgetIntegration;(()=>{const r=document.querySelector(".editor-widget.find-widget");return r?(this.decorateFindWidget(r,t),!0):!1})()||t.observer||(t.observer=new MutationObserver(r=>{for(const o of r){if(o.addedNodes)for(const c of o.addedNodes){if(!c||c.nodeType!==1)continue;const s=c;if(s.classList.contains("find-widget")){this.decorateFindWidget(s,t);continue}const l=s.querySelector?s.querySelector(".editor-widget.find-widget, .find-widget"):null;if(l){const d=l.classList&&l.classList.contains("find-widget")?l:l.querySelector(".find-widget");d&&this.decorateFindWidget(d,t)}}if(o.removedNodes&&t.widget)for(const c of o.removedNodes)!c||c.nodeType!==1||(c===t.widget||c.contains&&c.contains(t.widget))&&this.handleFindWidgetRemoval()}}),t.observer.observe(document.body,{childList:!0,subtree:!0}))}async openFindWidget(e={}){const t=this.getActiveEditor();if(!t)return null;this.setupFindWidgetIntegration(t);const i=t.getAction&&t.getAction("actions.find");try{i&&typeof i.run=="function"?await i.run():t.trigger("keyboard","actions.find",null)}catch(c){console.warn("Find widget command failed, triggering fallback:",c),t.trigger("keyboard","actions.find",null)}const r=Date.now(),o=typeof requestAnimationFrame=="function"?requestAnimationFrame:c=>setTimeout(c,30);return new Promise(c=>{const s=()=>{const l=this.findWidgetIntegration;if(l&&l.widget&&l.inputElement){const d=l.inputElement,f=e.focus!==!1,h=e.select!==!1,m=e.notify===!0,M=typeof e.jsonPathMode=="boolean",I=M?e.jsonPathMode:null,T=typeof e.query=="string",y=(T?e.query:"").trim();T&&d.value!==y&&(d.value=y),M&&this.setFindWidgetJSONPathMode(I,{notify:m,focusInput:!1}),(!M||I!==!0)&&T&&d.dispatchEvent(new Event("input",{bubbles:!0})),f&&(d.focus(),h&&d.select()),c(l);return}if(Date.now()-r>1200){c(null);return}o(s)};s()})}decorateFindWidget(e,t=this.findWidgetIntegration){if(!t||!e||typeof e.querySelector!="function")return;e.dataset&&(e.dataset.jsonpathDecorated="true"),e.classList.add("jsonpath-extended"),t.widget=e,typeof window<"u"&&(t.resizeHandler&&window.removeEventListener("resize",t.resizeHandler),t.resizeHandler=window.debounce?window.debounce(()=>this.refreshFindWidgetLayout(),150):()=>this.refreshFindWidgetLayout(),window.addEventListener("resize",t.resizeHandler,{passive:!0})),typeof ResizeObserver<"u"&&(t.resizeObserver?t.resizeObserver.disconnect():t.resizeObserver=new ResizeObserver(()=>{this.refreshFindWidgetLayout()}),t.resizeObserver.observe(e));const i=e.querySelector(".matchesCount");i&&(t.matchesElement=i,t.originalMatchesText||(t.originalMatchesText=i.textContent||""));const r=e.querySelector(".controls");if(r&&r.classList.add("jsonpath-widget-controls"),r&&!e.querySelector("[data-jsonpath-toggle]")){const d=document.createElement("div");d.className="monaco-custom-toggle codicon codicon-symbol-structure",d.setAttribute("role","checkbox"),d.setAttribute("tabindex","0"),d.setAttribute("aria-checked","false"),d.setAttribute("aria-label","Use JSONPath (Alt+J)"),d.setAttribute("title","Use JSONPath (Alt+J)"),d.dataset.jsonpathToggle="true",d.classList.add("monaco-jsonpath-toggle");const f=h=>{h.preventDefault(),h.stopPropagation(),this.setFindWidgetJSONPathMode(!t.enabled,{notify:!0,focusInput:!0})};d.addEventListener("click",f),d.addEventListener("keydown",h=>{(h.key===" "||h.key==="Enter")&&f(h)}),r.firstChild?r.insertBefore(d,r.firstChild):r.appendChild(d),t.toggleElement=d}else r&&(t.toggleElement||(t.toggleElement=r.querySelector("[data-jsonpath-toggle]")),t.toggleElement&&t.toggleElement.classList.add("monaco-jsonpath-toggle"));const o=e.querySelector(".find-part .input");o&&(t.inputElement=o,o.dataset.jsonpathBound||(o.dataset.jsonpathBound="true",o.addEventListener("input",()=>{t.enabled&&this.performFindWidgetJSONPathSearch(o.value)}),o.addEventListener("keydown",d=>{if(t.enabled&&d.key==="Enter"){d.preventDefault(),d.stopPropagation();const f=o.value.trim();if(!f){this.updateFindWidgetMatchesCount(0,!1,-1,{emptyQuery:!0});return}if(f!==this.lastJSONPathQuery){this.performFindWidgetJSONPathSearch(f,{immediate:!0});return}const h=d.shiftKey?-1:1;this.navigateJSONPathMatches(h,t.editor,{fromWidget:!0,notify:!1})}})));const c=e.querySelector(".codicon-find-next-match");c&&(t.nextButton=c,c.dataset.jsonpathBound||(c.dataset.jsonpathBound="true",c.addEventListener("mousedown",d=>{t.enabled&&(d.preventDefault(),d.stopPropagation())}),c.addEventListener("click",d=>{if(!t.enabled)return;d.preventDefault(),d.stopPropagation();const f=t.inputElement?t.inputElement.value.trim():"";if(f&&f!==this.lastJSONPathQuery){this.performFindWidgetJSONPathSearch(f,{immediate:!0});return}this.navigateJSONPathMatches(1,t.editor,{fromWidget:!0,notify:!1})})));const s=e.querySelector(".codicon-find-previous-match");s&&(t.prevButton=s,s.dataset.jsonpathBound||(s.dataset.jsonpathBound="true",s.addEventListener("mousedown",d=>{t.enabled&&(d.preventDefault(),d.stopPropagation())}),s.addEventListener("click",d=>{if(!t.enabled)return;d.preventDefault(),d.stopPropagation();const f=t.inputElement?t.inputElement.value.trim():"";if(f&&f!==this.lastJSONPathQuery){this.performFindWidgetJSONPathSearch(f,{immediate:!0});return}this.navigateJSONPathMatches(-1,t.editor,{fromWidget:!0,notify:!1})})));const l=e.querySelector(".codicon-widget-close");if(l&&(t.closeButton=l,l.dataset.jsonpathBound||(l.dataset.jsonpathBound="true",l.addEventListener("click",()=>{t.enabled&&this.setFindWidgetJSONPathMode(!1,{notify:!1})}))),t.enabled){const d=this.lastJSONPathMeta||{},f=typeof d.totalCount=="number"&&d.totalCount>0?d.totalCount:Array.isArray(this.lastJSONPathResults)?this.lastJSONPathResults.length:0;f>0?this.updateFindWidgetMatchesCount(f,!!d.truncated,this.currentJSONPathIndex,{force:!0}):this.updateFindWidgetMatchesCount(0,!1,-1,{emptyQuery:!this.lastJSONPathQuery})}this.refreshFindWidgetLayout({immediate:!0})}refreshFindWidgetLayout(e={}){const t=this.findWidgetIntegration;if(!t||!t.widget)return;const i=t.widget;i.classList.add("jsonpath-extended");const r=typeof requestAnimationFrame=="function"?"raf":"timeout",o=r==="raf"?requestAnimationFrame:s=>setTimeout(s,20);t.layoutRaf!==null&&(t.layoutScheduler==="raf"&&typeof cancelAnimationFrame=="function"?cancelAnimationFrame(t.layoutRaf):clearTimeout(t.layoutRaf),t.layoutRaf=null),t.layoutScheduler=r;const c=()=>{t.layoutRaf=null;const s=typeof window<"u"&&window.innerWidth||0;let l=460;if(s>0){const g=s<600?24:48,y=s<1280?.62:.5,C=Math.round(s*y);l=Math.max(380,Math.min(720,s-g,C)),s<=520&&(l=Math.max(320,s-20))}let d=l;if(s>0){const g=Math.max(320,s-32);d=Math.min(l,g)}t.lastLayoutWidth!==d&&(i.style.width=`${d}px`,i.style.maxWidth="calc(100vw - 32px)",i.style.minWidth=`${Math.min(Math.max(d,320),420)}px`,t.lastLayoutWidth=d);const f=i.querySelector(".find-part");f&&(f.style.flex="1 1 auto",f.style.minWidth="0");const h=i.querySelector(".find-part .monaco-findInput");h&&(h.style.flex="1 1 auto",h.style.minWidth="0");const m=i.querySelector(".replace-part");m&&(m.style.flex="1 1 auto",m.style.minWidth="0");const M=i.querySelector(".find-part .controls");let I=88;if(M){M.classList.add("jsonpath-widget-controls");const g=M.getBoundingClientRect();g&&g.width?I=Math.max(72,Math.round(g.width)+12):M.children&&M.children.length&&(I=Math.max(72,M.children.length*24+12))}if(t.lastReservedPadding!==I){const g=(y,C,A)=>{const B=i.querySelector(y);if(!B)return;const X=B.querySelector(".input"),H=B.querySelector(".mirror"),le=Math.max(A,I-C);X&&(X.style.width=`calc(100% - ${le}px)`),H&&(H.style.paddingRight=`${le}px`)};g(".find-part .monaco-findInput",0,72),g(".replace-part .monaco-findInput",24,56),t.lastReservedPadding=I}const T=i.querySelector(".matchesCount");T&&(T.style.minWidth="96px",T.style.textAlign="right")};e.immediate&&c(),t.layoutRaf=o(()=>{c()})}toggleFindWidgetJSONPathMode(e){const t=this.getActiveEditor();if(!t)return;const i=this.findWidgetIntegration,r=typeof e=="boolean"?e:!(i&&i.enabled),o=()=>{this.setupFindWidgetIntegration(t);const c=this.findWidgetIntegration;c&&c.widget&&this.setFindWidgetJSONPathMode(r,{notify:!0,focusInput:!0})};if(!i||!i.widget){const c=t.getAction&&t.getAction("actions.find");c&&typeof c.run=="function"?c.run().then(()=>{setTimeout(o,0)}).catch(()=>{setTimeout(o,0)}):(t.trigger("keyboard","actions.find",null),setTimeout(o,0))}else o()}setFindWidgetJSONPathMode(e,t={}){const i=this.findWidgetIntegration;if(!i)return;const r=i.enabled;if(i.enabled=!!e,i.toggleElement){i.toggleElement.setAttribute("aria-checked",i.enabled?"true":"false"),i.toggleElement.classList.toggle("checked",i.enabled);const s=i.enabled?"Disable JSONPath (Alt+J)":"Use JSONPath (Alt+J)";i.toggleElement.setAttribute("aria-label",s),i.toggleElement.setAttribute("title",s)}if(i.widget&&i.widget.classList.toggle("jsonpath-mode",i.enabled),this.refreshFindWidgetLayout(),!i.enabled){i.searchDebounce&&(clearTimeout(i.searchDebounce),i.searchDebounce=null),this.updateFindWidgetMatchesCount(null,!1,-1,{reset:!0}),t.notify&&r!==i.enabled&&this.showNotification("JSONPath mode disabled in find widget","info");return}t.notify&&r!==i.enabled&&this.showNotification("JSONPath mode enabled in find widget","info");const o=i.inputElement;t.focusInput&&o&&(o.focus(),o.select());const c=o?o.value.trim():"";c?this.performFindWidgetJSONPathSearch(c,{immediate:!0}):this.updateFindWidgetMatchesCount(0,!1,-1,{emptyQuery:!0})}handleFindWidgetRemoval(){const e=this.findWidgetIntegration;if(e){if(e.searchDebounce&&(clearTimeout(e.searchDebounce),e.searchDebounce=null),e.layoutRaf!==null&&(e.layoutScheduler==="raf"&&typeof cancelAnimationFrame=="function"?cancelAnimationFrame(e.layoutRaf):clearTimeout(e.layoutRaf),e.layoutRaf=null),e.resizeObserver&&typeof e.resizeObserver.disconnect=="function"&&(e.resizeObserver.disconnect(),e.resizeObserver=null),e.resizeHandler&&typeof window<"u"&&(window.removeEventListener("resize",e.resizeHandler),e.resizeHandler=null),e.widget){e.widget.classList.remove("jsonpath-extended","jsonpath-mode"),e.widget.style.removeProperty("width"),e.widget.style.removeProperty("maxWidth"),e.widget.style.removeProperty("minWidth");const t=e.widget.querySelector(".find-part .input"),i=e.widget.querySelector(".find-part .mirror");t&&t.style.removeProperty("width"),i&&i.style.removeProperty("padding-right");const r=e.widget.querySelector(".replace-part .input"),o=e.widget.querySelector(".replace-part .mirror");r&&r.style.removeProperty("width"),o&&o.style.removeProperty("padding-right")}e.lastLayoutWidth=null,e.lastReservedPadding=null,e.widget=null,e.toggleElement=null,e.matchesElement=null,e.inputElement=null,e.nextButton=null,e.prevButton=null,e.closeButton=null,e.enabled=!1}}startHealthMonitoring(){this.healthMonitoring.enabled||(this.healthMonitoring.enabled=!0,this.healthMonitoring.interval=setInterval(()=>{this.updateHealthStats()},5e3),console.log("\u{1F48A} Health monitoring started"))}updateHealthStats(){try{const e={timestamp:Date.now(),workerPool:this.workerPool?this.workerPool.getStats():null,searchIndex:this.searchIndex&&typeof this.searchIndex.getStats=="function"?this.searchIndex.getStats():null,performance:this.performanceController&&typeof this.performanceController.getStats=="function"?this.performanceController.getStats():null,memory:performance.memory?{used:Math.round(performance.memory.usedJSHeapSize/1024/1024),total:Math.round(performance.memory.totalJSHeapSize/1024/1024),limit:Math.round(performance.memory.jsHeapSizeLimit/1024/1024)}:null};this.healthMonitoring.stats=e,e.workerPool&&e.workerPool.queued>10&&console.warn("\u26A0\uFE0F Worker pool queue is growing:",e.workerPool.queued),e.memory&&e.memory.used>e.memory.limit*.8&&console.warn("\u26A0\uFE0F Memory usage high:",e.memory)}catch(e){console.error("Health monitoring error:",e)}}getHealthStats(){return this.healthMonitoring.stats}showPerformanceBadge(){const e=this.getHealthStats();if(!e)return;let t=document.getElementById("performanceBadge");t||(t=document.createElement("div"),t.id="performanceBadge",t.className="perf-monitor",document.body.appendChild(t));const i=[];e.workerPool&&(i.push(`Workers: ${e.workerPool.busy}/${e.workerPool.workers}`),e.workerPool.queued>0&&i.push(`Queue: ${e.workerPool.queued}`)),e.memory&&i.push(`RAM: ${e.memory.used}MB`),t.textContent=i.join(" | "),t.classList.add("show")}dispose(){this.healthMonitoring.interval&&(clearInterval(this.healthMonitoring.interval),this.healthMonitoring.interval=null,this.healthMonitoring.enabled=!1),this.editors.forEach(e=>{e.virtualRenderer&&e.virtualRenderer.dispose(),e.dispose()}),this.editors.clear(),this.diffEditor&&(this.diffEditor.dispose(),this.diffEditor=null),this.workerPool&&this.workerPool.terminate(),this.searchIndex&&typeof this.searchIndex.clear=="function"&&this.searchIndex.clear(),this.findWidgetIntegration&&(this.handleFindWidgetRemoval(),this.findWidgetIntegration.observer&&(this.findWidgetIntegration.observer.disconnect(),this.findWidgetIntegration.observer=null),this.findWidgetIntegration.searchDebounce&&(clearTimeout(this.findWidgetIntegration.searchDebounce),this.findWidgetIntegration.searchDebounce=null),this.findWidgetIntegration=null),this.isInitialized=!1}}const monacoInitializer=new MonacoInitializer;let monacoInitializationPromise=null,monacoReadyEventDispatched=!1;function dispatchMonacoReadyEvent(){if(monacoReadyEventDispatched||(monacoReadyEventDispatched=!0,typeof window>"u"||typeof window.dispatchEvent!="function"))return;let n=null;typeof window.CustomEvent=="function"?n=new CustomEvent("monaco:ready",{detail:{initializer:monacoInitializer}}):typeof document<"u"&&typeof document.createEvent=="function"&&(n=document.createEvent("Event"),n.initEvent("monaco:ready",!1,!1),n.detail={initializer:monacoInitializer}),n&&window.dispatchEvent(n)}function bootstrapMonacoInitializer(){if(!monacoInitializationPromise){try{monacoInitializationPromise=monacoInitializer.initialize()}catch(n){console.error(n),monacoInitializationPromise=Promise.reject(n)}monacoInitializationPromise.then(dispatchMonacoReadyEvent).catch(n=>{console.error(n)})}return monacoInitializationPromise}window.addEventListener("monaco:loaded",()=>{console.log("\u{1F680} [Lazy Init] monaco:loaded event received, initializing editor..."),bootstrapMonacoInitializer()}),window.bootstrapMonacoInitializer=bootstrapMonacoInitializer,typeof window<"u"&&(window.monacoInitializer=monacoInitializer,window.renderHistoryModal=renderHistoryModal);
