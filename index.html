<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iMock - Wiremock UI Client</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- CSS files in logical loading order -->
    <link rel="stylesheet" href="styles/animations.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/modals.css">
    <link rel="stylesheet" href="styles/main.css">
</head>
<body data-theme="light">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: none;" aria-hidden="true">
        <symbol id="icon-logo" viewBox="0 0 24 24">
            <path d="M12 2.5c-5.24 0-9.5 4.26-9.5 9.5s4.26 9.5 9.5 9.5c3.02 0 5.72-1.39 7.45-3.58a1 1 0 00-.78-1.62h-5.17a2.75 2.75 0 110-5.5h5.17a1 1 0 00.78-1.62C17.72 3.89 15.02 2.5 12 2.5z" fill="currentColor"/>
        </symbol>
        <symbol id="icon-moon" viewBox="0 0 24 24">
            <path d="M21 12.79A9 9 0 0111.21 3 7 7 0 0012 21a7 7 0 009-8.21z" fill="currentColor"/>
        </symbol>
        <symbol id="icon-sun" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="4" fill="currentColor"/>
            <path d="M12 3v2M12 19v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M3 12h2M19 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="icon-clipboard" viewBox="0 0 24 24">
            <path d="M9 4h6a2 2 0 012 2v12a2 2 0 01-2 2H9a2 2 0 01-2-2V6a2 2 0 012-2z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <path d="M9 2.75A1.75 1.75 0 0110.75 1h2.5A1.75 1.75 0 0115 2.75V4H9z" fill="currentColor"/>
        </symbol>
        <symbol id="icon-inbox" viewBox="0 0 24 24">
            <path d="M4.75 6.5A1.75 1.75 0 016.5 4.75h11a1.75 1.75 0 011.75 1.75v6a1.75 1.75 0 01-1.75 1.75h-2.94a2.06 2.06 0 00-1.46.6l-.7.7a2.06 2.06 0 01-1.46.6h-1.48a2.06 2.06 0 01-1.46-.6l-.7-.7a2.06 2.06 0 00-1.46-.6H6.5A1.75 1.75 0 014.75 12.5z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <path d="M12 7v4m0 0l2-2m-2 2l-2-2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="icon-masks" viewBox="0 0 24 24">
            <path d="M5 6a4 4 0 014-4h6a4 4 0 014 4v5a4 4 0 01-4 4h-2l-2 2-2-2H9a4 4 0 01-4-4z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <path d="M9 9a1 1 0 11-2 0m8 0a1 1 0 11-2 0" fill="currentColor"/>
            <path d="M8.5 11.5c1.5 1 3.5 1 5 0" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="icon-box" viewBox="0 0 24 24">
            <path d="M3.5 7.5L12 3l8.5 4.5v9L12 21l-8.5-4.5z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <path d="M12 21v-9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M20.5 7.5l-8.5 4.5L3.5 7.5" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
        </symbol>
        <symbol id="icon-mic" viewBox="0 0 24 24">
            <rect x="9" y="4" width="6" height="10" rx="3" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <path d="M5 10a7 7 0 0014 0" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M12 20v-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M9 20h6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="icon-settings" viewBox="0 0 24 24">
            <path d="M10.325 4.317a1.75 1.75 0 013.35 0l.287.955a1.75 1.75 0 001.651 1.224h1.003a1.75 1.75 0 011.237 2.987l-.725.725a1.75 1.75 0 000 2.475l.725.725a1.75 1.75 0 01-1.237 2.987h-1.003a1.75 1.75 0 00-1.651 1.224l-.287.955a1.75 1.75 0 01-3.35 0l-.287-.955a1.75 1.75 0 00-1.651-1.224H8.384a1.75 1.75 0 01-1.237-2.987l.725-.725a1.75 1.75 0 000-2.475l-.725-.725a1.75 1.75 0 011.237-2.987h1.003a1.75 1.75 0 001.651-1.224z" fill="none" stroke="currentColor" stroke-width="1.3"/>
            <circle cx="12" cy="12" r="3" fill="currentColor"/>
        </symbol>
        <symbol id="icon-refresh" viewBox="0 0 24 24">
            <path d="M4.5 12a7.5 7.5 0 0112.73-5.3L19.5 9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            <path d="M19.5 6v3a1 1 0 01-1 1h-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            <path d="M19.5 12a7.5 7.5 0 01-12.73 5.3L4.5 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            <path d="M4.5 18v-3a1 1 0 011-1h3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
        </symbol>
        <symbol id="icon-bolt" viewBox="0 0 24 24">
            <path d="M11 2L5 13h5v9l6-11h-5z" fill="currentColor"/>
        </symbol>
        <symbol id="icon-plus" viewBox="0 0 24 24">
            <path d="M12 5v14m-7-7h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="icon-trash" viewBox="0 0 24 24">
            <path d="M5 7h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M6 7l1 12a2 2 0 002 2h6a2 2 0 002-2l1-12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 11v6m4-6v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="icon-pencil" viewBox="0 0 24 24">
            <path d="M4 17.5V20h2.5l11-11-2.5-2.5-11 11z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <path d="M14.5 4.5l2.5 2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="icon-open-external" viewBox="0 0 24 24">
            <path d="M13 5h6v6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M11 13l8-8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M19 13v5a2 2 0 01-2 2H7a2 2 0 01-2-2V7a2 2 0 012-2h5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="icon-check-circle" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <path d="M9.5 12.5l2 2 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="icon-x-circle" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <path d="M9.5 9.5l5 5m0-5l-5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="icon-request-in" viewBox="0 0 24 24">
            <path d="M6 6a2 2 0 012-2h8a2 2 0 012 2v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M7 12l5 5 5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 17V6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="icon-response-out" viewBox="0 0 24 24">
            <path d="M18 18a2 2 0 01-2 2H8a2 2 0 01-2-2v-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M12 7v11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M7 11l5-5 5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="icon-info" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5" fill="none"/>
            <path d="M12 8h.01M11 11h1v4h1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="icon-broom" viewBox="0 0 24 24">
            <path d="M4 16l4 4 10-10-4-4z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <path d="M16 6l3-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="icon-save" viewBox="0 0 24 24">
            <path d="M5 5a2 2 0 012-2h9l3 3v13a2 2 0 01-2 2H7a2 2 0 01-2-2z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <path d="M9 3v5h6V3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <rect x="9" y="13" width="6" height="5" rx="1" fill="currentColor"/>
        </symbol>
        <symbol id="icon-play" viewBox="0 0 24 24">
            <path d="M8 5v14l10-7z" fill="currentColor"/>
        </symbol>
        <symbol id="icon-stop" viewBox="0 0 24 24">
            <rect x="7" y="7" width="10" height="10" rx="1.5" fill="currentColor"/>
        </symbol>
    </svg>
    <div class="header">
        <div class="logo">
            <span class="logo-mark" aria-hidden="true">
                <svg class="icon icon-logo" focusable="false">
                    <use href="#icon-logo"></use>
                </svg>
            </span>
            <span class="logo-text">iMock</span>
            <span class="version">v2.2</span>
        </div>
        <div class="status">
            <div class="status-indicator">
                <div class="status-dot" id="status-dot"></div>
                <span id="status-text">Disconnected</span>
                <span id="health-indicator" style="display: none; margin-left: 10px; font-size: 0.9em;"></span>
            </div>
            <button class="theme-toggle" onclick="if(typeof toggleTheme === 'function') toggleTheme()">
                <svg class="icon" aria-hidden="true" focusable="false">
                    <use id="theme-icon" href="#icon-moon"></use>
                </svg>
                <span class="sr-only">Toggle theme</span>
            </button>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="nav-item active" onclick="showPage('mappings', this)">
                <svg class="icon nav-icon" aria-hidden="true" focusable="false"><use href="#icon-clipboard"></use></svg>
                <span>Mappings</span>
            </div>
            <div class="nav-item" onclick="showPage('requests', this)">
                <svg class="icon nav-icon" aria-hidden="true" focusable="false"><use href="#icon-inbox"></use></svg>
                <span>Request Log</span>
            </div>
            <div class="nav-item" onclick="showPage('scenarios', this)">
                <svg class="icon nav-icon" aria-hidden="true" focusable="false"><use href="#icon-masks"></use></svg>
                <span>Scenarios</span>
            </div>
            <div class="nav-item" onclick="showPage('import-export', this)">
                <svg class="icon nav-icon" aria-hidden="true" focusable="false"><use href="#icon-box"></use></svg>
                <span>Import/Export</span>
            </div>
            <div class="nav-item" onclick="showPage('recording', this)">
                <svg class="icon nav-icon" aria-hidden="true" focusable="false"><use href="#icon-mic"></use></svg>
                <span>Recording</span>
            </div>
            <div class="nav-item" onclick="showPage('settings', this)">
                <svg class="icon nav-icon" aria-hidden="true" focusable="false"><use href="#icon-settings"></use></svg>
                <span>Settings</span>
            </div>
        </div>
        
        <div class="main-content">
            <!-- MAPPINGS PAGE -->
            <div id="mappings-page">
                <div class="page-header">
                    <div class="stats-spacer" id="stats-spacer"></div>
                    <div class="stats" id="stats" style="display: none;">
                        <div class="stat-card">
                            <div class="stat-number" id="mappings-count">0</div>
                            <div class="stat-label">Mappings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="requests-count">0</div>
                            <div class="stat-label">Requests</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="scenarios-count">0</div>
                            <div class="stat-label">Scenarios</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="uptime">0s</div>
                            <div class="stat-label">Uptime</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: var(--space-3); align-items: center;">
                        <span id="data-source-indicator" class="badge badge-secondary" title="Current data source">Source: direct</span>
                        <button class="btn btn-secondary" onclick="refreshMappings()">
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-refresh"></use></svg>
                            <span>Refresh</span>
                        </button>
                        <button class="btn btn-secondary" onclick="forceRefreshCache()" title="Rebuild the service cache mapping and reload">
                            <span class="btn-spinner loading-spinner" aria-hidden="true"></span>
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-bolt"></use></svg>
                            <span class="btn-label">Force Refresh Cache</span>
                        </button>
                        <button class="btn btn-primary" onclick="openAddMappingModal()" id="add-mapping-btn" disabled>
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-plus"></use></svg>
                            <span>Add Mapping</span>
                        </button>
                    </div>
                </div>

                <div class="card" id="connection-setup">
                    <div class="card-header">
                        <h3 class="card-title">Connect to WireMock Server</h3>
                    </div>
                    <p style="margin-bottom: var(--space-6); color: var(--text-secondary);">Enter your WireMock server details to get started:</p>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Host</label>
                            <input type="text" class="form-input" id="wiremock-host" value="localhost">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Port</label>
                            <input type="number" class="form-input" id="wiremock-port" value="8080">
                        </div>
                        <div class="form-group" style="display: flex; gap: var(--space-2); align-items: end;">
                            <button class="btn btn-success" onclick="connectToWireMock()">Connect</button>
                            <button class="btn btn-secondary" onclick="loadMockData()">Demo Mode</button>
                            <button class="btn btn-warning" onclick="checkHealth()">Health Check</button>
                        </div>
                    </div>
                </div>
                
                
                <div class="search-filters" id="search-filters" style="display: none;">
                    <div class="filter-grid">
                        <div class="form-group">
                            <label class="form-label">Method</label>
                            <select class="form-select" id="filter-method" onchange="applyFilters()">
                                <option value="">All Methods</option>
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                                <option value="PATCH">PATCH</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Search by URL or Name</label>
                            <input type="text" class="form-input" id="filter-url" placeholder="Enter URL or Name" oninput="applyFilters()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <input type="number" class="form-input" id="filter-status" placeholder="e.g., 200" min="100" max="599" oninput="applyFilters()">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" onclick="clearMappingFilters()">Clear Filters</button>
                        </div>
                    </div>
                </div>
                
                <div id="mappings-loading" class="loading hidden">Loading mappings...</div>
                <div id="mappings-list-container">
                    <div id="mappings-empty" class="empty-state hidden">
                        <h3>No mappings found</h3>
                        <p>Connect to WireMock server or use Demo Mode to see mappings.</p>
                    </div>
                    <div class="cards-container" id="mappings-list" style="display: none;">
                        <!-- Mapping items will be dynamically inserted here -->
                    </div>
                </div>
            </div>
            
            <!-- REQUESTS PAGE -->
            <div id="requests-page" class="hidden">
                <div class="page-header">
                    <div class="page-title">Request Log</div>
                    <div style="display: flex; gap: var(--space-2); align-items: center;">
                        <span id="requests-source-indicator" class="badge badge-secondary" title="Current data source">Requests: direct</span>
                        <button class="btn btn-secondary" onclick="refreshRequests()">
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-refresh"></use></svg>
                            <span>Refresh</span>
                        </button>
                        <button class="btn btn-danger" onclick="clearRequests()">
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-trash"></use></svg>
                            <span>Clear Log</span>
                        </button>
                        <button class="btn btn-secondary" onclick="clearRequestFilters()">
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-broom"></use></svg>
                            <span>Clear Filters</span>
                        </button>
                    </div>
                </div>
                
                <div class="search-filters">
                    <!-- First row: Basic filters -->
                    <div class="filter-grid">
                        <div class="form-group">
                            <label class="form-label">Method</label>
                            <select class="form-select" id="req-filter-method" onchange="applyRequestFilters()">
                                <option value="">All Methods</option>
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                                <option value="PATCH">PATCH</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="req-filter-status" onchange="applyRequestFilters()">
                                <option value="">All Statuses</option>
                                <option value="matched">Matched</option>
                                <option value="unmatched">Unmatched</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">URL Pattern</label>
                            <input type="text" class="form-input" id="req-filter-url" placeholder="e.g., /api/*" oninput="applyRequestFilters()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quick Filter</label>
                            <select class="form-select" id="req-filter-quick" onchange="applyQuickFilter()">
                                <option value="">Select time range</option>
                                <option value="5m">Last 5 minutes</option>
                                <option value="15m">Last 15 minutes</option>
                                <option value="30m">Last 30 minutes</option>
                                <option value="1h">Last 1 hour</option>
                                <option value="3h">Last 3 hours</option>
                                <option value="6h">Last 6 hours</option>
                                <option value="12h">Last 12 hours</option>
                                <option value="1d">Last 1 day</option>
                                <option value="3d">Last 3 days</option>
                                <option value="7d">Last 7 days</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Second row: Time Range -->
                    <div class="filter-grid" style="margin-top: var(--space-3);">
                        <div class="form-group">
                            <label class="form-label">Custom Time Range</label>
                            <div style="display: flex; gap: var(--space-2);">
                                <input type="datetime-local" class="form-input" id="req-filter-from" onchange="clearQuickFilter(); applyRequestFilters()" style="flex: 1;" placeholder="From">
                                <input type="datetime-local" class="form-input" id="req-filter-to" onchange="clearQuickFilter(); applyRequestFilters()" style="flex: 1;" placeholder="To">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="requests-loading" class="loading hidden">Loading requests...</div>
                <div id="requests-list-container">
                    <div id="requests-empty" class="empty-state hidden">
                        <h3>No requests logged</h3>
                        <p>Make some API calls to see them here.</p>
                    </div>
                    <div class="cards-container" id="requests-list" style="display: none;">
                        <!-- Request items will be dynamically inserted here -->
                    </div>
                </div>
            </div>
            
            <!-- SCENARIOS PAGE -->
            <div id="scenarios-page" class="hidden">
                <div class="page-header">
                    <div class="page-title">Scenario Management</div>
                    <div style="display: flex; gap: var(--space-2);">
                        <button class="btn btn-secondary" onclick="refreshScenarios()">
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-refresh"></use></svg>
                            <span>Refresh</span>
                        </button>
                        <button class="btn btn-danger" onclick="resetAllScenarios()">
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-refresh"></use></svg>
                            <span>Reset All</span>
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Scenario State Control</h3>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Scenario</label>
                            <select class="form-select" id="scenario-select">
                                <option value="">Select Scenario</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Set State</label>
                            <input type="text" class="form-input" id="scenario-state" placeholder="Enter state name" list="scenario-state-options">
                            <datalist id="scenario-state-options"></datalist>
                        </div>
                        <div class="form-group" style="display: flex; align-items: end;">
                            <button class="btn btn-primary" id="scenario-update-btn" onclick="updateScenarioState()">Update State</button>
                        </div>
                    </div>
                </div>
                
                <div id="scenarios-loading" class="loading hidden">Loading scenarios...</div>
                <div id="scenarios-list-container">
                    <div id="scenarios-empty" class="empty-state hidden">
                        <h3>No scenarios found</h3>
                        <p>Create mappings with scenarios to manage state here.</p>
                    </div>
                    <div class="cards-container" id="scenarios-list" style="display: none;">
                        <!-- Scenario items will be dynamically inserted here -->
                    </div>
                </div>
            </div>
            
            <!-- IMPORT/EXPORT PAGE -->
            <div id="import-export-page" class="hidden">
                <div class="page-header">
                    <div class="page-title">Import/Export</div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6);">
                    <!-- Export Section -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg class="icon icon-inline" aria-hidden="true" focusable="false"><use href="#icon-response-out"></use></svg>
                                Export Data
                            </h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Export Format</label>
                            <select class="form-select" id="export-format">
                                <option value="json">JSON</option>
                                <option value="yaml">YAML</option>
                            </select>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: var(--space-3);">
                            <button class="btn btn-primary" onclick="exportMappings()">
                                <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-response-out"></use></svg>
                                <span>Export All Mappings</span>
                            </button>
                            <button class="btn btn-secondary" onclick="exportRequests()">
                                <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-response-out"></use></svg>
                                <span>Export Request Log</span>
                            </button>
                        </div>
                        <div id="export-result" style="margin-top: var(--space-4);"></div>
                        <p class="form-help" style="margin-top: var(--space-3);">
                            Looking for ready-made mocks? Explore the <a href="https://library.wiremock.org/" target="_blank" rel="noopener">WireMock Templates Library</a> for example mappings you can import or adapt.</p>
                    </div>
                    
                    <!-- Import Section -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <svg class="icon icon-inline" aria-hidden="true" focusable="false"><use href="#icon-request-in"></use></svg>
                                Import Data
                            </h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Import File</label>
                            <div class="file-input-container">
                                <input type="file" class="file-input" id="import-file" accept=".json,.yaml,.yml" onchange="updateFileDisplay()">
                                <label for="import-file" class="btn btn-secondary" style="width: 100%; justify-content: center;">
                                    <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-box"></use></svg>
                                    <span>Choose File</span>
                                </label>
                                <div class="file-display" style="margin-top: var(--space-2); padding: var(--space-3); background: var(--bg-secondary); border-radius: var(--radius-md); text-align: center; color: var(--text-secondary);" id="file-display">
                                    <span class="file-placeholder">No file selected</span>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Import Mode</label>
                            <select class="form-select" id="import-mode">
                                <option value="MERGE">MERGE (default)</option>
                                <option value="OVERWRITE">OVERWRITE</option>
                                <option value="DELETE_ALL">DELETE_ALL</option>
                                <option value="STANDARD">STANDARD</option>
                            </select>
                            <p class="form-help">Select how WireMock should handle existing mappings during import.</p>
                        </div>
                        <div class="form-group" id="import-actions" style="display: none;">
                            <button class="btn btn-primary" id="import-submit-btn" onclick="executeImportFromUi()">
                                <span class="btn-spinner loading-spinner" aria-hidden="true"></span>
                                <span class="btn-label">
                                    <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-request-in"></use></svg>
                                    <span>Import</span>
                                </span>
                            </button>
                        </div>
                        <div id="import-result" style="margin-top: var(--space-4);"></div>
                    </div>
                </div>
            </div>
            
            <!-- RECORDING PAGE -->
            <div id="recording-page" class="hidden">
                <div class="page-header">
                    <div class="page-title">Recording</div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg class="icon icon-inline" aria-hidden="true" focusable="false"><use href="#icon-mic"></use></svg>
                            Record API Calls
                        </h3>
                    </div>
                    <p style="margin-bottom: var(--space-4); color: var(--text-secondary);">Configure recording settings to capture real API calls and generate mappings automatically.</p>
                    <p class="form-help" style="margin-bottom: var(--space-4);">Need the classic recorder interface? Open <a id="recorder-link" href="" target="_blank" rel="noopener">configure host to enable link</a>.</p>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Target URL</label>
                            <input type="text" class="form-input" id="record-target-url" placeholder="https://api.example.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Recording Mode</label>
                            <select class="form-select" id="record-mode">
                                <option value="record">Record</option>
                                <option value="snapshot">Snapshot</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: flex; gap: var(--space-3); margin-top: var(--space-4);">
                        <button class="btn btn-success" onclick="startRecording()">
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-play"></use></svg>
                            <span>Start Recording</span>
                        </button>
                        <button class="btn btn-danger" onclick="stopRecording()">
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-stop"></use></svg>
                            <span>Stop Recording</span>
                        </button>
                        <button class="btn btn-secondary" onclick="clearRecordings()">
                            <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-trash"></use></svg>
                            <span>Clear Recordings</span>
                        </button>
                    </div>

                    <div id="recording-status" style="margin-top: var(--space-4);"></div>
                    </div>

                <div id="recordings-list" style="margin-top: var(--space-6);">
                    <!-- Recorded mappings will appear here -->
                </div>
            </div>
            
            <!-- SETTINGS PAGE -->
            <div id="settings-page" class="hidden">
                <div class="page-header">
                    <div class="page-title">Settings</div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6);">
                    <!-- General Settings -->
                    <div class="card">
                        <div class="card-header">
                        <h3 class="card-title">
                            <svg class="icon icon-inline" aria-hidden="true" focusable="false"><use href="#icon-settings"></use></svg>
                            General Settings
                        </h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Theme</label>
                            <select class="form-select" id="theme-select" onchange="changeTheme()">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="auto">Auto</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Auto-refresh Interval (seconds)</label>
                            <input type="number" class="form-input" id="refresh-interval" value="" min="0" max="300">
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="auto-refresh-enabled"> Enable Auto-refresh
                            </label>
                        </div>
                    </div>
                    
                    <!-- Connection Settings -->
                    <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <svg class="icon icon-inline" aria-hidden="true" focusable="false"><use href="#icon-settings"></use></svg>
                            Connection Settings
                        </h3>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Default Host</label>
                            <input type="text" class="form-input" id="default-host" value="">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Default Port</label>
                            <input type="number" class="form-input" id="default-port" value="">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Request Timeout (ms)</label>
                            <input type="number" class="form-input" id="request-timeout" value="" min="1000" max="600000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Authorization Header</label>
                            <input type="text" class="form-input" id="auth-header" placeholder="Bearer token123 or Basic dXNlcjpwYXNz">
                            <small class="form-help">Optional. Will be added to all WireMock API requests</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="cache-enabled"> Enable Cache </label>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: var(--space-6); text-align: center;">
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-save"></use></svg>
                        <span>Save Settings</span>
                    </button>
                    <button class="btn btn-secondary" onclick="resetSettings()">
                        <svg class="icon" aria-hidden="true" focusable="false"><use href="#icon-refresh"></use></svg>
                        <span>Reset to Defaults</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL FOR ADDING/EDITING MAPPINGS -->
    <div id="add-mapping-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn btn-primary" onclick="saveMappingWrapper()">Save Mapping</button>
                <h3 id="modal-title">Add New Mapping</h3>
                <button class="modal-close" onclick="hideModal('add-mapping-modal')">&times;</button>
            </div>
            <form id="mapping-form">
                <input type="hidden" id="mapping-id">
                
                <div class="form-group">
                    <label class="form-label">Mapping Name</label>
                    <input type="text" class="form-input" id="mapping-name" placeholder="Enter mapping name">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Method</label>
                        <select class="form-select" id="method">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                            <option value="PATCH">PATCH</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">URL Pattern</label>
                        <input type="text" class="form-input" id="url-pattern" placeholder="/api/users" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Response Status</label>
                    <input type="number" class="form-input" id="response-status" value="200" min="100" max="599">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Response Body</label>
                    <textarea class="form-textarea" id="response-body" rows="6" placeholder='{ "message": "Hello World" }'></textarea>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL FOR EDITING MAPPINGS -->
    <div id="edit-mapping-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-header-main">
                    <h3 id="edit-modal-title">Edit Mapping</h3>
                    <span id="editor-dirty-indicator" class="dirty-indicator" style="display: none;">‚óè Unsaved changes</span>
                </div>
                <div class="modal-header-actions">
                    <button type="button" class="btn btn-secondary btn-sm" data-action="format-json">Format</button>
                    <button type="button" class="btn btn-secondary btn-sm" data-action="minify-json">Minify</button>
                    <button type="button" class="btn btn-primary" id="update-mapping-btn" onclick="updateMapping()">
                        <span class="btn-label">Update Mapping</span>
                        <span class="btn-spinner loading-spinner" aria-hidden="true"></span>
                    </button>
                    <button class="modal-close" onclick="hideModal('edit-mapping-modal')">&times;</button>
                </div>
            </div>
            
            <!-- Form Editor (Hidden by default) -->
            <div id="form-editor-container" style="display: none;">
            <form id="edit-mapping-form">
                <input type="hidden" id="edit-mapping-id">
                
                <div class="form-group">
                    <label class="form-label">Mapping Name</label>
                    <input type="text" class="form-input" id="edit-mapping-name" placeholder="Enter mapping name">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Method</label>
                        <select class="form-select" id="edit-method">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                            <option value="PATCH">PATCH</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">URL Pattern</label>
                        <input type="text" class="form-input" id="edit-url-pattern" placeholder="/api/users" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Response Status</label>
                    <input type="number" class="form-input" id="edit-response-status" value="200" min="100" max="599">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Response Delay (ms)</label>
                    <input type="number" class="form-input" id="edit-response-delay" placeholder="Delay in milliseconds">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Request Headers (JSON)</label>
                    <textarea class="form-textarea" id="edit-request-headers" rows="3" placeholder='{ "Content-Type": "application/json" }'></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Request Body</label>
                    <textarea class="form-textarea" id="edit-request-body" rows="3" placeholder='{ "name": "example" }'></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Response Headers (JSON)</label>
                    <textarea class="form-textarea" id="edit-response-headers" rows="3" placeholder='{ "Content-Type": "application/json" }'></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Response Body</label>
                    <textarea class="form-textarea" id="edit-response-body" rows="6" placeholder='{ "message": "Hello World" }'></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Priority</label>
                        <input type="number" class="form-input" id="edit-mapping-priority" placeholder="Priority">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Scenario Name</label>
                        <input type="text" class="form-input" id="edit-mapping-scenario" placeholder="Scenario name">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Required Scenario State</label>
                        <input type="text" class="form-input" id="edit-required-scenario-state" placeholder="State required to match">
                    </div>
                    <div class="form-group">
                        <label class="form-label">New Scenario State</label>
                        <input type="text" class="form-input" id="edit-new-scenario-state" placeholder="State after match">
                    </div>
                </div>
            </form>
            </div>
            
            <!-- JSON Editor Container -->
            <div id="json-editor-container" class="json-editor-wrapper">
                <textarea id="json-editor" class="json-editor" rows="1" placeholder="{
  \"name\": \"My Mapping\",
  \"request\": {
    \"method\": \"GET\",
    \"url\": \"/api/example\"
  },
  \"response\": {
    \"status\": 200,
    \"body\": \"{\\\"message\\\":\\\"Hello World\\\"}\",
    \"headers\": {
      \"Content-Type\": \"application/json\"
    }
  }
}"></textarea>
            </div>
        </div>
    </div>

    <!-- MODAL FOR REQUEST DETAILS -->
    <div id="request-details-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Request Details</h3>
                <button class="modal-close" onclick="hideModal('request-details-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="request-details-content">
                    <!-- Request details will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideModal('request-details-modal')">Close</button>
            </div>
        </div>
    </div>

    <!-- MODAL FOR MAPPING DETAILS -->
    <div id="mapping-details-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Mapping Details</h3>
                <button class="modal-close" onclick="hideModal('mapping-details-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="mapping-details-content">
                    <!-- Mapping details will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideModal('mapping-details-modal')">Close</button>
            </div>
        </div>
    </div>

<!-- JavaScript modules in loading order -->
<script src="js/vendor-js-yaml.min.js"></script>
<script src="js/core.js"></script>
<script src="js/managers.js"></script>
<script src="js/features.js"></script>
<script src="js/editor.js"></script>
<script src="js/main.js"></script>

</body>
</html>
